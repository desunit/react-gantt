{"version":3,"file":"index.es.js","sources":["../src/context.js","../src/helpers/locate.js","../src/helpers/reorder.js","../src/components/grid/TextCell.jsx","../src/components/grid/ActionCell.jsx","../src/components/grid/Grid.jsx","../src/components/chart/CellGrid.jsx","../src/components/chart/Links.jsx","../src/components/chart/BarSegments.jsx","../src/components/chart/Bars.jsx","../src/components/chart/TimeScale.jsx","../src/helpers/debug.js","../src/components/chart/Chart.jsx","../src/components/Resizer.jsx","../src/helpers/modeResizeObserver.js","../src/components/Layout.jsx","../src/helpers/prepareConfig.js","../src/components/Gantt.jsx","../src/components/Toolbar.jsx","../src/components/ContextMenu.jsx","../src/components/editor/Links.jsx","../src/components/editor/DateTimePicker.jsx","../src/components/Editor.jsx","../src/components/grid/HeaderMenu.jsx","../src/widgets/Tooltip.jsx","../src/themes/Material.jsx","../src/themes/Willow.jsx","../src/themes/WillowDark.jsx"],"sourcesContent":["import { createContext } from 'react';\n\nconst store = createContext(null);\nexport default store;\n","export function getID(node) {\n  const id = node.getAttribute('data-id');\n  const numId = parseInt(id);\n  return isNaN(numId) || numId.toString() != id ? id : numId;\n}\n","import { getID } from './locate';\nimport { locate } from '@svar-ui/lib-dom';\n\nfunction getOffset(node, relative, ev) {\n  const box = node.getBoundingClientRect();\n  const base = relative.querySelector('.wx-body').getBoundingClientRect();\n\n  return {\n    top: box.top - base.top,\n    left: box.left - base.left,\n    dt: box.bottom - ev.clientY,\n    db: ev.clientY - box.top,\n  };\n}\n\nfunction checkSource(node) {\n  return node && node.getAttribute('data-context-id');\n}\n\nconst SHIFT = 5;\n\nexport function reorder(node, config) {\n  let source, clone, sid;\n  let x, y, base, detail;\n  let touched, touchTimer;\n\n  function down(event) {\n    x = event.clientX;\n    y = event.clientY;\n    base = {\n      ...getOffset(source, node, event),\n      y: config.getTask(sid).$y,\n    };\n\n    document.body.style.userSelect = 'none';\n  }\n\n  function handleTouchstart(event) {\n    source = locate(event);\n    if (!checkSource(source)) return;\n\n    sid = getID(source);\n\n    touchTimer = setTimeout(() => {\n      touched = true;\n      if (config && config.touchStart) config.touchStart();\n      down(event.touches[0]);\n    }, 500);\n\n    node.addEventListener('touchmove', handleTouchmove);\n    node.addEventListener('contextmenu', handleContext);\n    window.addEventListener('touchend', handleTouchend);\n  }\n\n  function handleContext(event) {\n    if (touched || touchTimer) {\n      event.preventDefault();\n      return false;\n    }\n  }\n\n  function handleMousedown(event) {\n    if (event.which !== 1) return;\n\n    source = locate(event);\n    if (!checkSource(source)) return;\n\n    sid = getID(source);\n\n    node.addEventListener('mousemove', handleMousemove);\n    window.addEventListener('mouseup', handleMouseup);\n\n    down(event);\n  }\n\n  function end(full) {\n    node.removeEventListener('mousemove', handleMousemove);\n    node.removeEventListener('touchmove', handleTouchmove);\n    document.body.removeEventListener('mouseup', handleMouseup);\n    document.body.removeEventListener('touchend', handleTouchend);\n    document.body.style.userSelect = '';\n\n    if (full) {\n      node.removeEventListener('mousedown', handleMousedown);\n      node.removeEventListener('touchstart', handleTouchstart);\n    }\n  }\n\n  function move(event) {\n    const dx = event.clientX - x;\n    const dy = event.clientY - y;\n    if (!clone) {\n      if (Math.abs(dx) < SHIFT && Math.abs(dy) < SHIFT) return;\n      if (config && config.start) {\n        if (config.start({ id: sid, e: event }) === false) return;\n      }\n\n      clone = source.cloneNode(true);\n      clone.style.pointerEvents = 'none';\n      clone.classList.add('wx-reorder-task');\n      clone.style.position = 'absolute';\n      clone.style.left = base.left + 'px';\n      clone.style.top = base.top + 'px';\n\n      source.style.visibility = 'hidden';\n      source.parentNode.insertBefore(clone, source);\n    }\n\n    if (clone) {\n      const top = Math.round(Math.max(0, base.top + dy));\n\n      if (config && config.move) {\n        if (config.move({ id: sid, top, detail }) === false) return;\n      }\n\n      const task = config.getTask(sid);\n      const y = task.$y;\n      //dnd may be blocked\n      if (!base.start && base.y == y) return up();\n\n      base.start = true;\n      base.y = task.$y - 4;\n      clone.style.top = top + 'px'; //task.$y - scroll\n\n      const targetNode = document.elementFromPoint(\n        event.clientX,\n        event.clientY,\n      );\n      const target = locate(targetNode);\n\n      if (target && target !== source) {\n        const tid = getID(target);\n        const box = target.getBoundingClientRect();\n        const line = box.top + box.height / 2;\n\n        const after =\n          event.clientY + base.db > line &&\n          target.nextElementSibling !== source;\n        const before =\n          event.clientY - base.dt < line &&\n          target.previousElementSibling !== source;\n\n        if (detail?.after == tid || detail?.before == tid) {\n          // avoid duplicate calls\n          detail = null;\n        } else if (after) {\n          // move down\n          detail = { id: sid, after: tid };\n        } else if (before) {\n          // move up\n          detail = { id: sid, before: tid };\n        }\n      }\n    }\n  }\n\n  function handleMousemove(event) {\n    move(event);\n  }\n\n  function handleTouchmove(event) {\n    if (touched) {\n      event.preventDefault();\n      move(event.touches[0]);\n    } else if (touchTimer) {\n      clearTimeout(touchTimer);\n      touchTimer = null;\n    }\n  }\n\n  function handleTouchend() {\n    touched = null;\n    if (touchTimer) {\n      clearTimeout(touchTimer);\n      touchTimer = null;\n    }\n    up();\n  }\n\n  function handleMouseup() {\n    up();\n  }\n\n  function up() {\n    if (source) {\n      source.style.visibility = '';\n    }\n    if (clone) {\n      clone.parentNode.removeChild(clone);\n      if (config && config.end) config.end({ id: sid, top: base.top });\n    }\n\n    sid = source = clone = base = detail = null;\n    end();\n  }\n\n  if (node.style.position !== 'absolute') node.style.position = 'relative';\n\n  node.addEventListener('mousedown', handleMousedown);\n  node.addEventListener('touchstart', handleTouchstart);\n\n  return {\n    destroy() {\n      end(true);\n    },\n  };\n}\n","import './TextCell.css';\n\nfunction TextCell({ row, column }) {\n  function getStyle(row, col) {\n    return {\n      justifyContent: col.align,\n      paddingLeft: `${(row.$level - 1) * 20}px`,\n    };\n  }\n\n  const CellComponent = column && column._cell;\n\n  return (\n    <div className=\"wx-pqc08MHU wx-content\" style={getStyle(row, column)}>\n      {row.data || row.lazy ? (\n        <i\n          className={`wx-pqc08MHU wx-toggle-icon wxi-menu-${row.open ? 'down' : 'right'}`}\n          data-action=\"open-task\"\n        />\n      ) : (\n        <i className=\"wx-pqc08MHU wx-toggle-placeholder\" />\n      )}\n      <div className=\"wx-pqc08MHU wx-text\">\n        {CellComponent ? <CellComponent row={row} column={column} /> : row.text}\n      </div>\n    </div>\n  );\n}\n\nexport default TextCell;\n","import { useMemo } from 'react';\nimport './ActionCell.css';\n\nfunction ActionCell({ column, cell }) {\n  const action = useMemo(() => column.id, [column?.id]);\n\n  return cell || column.id == 'add-task' ? (\n    <div style={{ textAlign: column.align }}>\n      <i\n        className=\"wx-9DAESAHW wx-action-icon wxi-plus\"\n        data-action={action}\n      ></i>\n    </div>\n  ) : null;\n}\n\nexport default ActionCell;\n","import {\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { context } from '@svar-ui/react-core';\nimport { locateID, locateAttr } from '@svar-ui/lib-dom';\nimport { reorder } from '../../helpers/reorder';\nimport { prepareEditTask } from '@svar-ui/gantt-store';\nimport { Grid as WxGrid } from '@svar-ui/react-grid';\nimport TextCell from './TextCell.jsx';\nimport ActionCell from './ActionCell.jsx';\nimport { useWritableProp, useStore } from '@svar-ui/lib-react';\nimport storeContext from '../../context';\nimport './Grid.css';\n\nexport default function Grid(props) {\n  const {\n    readonly,\n    compactMode,\n    width = 0,\n    display = 'all',\n    columnWidth: columnWidthProp = 0,\n    onTableAPIChange,\n    multiTaskRows = false,\n    rowMapping = null,\n  } = props;\n  const [columnWidth, setColumnWidthProp] = useWritableProp(columnWidthProp);\n  const [tableAPI, setTableAPI] = useState();\n\n  const i18n = useContext(context.i18n);\n  const _ = useMemo(() => i18n.getGroup('gantt'), [i18n]);\n  const api = useContext(storeContext);\n\n  const scrollTopVal = useStore(api, 'scrollTop');\n  const cellHeightVal = useStore(api, 'cellHeight');\n  const scrollTask = useStore(api, '_scrollTask');\n  const selectedVal = useStore(api, '_selected');\n  const areaVal = useStore(api, 'area');\n  const rTasksVal = useStore(api, '_tasks');\n  const scalesVal = useStore(api, '_scales');\n  const columnsVal = useStore(api, 'columns');\n  const sortVal = useStore(api, '_sort');\n  const calendarVal = useStore(api, 'calendar');\n  const durationUnitVal = useStore(api, 'durationUnit');\n  const splitTasksVal = useStore(api, 'splitTasks');\n\n  const [dragTask, setDragTask] = useState(null);\n\n  const tasks = useMemo(() => {\n    if (!rTasksVal || !areaVal) return [];\n\n    // When multiTaskRows is enabled, the store's area calculation doesn't account\n    // for reduced row count. Include all tasks and let CSS overflow handle visibility.\n    // This is safe because the container height is already correctly calculated.\n    if (multiTaskRows && rowMapping) {\n      return rTasksVal;\n    }\n\n    return rTasksVal.slice(areaVal.start, areaVal.end);\n  }, [rTasksVal, areaVal, multiTaskRows, rowMapping]);\n\n  const execAction = useCallback(\n    (id, action) => {\n      if (action === 'add-task') {\n        api.exec(action, {\n          target: id,\n          task: { text: _('New Task') },\n          mode: 'child',\n          show: true,\n        });\n      } else if (action === 'open-task') {\n        const task = tasks.find((a) => a.id === id);\n        if (task?.data || task?.lazy)\n          api.exec(action, { id, mode: !task.open });\n      }\n    },\n    [tasks],\n  );\n\n  const onClick = useCallback(\n    (e) => {\n      const id = locateID(e);\n      const action = e.target.dataset.action;\n      if (action) e.preventDefault();\n      if (id) {\n        if (action === 'add-task' || action === 'open-task') {\n          execAction(id, action);\n        } else {\n          api.exec('select-task', {\n            id,\n            toggle: e.ctrlKey || e.metaKey,\n            range: e.shiftKey,\n            show: true,\n          });\n        }\n      } else if (action === 'add-task') {\n        execAction(null, action);\n      }\n    },\n    [api, execAction],\n  );\n\n  const tableRef = useRef(null);\n  const tableContainerRef = useRef(null);\n  const [gridWidth, setGridWidth] = useState(0);\n  const [updateFlex, setUpdateFlex] = useState(false);\n\n  useEffect(() => {\n    const node = tableContainerRef.current;\n    if (!node || typeof ResizeObserver === 'undefined') return;\n    const update = () => setGridWidth(node.clientWidth);\n    update();\n    const ro = new ResizeObserver(update);\n    ro.observe(node);\n    return () => ro.disconnect();\n  }, []);\n\n  const lastDetailRef = useRef(null);\n\n  const reorderTasks = useCallback(\n    (detail) => {\n      const id = detail.id;\n      const { before, after } = detail;\n      const inProgress = detail.onMove;\n\n      let target = before || after;\n      let mode = before ? 'before' : 'after';\n\n      if (inProgress) {\n        if (mode === 'after') {\n          const task = api.getTask(target);\n          if (task.data?.length && task.open) {\n            mode = 'before';\n            target = task.data[0].id;\n          }\n        }\n        lastDetailRef.current = { id, [mode]: target };\n      } else lastDetailRef.current = null;\n\n      api.exec('move-task', {\n        id,\n        mode,\n        target,\n        inProgress,\n      });\n    },\n    [api],\n  );\n\n  // When multiTaskRows is enabled, we show all rows without virtualization, so no offset needed\n  const scrollDelta = useMemo(() => {\n    if (multiTaskRows && rowMapping) return 0;\n    return areaVal?.from ?? 0;\n  }, [areaVal, multiTaskRows, rowMapping]);\n  const headerHeight = useMemo(() => scalesVal?.height ?? 0, [scalesVal]);\n\n  const scrollX = useMemo(() => {\n    if (!compactMode && display !== 'grid') {\n      return (columnWidth ?? 0) > (width ?? 0);\n    } else {\n      return (columnWidth ?? 0) > (gridWidth ?? 0);\n    }\n  }, [compactMode, display, columnWidth, width, gridWidth]);\n\n  const tableStyle = useMemo(() => {\n    const style = {};\n    if ((scrollX && display === 'all') || (display === 'grid' && scrollX)) {\n      style.width = columnWidth;\n    } else if (display === 'grid') {\n      style.width = '100%';\n    }\n    return style;\n  }, [scrollX, display, columnWidth]);\n\n  const allTasks = useMemo(() => {\n    if (dragTask && !tasks.find((t) => t.id === dragTask.id)) {\n      return [...tasks, dragTask];\n    }\n    return tasks;\n  }, [tasks, dragTask]);\n\n  // Aggregate rows when multiTaskRows is enabled\n  const gridRows = useMemo(() => {\n    if (!multiTaskRows || !rowMapping) return allTasks;\n\n    const rowMap = new Map();\n    const processedRows = new Set();\n\n    allTasks.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n\n      if (!processedRows.has(rowId)) {\n        // First task in row - use its properties\n        rowMap.set(rowId, {\n          ...task,\n          $rowTasks: rowMapping.rowMap.get(rowId) || [task.id],\n        });\n        processedRows.add(rowId);\n      }\n    });\n\n    return Array.from(rowMap.values());\n  }, [allTasks, multiTaskRows, rowMapping]);\n\n  const cols = useMemo(() => {\n    let cols = (columnsVal || []).map((col) => {\n      col = { ...col };\n      const header = col.header;\n      if (typeof header === 'object') {\n        const text = header.text && _(header.text);\n        col.header = { ...header, text };\n      } else col.header = _(header);\n      return col;\n    });\n    const ti = cols.findIndex((c) => c.id === 'text');\n    const ai = cols.findIndex((c) => c.id === 'add-task');\n\n    if (ti !== -1) {\n      if (cols[ti].cell) cols[ti]._cell = cols[ti].cell;\n      cols[ti].cell = TextCell;\n    }\n    if (ai !== -1) {\n      cols[ai].cell = cols[ai].cell || ActionCell;\n\n      const header = cols[ai].header;\n      if (typeof header !== 'object') cols[ai].header = { text: header };\n      cols[ai].header.cell = header.cell || ActionCell;\n\n      if (readonly) {\n        cols.splice(ai, 1);\n      } else {\n        if (compactMode) {\n          const [actionCol] = cols.splice(ai, 1);\n          cols.unshift(actionCol);\n        }\n      }\n    }\n\n    if (cols.length > 0) cols[cols.length - 1].resize = false;\n    return cols;\n  }, [columnsVal, _, readonly, compactMode]);\n\n  const basis = useMemo(() => {\n    if (display === 'all') return `${width}px`;\n    if (display === 'grid') return 'calc(100% - 4px)';\n    return cols.find((c) => c.id === 'add-task') ? '50px' : '0';\n  }, [display, width, cols]);\n\n  const sortMarks = useMemo(() => {\n    if (gridRows && sortVal?.length) {\n      const marks = {};\n      sortVal.forEach(({ key, order }, index) => {\n        marks[key] = {\n          order,\n          ...(sortVal.length > 1 && { index }),\n        };\n      });\n      return marks;\n    }\n    return {};\n  }, [gridRows, sortVal]);\n\n  const checkFlex = useCallback(() => {\n    return cols.some((c) => c.flexgrow && !c.hidden);\n  }, []); // cols defined later; will use latest value when invoked\n\n  const hasFlexCol = useMemo(() => {\n    // updateFlex is used to trigger re-evaluation\n    void updateFlex;\n    return checkFlex();\n  }, [checkFlex, updateFlex]);\n\n  const fitColumns = useMemo(() => {\n    let filteredColumns =\n      display === 'chart' ? cols.filter((c) => c.id === 'add-task') : cols;\n\n    const containerWidth = display === 'all' ? width : gridWidth;\n    if (!hasFlexCol) {\n      let baseColumnWidth = columnWidth;\n      let forceReset = false;\n      if (cols.some((c) => c.$width)) {\n        let actualWidth = 0;\n        baseColumnWidth = cols.reduce((acc, col) => {\n          if (!col.hidden) {\n            actualWidth += col.width;\n            acc += col.$width || col.width;\n          }\n          return acc;\n        }, 0);\n\n        if (actualWidth > baseColumnWidth && baseColumnWidth > containerWidth)\n          forceReset = true;\n      }\n\n      if (forceReset || baseColumnWidth < containerWidth) {\n        let k = 1;\n        if (!forceReset)\n          k = (containerWidth - 50) / (baseColumnWidth - 50 || 1);\n        return filteredColumns.map((c) => {\n          if (c.id !== 'add-task' && !c.hidden) {\n            if (!c.$width) c.$width = c.width;\n            c.width = c.$width * k;\n          }\n          return c;\n        });\n      }\n    }\n    return filteredColumns;\n  }, [display, cols, hasFlexCol, columnWidth, width, gridWidth]);\n\n  const setColumnWidth = useCallback(\n    (resized) => {\n      if (!checkFlex()) {\n        const newColumnWidth = fitColumns.reduce((acc, col) => {\n          if (resized && col.$width) col.$width = col.width;\n          return acc + (col.hidden ? 0 : col.width);\n        }, 0);\n        if (newColumnWidth !== columnWidth) setColumnWidthProp(newColumnWidth);\n      }\n      setUpdateFlex(true);\n      setUpdateFlex(false);\n    },\n    [checkFlex, fitColumns, columnWidth, setColumnWidthProp],\n  );\n\n  const adjustColumns = useCallback(() => {\n    const flexCols = cols.filter((c) => c.flexgrow && !c.hidden);\n    if (flexCols.length === 1)\n      cols.forEach((c) => {\n        if (c.$width && !c.flexgrow && !c.hidden) c.width = c.$width;\n      });\n  }, []); // cols defined later; will use latest\n\n  const onDblClick = useCallback(\n    (e) => {\n      if (!readonly) {\n        const id = locateID(e);\n        const column = locateAttr(e, 'data-col-id');\n        const columnObj = column && cols.find((c) => c.id == column);\n        if (!columnObj?.editor && id) api.exec('show-editor', { id });\n      }\n    },\n    [api, readonly], // cols is defined later; relies on latest value at call time\n  );\n\n  const sel = useMemo(\n    () => (Array.isArray(selectedVal) ? selectedVal.map((o) => o.id) : []),\n    [selectedVal],\n  );\n\n  // Direct scroll sync via event listener (bypasses React state for performance)\n  const scrollDeltaRef = useRef(scrollDelta);\n  scrollDeltaRef.current = scrollDelta;\n\n  useEffect(() => {\n    const updateScrollOffset = (scrollTop) => {\n      if (tableRef.current) {\n        const body = tableRef.current.querySelector('.wx-body');\n        if (body) {\n          body.style.top = -((scrollTop ?? 0) - (scrollDeltaRef.current ?? 0)) + 'px';\n        }\n      }\n      if (tableContainerRef.current) tableContainerRef.current.scrollTop = 0;\n    };\n\n    // Initial sync\n    updateScrollOffset(scrollTopVal);\n\n    // Listen directly to scroll-chart events for immediate sync\n    const unsubscribe = api.on('scroll-chart', ({ top }) => {\n      if (top !== undefined) {\n        updateScrollOffset(top);\n      }\n    });\n\n    return unsubscribe;\n  }, [api, scrollTopVal]);\n\n  // Update on scrollDelta change (area virtualization)\n  useEffect(() => {\n    if (tableRef.current) {\n      const body = tableRef.current.querySelector('.wx-body');\n      if (body) {\n        body.style.top = -((scrollTopVal ?? 0) - (scrollDelta ?? 0)) + 'px';\n      }\n    }\n  }, [scrollDelta]);\n\n  useEffect(() => {\n    const tableEl = tableRef.current;\n    if (!tableEl) return;\n    const bodyEl = tableEl.querySelector('.wx-table-box .wx-body');\n    if (!bodyEl || typeof ResizeObserver === 'undefined') return;\n    const ro = new ResizeObserver(() => {\n      // Re-sync scroll offset on resize\n      if (tableRef.current) {\n        const body = tableRef.current.querySelector('.wx-body');\n        if (body) {\n          body.style.top = -((scrollTopVal ?? 0) - (scrollDeltaRef.current ?? 0)) + 'px';\n        }\n      }\n    });\n    ro.observe(bodyEl);\n    return () => {\n      ro.disconnect();\n    };\n  }, [fitColumns, tableStyle, display, basis, gridRows, scrollTopVal]);\n\n  useEffect(() => {\n    if (!scrollTask || !tableAPI) return;\n\n    const { id } = scrollTask;\n    const focusCell = tableAPI.getState().focusCell;\n    if (\n      focusCell &&\n      focusCell.row !== id &&\n      tableRef.current &&\n      tableRef.current.contains(document.activeElement)\n    ) {\n      tableAPI.exec('focus-cell', {\n        row: id,\n        column: focusCell.column,\n      });\n    }\n  }, [scrollTask, tableAPI]);\n\n  const startReorder = useCallback(\n    ({ id }) => {\n      if (readonly) return false;\n\n      if (api.getTask(id).open) api.exec('open-task', { id, mode: false });\n\n      const t = api.getState()._tasks.find((t) => t.id === id);\n      setDragTask(t || null);\n      if (!t) return false;\n    },\n    [api, readonly],\n  );\n\n  const endReorder = useCallback(\n    ({ id, top }) => {\n      if (lastDetailRef.current) {\n        reorderTasks({ ...lastDetailRef.current, onMove: false });\n      } else {\n        api.exec('drag-task', {\n          id,\n          top: top + (scrollDelta ?? 0),\n          inProgress: false,\n        });\n      }\n      setDragTask(null);\n    },\n    [api, reorderTasks, scrollDelta],\n  );\n\n  const moveReorder = useCallback(\n    ({ id, top, detail }) => {\n      if (detail) {\n        reorderTasks({ ...detail, onMove: true });\n      }\n      api.exec('drag-task', {\n        id,\n        top: top + (scrollDelta ?? 0),\n        inProgress: true,\n      });\n    },\n    [api, reorderTasks, scrollDelta],\n  );\n\n  useEffect(() => {\n    const node = tableRef.current;\n    if (!node) return;\n    const action = reorder(node, {\n      start: startReorder,\n      end: endReorder,\n      move: moveReorder,\n      getTask: api.getTask,\n    });\n    return action.destroy;\n  }, [api, startReorder, endReorder, moveReorder]);\n\n  const handleHotkey = useCallback(\n    (ev) => {\n      const { key, isInput } = ev;\n      if (!isInput && (key === 'arrowup' || key === 'arrowdown')) {\n        ev.eventSource = 'grid';\n        api.exec('hotkey', ev);\n        return false;\n      } else if (key === 'enter') {\n        const focusCell = tableAPI?.getState().focusCell;\n        if (focusCell) {\n          const { row, column } = focusCell;\n          if (column === 'add-task') {\n            execAction(row, 'add-task');\n          } else if (column === 'text') {\n            execAction(row, 'open-task');\n          }\n        }\n      }\n    },\n    [api, execAction, tableAPI],\n  );\n\n  // FIXME - temporary hack to provide fresh values to grid's handlers\n  const handlersStateRef = useRef(null);\n  const setHandlersState = () => {\n    handlersStateRef.current = {\n      setTableAPI,\n      handleHotkey,\n      sortVal,\n      api,\n      adjustColumns,\n      setColumnWidth,\n      tasks,\n      calendarVal,\n      durationUnitVal,\n      splitTasksVal,\n      onTableAPIChange,\n    };\n  };\n  setHandlersState();\n  useEffect(() => {\n    setHandlersState();\n  }, [\n    setTableAPI,\n    handleHotkey,\n    sortVal,\n    api,\n    adjustColumns,\n    setColumnWidth,\n    tasks,\n    calendarVal,\n    durationUnitVal,\n    splitTasksVal,\n    onTableAPIChange,\n  ]);\n\n  const init = useCallback((tapi) => {\n    setTableAPI(tapi);\n    tapi.intercept('hotkey', (ev) => handlersStateRef.current.handleHotkey(ev));\n    tapi.intercept('scroll', () => false);\n    tapi.intercept('select-row', () => false);\n    tapi.intercept('sort-rows', (e) => {\n      const sortVal = handlersStateRef.current.sortVal;\n      const { key, add } = e;\n      const keySort = sortVal ? sortVal.find((s) => s.key === key) : null;\n      let order = 'asc';\n      if (keySort) order = !keySort || keySort.order === 'asc' ? 'desc' : 'asc';\n\n      api.exec('sort-tasks', {\n        key,\n        order,\n        add,\n      });\n      return false;\n    });\n\n    tapi.on('resize-column', () => {\n      handlersStateRef.current.setColumnWidth(true);\n    });\n\n    tapi.on('hide-column', (ev) => {\n      if (!ev.mode) handlersStateRef.current.adjustColumns();\n      handlersStateRef.current.setColumnWidth();\n    });\n\n    tapi.intercept('update-cell', (e) => {\n      const { id, column, value } = e;\n      const task = handlersStateRef.current.tasks.find((t) => t.id === id);\n\n      if (task) {\n        const update = { ...task };\n        let v = value;\n        if (v && !isNaN(v) && !(v instanceof Date)) v *= 1;\n        update[column] = v;\n\n        prepareEditTask(\n          update,\n          {\n            calendar: handlersStateRef.current.calendarVal,\n            durationUnit: handlersStateRef.current.durationUnitVal,\n            splitTasks: handlersStateRef.current.splitTasksVal,\n          },\n          column,\n        );\n\n        api.exec('update-task', {\n          id: id,\n          task: update,\n        });\n      }\n      return false;\n    });\n\n    onTableAPIChange && onTableAPIChange(tapi);\n  }, []);\n\n  return (\n    <div\n      className=\"wx-rHj6070p wx-table-container\"\n      style={{ flex: `0 0 ${basis}` }}\n      ref={tableContainerRef}\n    >\n      <div\n        ref={tableRef}\n        style={tableStyle}\n        className=\"wx-rHj6070p wx-table\"\n        onClick={onClick}\n        onDoubleClick={onDblClick}\n      >\n        <WxGrid\n          init={init}\n          sizes={{\n            rowHeight: cellHeightVal,\n            headerHeight: (headerHeight ?? 0) - 1,\n          }}\n          rowStyle={(row) =>\n            row.$reorder ? 'wx-rHj6070p wx-reorder-task' : 'wx-rHj6070p'\n          }\n          columnStyle={(col) =>\n            `wx-rHj6070p wx-text-${col.align}${col.id === 'add-task' ? ' wx-action' : ''}`\n          }\n          data={gridRows}\n          columns={fitColumns}\n          selectedRows={[...sel]}\n          sortMarks={sortMarks}\n        />\n      </div>\n    </div>\n  );\n}\n","import { useContext, useEffect, useRef, useState } from 'react';\nimport storeContext from '../../context';\nimport { grid } from '@svar-ui/gantt-store';\nimport { useStore } from '@svar-ui/lib-react';\n\nfunction CellGrid({ borders = '' }) {\n  const api = useContext(storeContext);\n  const cellWidth = useStore(api, 'cellWidth');\n  const cellHeight = useStore(api, 'cellHeight');\n\n  const nodeRef = useRef(null);\n  const [color, setColor] = useState('#e4e4e4');\n\n  useEffect(() => {\n    if (typeof getComputedStyle !== 'undefined' && nodeRef.current) {\n      const border = getComputedStyle(nodeRef.current).getPropertyValue(\n        '--wx-gantt-border',\n      );\n      setColor(border ? border.substring(border.indexOf('#')) : '#1d1e261a');\n    }\n  }, []);\n\n  const style = {\n    width: '100%',\n    height: '100%',\n    background:\n      cellWidth != null && cellHeight != null\n        ? `url(${grid(cellWidth, cellHeight, color, borders)})`\n        : undefined,\n    position: 'absolute',\n    pointerEvents: 'none',\n  };\n\n  return <div ref={nodeRef} style={style} />;\n}\n\nexport default CellGrid;\n","import { useCallback, useContext, useEffect, useRef } from 'react';\nimport storeContext from '../../context';\nimport { useStore } from '@svar-ui/lib-react';\nimport './Links.css';\n\nexport default function Links({ onSelectLink, selectedLink, readonly }) {\n  const api = useContext(storeContext);\n  const links = useStore(api, '_links');\n  const criticalPath = useStore(api, 'criticalPath');\n\n  const selectedLineRef = useRef(null);\n\n  const onClickOutside = useCallback(\n    (event) => {\n      const css = event?.target?.classList;\n      if (!css?.contains('wx-line') && !css?.contains('wx-delete-button')) {\n        onSelectLink(null);\n      }\n    },\n    [onSelectLink],\n  );\n\n  useEffect(() => {\n    if (!readonly && selectedLink && selectedLineRef.current) {\n      const handler = (event) => {\n        if (\n          selectedLineRef.current &&\n          !selectedLineRef.current.contains(event.target)\n        ) {\n          onClickOutside(event);\n        }\n      };\n      document.addEventListener('click', handler);\n      return () => {\n        document.removeEventListener('click', handler);\n      };\n    }\n  }, [readonly, selectedLink, onClickOutside]);\n\n  return (\n    <svg className=\"wx-dkx3NwEn wx-links\">\n      {(links || []).map((link) => {\n        const className =\n          'wx-dkx3NwEn wx-line' +\n          (criticalPath && link.$critical ? ' wx-critical' : '') +\n          (!readonly ? ' wx-line-selectable' : '');\n        return (\n          <polyline\n            className={className}\n            points={link.$p}\n            key={link.id}\n            onClick={() => !readonly && onSelectLink(link.id)}\n            data-link-id={link.id}\n          />\n        );\n      })}\n      {!readonly && selectedLink && (\n        <polyline\n          ref={selectedLineRef}\n          className=\"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link\"\n          points={selectedLink.$p}\n        />\n      )}\n    </svg>\n  );\n}\n","import './BarSegments.css';\n\nfunction BarSegments(props) {\n  const { task, type } = props;\n\n  function segmentStyle(i) {\n    const s = task.segments[i];\n    return {\n      left: `${s.$x}px`,\n      top: '0px',\n      width: `${s.$w}px`,\n      height: '100%',\n    };\n  }\n\n  function getSegProgress(segmentIndex) {\n    if (!task.progress) return 0;\n\n    const progress = (task.duration * task.progress) / 100;\n    const segments = task.segments;\n    let duration = 0,\n      i = 0,\n      result = null;\n    do {\n      const s = segments[i];\n      if (i === segmentIndex) {\n        if (duration > progress) result = 0;\n        else result = Math.min((progress - duration) / s.duration, 1) * 100;\n      }\n      duration += s.duration;\n      i++;\n    } while (result === null && i < segments.length);\n    return result || 0;\n  }\n\n  return (\n    <div className=\"wx-segments wx-GKbcLEGA\">\n      {task.segments.map((seg, i) => (\n        <div\n          key={i}\n          className={`wx-segment wx-bar wx-${type} wx-GKbcLEGA`}\n          data-segment={i}\n          style={segmentStyle(i)}\n        >\n          {task.progress ? (\n            <div className=\"wx-progress-wrapper\">\n              <div\n                className=\"wx-progress-percent wx-GKbcLEGA\"\n                style={{ width: `${getSegProgress(i)}%` }}\n              ></div>\n            </div>\n          ) : null}\n          <div className=\"wx-content\">{seg.text || ''}</div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport default BarSegments;\n","import {\n  Fragment,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { locate, locateID } from '@svar-ui/lib-dom';\nimport { getID } from '../../helpers/locate';\nimport storeContext from '../../context';\nimport { useStore, useStoreWithCounter } from '@svar-ui/lib-react';\nimport { isSegmentMoveAllowed, extendDragOptions } from '@svar-ui/gantt-store';\nimport { Button } from '@svar-ui/react-core';\nimport Links from './Links.jsx';\nimport BarSegments from './BarSegments.jsx';\nimport './Bars.css';\n\n// Module-level clipboard (persists across renders)\nlet clipboardTasks = [];\nlet clipboardBaseDate = null;\nlet clipboardParent = null;\n\n// Pixel to date conversion helper - snaps to cell start (beginning of week/day/etc)\n// scales.start is normalized to UTC midnight in useMemo above\nconst pixelToDate = (px, scales) => {\n  if (!scales || !scales.start) return null;\n  const { start, lengthUnitWidth, lengthUnit } = scales;\n  const msPerDay = 86400000;\n  const daysPerUnit = lengthUnit === 'week' ? 7 : lengthUnit === 'month' ? 30 : lengthUnit === 'quarter' ? 91 : lengthUnit === 'year' ? 365 : 1;\n  const units = Math.floor(px / lengthUnitWidth);\n  const date = new Date(start.getTime() + units * daysPerUnit * msPerDay);\n  date.setUTCHours(0, 0, 0, 0);\n\n  console.log('[pixelToDate]', {\n    px,\n    units,\n    scalesStart: start.toISOString(),\n    result: date.toISOString(),\n  });\n\n  return date;\n};\n\n// Get cell offset (in whole cells) between two dates\nconst getCellOffset = (date, baseDate, scales) => {\n  if (!scales || !date || !baseDate) return 0;\n  const { lengthUnit } = scales;\n  const msPerDay = 86400000;\n  const daysPerUnit = lengthUnit === 'week' ? 7 : lengthUnit === 'month' ? 30 : lengthUnit === 'quarter' ? 91 : lengthUnit === 'year' ? 365 : 1;\n  const msPerUnit = daysPerUnit * msPerDay;\n  return Math.round((date.getTime() - baseDate.getTime()) / msPerUnit);\n};\n\n// Add cells to a date (returns UTC midnight)\nconst addCells = (date, cells, scales) => {\n  if (!scales || !date) {\n    console.log('[addCells] early return:', { scales: !!scales, date: date?.toISOString?.() });\n    return date;\n  }\n  const { lengthUnit } = scales;\n  const msPerDay = 86400000;\n  const daysPerUnit = lengthUnit === 'week' ? 7 : lengthUnit === 'month' ? 30 : lengthUnit === 'quarter' ? 91 : lengthUnit === 'year' ? 365 : 1;\n  const msPerUnit = daysPerUnit * msPerDay;\n  const result = new Date(date.getTime() + cells * msPerUnit);\n  result.setUTCHours(0, 0, 0, 0);\n  console.log('[addCells]', { date: date.toISOString(), cells, lengthUnit, result: result.toISOString() });\n  return result;\n};\n\n// Check if two horizontal bounds overlap (AABB collision)\nconst boundsOverlap = (left1, right1, left2, right2) => {\n  return left1 < right2 && right1 > left2;\n};\n\nfunction Bars(props) {\n  const {\n    readonly,\n    taskTemplate: TaskTemplate,\n    multiTaskRows = false,\n    rowMapping = null,\n    marqueeSelect = false,\n    copyPaste = false,\n    allowTaskIntersection = true,\n    summaryBarCounts = false,\n  } = props;\n\n  const api = useContext(storeContext);\n\n  const [rTasksValue, rTasksCounter] = useStoreWithCounter(api, '_tasks');\n  const [rLinksValue, rLinksCounter] = useStoreWithCounter(api, '_links');\n  const areaValue = useStore(api, 'area');\n  const scalesValueRaw = useStore(api, '_scales');\n  const taskTypesValue = useStore(api, 'taskTypes');\n\n  // Normalize scales.start to Monday at UTC midnight for consistent positioning\n  // The store may have scales.start at local midnight and/or not on Monday\n  const scalesValue = useMemo(() => {\n    if (!scalesValueRaw || !scalesValueRaw.start) return scalesValueRaw;\n    // First normalize to UTC midnight\n    const utcDate = new Date(Date.UTC(\n      scalesValueRaw.start.getFullYear(),\n      scalesValueRaw.start.getMonth(),\n      scalesValueRaw.start.getDate()\n    ));\n    // Then snap to Monday of that week (ISO week starts Monday)\n    const dayOfWeek = utcDate.getUTCDay(); // 0=Sun, 1=Mon, ..., 6=Sat\n    const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // Sun→-6, Mon→0, Tue→-1, etc.\n    const monday = new Date(utcDate.getTime() + daysToMonday * 86400000);\n    monday.setUTCHours(0, 0, 0, 0);\n    console.log('[scales-normalize]', {\n      raw: scalesValueRaw.start.toISOString(),\n      utc: utcDate.toISOString(),\n      dayOfWeek,\n      daysToMonday,\n      monday: monday.toISOString(),\n    });\n    return { ...scalesValueRaw, start: monday };\n  }, [scalesValueRaw]);\n  const baselinesValue = useStore(api, 'baselines');\n  const [selectedValue, selectedCounter] = useStoreWithCounter(api, '_selected');\n  const scrollTaskStore = useStore(api, '_scrollTask');\n  const criticalPath = useStore(api, 'criticalPath');\n  const tree = useStore(api, 'tasks');\n  const schedule = useStore(api, 'schedule');\n  const splitTasks = useStore(api, 'splitTasks');\n\n  const tasks = useMemo(() => {\n    if (!areaValue || !Array.isArray(rTasksValue)) return [];\n    const start = areaValue.start ?? 0;\n    const end = areaValue.end ?? 0;\n\n    // When multiTaskRows is enabled, the store's area calculation doesn't account\n    // for reduced row count. Include all tasks and let CSS overflow handle visibility.\n    // This is safe because the container height is already correctly calculated.\n    if (multiTaskRows && rowMapping) {\n      return rTasksValue.map((a) => ({ ...a }));\n    }\n\n    return rTasksValue.slice(start, end).map((a) => ({ ...a }));\n  }, [rTasksCounter, areaValue, multiTaskRows, rowMapping]);\n\n  // Adjust task $y positions for multiTaskRows\n  const cellHeight = useStore(api, 'cellHeight');\n  const adjustedTasks = useMemo(() => {\n    if (!multiTaskRows || !rowMapping || !tasks.length) return tasks;\n\n    // Build rowId to rowIndex map\n    const rowIndexMap = new Map();\n    const seenRows = [];\n\n    rTasksValue.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      if (!rowIndexMap.has(rowId)) {\n        rowIndexMap.set(rowId, seenRows.length);\n        seenRows.push(rowId);\n      }\n    });\n\n    // Adjust $y for visible tasks\n    return tasks.map((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      const rowIndex = rowIndexMap.get(rowId) ?? 0;\n      return {\n        ...task,\n        $y: rowIndex * cellHeight,\n        $y_base: task.$y_base !== undefined ? rowIndex * cellHeight : undefined,\n      };\n    });\n  }, [tasks, multiTaskRows, rowMapping, rTasksValue, cellHeight]);\n\n  const lengthUnitWidth = useMemo(\n    () => scalesValue.lengthUnitWidth,\n    [scalesValue],\n  );\n\n  const lengthUnit = useMemo(\n    () => scalesValue.lengthUnit || 'day',\n    [scalesValue],\n  );\n\n  // Compute per-column child task counts for summary bars\n  const summaryColCounts = useMemo(() => {\n    if (!summaryBarCounts || !rTasksValue?.length || !lengthUnitWidth) return null;\n\n    // Build parent→children map\n    const childrenMap = new Map();\n    const summaryIds = new Set();\n    rTasksValue.forEach((task) => {\n      if (task.type === 'summary') {\n        summaryIds.add(task.id);\n      }\n      if (task.parent && task.parent !== 0 && task.type !== 'summary') {\n        if (!childrenMap.has(task.parent)) {\n          childrenMap.set(task.parent, []);\n        }\n        childrenMap.get(task.parent).push(task);\n      }\n    });\n\n    // For each summary, count children per column\n    const counts = new Map(); // summaryId → Map<colIndex, count>\n    summaryIds.forEach((summaryId) => {\n      const children = childrenMap.get(summaryId);\n      if (!children?.length) return;\n\n      const colCounts = new Map();\n      children.forEach((child) => {\n        if (child.$x == null || child.$w == null) return;\n        const startCol = Math.floor(child.$x / lengthUnitWidth);\n        const endCol = Math.ceil((child.$x + child.$w) / lengthUnitWidth);\n        for (let col = startCol; col < endCol; col++) {\n          colCounts.set(col, (colCounts.get(col) || 0) + 1);\n        }\n      });\n\n      if (colCounts.size > 0) {\n        counts.set(summaryId, colCounts);\n      }\n    });\n\n    return counts;\n  }, [summaryBarCounts, rTasksValue, lengthUnitWidth]);\n\n  const ignoreNextClickRef = useRef(false);\n\n  const [linkFrom, setLinkFrom] = useState(undefined);\n  const [taskMove, setTaskMove] = useState(null);\n  const progressFromRef = useRef(null);\n\n  const [selectedLink, setSelectedLink] = useState(null);\n\n  const [touched, setTouched] = useState(undefined);\n  const touchTimerRef = useRef(null);\n\n  const [totalWidth, setTotalWidth] = useState(0);\n\n  // Marquee selection state\n  const [marquee, setMarquee] = useState(null);\n  // Ref to track latest marquee coords (since React state may not update before mouseup)\n  const marqueeRef = useRef(null);\n  // Bulk move state\n  const [bulkMove, setBulkMove] = useState(null);\n  // Paste target position (for copy/paste feature)\n  const [pasteTargetDate, setPasteTargetDate] = useState(null);\n  // Paste preview mode state\n  const [pastePreview, setPastePreview] = useState(null);\n  // Shape: { tasks: [], baseDate, parent, currentX }\n  // Ref for copy/paste handler to avoid stale closure\n  const pasteTargetDateRef = useRef(null);\n  pasteTargetDateRef.current = pasteTargetDate;\n  // Track last mouse X position in container (for paste preview initial position)\n  const lastMouseXRef = useRef(200);\n\n  const containerRef = useRef(null);\n\n  const hasFocus = useMemo(() => {\n    const el = containerRef.current;\n    return !!(\n      selectedValue.length &&\n      el &&\n      el.contains(document.activeElement)\n    );\n  }, [selectedValue, containerRef.current]);\n\n  const focused = useMemo(() => {\n    return hasFocus && selectedValue[selectedValue.length - 1]?.id;\n  }, [hasFocus, selectedValue]);\n\n  useEffect(() => {\n    if (!scrollTaskStore) return;\n    if (hasFocus && scrollTaskStore) {\n      const { id } = scrollTaskStore;\n      const node = containerRef.current?.querySelector(\n        `.wx-bar[data-id='${id}']`,\n      );\n      if (node) node.focus({ preventScroll: true });\n    }\n  }, [scrollTaskStore]);\n\n  useEffect(() => {\n    const el = containerRef.current;\n    if (!el) return;\n    setTotalWidth(el.offsetWidth || 0);\n    if (typeof ResizeObserver !== 'undefined') {\n      const ro = new ResizeObserver((entries) => {\n        if (entries[0]) {\n          setTotalWidth(entries[0].contentRect.width);\n        }\n      });\n      ro.observe(el);\n      return () => ro.disconnect();\n    }\n  }, [containerRef.current]);\n\n  const startDrag = useCallback(() => {\n    document.body.style.userSelect = 'none';\n  }, []);\n\n  const endDrag = useCallback(() => {\n    document.body.style.userSelect = '';\n  }, []);\n\n  const getMoveMode = useCallback(\n    (node, e, task) => {\n      if (e.target.classList.contains('wx-line')) return '';\n      if (!task) task = api.getTask(getID(node));\n      if (task.type === 'milestone' || task.type === 'summary') return '';\n\n      const segmentNode = locate(e, 'data-segment');\n      if (segmentNode) node = segmentNode;\n\n      const { left, width } = node.getBoundingClientRect();\n      const p = (e.clientX - left) / width;\n      let delta = 0.2 / (width > 200 ? width / 200 : 1);\n      if (p < delta) return 'start';\n      if (p > 1 - delta) return 'end';\n      return '';\n    },\n    [api],\n  );\n\n  // Compute which tasks are overlapping with others in the same row\n  // Returns a Set of task IDs that have collisions\n  const overlappingTaskIds = useMemo(() => {\n    const overlapping = new Set();\n\n    // Only check for overlaps if allowTaskIntersection is false and multiTaskRows is enabled\n    if (allowTaskIntersection || !multiTaskRows || !rowMapping) {\n      return overlapping;\n    }\n\n    // Group tasks by row\n    const tasksByRow = new Map();\n    rTasksValue.forEach((task) => {\n      // Skip summary and milestone tasks\n      if (task.type === 'summary' || task.type === 'milestone') return;\n\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      if (!tasksByRow.has(rowId)) {\n        tasksByRow.set(rowId, []);\n      }\n      tasksByRow.get(rowId).push(task);\n    });\n\n    // Check each row for overlaps\n    tasksByRow.forEach((rowTasks) => {\n      if (rowTasks.length < 2) return;\n\n      // Check each pair of tasks in the row\n      for (let i = 0; i < rowTasks.length; i++) {\n        for (let j = i + 1; j < rowTasks.length; j++) {\n          const task1 = rowTasks[i];\n          const task2 = rowTasks[j];\n\n          const left1 = task1.$x;\n          const right1 = task1.$x + task1.$w;\n          const left2 = task2.$x;\n          const right2 = task2.$x + task2.$w;\n\n          if (boundsOverlap(left1, right1, left2, right2)) {\n            overlapping.add(task1.id);\n            overlapping.add(task2.id);\n          }\n        }\n      }\n    });\n\n    return overlapping;\n  }, [allowTaskIntersection, multiTaskRows, rowMapping, rTasksValue, rTasksCounter]);\n\n  // Precompute adjusted Y positions for all tasks (used for marquee intersection)\n  const taskYPositions = useMemo(() => {\n    const yMap = new Map();\n\n    if (!multiTaskRows || !rowMapping) {\n      // No multi-row adjustment - use original $y\n      rTasksValue.forEach((task) => {\n        yMap.set(task.id, task.$y);\n      });\n      return yMap;\n    }\n\n    // Build rowIndex map\n    const rowIndexMap = new Map();\n    const seenRows = [];\n    rTasksValue.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      if (!rowIndexMap.has(rowId)) {\n        rowIndexMap.set(rowId, seenRows.length);\n        seenRows.push(rowId);\n      }\n    });\n\n    // Compute adjusted Y for each task\n    rTasksValue.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      const rowIndex = rowIndexMap.get(rowId) ?? 0;\n      yMap.set(task.id, rowIndex * cellHeight);\n    });\n\n    return yMap;\n  }, [rTasksValue, multiTaskRows, rowMapping, cellHeight]);\n\n  // Map rowId to Y position (for paste preview ghosts)\n  const rowYPositions = useMemo(() => {\n    const yMap = new Map();\n\n    if (!multiTaskRows || !rowMapping) {\n      // Without multiTaskRows, each task is its own row\n      rTasksValue.forEach((task) => {\n        yMap.set(task.id, task.$y);\n        if (task.row !== undefined) {\n          yMap.set(task.row, task.$y);\n        }\n      });\n      return yMap;\n    }\n\n    // Build rowIndex map\n    const rowIndexMap = new Map();\n    const seenRows = [];\n    rTasksValue.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      if (!rowIndexMap.has(rowId)) {\n        rowIndexMap.set(rowId, seenRows.length);\n        seenRows.push(rowId);\n      }\n    });\n\n    // Map rowId to Y position\n    rowIndexMap.forEach((rowIndex, rowId) => {\n      yMap.set(rowId, rowIndex * cellHeight);\n    });\n\n    return yMap;\n  }, [rTasksValue, multiTaskRows, rowMapping, cellHeight]);\n\n  // Get tasks intersecting with a rectangle\n  // Marquee coordinates are already in content-space because getBoundingClientRect()\n  // on a scrolled element returns position accounting for scroll offset\n  const getIntersectingTasks = useCallback(\n    (rect) => {\n      const container = containerRef.current;\n      if (!container) return [];\n\n      // Marquee coords are already content-space (no scroll adjustment needed)\n      // because getBoundingClientRect() on .wx-bars accounts for parent scroll\n      const minX = Math.min(rect.startX, rect.currentX);\n      const maxX = Math.max(rect.startX, rect.currentX);\n      const minY = Math.min(rect.startY, rect.currentY);\n      const maxY = Math.max(rect.startY, rect.currentY);\n\n      return rTasksValue.filter((task) => {\n        const taskLeft = task.$x;\n        const taskRight = task.$x + task.$w;\n        const taskAbsoluteY = taskYPositions.get(task.id) ?? task.$y;\n        const taskTop = taskAbsoluteY;\n        const taskBottom = taskTop + task.$h;\n\n        return (\n          taskLeft < maxX &&\n          taskRight > minX &&\n          taskTop < maxY &&\n          taskBottom > minY\n        );\n      });\n    },\n    [rTasksValue, taskYPositions],\n  );\n\n  // Set of selected task IDs for fast lookup\n  const selectedIds = useMemo(() => {\n    return new Set(selectedValue.map((s) => s.id));\n  }, [selectedValue, selectedCounter]);\n\n  // Check if a task is in the current selection\n  const isTaskSelected = useCallback(\n    (taskId) => {\n      return selectedIds.has(taskId);\n    },\n    [selectedIds],\n  );\n\n  const down = useCallback(\n    (node, point) => {\n      const { clientX } = point;\n      const id = getID(node);\n      const task = api.getTask(id);\n      const css = point.target.classList;\n      if (point.target.closest('.wx-delete-button')) return;\n      if (!readonly) {\n        if (css.contains('wx-progress-marker')) {\n          const { progress } = api.getTask(id);\n          progressFromRef.current = {\n            id,\n            x: clientX,\n            progress,\n            dx: 0,\n            node,\n            marker: point.target,\n          };\n          point.target.classList.add('wx-progress-in-drag');\n        } else {\n          const mode = getMoveMode(node, point, task) || 'move';\n\n          const newTaskMove = {\n            id,\n            mode,\n            x: clientX,\n            dx: 0,\n            l: task.$x,\n            w: task.$w,\n          };\n\n          if (splitTasks && task.segments?.length) {\n            const segNode = locate(point, 'data-segment');\n            if (segNode) {\n              newTaskMove.segmentIndex = segNode.dataset['segment'] * 1;\n              extendDragOptions(task, newTaskMove);\n            }\n          }\n\n          setTaskMove(newTaskMove);\n        }\n        startDrag();\n      }\n    },\n    [api, readonly, getMoveMode, startDrag, splitTasks],\n  );\n\n  const mousedown = useCallback(\n    (e) => {\n      if (e.button !== 0) return;\n\n      // Skip mousedown processing when in paste preview mode\n      // Let onClick handle the paste confirmation\n      if (pastePreview) return;\n\n      const node = locate(e);\n\n      // Marquee selection: click on empty space\n      if (!node && marqueeSelect && !readonly) {\n        const container = containerRef.current;\n        if (!container) return;\n        const rect = container.getBoundingClientRect();\n\n        // Convert viewport coordinates to content-space coordinates\n        // The .wx-bars element spans the full content width, so its bounding rect\n        // already accounts for scroll - no need to add scrollLeft\n        const startX = e.clientX - rect.left;\n        const startY = e.clientY - rect.top;\n\n        // Track click position for paste target (copyPaste feature)\n        // Update ref directly for immediate access (state update may not be ready before Ctrl+V)\n        if (copyPaste) {\n          const clickDate = pixelToDate(startX, scalesValue);\n          if (clickDate) {\n            pasteTargetDateRef.current = clickDate; // Direct ref update for immediate access\n            setPasteTargetDate(clickDate);\n          }\n        }\n\n        const marqueeData = {\n          startX,\n          startY,\n          currentX: startX,\n          currentY: startY,\n          ctrlKey: e.ctrlKey || e.metaKey,\n        };\n        setMarquee(marqueeData);\n        marqueeRef.current = marqueeData;\n        startDrag();\n        return;\n      }\n\n      if (!node) return;\n\n      // Bulk move: click on already-selected task when multiple tasks are selected\n      if (marqueeSelect && !readonly && selectedValue.length > 1) {\n        const id = getID(node);\n        if (isTaskSelected(id)) {\n          const css = e.target.classList;\n          // Don't start bulk move if clicking on link markers, progress marker, or delete buttons\n          if (\n            !css.contains('wx-link') &&\n            !css.contains('wx-progress-marker') &&\n            !e.target.closest('.wx-delete-button')\n          ) {\n            // Check if we're at a resize edge - if so, don't start bulk move\n            const task = api.getTask(id);\n            const mode = getMoveMode(node, e, task);\n            if (!mode) {\n              // Start bulk move\n              const originalPositions = new Map();\n              selectedValue.forEach((sel) => {\n                const t = api.getTask(sel.id);\n                if (t) {\n                  // Skip summary tasks when auto-schedule is on\n                  if (schedule?.auto && t.type === 'summary') return;\n                  originalPositions.set(sel.id, {\n                    $x: t.$x,\n                    $w: t.$w,\n                    start: t.start,\n                    end: t.end,\n                  });\n                }\n              });\n\n              setBulkMove({\n                baseTaskId: id,\n                startX: e.clientX,\n                dx: 0,\n                originalPositions,\n              });\n              startDrag();\n              return;\n            }\n          }\n        }\n      }\n\n      down(node, e);\n    },\n    [down, marqueeSelect, copyPaste, readonly, selectedValue, isTaskSelected, api, getMoveMode, schedule, startDrag, scalesValue, pastePreview],\n  );\n\n  const touchstart = useCallback(\n    (e) => {\n      const node = locate(e);\n      if (node) {\n        touchTimerRef.current = setTimeout(() => {\n          setTouched(true);\n          down(node, e.touches[0]);\n        }, 300);\n      }\n    },\n    [down],\n  );\n\n  const onSelectLink = useCallback(\n    (id) => {\n      setSelectedLink(id && { ...rLinksValue.find((link) => link.id === id) });\n    },\n    [rLinksValue],\n  );\n\n  const up = useCallback(() => {\n    // Handle marquee selection finalization\n    // Use ref instead of state since React may not have flushed state updates yet\n    const currentMarquee = marqueeRef.current;\n    if (currentMarquee) {\n      const intersecting = getIntersectingTasks(currentMarquee);\n\n      if (currentMarquee.ctrlKey) {\n        // Additive selection: toggle each intersecting task\n        intersecting.forEach((task) => {\n          api.exec('select-task', { id: task.id, toggle: true, marquee: true });\n        });\n      } else {\n        // Replace selection: clear first, then select intersecting\n        // First clear any existing selection\n        if (selectedValue.length > 0) {\n          api.exec('select-task', { id: null, marquee: true });\n        }\n        // Then select all intersecting tasks\n        intersecting.forEach((task, index) => {\n          api.exec('select-task', {\n            id: task.id,\n            toggle: index > 0, // First one replaces, rest toggle (add)\n            marquee: true,\n          });\n        });\n      }\n\n      setMarquee(null);\n      marqueeRef.current = null;\n      endDrag();\n      ignoreNextClickRef.current = true;\n      return;\n    }\n\n    // Handle bulk move finalization\n    if (bulkMove) {\n      const { dx, originalPositions } = bulkMove;\n      const diff = Math.round(dx / lengthUnitWidth);\n\n      if (diff !== 0) {\n        let isFirst = true;\n        originalPositions.forEach((_origPos, taskId) => {\n          const task = api.getTask(taskId);\n          if (task) {\n            api.exec('update-task', {\n              id: taskId,\n              diff,\n              task: { start: task.start, end: task.end },\n              skipUndo: !isFirst, // Only first task creates undo entry\n            });\n            isFirst = false;\n          }\n        });\n        ignoreNextClickRef.current = true;\n      } else {\n        // No actual move, reset visual positions\n        originalPositions.forEach((origPos, taskId) => {\n          api.exec('drag-task', {\n            id: taskId,\n            left: origPos.$x,\n            width: origPos.$w,\n            inProgress: false,\n          });\n        });\n      }\n\n      setBulkMove(null);\n      endDrag();\n      return;\n    }\n\n    if (progressFromRef.current) {\n      const { dx, id, marker, value } = progressFromRef.current;\n      progressFromRef.current = null;\n      if (typeof value != 'undefined' && dx)\n        api.exec('update-task', {\n          id,\n          task: { progress: value },\n          inProgress: false,\n        });\n      marker.classList.remove('wx-progress-in-drag');\n\n      ignoreNextClickRef.current = true;\n      endDrag();\n    } else if (taskMove) {\n      const { id, mode, dx, l, w, start, segment, index } = taskMove;\n      setTaskMove(null);\n      if (start) {\n        const diff = Math.round(dx / lengthUnitWidth);\n\n        if (!diff) {\n          api.exec('drag-task', {\n            id,\n            width: w,\n            left: l,\n            inProgress: false,\n            ...(segment && { segmentIndex: index }),\n          });\n        } else {\n          let update = {};\n          let task = api.getTask(id);\n          if (segment) task = task.segments[index];\n\n          // Calculate new dates directly instead of relying on store's diff handling\n          const msPerDay = 24 * 60 * 60 * 1000;\n          const daysPerUnit = lengthUnit === 'week' ? 7 : lengthUnit === 'month' ? 30 : lengthUnit === 'quarter' ? 91 : lengthUnit === 'year' ? 365 : 1;\n          const diffMs = diff * daysPerUnit * msPerDay;\n\n          if (mode === 'move') {\n            update.start = new Date(task.start.getTime() + diffMs);\n            update.end = new Date(task.end.getTime() + diffMs);\n          } else if (mode === 'start') {\n            update.start = new Date(task.start.getTime() + diffMs);\n            update.end = task.end; // Keep end fixed for resize\n          } else if (mode === 'end') {\n            update.start = task.start; // Keep start fixed for resize\n            update.end = new Date(task.end.getTime() + diffMs);\n          }\n\n          api.exec('update-task', {\n            id,\n            task: update,\n            ...(segment && { segmentIndex: index }),\n          });\n        }\n        ignoreNextClickRef.current = true;\n      }\n\n      endDrag();\n    }\n  }, [api, endDrag, taskMove, lengthUnitWidth, lengthUnit, marquee, bulkMove, getIntersectingTasks, selectedValue]);\n\n  const move = useCallback(\n    (e, point) => {\n      const { clientX, clientY } = point;\n\n      // Always track mouse X position for paste preview initial position\n      const container = containerRef.current;\n      if (container) {\n        const rect = container.getBoundingClientRect();\n        lastMouseXRef.current = clientX - rect.left;\n      }\n\n      // Handle paste preview mode - ghosts follow cursor\n      if (pastePreview) {\n        if (!container) return;\n        const rect = container.getBoundingClientRect();\n        const currentX = clientX - rect.left;\n        setPastePreview(prev => ({ ...prev, currentX }));\n        return; // Don't process other interactions\n      }\n\n      if (!readonly) {\n        // Handle marquee selection drag\n        if (marquee) {\n          const container = containerRef.current;\n          if (!container) return;\n          const rect = container.getBoundingClientRect();\n\n          // Convert to content-space coordinates (consistent with task.$x)\n          const currentX = clientX - rect.left;\n          const currentY = clientY - rect.top;\n\n          // Update both state (for rendering) and ref (for immediate access in mouseup)\n          setMarquee((prev) => ({\n            ...prev,\n            currentX,\n            currentY,\n          }));\n          if (marqueeRef.current) {\n            marqueeRef.current.currentX = currentX;\n            marqueeRef.current.currentY = currentY;\n          }\n          return;\n        }\n\n        // Handle bulk move drag\n        if (bulkMove) {\n          const dx = clientX - bulkMove.startX;\n\n          // Apply visual offset to all selected tasks\n          bulkMove.originalPositions.forEach((origPos, taskId) => {\n            const newLeft = origPos.$x + dx;\n            api.exec('drag-task', {\n              id: taskId,\n              left: newLeft,\n              width: origPos.$w,\n              inProgress: true,\n            });\n          });\n\n          setBulkMove((prev) => ({ ...prev, dx }));\n          return;\n        }\n\n        if (progressFromRef.current) {\n          const { node, x, id } = progressFromRef.current;\n          const dx = (progressFromRef.current.dx = clientX - x);\n\n          const diff = Math.round((dx / node.offsetWidth) * 100);\n          let progress = progressFromRef.current.progress + diff;\n          progressFromRef.current.value = progress = Math.min(\n            Math.max(0, progress),\n            100,\n          );\n\n          api.exec('update-task', {\n            id,\n            task: { progress },\n            inProgress: true,\n          });\n        } else if (taskMove) {\n          onSelectLink(null);\n          const { mode, l, w, x, id, start, segment, index } = taskMove;\n          const task = api.getTask(id);\n          const dx = clientX - x;\n          if (\n            (!start && Math.abs(dx) < 20) ||\n            (mode === 'start' && w - dx < lengthUnitWidth) ||\n            (mode === 'end' && w + dx < lengthUnitWidth) ||\n            (mode === 'move' &&\n              ((dx < 0 && l + dx < 0) ||\n                (dx > 0 && l + w + dx > totalWidth))) ||\n            (taskMove.segment && !isSegmentMoveAllowed(task, taskMove))\n          )\n            return;\n\n          const nextTaskMove = { ...taskMove, dx };\n\n          let left, width;\n          if (mode === 'start') {\n            left = l + dx;\n            width = w - dx;\n          } else if (mode === 'end') {\n            left = l;\n            width = w + dx;\n          } else if (mode === 'move') {\n            left = l + dx;\n            width = w;\n          }\n\n          api.exec('drag-task', {\n            id,\n            width: width,\n            left: left,\n            inProgress: true,\n            ...(segment && { segmentIndex: index }),\n          });\n\n          if (\n            !nextTaskMove.start &&\n            ((mode === 'move' && task.$x == l) ||\n              (mode !== 'move' && task.$w == w))\n          ) {\n            ignoreNextClickRef.current = true;\n            up();\n            return;\n          }\n          nextTaskMove.start = true;\n          setTaskMove(nextTaskMove);\n        } else {\n          const taskNode = locate(e);\n          if (taskNode) {\n            const task = api.getTask(getID(taskNode));\n            const segNode = locate(e, 'data-segment');\n            const barNode = segNode || taskNode;\n            const mode = getMoveMode(barNode, point, task);\n            barNode.style.cursor = mode && !readonly ? 'col-resize' : 'pointer';\n          }\n        }\n      }\n    },\n    [\n      api,\n      readonly,\n      taskMove,\n      lengthUnitWidth,\n      totalWidth,\n      getMoveMode,\n      onSelectLink,\n      up,\n      marquee,\n      bulkMove,\n      pastePreview,\n    ],\n  );\n\n  const mousemove = useCallback(\n    (e) => {\n      move(e, e);\n    },\n    [move],\n  );\n\n  const touchmove = useCallback(\n    (e) => {\n      if (touched) {\n        e.preventDefault();\n        move(e, e.touches[0]);\n      } else if (touchTimerRef.current) {\n        clearTimeout(touchTimerRef.current);\n        touchTimerRef.current = null;\n      }\n    },\n    [touched, move],\n  );\n\n  const mouseup = useCallback(() => {\n    up();\n  }, [up]);\n\n  const touchend = useCallback(() => {\n    setTouched(null);\n    if (touchTimerRef.current) {\n      clearTimeout(touchTimerRef.current);\n      touchTimerRef.current = null;\n    }\n    up();\n  }, [up]);\n\n  useEffect(() => {\n    window.addEventListener('mouseup', mouseup);\n    return () => {\n      window.removeEventListener('mouseup', mouseup);\n    };\n  }, [mouseup]);\n\n  const onDblClick = useCallback(\n    (e) => {\n      if (!readonly) {\n        const id = locateID(e.target);\n        if (id && !e.target.classList.contains('wx-link')) {\n          const segmentIndex = locateID(e.target, 'data-segment');\n          api.exec('show-editor', {\n            id,\n            ...(segmentIndex !== null && { segmentIndex }),\n          });\n        }\n      }\n    },\n    [api, readonly],\n  );\n\n  const types = ['e2s', 's2s', 'e2e', 's2e'];\n  const getLinkType = useCallback((fromStart, toStart) => {\n    return types[(fromStart ? 1 : 0) + (toStart ? 0 : 2)];\n  }, []);\n\n  const alreadyLinked = useCallback(\n    (target, toStart) => {\n      const source = linkFrom.id;\n      const fromStart = linkFrom.start;\n\n      if (target === source) return true;\n\n      return !!rLinksValue.find((l) => {\n        return (\n          l.target == target &&\n          l.source == source &&\n          l.type === getLinkType(fromStart, toStart)\n        );\n      });\n    },\n    [linkFrom, rLinksCounter, getLinkType],\n  );\n\n  const removeLinkMarker = useCallback(() => {\n    if (linkFrom) {\n      setLinkFrom(null);\n    }\n  }, [linkFrom]);\n\n  // Execute paste - creates new tasks at target position\n  // Tasks are pasted within the same parent, each task keeps its original row\n  const executePaste = useCallback((targetDate, tasks, parent) => {\n    if (!tasks.length || !targetDate) return;\n    // Note: parent can be 0 (root level), so check for undefined/null specifically\n    if (parent === undefined || parent === null) return;\n\n    console.log('[paste] executePaste called:', {\n      targetDate: targetDate.toISOString(),\n      taskCount: tasks.length,\n      parent,\n    });\n\n    const msPerDay = 86400000;\n    const history = api.getHistory();\n    history?.startBatch();\n\n    // Normalize targetDate to UTC midnight (scales.start is now normalized)\n    const targetColumnStart = new Date(targetDate);\n    targetColumnStart.setUTCHours(0, 0, 0, 0);\n\n    console.log('[paste] scalesValue:', {\n      start: scalesValue?.start?.toISOString?.(),\n      lengthUnit: scalesValue?.lengthUnit,\n      lengthUnitWidth: scalesValue?.lengthUnitWidth,\n    });\n\n    tasks.forEach((task, i) => {\n      const newId = `task-${Date.now()}-${i}`;\n\n      console.log('[paste] task input:', {\n        text: task.text,\n        _startCellOffset: task._startCellOffset,\n        _startDayOfWeek: task._startDayOfWeek,\n        _durationDays: task._durationDays,\n        start: task.start?.toISOString?.(),\n        end: task.end?.toISOString?.(),\n      });\n\n      // Calculate the cell offset from the target column (scales.start is normalized to Monday)\n      const cellOffset = addCells(targetColumnStart, task._startCellOffset || 0, scalesValue);\n      console.log('[paste] cellOffset:', cellOffset?.toISOString?.());\n\n      // Add day-of-week offset (scales.start is Monday, so _startDayOfWeek=0 means Monday)\n      const newStart = new Date(cellOffset.getTime() + (task._startDayOfWeek || 0) * msPerDay);\n      newStart.setUTCHours(0, 0, 0, 0);\n      // Add exact duration in days (not weeks!) to preserve visual width\n      const newEnd = new Date(newStart.getTime() + (task._durationDays || 7) * msPerDay);\n      newEnd.setUTCHours(0, 0, 0, 0);\n      console.log('[paste] task calculated:', {\n        text: task.text,\n        newStart: newStart.toISOString(),\n        newEnd: newEnd.toISOString(),\n        row: task.row,\n      });\n\n      api.exec('add-task', {\n        task: {\n          id: newId,\n          text: task.text,\n          start: newStart,\n          end: newEnd,\n          type: task.type || 'task',\n          parent: parent,\n          row: task.row,\n        },\n        target: parent,\n        mode: 'child',\n        skipUndo: i > 0,\n      });\n    });\n\n    history?.endBatch();\n  }, [api, scalesValue]);\n\n  const onClick = useCallback(\n    (e) => {\n      if (ignoreNextClickRef.current) {\n        ignoreNextClickRef.current = false;\n        return;\n      }\n\n      // Handle paste preview confirm\n      if (pastePreview && pastePreview.currentX != null) {\n        const targetDate = pixelToDate(pastePreview.currentX, scalesValue);\n        if (targetDate) {\n          executePaste(targetDate, pastePreview.tasks, pastePreview.parent);\n        }\n        setPastePreview(null);\n        return;\n      }\n\n      const id = locateID(e.target);\n      if (id) {\n        // Debug: log task info on click\n        const clickedTask = api.getTask(id);\n        const renderedTask = rTasksValue.find(t => t.id === id);\n        console.log('[click] task:', clickedTask?.text, 'id:', id);\n        console.log('[click] api.getTask:', { start: clickedTask?.start, end: clickedTask?.end, duration: clickedTask?.duration });\n        console.log('[click] rendered:', { start: renderedTask?.start, end: renderedTask?.end, $w: renderedTask?.$w, $x: renderedTask?.$x });\n\n        const css = e.target.classList;\n        if (css.contains('wx-link')) {\n          const toStart = css.contains('wx-left');\n          if (!linkFrom) {\n            setLinkFrom({ id, start: toStart });\n            return;\n          }\n\n          if (linkFrom.id !== id && !alreadyLinked(id, toStart)) {\n            api.exec('add-link', {\n              link: {\n                source: linkFrom.id,\n                target: id,\n                type: getLinkType(linkFrom.start, toStart),\n              },\n            });\n          }\n        } else if (css.contains('wx-delete-button-icon')) {\n          api.exec('delete-link', { id: selectedLink.id });\n          setSelectedLink(null);\n        } else {\n          let segmentIndex;\n          const segmentNode = locate(e, 'data-segment');\n          if (segmentNode) segmentIndex = segmentNode.dataset.segment * 1;\n          api.exec('select-task', {\n            id,\n            toggle: e.ctrlKey || e.metaKey,\n            range: e.shiftKey,\n            segmentIndex,\n          });\n        }\n      }\n      removeLinkMarker();\n    },\n    [\n      api,\n      linkFrom,\n      rLinksCounter,\n      selectedLink,\n      alreadyLinked,\n      getLinkType,\n      removeLinkMarker,\n      pastePreview,\n      scalesValue,\n      executePaste,\n    ],\n  );\n\n  const taskStyle = useCallback((task) => {\n    return {\n      left: `${task.$x}px`,\n      top: `${task.$y}px`,\n      width: `${task.$w}px`,\n      height: `${task.$h}px`,\n    };\n  }, []);\n\n  const baselineStyle = useCallback((task) => {\n    return {\n      left: `${task.$x_base}px`,\n      top: `${task.$y_base}px`,\n      width: `${task.$w_base}px`,\n      height: `${task.$h_base}px`,\n    };\n  }, []);\n\n  const contextmenu = useCallback(\n    (ev) => {\n      if (touched || touchTimerRef.current) {\n        ev.preventDefault();\n        return false;\n      }\n    },\n    [touched],\n  );\n\n  const taskTypeIds = useMemo(\n    () => taskTypesValue.map((t) => t.id),\n    [taskTypesValue],\n  );\n\n  const taskTypeCss = useCallback(\n    (type) => {\n      let css = taskTypeIds.includes(type) ? type : 'task';\n      if (!['task', 'milestone', 'summary'].includes(type)) {\n        css = `task ${css}`;\n      }\n      return css;\n    },\n    [taskTypeIds],\n  );\n\n  const forward = useCallback(\n    (ev) => {\n      api.exec(ev.action, ev.data);\n    },\n    [api],\n  );\n\n  const isTaskCritical = useCallback(\n    (taskId) => {\n      return criticalPath && tree.byId(taskId).$critical;\n    },\n    [criticalPath, tree],\n  );\n\n  const isLinkMarkerVisible = useCallback(\n    (id) => {\n      if (schedule?.auto) {\n        const summaryIds = tree.getSummaryId(id, true);\n        const linkFromSummaryIds = tree.getSummaryId(linkFrom.id, true);\n        return (\n          linkFrom?.id &&\n          !(Array.isArray(summaryIds) ? summaryIds : [summaryIds]).includes(\n            linkFrom.id,\n          ) &&\n          !(\n            Array.isArray(linkFromSummaryIds)\n              ? linkFromSummaryIds\n              : [linkFromSummaryIds]\n          ).includes(id)\n        );\n      }\n      return linkFrom;\n    },\n    [schedule, tree, linkFrom],\n  );\n\n  // Copy handler - stores selected tasks in module-level clipboard\n  // Only allows copying tasks from the same parent (company), but different rows are OK\n  // All dates are expected to be UTC - no conversion needed\n  const handleCopy = useCallback(() => {\n    const selected = api.getState()._selected;\n    if (!selected || !selected.length) return;\n\n    const msPerDay = 86400000;\n\n    // Get all selected tasks with their render data from _tasks\n    const tasks = selected.map((sel) => {\n      const task = api.getTask(sel.id);\n      if (!task) return null;\n      // Find the rendered task to get $w (pixel width) and row\n      const renderedTask = rTasksValue.find(t => t.id === sel.id);\n      if (!renderedTask) return null;\n      const { $x, $y, $h, $w, $skip, $level, $index, $y_base, $x_base, $w_base, $h_base, $skip_baseline, $critical, $reorder, ...clean } = renderedTask;\n      // Calculate exact duration in days (not cells!) to preserve visual width\n      const durationDays = renderedTask.end && renderedTask.start\n        ? Math.round((renderedTask.end.getTime() - renderedTask.start.getTime()) / msPerDay)\n        : 0;\n      // Store day-of-week offset (0=Mon, 6=Sun) to preserve position within week\n      // Dates are already UTC\n      const startDayOfWeek = renderedTask.start\n        ? (renderedTask.start.getUTCDay() + 6) % 7  // Convert JS Sun=0 to Mon=0\n        : 0;\n      console.log('[copy] task:', {\n        id: task.id,\n        text: task.text,\n        start: renderedTask.start?.toISOString?.(),\n        end: renderedTask.end?.toISOString?.(),\n        durationDays,\n        startDayOfWeek,\n        $w,\n        $h,\n        row: renderedTask.row,\n        parent: renderedTask.parent,\n      });\n      return { ...clean, _durationDays: durationDays, _startDayOfWeek: startDayOfWeek, _originalWidth: $w, _originalHeight: $h };\n    }).filter(Boolean);\n\n    if (!tasks.length) return;\n\n    // Check that all tasks have the same parent (company)\n    const firstTask = tasks[0];\n    const commonParent = firstTask.parent;\n\n    // Filter to only include tasks with matching parent (different rows OK)\n    const validTasks = tasks.filter(t => t.parent === commonParent);\n\n    if (validTasks.length === 0) return;\n\n    // Store base date (earliest start) - dates are already UTC\n    const baseDate = validTasks.reduce((min, t) => {\n      if (!t.start) return min;\n      return !min || t.start < min ? t.start : min;\n    }, null);\n\n    // Store clipboard data with cell offsets (weeks between tasks)\n    clipboardTasks = validTasks.map(t => ({\n      ...t,\n      _startCellOffset: getCellOffset(t.start, baseDate, scalesValue),\n    }));\n    clipboardParent = commonParent;\n    clipboardBaseDate = baseDate;\n\n    // Log clipboard summary for debugging\n    console.log('[copy] clipboard stored:', {\n      taskCount: clipboardTasks.length,\n      baseDate: baseDate?.toISOString?.(),\n      parent: commonParent,\n      tasks: clipboardTasks.map(t => ({\n        id: t.id,\n        text: t.text,\n        _startCellOffset: t._startCellOffset,\n        _startDayOfWeek: t._startDayOfWeek,\n        _durationDays: t._durationDays,\n      })),\n    });\n  }, [api, scalesValue]);\n\n  // Hotkey intercept for copy/paste\n  useEffect(() => {\n    if (!copyPaste) return;\n\n    const unsub = api.intercept('hotkey', (ev) => {\n      if (ev.key === 'ctrl+c' || ev.key === 'meta+c') {\n        handleCopy();\n        return false;\n      }\n      if (ev.key === 'ctrl+v' || ev.key === 'meta+v') {\n        // Enter paste preview mode instead of immediate paste\n        if (!clipboardTasks.length || !clipboardBaseDate) return false;\n        // Use last tracked mouse position for immediate ghost display\n        setPastePreview({\n          tasks: clipboardTasks,\n          baseDate: clipboardBaseDate,\n          parent: clipboardParent,\n          currentX: lastMouseXRef.current, // Show ghosts at current mouse position\n        });\n        return false;\n      }\n    });\n    return unsub;\n  }, [copyPaste, api, handleCopy]);\n\n  // Escape key to cancel paste preview (separate listener for reliability)\n  useEffect(() => {\n    if (!pastePreview) return;\n\n    const handleKeyDown = (e) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        e.stopPropagation();\n        setPastePreview(null);\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown, true);\n    return () => document.removeEventListener('keydown', handleKeyDown, true);\n  }, [pastePreview]);\n\n  // Compute marquee rectangle style\n  const marqueeStyle = useMemo(() => {\n    if (!marquee) return null;\n    const left = Math.min(marquee.startX, marquee.currentX);\n    const top = Math.min(marquee.startY, marquee.currentY);\n    const width = Math.abs(marquee.currentX - marquee.startX);\n    const height = Math.abs(marquee.currentY - marquee.startY);\n    return {\n      left: `${left}px`,\n      top: `${top}px`,\n      width: `${width}px`,\n      height: `${height}px`,\n    };\n  }, [marquee]);\n\n  return (\n    <div\n      className=\"wx-GKbcLEGA wx-bars\"\n      style={{ lineHeight: `${adjustedTasks.length ? adjustedTasks[0].$h : 0}px` }}\n      ref={containerRef}\n      onContextMenu={contextmenu}\n      onMouseDown={mousedown}\n      onMouseMove={mousemove}\n      onTouchStart={touchstart}\n      onTouchMove={touchmove}\n      onTouchEnd={touchend}\n      onClick={onClick}\n      onDoubleClick={onDblClick}\n      onDragStart={(e) => {\n        e.preventDefault();\n        return false;\n      }}\n    >\n      <Links\n        onSelectLink={onSelectLink}\n        selectedLink={selectedLink}\n        readonly={readonly}\n      />\n      {adjustedTasks.map((task) => {\n        if (task.$skip && task.$skip_baseline) return null;\n        const isOverlapping = overlappingTaskIds.has(task.id);\n        const barClass =\n          `wx-bar wx-${taskTypeCss(task.type)}` +\n          (task.$css ? ` ${task.$css}` : '') +\n          (touched && taskMove && task.id === taskMove.id ? ' wx-touch' : '') +\n          (linkFrom && linkFrom.id === task.id ? ' wx-selected' : '') +\n          (selectedIds.has(task.id) ? ' wx-selected' : '') +\n          (isTaskCritical(task.id) ? ' wx-critical' : '') +\n          (task.$reorder ? ' wx-reorder-task' : '') +\n          (splitTasks && task.segments ? ' wx-split' : '') +\n          (isOverlapping ? ' wx-collision' : '');\n        const leftLinkClass =\n          'wx-link wx-left' +\n          (linkFrom ? ' wx-visible' : '') +\n          (!linkFrom ||\n          (!alreadyLinked(task.id, true) && isLinkMarkerVisible(task.id))\n            ? ' wx-target'\n            : '') +\n          (linkFrom && linkFrom.id === task.id && linkFrom.start\n            ? ' wx-selected'\n            : '') +\n          (isTaskCritical(task.id) ? ' wx-critical' : '');\n        const rightLinkClass =\n          'wx-link wx-right' +\n          (linkFrom ? ' wx-visible' : '') +\n          (!linkFrom ||\n          (!alreadyLinked(task.id, false) && isLinkMarkerVisible(task.id))\n            ? ' wx-target'\n            : '') +\n          (linkFrom && linkFrom.id === task.id && !linkFrom.start\n            ? ' wx-selected'\n            : '') +\n          (isTaskCritical(task.id) ? ' wx-critical' : '');\n        return (\n          <Fragment key={task.id}>\n            {!task.$skip && (\n              <div\n                className={'wx-GKbcLEGA ' + barClass}\n                style={taskStyle(task)}\n                data-tooltip-id={task.id}\n                data-id={task.id}\n                tabIndex={focused === task.id ? 0 : -1}\n              >\n                {!readonly ? (\n                  task.id === selectedLink?.target &&\n                  selectedLink?.type[2] === 's' ? (\n                    <Button\n                      type=\"danger\"\n                      css=\"wx-left wx-delete-button wx-delete-link\"\n                    >\n                      <i className=\"wxi-close wx-delete-button-icon\"></i>\n                    </Button>\n                  ) : (\n                    <div className={'wx-GKbcLEGA ' + leftLinkClass}>\n                      <div className=\"wx-GKbcLEGA wx-inner\"></div>\n                    </div>\n                  )\n                ) : null}\n\n                {task.type !== 'milestone' ? (\n                  <>\n                    {task.progress && !(splitTasks && task.segments) ? (\n                      <div className=\"wx-GKbcLEGA wx-progress-wrapper\">\n                        <div\n                          className=\"wx-GKbcLEGA wx-progress-percent\"\n                          style={{ width: `${task.progress}%` }}\n                        ></div>\n                      </div>\n                    ) : null}\n                    {!readonly && !(splitTasks && task.segments) ? (\n                      <div\n                        className=\"wx-GKbcLEGA wx-progress-marker\"\n                        style={{ left: `calc(${task.progress}% - 10px)` }}\n                      >\n                        {task.progress}\n                      </div>\n                    ) : null}\n                    {TaskTemplate ? (\n                      <TaskTemplate data={task} api={api} onAction={forward} />\n                    ) : splitTasks && task.segments ? (\n                      <BarSegments task={task} type={taskTypeCss(task.type)} />\n                    ) : (\n                      <div className=\"wx-GKbcLEGA wx-content\">\n                        {summaryBarCounts && task.type === 'summary' ? '' : (task.$barText || task.text || '')}\n                      </div>\n                    )}\n                    {isOverlapping && (\n                      <div className=\"wx-GKbcLEGA wx-collision-warning\" title=\"This task overlaps with another task in the same row\">\n                        !\n                      </div>\n                    )}\n                    {summaryColCounts && task.type === 'summary' && (() => {\n                      const colCounts = summaryColCounts.get(task.id);\n                      const startCol = Math.floor(task.$x / lengthUnitWidth);\n                      const endCol = Math.ceil((task.$x + task.$w) / lengthUnitWidth);\n                      return (\n                        <div className=\"wx-GKbcLEGA wx-summary-week-counts\">\n                          {Array.from({ length: endCol - startCol }, (_, i) => {\n                            const col = startCol + i;\n                            const count = colCounts?.get(col) || 0;\n                            return (\n                              <span\n                                key={col}\n                                className={`wx-GKbcLEGA wx-week-count${count === 0 ? ' wx-week-count-zero' : ''}`}\n                                style={{\n                                  position: 'absolute',\n                                  left: `${col * lengthUnitWidth - task.$x}px`,\n                                  width: `${lengthUnitWidth}px`,\n                                  top: 0,\n                                  height: '100%',\n                                  display: 'flex',\n                                  alignItems: 'center',\n                                  justifyContent: 'center',\n                                }}\n                              >\n                                {count}\n                              </span>\n                            );\n                          })}\n                        </div>\n                      );\n                    })()}\n                  </>\n                ) : (\n                  <>\n                    <div className=\"wx-GKbcLEGA wx-content\"></div>\n                    {TaskTemplate ? (\n                      <TaskTemplate data={task} api={api} onAction={forward} />\n                    ) : (\n                      <div className=\"wx-GKbcLEGA wx-text-out\">{task.$barText || task.text}</div>\n                    )}\n                  </>\n                )}\n\n                {!readonly ? (\n                  task.id === selectedLink?.target &&\n                  selectedLink?.type[2] === 'e' ? (\n                    <Button\n                      type=\"danger\"\n                      css=\"wx-right wx-delete-button wx-delete-link\"\n                    >\n                      <i className=\"wxi-close wx-delete-button-icon\"></i>\n                    </Button>\n                  ) : (\n                    <div className={'wx-GKbcLEGA ' + rightLinkClass}>\n                      <div className=\"wx-GKbcLEGA wx-inner\"></div>\n                    </div>\n                  )\n                ) : null}\n              </div>\n            )}\n            {baselinesValue && !task.$skip_baseline ? (\n              <div\n                className={\n                  'wx-GKbcLEGA wx-baseline' +\n                  (task.type === 'milestone' ? ' wx-milestone' : '')\n                }\n                style={baselineStyle(task)}\n              ></div>\n            ) : null}\n          </Fragment>\n        );\n      })}\n      {marquee && marqueeStyle && (\n        <div className=\"wx-GKbcLEGA wx-marquee-selection\" style={marqueeStyle} />\n      )}\n      {pastePreview && pastePreview.currentX != null && (\n        pastePreview.tasks.map((task, i) => {\n          // Calculate ghost x position directly from pixel position (snap to week cell)\n          const cellIndex = Math.floor(pastePreview.currentX / lengthUnitWidth);\n          const x = (cellIndex + (task._startCellOffset || 0)) * lengthUnitWidth;\n          // Use original width and height for accurate ghost size\n          const w = task._originalWidth || lengthUnitWidth;\n          const h = task._originalHeight || cellHeight;\n          // Find row Y position using rowYPositions map or fallback\n          const rowY = rowYPositions.get(task.row) ?? (task.$y || 0);\n          return (\n            <div\n              key={`preview-${i}`}\n              className=\"wx-GKbcLEGA wx-bar wx-task wx-paste-preview\"\n              style={{ left: x, top: rowY, width: w, height: h }}\n            >\n              <div className=\"wx-GKbcLEGA wx-content\">{task.$barText || task.text}</div>\n            </div>\n          );\n        })\n      )}\n    </div>\n  );\n}\n\nexport default Bars;\n","import { useContext } from 'react';\nimport storeContext from '../../context';\nimport { useStore } from '@svar-ui/lib-react';\nimport './TimeScale.css';\n\nfunction TimeScale(props) {\n  const { highlightTime, onScaleClick } = props;\n\n  const api = useContext(storeContext);\n  const scales = useStore(api, '_scales');\n\n  return (\n    <div className=\"wx-ZkvhDKir wx-scale\" style={{ width: scales.width }}>\n      {(scales?.rows || []).map((row, rowIdx) => (\n        <div\n          className=\"wx-ZkvhDKir wx-row\"\n          style={{ height: `${row.height}px` }}\n          key={rowIdx}\n        >\n          {(row.cells || []).map((cell, cellIdx) => {\n            const extraClass = highlightTime\n              ? highlightTime(cell.date, cell.unit)\n              : '';\n            const className =\n              'wx-cell ' + (cell.css || '') + ' ' + (extraClass || '');\n            // Support HTML in scale cell values (for multi-line templates)\n            const isHtml = typeof cell.value === 'string' && cell.value.includes('<');\n            return (\n              <div\n                className={'wx-ZkvhDKir ' + className}\n                style={{ width: `${cell.width}px`, cursor: onScaleClick ? 'pointer' : undefined }}\n                key={cellIdx}\n                onClick={onScaleClick ? (e) => onScaleClick(cell.date, cell.unit, e.nativeEvent) : undefined}\n                {...(isHtml ? { dangerouslySetInnerHTML: { __html: cell.value } } : { children: cell.value })}\n              />\n            );\n          })}\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport default TimeScale;\n","import { useRef, useEffect } from 'react';\n\nconst renderMetrics = new Map();\n\nexport function useRenderTime(label) {\n  const startTime = useRef(null);\n  const renderCount = useRef(0);\n  const rafRef = useRef(null);\n\n  const enabled =\n    typeof window !== 'undefined' && window.__RENDER_METRICS_ENABLED__;\n\n  if (startTime.current === null) {\n    startTime.current = performance.now();\n  }\n  renderCount.current++;\n\n  useEffect(() => {\n    if (!enabled) return;\n\n    cancelAnimationFrame(rafRef.current);\n\n    rafRef.current = requestAnimationFrame(() => {\n      const metric = {\n        label,\n        time: performance.now() - startTime.current,\n        renders: renderCount.current,\n        timestamp: Date.now(),\n      };\n\n      renderMetrics.set(label, metric);\n\n      window.dispatchEvent(\n        new CustomEvent('render-metric', { detail: metric }),\n      );\n    });\n\n    return () => cancelAnimationFrame(rafRef.current);\n  });\n}\n","import {\n  useState,\n  useEffect,\n  useMemo,\n  useRef,\n  useContext,\n  useCallback,\n} from 'react';\nimport CellGrid from './CellGrid.jsx';\nimport Bars from './Bars.jsx';\nimport { hotkeys } from '@svar-ui/grid-store';\nimport storeContext from '../../context';\nimport { useStore, useStoreWithCounter } from '@svar-ui/lib-react';\nimport './Chart.css';\nimport TimeScales from './TimeScale.jsx';\nimport { useRenderTime } from '../../helpers/debug.js';\n\nfunction Chart(props) {\n  const {\n    readonly,\n    fullWidth,\n    fullHeight,\n    taskTemplate,\n    cellBorders,\n    highlightTime,\n    onScaleClick,\n    multiTaskRows = false,\n    rowMapping = null,\n    marqueeSelect = false,\n    copyPaste = false,\n    scrollToCurrentWeek = false,\n    currentWeekColor = null,\n    allowTaskIntersection = true,\n    summaryBarCounts = false,\n  } = props;\n\n  const api = useContext(storeContext);\n\n  const [selected, selectedCounter] = useStoreWithCounter(api, '_selected');\n  const rScrollTop = useStore(api, 'scrollTop');\n  const cellHeight = useStore(api, 'cellHeight');\n  const cellWidth = useStore(api, 'cellWidth');\n  const scales = useStore(api, '_scales');\n  const markers = useStore(api, '_markers');\n  const rScrollTask = useStore(api, '_scrollTask');\n  const zoom = useStore(api, 'zoom');\n  const rTasks = useStore(api, '_tasks');\n\n  const [chartHeight, setChartHeight] = useState();\n  const chartRef = useRef(null);\n  const zoomAccumulatorRef = useRef(0);\n  const hasScrolledToCurrentWeekRef = useRef(false);\n\n  const extraRows = 1 + (scales?.rows?.length || 0);\n\n  // Compute adjusted Y positions for multiTaskRows\n  const taskYPositions = useMemo(() => {\n    if (!multiTaskRows || !rowMapping || !rTasks?.length) return null;\n\n    const yMap = new Map();\n    const rowIndexMap = new Map();\n    const seenRows = [];\n\n    rTasks.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      if (!rowIndexMap.has(rowId)) {\n        rowIndexMap.set(rowId, seenRows.length);\n        seenRows.push(rowId);\n      }\n    });\n\n    rTasks.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      const rowIndex = rowIndexMap.get(rowId) ?? 0;\n      yMap.set(task.id, rowIndex * cellHeight);\n    });\n\n    return yMap;\n  }, [rTasks, multiTaskRows, rowMapping, cellHeight]);\n\n  const selectStyle = useMemo(() => {\n    const t = [];\n    if (selected && selected.length && cellHeight) {\n      selected.forEach((obj) => {\n        // Use adjusted Y if multiTaskRows is enabled\n        const adjustedY = taskYPositions?.get(obj.id) ?? obj.$y;\n        t.push({ height: `${cellHeight}px`, top: `${adjustedY - 3}px` });\n      });\n    }\n    return t;\n  }, [selectedCounter, cellHeight, taskYPositions]);\n\n  const chartGridHeight = useMemo(\n    () => Math.max(chartHeight || 0, fullHeight),\n    [chartHeight, fullHeight],\n  );\n\n  useEffect(() => {\n    const el = chartRef.current;\n    if (!el) return;\n\n    if (typeof rScrollTop === 'number') {\n      el.scrollTop = rScrollTop;\n    }\n  }, [rScrollTop]);\n\n  const onScroll = () => {\n    const scroll = { left: true };\n    setScroll(scroll);\n  };\n\n  function setScroll(scroll) {\n    const el = chartRef.current;\n    if (!el) return;\n    const pos = {};\n    if (scroll.left) pos.left = el.scrollLeft;\n    api.exec('scroll-chart', pos);\n  }\n\n  function dataRequest() {\n    const el = chartRef.current;\n    const clientHeightLocal = chartHeight || 0;\n    const num = Math.ceil(clientHeightLocal / (cellHeight || 1)) + 1;\n    const pos = Math.floor(((el && el.scrollTop) || 0) / (cellHeight || 1));\n    const start = Math.max(0, pos - extraRows);\n    const end = pos + num + extraRows;\n    const from = start * (cellHeight || 0);\n    api.exec('render-data', {\n      start,\n      end,\n      from,\n    });\n  }\n\n  useEffect(() => {\n    dataRequest();\n  }, [chartHeight, rScrollTop]);\n\n  const showTask = useCallback(\n    (value) => {\n      if (!value) return;\n\n      const { id, mode } = value;\n\n      if (mode.toString().indexOf('x') < 0) return;\n      const el = chartRef.current;\n      if (!el) return;\n      const { clientWidth } = el;\n      const task = api.getTask(id);\n      if (task.$x + task.$w < el.scrollLeft) {\n        api.exec('scroll-chart', { left: task.$x - (cellWidth || 0) });\n        el.scrollLeft = task.$x - (cellWidth || 0);\n      } else if (task.$x >= clientWidth + el.scrollLeft) {\n        const width = clientWidth < task.$w ? cellWidth || 0 : task.$w;\n        api.exec('scroll-chart', { left: task.$x - clientWidth + width });\n        el.scrollLeft = task.$x - clientWidth + width;\n      }\n    },\n    [api, cellWidth],\n  );\n\n  useEffect(() => {\n    showTask(rScrollTask);\n  }, [rScrollTask]);\n\n  function onWheel(e) {\n    if (zoom && (e.ctrlKey || e.metaKey)) {\n      e.preventDefault();\n      const el = chartRef.current;\n      const offset = e.clientX - (el ? el.getBoundingClientRect().left : 0);\n\n      // Accumulate delta for smoother zoom (threshold ~3 wheel ticks)\n      zoomAccumulatorRef.current += e.deltaY;\n      const threshold = 150;\n\n      if (Math.abs(zoomAccumulatorRef.current) >= threshold) {\n        const dir = -Math.sign(zoomAccumulatorRef.current);\n        zoomAccumulatorRef.current = 0;\n        api.exec('zoom-scale', {\n          dir,\n          offset,\n        });\n      }\n    }\n  }\n\n  const getHoliday = useCallback((cell) => {\n    const style = highlightTime(cell.date, cell.unit);\n    if (style)\n      return {\n        css: style,\n        width: cell.width,\n      };\n    return null;\n  }, [highlightTime]);\n\n  const holidays = useMemo(() => {\n    if (!scales || !highlightTime) return null;\n    // Support day, hour, and week units for highlighting\n    const supportedUnits = ['hour', 'day', 'week'];\n    if (!supportedUnits.includes(scales.minUnit)) return null;\n\n    // Calculate left positions for each cell\n    let accumulatedLeft = 0;\n    return scales.rows[scales.rows.length - 1].cells.map((cell) => {\n      const holiday = getHoliday(cell);\n      const left = accumulatedLeft;\n      accumulatedLeft += cell.width;\n      if (holiday) {\n        return { ...holiday, left };\n      }\n      return null;\n    });\n  }, [scales, highlightTime, getHoliday]);\n\n  const handleHotkey = useCallback(\n    (ev) => {\n      ev.eventSource = 'chart';\n      api.exec('hotkey', ev);\n    },\n    [api],\n  );\n\n  useEffect(() => {\n    const el = chartRef.current;\n    if (!el) return;\n    const update = () => setChartHeight(el.clientHeight);\n    update();\n    const ro = new ResizeObserver(() => update());\n    ro.observe(el);\n    return () => {\n      ro.disconnect();\n    };\n  }, [chartRef.current]);\n\n  const cleanupRef = useRef(null);\n\n  useEffect(() => {\n    const el = chartRef.current;\n    if (!el) return;\n    if (cleanupRef.current) return;\n    cleanupRef.current = hotkeys(el, {\n      keys: {\n        arrowup: true,\n        arrowdown: true,\n      },\n      exec: (v) => handleHotkey(v),\n    });\n    return () => {\n      cleanupRef.current?.destroy();\n      cleanupRef.current = null;\n    };\n  }, []);\n\n  useEffect(() => {\n    const node = chartRef.current;\n    if (!node) return;\n\n    const handler = onWheel;\n    node.addEventListener('wheel', handler);\n    return () => {\n      node.removeEventListener('wheel', handler);\n    };\n  }, [onWheel]);\n\n  // Scroll to center current week on mount\n  useEffect(() => {\n    if (!scrollToCurrentWeek || hasScrolledToCurrentWeekRef.current) return;\n    if (!scales || !chartRef.current || !chartHeight) return;\n\n    const el = chartRef.current;\n    const { clientWidth } = el;\n\n    // Find current week cell in the bottom scale row\n    const now = new Date();\n    const cells = scales.rows[scales.rows.length - 1]?.cells;\n    if (!cells) return;\n\n    let currentWeekIndex = -1;\n    let accumulatedWidth = 0;\n    const cellPositions = []; // Store {left, width} for each cell\n\n    for (let i = 0; i < cells.length; i++) {\n      const cell = cells[i];\n      cellPositions.push({ left: accumulatedWidth, width: cell.width });\n\n      const cellStart = cell.date;\n      // Week cell: check if now is within 7 days of the cell start (UTC)\n      if (cell.unit === 'week') {\n        const cellEnd = new Date(cellStart);\n        cellEnd.setUTCDate(cellEnd.getUTCDate() + 7);\n        if (now >= cellStart && now < cellEnd) {\n          currentWeekIndex = i;\n        }\n      } else if (cell.unit === 'day') {\n        // Day cell: check if same date (UTC)\n        if (\n          now.getUTCFullYear() === cellStart.getUTCFullYear() &&\n          now.getUTCMonth() === cellStart.getUTCMonth() &&\n          now.getUTCDate() === cellStart.getUTCDate()\n        ) {\n          currentWeekIndex = i;\n        }\n      }\n      accumulatedWidth += cell.width;\n    }\n\n    // Use previous week if current week found\n    let targetIndex = currentWeekIndex;\n    if (currentWeekIndex > 0) {\n      targetIndex = currentWeekIndex - 1; // Previous week\n    }\n\n    if (targetIndex >= 0 && cellPositions[targetIndex]) {\n      const target = cellPositions[targetIndex];\n      // Scroll so previous week is at the left edge of viewport\n      const scrollLeft = Math.max(0, target.left);\n      el.scrollLeft = scrollLeft;\n      api.exec('scroll-chart', { left: scrollLeft });\n      hasScrolledToCurrentWeekRef.current = true;\n    }\n  }, [scrollToCurrentWeek, scales, chartHeight, api]);\n\n  useRenderTime(\"chart\");\n  \n  return (\n    <div\n      className=\"wx-mR7v2Xag wx-chart\"\n      tabIndex={-1}\n      ref={chartRef}\n      onScroll={onScroll}\n    >\n      <TimeScales highlightTime={highlightTime} onScaleClick={onScaleClick} scales={scales} />\n      {markers && markers.length ? (\n        <div\n          className=\"wx-mR7v2Xag wx-markers\"\n          style={{ height: `${chartGridHeight}px` }}\n        >\n          {markers.map((marker, i) => (\n            <div\n              key={i}\n              className={`wx-mR7v2Xag wx-marker ${marker.css || ''}`}\n              style={{ left: `${marker.left}px` }}\n            >\n              <div className=\"wx-mR7v2Xag wx-content\">{marker.text}</div>\n            </div>\n          ))}\n        </div>\n      ) : null}\n\n      <div\n        className=\"wx-mR7v2Xag wx-area\"\n        style={{ width: `${fullWidth}px`, height: `${chartGridHeight}px` }}\n      >\n        {holidays ? (\n          <div\n            className=\"wx-mR7v2Xag wx-gantt-holidays\"\n            style={{ height: '100%' }}\n          >\n            {holidays.map((holiday, i) =>\n              holiday ? (\n                <div\n                  key={i}\n                  className={'wx-mR7v2Xag ' + holiday.css}\n                  style={{\n                    width: `${holiday.width}px`,\n                    left: `${holiday.left}px`,\n                  }}\n                />\n              ) : null,\n            )}\n          </div>\n        ) : null}\n\n        <CellGrid borders={cellBorders} />\n\n        {selected && selected.length\n          ? selected.map((obj, index) =>\n              obj.$y ? (\n                <div\n                  key={obj.id}\n                  className=\"wx-mR7v2Xag wx-selected\"\n                  data-id={obj.id}\n                  style={selectStyle[index]}\n                ></div>\n              ) : null,\n            )\n          : null}\n\n        <Bars\n          readonly={readonly}\n          taskTemplate={taskTemplate}\n          multiTaskRows={multiTaskRows}\n          rowMapping={rowMapping}\n          marqueeSelect={marqueeSelect}\n          copyPaste={copyPaste}\n          allowTaskIntersection={allowTaskIntersection}\n          summaryBarCounts={summaryBarCounts}\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default Chart;\n","import { useState, useMemo, useRef, useCallback, useEffect } from 'react';\nimport { useWritableProp } from '@svar-ui/lib-react';\nimport './Resizer.css';\n\nfunction Resizer(props) {\n  const {\n    position = 'after',\n    size = 4,\n    dir = 'x',\n    onMove,\n    onDisplayChange,\n    compactMode,\n    containerWidth = 0,\n    leftThreshold = 50,\n    rightThreshold = 50,\n  } = props;\n\n  const [value, setValue] = useWritableProp(props.value ?? 0);\n  const [display, setDisplay] = useWritableProp(props.display ?? 'all');\n\n  function getBox(val) {\n    let offset = 0;\n    if (position == 'center') offset = size / 2;\n    else if (position == 'before') offset = size;\n\n    const box = {\n      size: [size + 'px', 'auto'],\n      p: [val - offset + 'px', '0px'],\n      p2: ['auto', '0px'],\n    };\n\n    if (dir != 'x') {\n      for (let name in box) box[name] = box[name].reverse();\n    }\n    return box;\n  }\n\n  const [active, setActive] = useState(false);\n  const [initialPosition, setInitialPosition] = useState(null);\n\n  const startRef = useRef(0);\n  const posRef = useRef();\n  const timeoutRef = useRef();\n  const displayRef = useRef(display);\n\n  useEffect(() => {\n    displayRef.current = display;\n  }, [display]);\n\n  useEffect(() => {\n    if (initialPosition === null && value > 0) {\n      setInitialPosition(value);\n    }\n  }, [initialPosition, value]);\n\n  function getEventPos(ev) {\n    return dir == 'x' ? ev.clientX : ev.clientY;\n  }\n\n  const move = useCallback(\n    (ev) => {\n      const newPos = posRef.current + getEventPos(ev) - startRef.current;\n\n      setValue(newPos);\n      let nextDisplay;\n\n      if (newPos <= leftThreshold) {\n        nextDisplay = 'chart';\n      } else if (containerWidth - newPos <= rightThreshold) {\n        nextDisplay = 'grid';\n      } else {\n        nextDisplay = 'all';\n      }\n\n      if (displayRef.current !== nextDisplay) {\n        setDisplay(nextDisplay);\n        displayRef.current = nextDisplay;\n      }\n\n      if (timeoutRef.current) clearTimeout(timeoutRef.current);\n      timeoutRef.current = setTimeout(() => onMove && onMove(newPos), 100);\n    },\n    [containerWidth, leftThreshold, rightThreshold, onMove],\n  );\n\n  const up = useCallback(() => {\n    document.body.style.cursor = '';\n    document.body.style.userSelect = '';\n    setActive(false);\n    window.removeEventListener('mousemove', move);\n    window.removeEventListener('mouseup', up);\n  }, [move]);\n\n  const cursor = useMemo(\n    () => (display !== 'all' ? 'auto' : dir == 'x' ? 'ew-resize' : 'ns-resize'),\n    [display, dir],\n  );\n\n  const down = useCallback(\n    (ev) => {\n      // Prevent dragging when in normal mode and only one view is visible\n      if (!compactMode && (display === 'grid' || display === 'chart')) {\n        return;\n      }\n\n      startRef.current = getEventPos(ev);\n\n      posRef.current = value;\n      setActive(true);\n\n      document.body.style.cursor = cursor;\n      document.body.style.userSelect = 'none';\n\n      window.addEventListener('mousemove', move);\n      window.addEventListener('mouseup', up);\n    },\n    [cursor, move, up, value, compactMode, display],\n  );\n\n  function resetToInitial() {\n    setDisplay('all');\n    if (initialPosition !== null) {\n      setValue(initialPosition);\n      if (onMove) onMove(initialPosition);\n    }\n  }\n\n  function handleExpand(direction) {\n    if (compactMode) {\n      const newDisplay = display === 'chart' ? 'grid' : 'chart';\n      setDisplay(newDisplay);\n      onDisplayChange(newDisplay);\n    } else {\n      if (display === 'grid' || display === 'chart') {\n        resetToInitial();\n        onDisplayChange('all');\n      } else {\n        const newDisplay = direction === 'left' ? 'chart' : 'grid';\n        setDisplay(newDisplay);\n        onDisplayChange(newDisplay);\n      }\n    }\n  }\n\n  function handleExpandLeft() {\n    handleExpand('left');\n  }\n\n  function handleExpandRight() {\n    handleExpand('right');\n  }\n\n  const b = useMemo(() => getBox(value), [value, position, size, dir]);\n\n  const rootClassName = [\n    'wx-resizer',\n    `wx-resizer-${dir}`,\n    `wx-resizer-display-${display}`,\n    active ? 'wx-resizer-active' : '',\n  ]\n    .filter(Boolean)\n    .join(' ');\n\n  return (\n    <div\n      className={'wx-pFykzMlT ' + rootClassName}\n      onMouseDown={down}\n      style={{ width: b.size[0], height: b.size[1], cursor }}\n    >\n      <div className=\"wx-pFykzMlT wx-button-expand-box\">\n        <div className=\"wx-pFykzMlT wx-button-expand-content wx-button-expand-left\">\n          <i\n            className=\"wx-pFykzMlT wxi-menu-left\"\n            onClick={handleExpandLeft}\n          ></i>\n        </div>\n        <div className=\"wx-pFykzMlT wx-button-expand-content wx-button-expand-right\">\n          <i\n            className=\"wx-pFykzMlT wxi-menu-right\"\n            onClick={handleExpandRight}\n          ></i>\n        </div>\n      </div>\n      <div className=\"wx-pFykzMlT wx-resizer-line\"></div>\n    </div>\n  );\n}\n\nexport default Resizer;\n","const COMPACT_WIDTH = 650;\n\nexport function modeObserver(callback) {\n  let observer;\n\n  function observe() {\n    observer = new ResizeObserver((entries) => {\n      for (let obj of entries) {\n        if (obj.target === document.body) {\n          let mode = obj.contentRect.width <= COMPACT_WIDTH;\n          callback(mode);\n        }\n      }\n    });\n\n    observer.observe(document.body);\n  }\n\n  function disconnect() {\n    if (observer) {\n      observer.disconnect();\n      observer = null;\n    }\n  }\n\n  return {\n    observe,\n    disconnect,\n  };\n}\n","import {\n  useState,\n  useEffect,\n  useMemo,\n  useRef,\n  useCallback,\n  useContext,\n} from 'react';\nimport { hotkeys } from '@svar-ui/grid-store';\nimport Grid from './grid/Grid.jsx';\nimport Chart from './chart/Chart.jsx';\nimport Resizer from './Resizer.jsx';\nimport { modeObserver } from '../helpers/modeResizeObserver';\nimport storeContext from '../context';\nimport { useStore } from '@svar-ui/lib-react';\nimport './Layout.css';\nimport { flushSync } from 'react-dom'\n\nfunction Layout(props) {\n  const {\n    taskTemplate,\n    readonly,\n    cellBorders,\n    highlightTime,\n    onScaleClick,\n    onTableAPIChange,\n    multiTaskRows = false,\n    rowMapping = null,\n    marqueeSelect = false,\n    copyPaste = false,\n    scrollToCurrentWeek = false,\n    currentWeekColor = null,\n    allowTaskIntersection = true,\n    summaryBarCounts = false,\n  } = props;\n\n  const api = useContext(storeContext);\n\n  const rTasks = useStore(api, '_tasks');\n  const rScales = useStore(api, '_scales');\n  const rCellHeight = useStore(api, 'cellHeight');\n  const rColumns = useStore(api, 'columns');\n  const rScrollTask = useStore(api, '_scrollTask');\n  const undo = useStore(api, 'undo');\n\n  // Compute rowMapping using reactive store tasks (updates when tasks are added/removed)\n  const computedRowMapping = useMemo(() => {\n    if (!multiTaskRows) return rowMapping;\n\n    // Build rowMapping from current store tasks\n    const rowMap = new Map(); // rowId -> taskIds[]\n    const taskRows = new Map(); // taskId -> rowId\n\n    rTasks.forEach((task) => {\n      const rowId = task.row ?? task.id;\n      taskRows.set(task.id, rowId);\n\n      if (!rowMap.has(rowId)) {\n        rowMap.set(rowId, []);\n      }\n      rowMap.get(rowId).push(task.id);\n    });\n\n    return { rowMap, taskRows };\n  }, [rTasks, multiTaskRows, rowMapping]);\n  const [compactMode, setCompactMode] = useState(false);\n  let [gridWidth, setGridWidth] = useState(0);\n  const [ganttWidth, setGanttWidth] = useState(0);\n  const [ganttHeight, setGanttHeight] = useState(0);\n  const [innerWidth, setInnerWidth] = useState(undefined);\n  const [display, setDisplay] = useState('all');\n\n  const lastDisplay = useRef(null);\n\n  const handleResize = useCallback(\n    (mode) => {\n      setCompactMode((prev) => {\n        if (mode !== prev) {\n          if (mode) {\n            lastDisplay.current = display;\n            if (display === 'all') setDisplay('grid');\n          } else if (!lastDisplay.current || lastDisplay.current === 'all') {\n            setDisplay('all');\n          }\n        }\n        return mode;\n      });\n    },\n    [display],\n  );\n\n  useEffect(() => {\n    const ro = modeObserver(handleResize);\n    ro.observe();\n    return () => {\n      ro.disconnect();\n    };\n  }, [handleResize]);\n\n  const gridColumnWidth = useMemo(() => {\n    let w;\n    if (rColumns.every((c) => c.width && !c.flexgrow)) {\n      w = rColumns.reduce((acc, c) => acc + parseInt(c.width), 0);\n    } else {\n      if (compactMode && display === 'chart') {\n        w = parseInt(rColumns.find((c) => c.id === 'action')?.width) || 50;\n      } else {\n        w = 440;\n      }\n    }\n    gridWidth = w;\n    return w;\n  }, [rColumns, compactMode, display]);\n\n  useEffect(() => {\n    setGridWidth(gridColumnWidth);\n  }, [gridColumnWidth]);\n\n  const scrollSize = useMemo(\n    () => (ganttWidth ?? 0) - (innerWidth ?? 0),\n    [ganttWidth, innerWidth],\n  );\n  const fullWidth = useMemo(() => rScales.width, [rScales]);\n  const fullHeight = useMemo(() => {\n    if (!multiTaskRows || !computedRowMapping) {\n      return rTasks.length * rCellHeight;\n    }\n    // Count unique rows\n    const uniqueRows = new Set();\n    rTasks.forEach((task) => {\n      const rowId = computedRowMapping.taskRows.get(task.id) ?? task.id;\n      uniqueRows.add(rowId);\n    });\n    return uniqueRows.size * rCellHeight;\n  }, [rTasks, rCellHeight, multiTaskRows, computedRowMapping]);\n  const scrollHeight = useMemo(\n    () => rScales.height + fullHeight + scrollSize,\n    [rScales, fullHeight, scrollSize],\n  );\n  const totalWidth = useMemo(\n    () => gridWidth + fullWidth,\n    [gridWidth, fullWidth],\n  );\n\n  const chartRef = useRef(null);\n  const expandScale = useCallback(() => {\n    Promise.resolve().then(() => {\n      if ((ganttWidth ?? 0) > (totalWidth ?? 0)) {\n        const minWidth = (ganttWidth ?? 0) - gridWidth;\n        api.exec('expand-scale', { minWidth });\n      }\n    });\n  }, [ganttWidth, totalWidth, gridWidth, api]);\n\n  useEffect(() => {\n    let ro;\n    if (chartRef.current) {\n      ro = new ResizeObserver(expandScale);\n      ro.observe(chartRef.current);\n    }\n    return () => {\n      if (ro) ro.disconnect();\n    };\n  }, [chartRef.current, expandScale]);\n\n  useEffect(() => {\n    expandScale();\n  }, [fullWidth]);\n\n  const ganttDivRef = useRef(null);\n  const pseudoRowsRef = useRef(null);\n\n  const onScroll = useCallback(() => {\n    const el = ganttDivRef.current;\n    if (el) {\n      api.exec('scroll-chart', {\n        top: el.scrollTop,\n      });\n    }\n  }, [api]);\n\n  const latest = useRef({\n    rTasks: [],\n    rScales: { height: 0 },\n    rCellHeight: 0,\n    scrollSize: 0,\n    ganttDiv: null,\n    ganttHeight: 0,\n  });\n\n  useEffect(() => {\n    latest.current = {\n      rTasks,\n      rScales,\n      rCellHeight,\n      scrollSize,\n      ganttDiv: ganttDivRef.current,\n      ganttHeight: ganttHeight ?? 0,\n    };\n  }, [rTasks, rScales, rCellHeight, scrollSize, ganttHeight]);\n\n  const scrollToTask = useCallback(\n    (value) => {\n      if (!value) return;\n      const {\n        rTasks: t,\n        rScales: sc,\n        rCellHeight: ch,\n        scrollSize: ss,\n        ganttDiv: el,\n        ganttHeight: gh,\n      } = latest.current;\n      if (!el) return;\n      const { id } = value;\n      const index = t.findIndex((tt) => tt.id === id);\n      if (index > -1) {\n        const height = gh - sc.height;\n        const scrollY = index * ch;\n        const now = el.scrollTop;\n        let top = null;\n        if (scrollY < now) {\n          top = scrollY;\n        } else if (scrollY + ch > now + height) {\n          top = scrollY - height + ch + ss;\n        }\n        if (top !== null) {\n          api.exec('scroll-chart', { top: Math.max(top, 0) });\n          ganttDivRef.current.scrollTop = Math.max(top, 0);\n        }\n      }\n    },\n    [api],\n  );\n\n  useEffect(() => {\n    scrollToTask(rScrollTask);\n  }, [rScrollTask]);\n\n  useEffect(() => {\n    const ganttDiv = ganttDivRef.current;\n    const pseudoRows = pseudoRowsRef.current;\n    if (!ganttDiv || !pseudoRows) return;\n    const update = () => {\n      flushSync(() => {\n        setGanttHeight(ganttDiv.offsetHeight);\n        setGanttWidth(ganttDiv.offsetWidth);\n        setInnerWidth(pseudoRows.offsetWidth);\n      });\n    };\n    const ro = new ResizeObserver(update);\n    ro.observe(ganttDiv);\n    return () => ro.disconnect();\n  }, [ganttDivRef.current]);\n\n  const layoutRef = useRef(null);\n  const cleanupRef = useRef(null);\n\n  useEffect(() => {\n    if (cleanupRef.current) {\n      cleanupRef.current.destroy();\n      cleanupRef.current = null;\n    }\n    const node = layoutRef.current;\n    if (!node) return;\n\n    cleanupRef.current = hotkeys(node, {\n      keys: {\n        'ctrl+c': true,\n        'ctrl+v': true,\n        'ctrl+x': true,\n        'ctrl+d': true,\n        'meta+c': true,\n        'meta+v': true,\n        'meta+x': true,\n        'meta+d': true,\n        backspace: true,\n        'ctrl+z': undo,\n        'ctrl+y': undo,\n        'meta+z': undo,\n        'meta+shift+z': undo,\n      },\n      exec: (ev) => {\n        if (ev.isInput) return;\n\n        // Handle undo/redo keys directly via api.exec\n        // The gantt-store uses exec('undo', {}) for undo\n        const key = ev.key;\n        if (key === 'ctrl+z' || key === 'meta+z') {\n          api.exec('undo', {});\n          return;\n        }\n        if (key === 'ctrl+y' || key === 'meta+shift+z') {\n          api.exec('redo', {});\n          return;\n        }\n\n        api.exec('hotkey', ev);\n      },\n    });\n\n    return () => {\n      cleanupRef.current?.destroy();\n      cleanupRef.current = null;\n    };\n  }, [undo]);\n\n  return (\n    <div className=\"wx-jlbQoHOz wx-gantt\" ref={ganttDivRef} onScroll={onScroll}>\n      <div\n        className=\"wx-jlbQoHOz wx-pseudo-rows\"\n        style={{ height: scrollHeight, width: '100%' }}\n        ref={pseudoRowsRef}\n      >\n        <div\n          className=\"wx-jlbQoHOz wx-stuck\"\n          style={{\n            height: ganttHeight,\n            width: innerWidth,\n          }}\n        >\n          <div tabIndex={0} className=\"wx-jlbQoHOz wx-layout\" ref={layoutRef}>\n            {rColumns.length ? (\n              <>\n                <Grid\n                  display={display}\n                  compactMode={compactMode}\n                  columnWidth={gridColumnWidth}\n                  width={gridWidth}\n                  readonly={readonly}\n                  fullHeight={fullHeight}\n                  onTableAPIChange={onTableAPIChange}\n                  multiTaskRows={multiTaskRows}\n                  rowMapping={computedRowMapping}\n                />\n                <Resizer\n                  value={gridWidth}\n                  display={display}\n                  compactMode={compactMode}\n                  containerWidth={ganttWidth}\n                  onMove={(value) => setGridWidth(value)}\n                  onDisplayChange={(display) => setDisplay(display)}\n                />\n              </>\n            ) : null}\n\n            <div className=\"wx-jlbQoHOz wx-content\" ref={chartRef}>\n              <Chart\n                readonly={readonly}\n                fullWidth={fullWidth}\n                fullHeight={fullHeight}\n                taskTemplate={taskTemplate}\n                cellBorders={cellBorders}\n                highlightTime={highlightTime}\n                onScaleClick={onScaleClick}\n                multiTaskRows={multiTaskRows}\n                rowMapping={computedRowMapping}\n                marqueeSelect={marqueeSelect}\n                copyPaste={copyPaste}\n                scrollToCurrentWeek={scrollToCurrentWeek}\n                currentWeekColor={currentWeekColor}\n                allowTaskIntersection={allowTaskIntersection}\n                summaryBarCounts={summaryBarCounts}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Layout;\n","import { dateToString } from '@svar-ui/lib-dom';\n\nexport function getUnitFormats(_) {\n  return {\n    year: '%Y',\n    quarter: `${_('Q')} %Q`,\n    month: '%M',\n    week: `${_('Week')} %w`,\n    day: '%M %j',\n    hour: '%H:%i',\n  };\n}\n\nfunction normalizeFormatter(value, calendarLocale) {\n  return typeof value === 'function'\n    ? value\n    : dateToString(value, calendarLocale);\n}\n\nexport function prepareScales(scales, calendarLocale) {\n  return scales.map(({ format, ...scale }) => ({\n    ...scale,\n    format: normalizeFormatter(format, calendarLocale),\n  }));\n}\n\nexport function prepareFormats(calendarLocale, _) {\n  const formats = getUnitFormats(_);\n  for (let unit in formats) {\n    formats[unit] = dateToString(formats[unit], calendarLocale);\n  }\n  return formats;\n}\n\nexport function prepareColumns(columns, calendarLocale) {\n  if (!columns || !columns.length) return columns;\n  const format = dateToString('%d-%m-%Y', calendarLocale);\n\n  return columns.map((col) => {\n    if (col.template) return col;\n\n    if (col.id === 'start' || col.id == 'end') {\n      return {\n        ...col,\n        //store locale template for unscheduled tasks\n        _template: (b) => format(b),\n        template: (b) => format(b),\n      };\n    }\n    if (col.id === 'duration') {\n      return {\n        ...col,\n        _template: (b) => b,\n        template: (b) => b,\n      };\n    }\n    return col;\n  });\n}\n\nexport function prepareZoom(zoom, calendarLocale) {\n  if (!zoom.levels) {\n    return zoom;\n  }\n\n  return {\n    ...zoom,\n    levels: zoom.levels.map((level) => ({\n      ...level,\n      scales: prepareScales(level.scales, calendarLocale),\n    })),\n  };\n}\n","import {\n  forwardRef,\n  useEffect,\n  useMemo,\n  useRef,\n  useImperativeHandle,\n  useState,\n  useContext,\n} from 'react';\n\n// core widgets lib\nimport { context } from '@svar-ui/react-core';\n\n// locales\nimport { locale as l } from '@svar-ui/lib-dom';\nimport { en } from '@svar-ui/gantt-locales';\nimport { en as coreEn } from '@svar-ui/core-locales';\n\n// stores\nimport { EventBusRouter } from '@svar-ui/lib-state';\nimport {\n  DataStore,\n  defaultColumns,\n  defaultTaskTypes,\n  parseTaskDates,\n  normalizeZoom,\n  normalizeLinks,\n} from '@svar-ui/gantt-store';\n\n// context\nimport StoreContext from '../context';\n\n// store factory\nimport { writable } from '@svar-ui/lib-react';\n\n// ui\nimport Layout from './Layout.jsx';\n\n// helpers\nimport {\n  prepareScales,\n  prepareFormats,\n  prepareColumns,\n  prepareZoom,\n} from '../helpers/prepareConfig.js';\n\nconst camelize = (s) =>\n  s\n    .split('-')\n    .map((part) => (part ? part.charAt(0).toUpperCase() + part.slice(1) : ''))\n    .join('');\n\nconst defaultScales = [\n  { unit: 'month', step: 1, format: '%F %Y' },\n  { unit: 'day', step: 1, format: '%j' },\n];\n\nconst Gantt = forwardRef(function Gantt(\n  {\n    taskTemplate = null,\n    markers = [],\n    taskTypes = defaultTaskTypes,\n    tasks = [],\n    selected = [],\n    activeTask = null,\n    links = [],\n    scales = defaultScales,\n    columns = defaultColumns,\n    start = null,\n    end = null,\n    lengthUnit = 'day',\n    durationUnit = 'day',\n    cellWidth = 100,\n    cellHeight = 38,\n    scaleHeight = 36,\n    readonly = false,\n    cellBorders = 'full',\n    zoom = false,\n    baselines = false,\n    highlightTime: highlightTimeProp = null,\n    onScaleClick = null,\n    init = null,\n    autoScale = true,\n    unscheduledTasks = false,\n    criticalPath = null,\n    schedule = { type: 'forward' },\n    projectStart = null,\n    projectEnd = null,\n    calendar = null,\n    undo = false,\n    splitTasks = false,\n    multiTaskRows = false,\n    marqueeSelect = false,\n    copyPaste = false,\n    currentWeekHighlight = false,\n    currentWeekColor = null,\n    scrollToCurrentWeek = false,\n    allowTaskIntersection = true,\n    summaryBarCounts = false,\n    ...restProps\n  },\n  ref,\n) {\n  // keep latest rest props for event routing\n  const restPropsRef = useRef();\n  restPropsRef.current = restProps;\n\n  // init stores\n  const dataStore = useMemo(() => new DataStore(writable), []);\n\n  // locale and formats\n  // uses same logic as the Locale component\n  const words = useMemo(() => ({ ...coreEn, ...en }), []);\n  const i18nCtx = useContext(context.i18n);\n  const locale = useMemo(() => {\n    if (!i18nCtx) return l(words);\n    return i18nCtx.extend(words, true);\n  }, [i18nCtx, words]);\n\n  // prepare configuration objects\n  const lCalendar = useMemo(() => locale.getRaw().calendar, [locale]);\n\n  const normalizedConfig = useMemo(() => {\n    let config = {\n      zoom: prepareZoom(zoom, lCalendar),\n      scales: prepareScales(scales, lCalendar),\n      columns: prepareColumns(columns, lCalendar),\n      links: normalizeLinks(links),\n      cellWidth,\n    };\n    if (config.zoom) {\n      config = {\n        ...config,\n        ...normalizeZoom(\n          config.zoom,\n          prepareFormats(lCalendar, locale.getGroup('gantt')),\n          config.scales,\n          cellWidth,\n        ),\n      };\n    }\n    return config;\n  }, [zoom, scales, columns, links, cellWidth, lCalendar, locale]);\n\n  // parse task dates effect\n  const parsedTasksRef = useRef(null);\n  if (parsedTasksRef.current !== tasks) {\n    parseTaskDates(tasks, { durationUnit, splitTasks, calendar });\n    parsedTasksRef.current = tasks;\n  }\n  useEffect(() => {\n    parseTaskDates(tasks, { durationUnit, splitTasks, calendar });\n  }, [tasks, durationUnit, calendar, splitTasks]);\n\n  // row mapping for multiTaskRows feature\n  const rowMapping = useMemo(() => {\n    if (!multiTaskRows) return null;\n\n    const rowMap = new Map(); // rowId -> taskIds[]\n    const taskRows = new Map(); // taskId -> rowId\n\n    const buildRowMap = (taskList) => {\n      taskList.forEach((task) => {\n        const rowId = task.row ?? task.id;\n        taskRows.set(task.id, rowId);\n\n        if (!rowMap.has(rowId)) {\n          rowMap.set(rowId, []);\n        }\n        rowMap.get(rowId).push(task.id);\n\n        if (task.data && task.data.length > 0) {\n          buildRowMap(task.data);\n        }\n      });\n    };\n\n    buildRowMap(tasks);\n\n    return { rowMap, taskRows };\n  }, [tasks, multiTaskRows]);\n\n  const firstInRoute = useMemo(() => dataStore.in, [dataStore]);\n\n  const lastInRouteRef = useRef(null);\n  if (lastInRouteRef.current === null) {\n    lastInRouteRef.current = new EventBusRouter((a, b) => {\n      const name = 'on' + camelize(a);\n      if (restPropsRef.current && restPropsRef.current[name]) {\n        restPropsRef.current[name](b);\n      }\n    });\n    firstInRoute.setNext(lastInRouteRef.current);\n  }\n\n  // writable prop for two-way binding tableAPI\n  const [tableAPI, setTableAPI] = useState(null);\n  const tableAPIRef = useRef(null);\n  tableAPIRef.current = tableAPI;\n\n  // public API\n  const api = useMemo(\n    () => ({\n      getState: dataStore.getState.bind(dataStore),\n      getReactiveState: dataStore.getReactive.bind(dataStore),\n      getStores: () => ({ data: dataStore }),\n      exec: firstInRoute.exec,\n      setNext: (ev) => {\n        lastInRouteRef.current = lastInRouteRef.current.setNext(ev);\n        return lastInRouteRef.current;\n      },\n      intercept: firstInRoute.intercept.bind(firstInRoute),\n      on: firstInRoute.on.bind(firstInRoute),\n      detach: firstInRoute.detach.bind(firstInRoute),\n      getTask: dataStore.getTask.bind(dataStore),\n      serialize: dataStore.serialize.bind(dataStore),\n      getTable: (waitRender) =>\n        waitRender\n          ? new Promise((res) => setTimeout(() => res(tableAPIRef.current), 1))\n          : tableAPIRef.current,\n      getHistory: () => dataStore.getHistory(),\n    }),\n    [dataStore, firstInRoute],\n  );\n\n  // expose API via ref\n  useImperativeHandle(\n    ref,\n    () => ({\n      ...api,\n    }),\n    [api],\n  );\n\n  const initOnceRef = useRef(0);\n  useEffect(() => {\n    if (!initOnceRef.current) {\n      if (init) init(api);\n    } else {\n      // const prev = dataStore.getState();\n      dataStore.init({\n        tasks,\n        links: normalizedConfig.links,\n        start,\n        columns: normalizedConfig.columns,\n        end,\n        lengthUnit,\n        cellWidth: normalizedConfig.cellWidth,\n        cellHeight,\n        scaleHeight,\n        scales: normalizedConfig.scales,\n        taskTypes,\n        zoom: normalizedConfig.zoom,\n        selected,\n        activeTask,\n        baselines,\n        autoScale,\n        unscheduledTasks,\n        markers,\n        durationUnit,\n        criticalPath,\n        schedule,\n        projectStart,\n        projectEnd,\n        calendar,\n        undo,\n        _weekStart: lCalendar.weekStart,\n        splitTasks,\n      });\n    }\n    initOnceRef.current++;\n  }, [\n    api,\n    init,\n    tasks,\n    normalizedConfig,\n    start,\n    end,\n    lengthUnit,\n    cellHeight,\n    scaleHeight,\n    taskTypes,\n    selected,\n    activeTask,\n    baselines,\n    autoScale,\n    unscheduledTasks,\n    markers,\n    durationUnit,\n    criticalPath,\n    schedule,\n    projectStart,\n    projectEnd,\n    calendar,\n    undo,\n    lCalendar,\n    splitTasks,\n    dataStore,\n  ]);\n\n  if (initOnceRef.current === 0) {\n    dataStore.init({\n      tasks,\n      links: normalizedConfig.links,\n      start,\n      columns: normalizedConfig.columns,\n      end,\n      lengthUnit,\n      cellWidth: normalizedConfig.cellWidth,\n      cellHeight,\n      scaleHeight,\n      scales: normalizedConfig.scales,\n      taskTypes,\n      zoom: normalizedConfig.zoom,\n      selected,\n      activeTask,\n      baselines,\n      autoScale,\n      unscheduledTasks,\n      markers,\n      durationUnit,\n      criticalPath,\n      schedule,\n      projectStart,\n      projectEnd,\n      calendar,\n      undo,\n      _weekStart: lCalendar.weekStart,\n      splitTasks,\n    });\n  }\n\n  // Helper to check if a date is in the current week (UTC)\n  const isCurrentWeek = useMemo(() => {\n    const now = new Date();\n    const weekStart = lCalendar?.weekStart ?? 0; // 0 = Sunday, 1 = Monday\n\n    // Get start of current week (UTC)\n    const currentWeekStart = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate()));\n    const dayOfWeek = currentWeekStart.getUTCDay();\n    const diff = (dayOfWeek - weekStart + 7) % 7;\n    currentWeekStart.setUTCDate(currentWeekStart.getUTCDate() - diff);\n    currentWeekStart.setUTCHours(0, 0, 0, 0);\n\n    // Get end of current week (UTC)\n    const currentWeekEnd = new Date(currentWeekStart);\n    currentWeekEnd.setUTCDate(currentWeekEnd.getUTCDate() + 7);\n\n    return (date) => date >= currentWeekStart && date < currentWeekEnd;\n  }, [lCalendar]);\n\n  // highlightTime from calendar + current week\n  const highlightTime = useMemo(() => {\n    return (day, unit) => {\n      let classes = [];\n\n      // Calendar-based highlighting (weekends)\n      if (calendar) {\n        if (unit == 'day' && !calendar.getDayHours(day)) classes.push('wx-weekend');\n        if (unit == 'hour' && !calendar.getDayHours(day)) classes.push('wx-weekend');\n      } else if (highlightTimeProp) {\n        const result = highlightTimeProp(day, unit);\n        if (result) classes.push(result);\n      }\n\n      // Current week highlighting\n      if (currentWeekHighlight && (unit === 'week' || unit === 'day')) {\n        if (isCurrentWeek(day)) {\n          classes.push('wx-current-week');\n        }\n      }\n\n      return classes.join(' ');\n    };\n  }, [calendar, highlightTimeProp, currentWeekHighlight, isCurrentWeek]);\n\n  return (\n    <context.i18n.Provider value={locale}>\n      <StoreContext.Provider value={api}>\n        <Layout\n          taskTemplate={taskTemplate}\n          readonly={readonly}\n          cellBorders={cellBorders}\n          highlightTime={highlightTime}\n          onScaleClick={onScaleClick}\n          onTableAPIChange={setTableAPI}\n          multiTaskRows={multiTaskRows}\n          rowMapping={rowMapping}\n          marqueeSelect={marqueeSelect}\n          copyPaste={copyPaste}\n          scrollToCurrentWeek={scrollToCurrentWeek}\n          currentWeekColor={currentWeekColor}\n          allowTaskIntersection={allowTaskIntersection}\n          summaryBarCounts={summaryBarCounts}\n        />\n      </StoreContext.Provider>\n    </context.i18n.Provider>\n  );\n});\n\nexport default Gantt;\n","import { useContext, useMemo } from 'react';\nimport { Toolbar as WxToolbar } from '@svar-ui/react-toolbar';\nimport { useStoreLater } from '@svar-ui/lib-react';\nimport {\n  handleAction,\n  getToolbarButtons,\n  isHandledAction,\n} from '@svar-ui/gantt-store';\nimport { locale } from '@svar-ui/lib-dom';\nimport { en } from '@svar-ui/gantt-locales';\nimport { context } from '@svar-ui/react-core';\n\nexport default function Toolbar({ api = null, items = [] }) {\n  const i18nCtx = useContext(context.i18n);\n  const i18nLocal = useMemo(() => (i18nCtx ? i18nCtx : locale(en)), [i18nCtx]);\n  const _ = useMemo(() => i18nLocal.getGroup('gantt'), [i18nLocal]);\n\n  const _selected = useStoreLater(api, '_selected');\n  const undo = useStoreLater(api, 'undo');\n  const history = useStoreLater(api, 'history');\n  const splitTasks = useStoreLater(api, 'splitTasks');\n\n  const historyActions = ['undo', 'redo'];\n\n  const finalItems = useMemo(() => {\n    const fullButtons = getToolbarButtons({ undo: true, splitTasks: true });\n    const buttons = items.length\n      ? items\n      : getToolbarButtons({\n          undo,\n          splitTasks,\n        });\n    return buttons.map((b) => {\n      let item = { ...b, disabled: false };\n      item.handler = isHandledAction(fullButtons, item.id)\n        ? (it) => handleAction(api, it.id, null, _)\n        : item.handler;\n      if (item.text) item.text = _(item.text);\n      if (item.menuText) item.menuText = _(item.menuText);\n      return item;\n    });\n  }, [items, api, _, undo, splitTasks]);\n\n  const buttons = useMemo(() => {\n    const finalButtons = [];\n    finalItems.forEach((item) => {\n      const action = item.id;\n      if (action === 'add-task') {\n        finalButtons.push(item);\n      } else if (!historyActions.includes(action)) {\n        if (!_selected?.length || !api) return;\n        finalButtons.push({\n          ...item,\n          disabled:\n            item.isDisabled &&\n            _selected.some((task) => item.isDisabled(task, api.getState())),\n        });\n      } else if (historyActions.includes(action)) {\n        finalButtons.push({\n          ...item,\n          disabled: item.isDisabled(history),\n        });\n      }\n    });\n    // filter out consecutive separators\n    return finalButtons.filter((button, index) => {\n      if (api && button.isHidden)\n        return !_selected.some((task) => button.isHidden(task, api.getState()));\n      if (button.comp === 'separator') {\n        const nextButton = finalButtons[index + 1];\n        if (!nextButton || nextButton.comp === 'separator') return false;\n      }\n      return true;\n    });\n  }, [api, _selected, history, finalItems]);\n\n  if (!i18nCtx) {\n    return (\n      <context.i18n.Provider value={i18nLocal}>\n        <WxToolbar items={buttons} />\n      </context.i18n.Provider>\n    );\n  }\n\n  return <WxToolbar items={buttons} />;\n}\n","import {\n  useEffect,\n  useMemo,\n  useRef,\n  useCallback,\n  useContext,\n  forwardRef,\n  useImperativeHandle,\n} from 'react';\nimport { ContextMenu as WxContextMenu } from '@svar-ui/react-menu';\nimport { handleAction, getMenuOptions, isHandledAction } from '@svar-ui/gantt-store';\nimport { locale, locateID } from '@svar-ui/lib-dom';\nimport { en } from '@svar-ui/gantt-locales';\nimport { en as coreEn } from '@svar-ui/core-locales';\nimport { context } from '@svar-ui/react-core';\nimport { useStoreLater } from '@svar-ui/lib-react';\nimport './ContextMenu.css';\n\nconst ContextMenu = forwardRef(function ContextMenu(\n  {\n    options: optionsInit = [],\n    api = null,\n    resolver = null,\n    filter = null,\n    at = 'point',\n    children,\n    onClick,\n    css,\n  },\n  ref,\n) {\n  const menuRef = useRef(null);\n  const activeIdRef = useRef(null);\n\n  // i18n context\n  const i18nCtx = useContext(context.i18n);\n  const l = useMemo(() => i18nCtx || locale({ ...en, ...coreEn }), [i18nCtx]);\n  const _ = useMemo(() => l.getGroup('gantt'), [l]);\n\n  const taskTypesVal = useStoreLater(api, 'taskTypes');\n  const selectedVal = useStoreLater(api, 'selected');\n  const selectedTasksVal = useStoreLater(api, '_selected');\n  const splitTasksVal = useStoreLater(api, 'splitTasks');\n\n  const fullOptions = useMemo(() => getMenuOptions({ splitTasks: true }), []);\n\n  useEffect(() => {\n    if (!api) return;\n\n    api.on('scroll-chart', () => {\n      if (menuRef.current && menuRef.current.show) menuRef.current.show();\n    });\n    api.on('drag-task', () => {\n      if (menuRef.current && menuRef.current.show) menuRef.current.show();\n    });\n  }, [api]);\n\n  function applyLocaleFn(opts) {\n    return opts.map((op) => {\n      op = { ...op };\n      if (op.text) op.text = _(op.text);\n      if (op.subtext) op.subtext = _(op.subtext);\n      if (op.data) op.data = applyLocaleFn(op.data);\n      return op;\n    });\n  }\n\n  function getOptions() {\n    const finalOptions = optionsInit.length\n      ? optionsInit\n      : getMenuOptions({ splitTasks: splitTasksVal });\n    const convertOption = finalOptions.find((o) => o.id === 'convert-task');\n    if (convertOption) {\n      convertOption.data = [];\n      (taskTypesVal || []).forEach((t) => {\n        convertOption.data.push(convertOption.dataFactory(t));\n      });\n    }\n    return applyLocaleFn(finalOptions);\n  }\n\n  const cOptions = useMemo(() => {\n    return getOptions();\n  }, [api, optionsInit, taskTypesVal, splitTasksVal, _]);\n\n  const selectedTasks = useMemo(\n    () => (selectedTasksVal && selectedTasksVal.length ? selectedTasksVal : []),\n    [selectedTasksVal],\n  );\n\n  const itemResolver = useCallback(\n    (id, ev) => {\n      let task = id ? api?.getTask(id) : null;\n      if (resolver) {\n        const result = resolver(id, ev);\n        task = result === true ? task : result;\n      }\n      if (task) {\n        const segmentIndex = locateID(ev.target, 'data-segment');\n        if (segmentIndex !== null)\n          activeIdRef.current = { id: task.id, segmentIndex };\n        else activeIdRef.current = task.id;\n\n        if (!Array.isArray(selectedVal) || !selectedVal.includes(task.id)) {\n          api && api.exec && api.exec('select-task', { id: task.id });\n        }\n      }\n      return task;\n    },\n    [api, resolver, selectedVal],\n  );\n\n  const menuAction = useCallback(\n    (ev) => {\n      const action = ev.action;\n      if (action) {\n        const isAction = isHandledAction(fullOptions, action.id);\n        if (isAction) handleAction(api, action.id, activeIdRef.current, _);\n        onClick && onClick(ev);\n      }\n    },\n    [api, _, onClick, fullOptions],\n  );\n\n  const filterMenu = useCallback(\n    (item, task) => {\n      // for single selection from resolver _selected are empty\n      // due to setAsyncState causing _selected to lag\n      const tasks = selectedTasks.length ? selectedTasks : task ? [task] : [];\n\n      let result = filter ? tasks.every((t) => filter(item, t)) : true;\n\n      if (result) {\n        if (item.isHidden)\n          result = !tasks.some((t) =>\n            item.isHidden(t, api.getState(), activeIdRef.current),\n          );\n        if (item.isDisabled) {\n          const disabled = tasks.some((t) =>\n            item.isDisabled(t, api.getState(), activeIdRef.current),\n          );\n          item.disabled = disabled;\n        }\n      }\n      return result;\n    },\n    [filter, selectedTasks, api],\n  );\n\n  useImperativeHandle(ref, () => ({\n    show: (ev, obj) => {\n      if (menuRef.current && menuRef.current.show) {\n        menuRef.current.show(ev, obj);\n      }\n    },\n  }));\n\n  const onContextMenu = useCallback((e) => {\n    if (menuRef.current && menuRef.current.show) {\n      menuRef.current.show(e);\n    }\n  }, []);\n\n  const content = (\n    <>\n      <WxContextMenu\n        filter={filterMenu}\n        options={cOptions}\n        dataKey={'id'}\n        resolver={itemResolver}\n        onClick={menuAction}\n        at={at}\n        ref={menuRef}\n        css={css}\n      />\n      <span onContextMenu={onContextMenu} data-menu-ignore=\"true\">\n        {typeof children === 'function' ? children() : children}\n      </span>\n    </>\n  );\n\n  if (!i18nCtx && context.i18n?.Provider) {\n    const Provider = context.i18n.Provider;\n    return <Provider value={l}>{content}</Provider>;\n  }\n\n  return content;\n});\n\nexport default ContextMenu;\n","import { useState, useEffect, useMemo, useContext } from 'react';\nimport { Field, Combo, Text } from '@svar-ui/react-core';\nimport { context } from '@svar-ui/react-core';\nimport { useStore } from '@svar-ui/lib-react';\nimport './Links.css';\n\nexport default function Links({ api, autoSave, onLinksChange }) {\n  const i18n = useContext(context.i18n);\n  const _ = i18n.getGroup('gantt');\n\n  const activeTask = useStore(api, 'activeTask');\n  const _activeTask = useStore(api, '_activeTask');\n  const links = useStore(api, '_links');\n  const schedule = useStore(api, 'schedule');\n  const unscheduledTasks = useStore(api, 'unscheduledTasks');\n\n  const [linksData, setLinksData] = useState();\n\n  function getLinksData() {\n    if (activeTask) {\n      const inLinks = links\n        .filter((a) => a.target == activeTask)\n        .map((link) => ({ link, task: api.getTask(link.source) }));\n\n      const outLinks = links\n        .filter((a) => a.source == activeTask)\n        .map((link) => ({ link, task: api.getTask(link.target) }));\n\n      return [\n        { title: _('Predecessors'), data: inLinks },\n        { title: _('Successors'), data: outLinks },\n      ];\n    }\n  }\n\n  useEffect(() => {\n    setLinksData(getLinksData());\n  }, [activeTask, links]);\n\n  const list = useMemo(\n    () => [\n      { id: 'e2s', label: _('End-to-start') },\n      { id: 's2s', label: _('Start-to-start') },\n      { id: 'e2e', label: _('End-to-end') },\n      { id: 's2e', label: _('Start-to-end') },\n    ],\n    [_],\n  );\n\n  function deleteLink(id) {\n    if (autoSave) {\n      api.exec('delete-link', { id });\n    } else {\n      setLinksData((prev) =>\n        (prev || []).map((group) => ({\n          ...group,\n          data: group.data.filter((item) => item.link.id !== id),\n        })),\n      );\n      onLinksChange &&\n        onLinksChange({\n          id,\n          action: 'delete-link',\n          data: { id },\n        });\n    }\n  }\n\n  function handleChange(id, update) {\n    if (autoSave) {\n      api.exec('update-link', {\n        id,\n        link: update,\n      });\n    } else {\n      setLinksData((prev) =>\n        (prev || []).map((group) => ({\n          ...group,\n          data: group.data.map((item) =>\n            item.link.id === id\n              ? { ...item, link: { ...item.link, ...update } }\n              : item,\n          ),\n        })),\n      );\n      onLinksChange &&\n        onLinksChange({\n          id,\n          action: 'update-link',\n          data: {\n            id,\n            link: update,\n          },\n        });\n    }\n  }\n\n  return (\n    <>\n      {(linksData || []).map((group, idx) =>\n        group.data.length ? (\n          <div className=\"wx-j93aYGQf wx-links\" key={idx}>\n            <Field label={group.title} position=\"top\">\n              <table>\n                <tbody>\n                  {group.data.map((obj) => (\n                    <tr key={obj.link.id}>\n                      <td className=\"wx-j93aYGQf wx-cell\">\n                        <div className=\"wx-j93aYGQf wx-task-name\">\n                          {obj.task.text || ''}\n                        </div>\n                      </td>\n                      {schedule?.auto && obj.link.type === 'e2s' ? (\n                        <td className=\"wx-j93aYGQf wx-cell wx-link-lag\">\n                          <Text\n                            type=\"number\"\n                            placeholder={_('Lag')}\n                            value={obj.link.lag}\n                            disabled={\n                              unscheduledTasks && _activeTask?.unscheduled\n                            }\n                            onChange={(ev) => {\n                              if (!ev.input)\n                                handleChange(obj.link.id, { lag: ev.value });\n                            }}\n                          />\n                        </td>\n                      ) : null}\n                      <td className=\"wx-j93aYGQf wx-cell\">\n                        <div className=\"wx-j93aYGQf wx-wrapper\">\n                          <Combo\n                            value={obj.link.type}\n                            placeholder={_('Select link type')}\n                            options={list}\n                            onChange={(ev) =>\n                              handleChange(obj.link.id, { type: ev.value })\n                            }\n                          >\n                            {({ option }) => option.label}\n                          </Combo>\n                        </div>\n                      </td>\n\n                      <td className=\"wx-j93aYGQf wx-cell\">\n                        <i\n                          className=\"wx-j93aYGQf wxi-delete wx-delete-icon\"\n                          onClick={() => deleteLink(obj.link.id)}\n                          role=\"button\"\n                        ></i>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </Field>\n          </div>\n        ) : null,\n      )}\n    </>\n  );\n}\n","import { DatePicker, TimePicker } from '@svar-ui/react-core';\nimport './DateTimePicker.css';\n\nexport default function DateTimePicker(props) {\n  const { value, time, format, onchange, onChange, ...restProps } = props;\n  const onChangeHandler = onChange ?? onchange;\n\n  function handleDateChange(ev) {\n    const current = new Date(ev.value);\n    // Preserve time from original value (UTC)\n    current.setUTCHours(value.getUTCHours());\n    current.setUTCMinutes(value.getUTCMinutes());\n\n    onChangeHandler && onChangeHandler({ value: current });\n  }\n\n  return (\n    <div className=\"wx-hFsbgDln date-time-controll\">\n      <DatePicker\n        {...restProps}\n        value={value}\n        onChange={handleDateChange}\n        format={format}\n        buttons={['today']}\n        clear={false}\n      />\n      {time ? (\n        <TimePicker value={value} onChange={onChangeHandler} format={format} />\n      ) : null}\n    </div>\n  );\n}\n","import { useState, useEffect, useMemo, useCallback, useContext } from 'react';\nimport { Editor as WxEditor, registerEditorItem } from '@svar-ui/react-editor';\nimport { Locale, RichSelect, Slider, Counter, TwoState } from '@svar-ui/react-core';\nimport { getEditorItems, prepareEditTask } from '@svar-ui/gantt-store';\nimport { dateToString, locale } from '@svar-ui/lib-dom';\nimport { en } from '@svar-ui/gantt-locales';\nimport { en as coreEn } from '@svar-ui/core-locales';\nimport { context } from '@svar-ui/react-core';\n\nimport Links from './editor/Links.jsx';\nimport DateTimePicker from './editor/DateTimePicker.jsx';\nimport { useStore } from '@svar-ui/lib-react';\n\n// helpers\nimport { modeObserver } from '../helpers/modeResizeObserver';\n\nimport './Editor.css';\n\nregisterEditorItem('select', RichSelect);\nregisterEditorItem('date', DateTimePicker);\nregisterEditorItem('twostate', TwoState);\nregisterEditorItem('slider', Slider);\nregisterEditorItem('counter', Counter);\nregisterEditorItem('links', Links);\n\nfunction Editor({\n  api,\n  items = [],\n  css = '',\n  layout = 'default',\n  readonly = false,\n  placement = 'sidebar',\n  bottomBar = true,\n  topBar = true,\n  autoSave = true,\n  focus = false,\n  hotkeys = {},\n}) {\n  const lFromCtx = useContext(context.i18n);\n  const l = useMemo(() => lFromCtx || locale({ ...en, ...coreEn }), [lFromCtx]);\n  const _ = useMemo(() => l.getGroup('gantt'), [l]);\n  const i18nData = l.getRaw();\n  const dateFormat = useMemo(() => {\n    const f = i18nData.gantt?.dateFormat || i18nData.formats?.dateFormat;\n    return dateToString(f, i18nData.calendar);\n  }, [i18nData]);\n\n  const normalizedTopBar = useMemo(() => {\n    if (topBar === true && !readonly) {\n      const buttons = [\n        { comp: 'icon', icon: 'wxi-close', id: 'close' },\n        { comp: 'spacer' },\n        {\n          comp: 'button',\n          type: 'danger',\n          text: _('Delete'),\n          id: 'delete',\n        },\n      ];\n      if (autoSave) return { items: buttons };\n      return {\n        items: [\n          ...buttons,\n          {\n            comp: 'button',\n            type: 'primary',\n            text: _('Save'),\n            id: 'save',\n          },\n        ],\n      };\n    }\n    return topBar;\n  }, [topBar, readonly, autoSave, _]);\n\n  // resize\n  const [compactMode, setCompactMode] = useState(false);\n  const styleCss = useMemo(\n    () => (compactMode ? 'wx-full-screen' : ''),\n    [compactMode],\n  );\n\n  const handleResize = useCallback((mode) => {\n    setCompactMode(mode);\n  }, []);\n\n  useEffect(() => {\n    const ro = modeObserver(handleResize);\n    ro.observe();\n    return () => {\n      ro.disconnect();\n    };\n  }, [handleResize]);\n\n  const activeTask = useStore(api, '_activeTask');\n  const taskId = useStore(api, 'activeTask');\n  const unscheduledTasks = useStore(api, 'unscheduledTasks');\n  const links = useStore(api, 'links');\n  const splitTasks = useStore(api, 'splitTasks');\n  const segmentIndex = useMemo(\n    () => splitTasks && taskId?.segmentIndex,\n    [splitTasks, taskId],\n  );\n  const isSegment = useMemo(\n    () => segmentIndex || segmentIndex === 0,\n    [segmentIndex],\n  );\n  const baseItems = useMemo(\n    () => getEditorItems({ unscheduledTasks }),\n    [unscheduledTasks],\n  );\n  const undo = useStore(api, 'undo');\n\n  const [linksActionsMap, setLinksActionsMap] = useState({});\n  const [inProgress, setInProgress] = useState(null);\n  const [editorValues, setEditorValues] = useState();\n  const [editorErrors, setEditorErrors] = useState(null);\n\n  const taskTypes = useStore(api, 'taskTypes');\n\n  const task = useMemo(() => {\n    if (!activeTask) return null;\n    let data;\n    if (isSegment && activeTask.segments)\n      data = { ...activeTask.segments[segmentIndex] };\n    else data = { ...activeTask };\n\n    if (readonly) {\n      // preserve parent to differentiate between segment and task\n      let values = { parent: data.parent };\n      baseItems.forEach(({ key, comp }) => {\n        if (comp !== 'links') {\n          const value = data[key];\n          if (comp === 'date' && value instanceof Date) {\n            values[key] = dateFormat(value);\n          } else if (comp === 'slider' && key === 'progress') {\n            values[key] = `${value}%`;\n          } else {\n            values[key] = value;\n          }\n        }\n      });\n      return values;\n    }\n    return data || null;\n  }, [activeTask, isSegment, segmentIndex, readonly, baseItems, dateFormat]);\n\n  useEffect(() => {\n    setEditorValues(task);\n  }, [task]);\n\n  useEffect(() => {\n    setLinksActionsMap({});\n    setEditorErrors(null);\n    setInProgress(null);\n  }, [taskId]);\n\n  function prepareEditorItems(localItems, taskData) {\n    return localItems.map((a) => {\n      const item = { ...a };\n      if (a.config) item.config = { ...item.config };\n      if (item.comp === 'links' && api) {\n        item.api = api;\n        item.autoSave = autoSave;\n        item.onLinksChange = handleLinksChange;\n      }\n      if (item.comp === 'select' && item.key === 'type') {\n        const options = item.options ?? (taskTypes ? taskTypes : []);\n        item.options = options.map((t) => ({\n          ...t,\n          label: _(t.label),\n        }));\n      }\n\n      if (item.comp === 'slider' && item.key === 'progress') {\n        item.labelTemplate = (value) => `${_(item.label)} ${value}%`;\n      }\n\n      if (item.label) item.label = _(item.label);\n      if (item.config?.placeholder)\n        item.config.placeholder = _(item.config.placeholder);\n\n      if (taskData) {\n        if (item.isDisabled && item.isDisabled(taskData, api.getState())) {\n          item.disabled = true;\n        } else delete item.disabled;\n      }\n      return item;\n    });\n  }\n\n  const editorItems = useMemo(() => {\n    let eItems = items.length ? items : baseItems;\n    eItems = prepareEditorItems(eItems, editorValues);\n    if (!editorValues) return eItems;\n    return eItems.filter(\n      (item) => !item.isHidden || !item.isHidden(editorValues, api.getState()),\n    );\n  }, [items, baseItems, editorValues, taskTypes, _, api, autoSave]);\n\n  const editorKeys = useMemo(\n    () => editorItems.map((i) => i.key),\n    [editorItems],\n  );\n\n  function handleLinksChange({ id, action, data }) {\n    setLinksActionsMap((prev) => ({\n      ...prev,\n      [id]: { action, data },\n    }));\n  }\n\n  const saveLinks = useCallback(() => {\n    for (let link in linksActionsMap) {\n      if (links.byId(link)) {\n        const { action, data } = linksActionsMap[link];\n        api.exec(action, data);\n      }\n    }\n  }, [api, linksActionsMap, links]);\n\n  const deleteTask = useCallback(() => {\n    const id = taskId?.id || taskId;\n    if (isSegment) {\n      if (activeTask?.segments) {\n        const segments = activeTask.segments.filter(\n          (s, index) => index !== segmentIndex,\n        );\n        api.exec('update-task', {\n          id,\n          task: { segments },\n        });\n      }\n    } else {\n      api.exec('delete-task', { id });\n    }\n  }, [api, taskId, isSegment, activeTask, segmentIndex]);\n\n  const hide = useCallback(() => {\n    api.exec('show-editor', { id: null });\n  }, [api]);\n\n  const handleAction = useCallback(\n    (ev) => {\n      const { item, changes } = ev;\n      if (item.id === 'delete') {\n        deleteTask();\n      }\n      if (item.id === 'save') {\n        if (!changes.length) saveLinks();\n        else hide();\n      }\n      if (item.comp) hide();\n    },\n    [api, taskId, autoSave, saveLinks, deleteTask, hide],\n  );\n\n  const normalizeTask = useCallback(\n    (t, key, input) => {\n      if (unscheduledTasks && t.type === 'summary') t.unscheduled = false;\n\n      prepareEditTask(t, api.getState(), key);\n      if (!input) setInProgress(false);\n      return t;\n    },\n    [unscheduledTasks, api],\n  );\n\n  const save = useCallback(\n    (values) => {\n      values = {\n        ...values,\n        unscheduled:\n          unscheduledTasks && values.unscheduled && values.type !== 'summary',\n      };\n      delete values.links;\n      delete values.data;\n\n      if (\n        editorKeys.indexOf('duration') === -1 ||\n        (values.segments && !values.duration)\n      )\n        delete values.duration;\n\n      const data = {\n        id: taskId?.id || taskId,\n        task: values,\n        ...(isSegment && { segmentIndex }),\n      };\n      if (autoSave && inProgress) data.inProgress = inProgress;\n\n      api.exec('update-task', data);\n\n      if (!autoSave) saveLinks();\n    },\n    [\n      api,\n      taskId,\n      unscheduledTasks,\n      autoSave,\n      saveLinks,\n      editorKeys,\n      isSegment,\n      segmentIndex,\n      inProgress,\n    ],\n  );\n\n  const handleChange = useCallback(\n    (ev) => {\n      let { update, key, input } = ev;\n\n      if (input) setInProgress(true);\n\n      ev.update = normalizeTask({ ...update }, key, input);\n\n      if (!autoSave) setEditorValues(ev.update);\n      else if (!editorErrors && !input) {\n        const item = editorItems.find((i) => i.key === key);\n        const v = update[key];\n        const isValid = !item.validation || item.validation(v);\n        if (isValid && (!item.required || v)) save(ev.update);\n      }\n    },\n    [autoSave, normalizeTask, editorErrors, editorItems, save],\n  );\n\n  const handleSave = useCallback(\n    (ev) => {\n      if (!autoSave) save(ev.values);\n    },\n    [autoSave, save],\n  );\n\n  const handleValidation = useCallback((check) => {\n    // get all errors after onchange action\n    setEditorErrors(check.errors);\n  }, []);\n\n  const defaultHotkeys = useMemo(\n    () =>\n      undo\n        ? {\n            'ctrl+z': (ev) => {\n              ev.preventDefault();\n              api.exec('undo');\n            },\n            'ctrl+y': (ev) => {\n              ev.preventDefault();\n              api.exec('redo');\n            },\n          }\n        : {},\n    [undo, api],\n  );\n\n  return task ? (\n    <Locale>\n      <WxEditor\n        css={`wx-XkvqDXuw wx-gantt-editor ${styleCss} ${css}`}\n        items={editorItems}\n        values={task}\n        topBar={normalizedTopBar}\n        bottomBar={bottomBar}\n        placement={placement}\n        layout={layout}\n        readonly={readonly}\n        autoSave={autoSave}\n        focus={focus}\n        onAction={handleAction}\n        onSave={handleSave}\n        onValidation={handleValidation}\n        onChange={handleChange}\n        hotkeys={hotkeys && { ...defaultHotkeys, ...hotkeys }}\n      />\n    </Locale>\n  ) : null;\n}\n\nexport default Editor;\n","import { useState, useEffect } from 'react';\nimport { HeaderMenu as HeaderMenuInner } from '@svar-ui/react-grid';\n\nconst HeaderMenu = ({ children, columns = null, api }) => {\n  const [tableAPI, setTableAPI] = useState(null);\n  useEffect(() => {\n    if (!api) return;\n    api.getTable(true).then(setTableAPI);\n  }, [api]);\n\n  return (\n    <HeaderMenuInner api={tableAPI} columns={columns}>\n      {children}\n    </HeaderMenuInner>\n  );\n};\n\nexport default HeaderMenu;\n","import { useState, useEffect, useRef } from 'react';\nimport './Tooltip.css';\n\nfunction Tooltip(props) {\n  const { api, content: Content, children } = props;\n\n  const areaRef = useRef(null);\n  const tooltipNodeRef = useRef(null);\n\n  const [areaCoords, setAreaCoords] = useState({});\n  const [tooltipData, setTooltipData] = useState(null);\n  const [pos, setPos] = useState({});\n\n  function findAttribute(node) {\n    while (node) {\n      if (node.getAttribute) {\n        const id = node.getAttribute('data-tooltip-id');\n        const at = node.getAttribute('data-tooltip-at');\n        const tooltip = node.getAttribute('data-tooltip');\n        if (id || tooltip) return { id, tooltip, target: node, at };\n      }\n      node = node.parentNode;\n    }\n\n    return { id: null, tooltip: null, target: null, at: null };\n  }\n\n  useEffect(() => {\n    const tooltipNode = tooltipNodeRef.current;\n    if (tooltipNode && pos && (pos.text || Content)) {\n      const tooltipCoords = tooltipNode.getBoundingClientRect();\n\n      let updated = false;\n      let newLeft = pos.left;\n      let newTop = pos.top;\n\n      if (tooltipCoords.right >= areaCoords.right) {\n        newLeft = areaCoords.width - tooltipCoords.width - 5;\n        updated = true;\n      }\n      if (tooltipCoords.bottom >= areaCoords.bottom) {\n        newTop = pos.top - (tooltipCoords.bottom - areaCoords.bottom + 2);\n        updated = true;\n      }\n\n      if (updated) {\n        setPos((prev) => {\n          if (!prev) return prev;\n          return { ...prev, left: newLeft, top: newTop };\n        });\n      }\n    }\n  }, [pos, areaCoords, Content]);\n\n  const timerRef = useRef(null);\n  const TIMEOUT = 300;\n  const debounce = (code) => {\n    clearTimeout(timerRef.current);\n    timerRef.current = setTimeout(() => {\n      code();\n    }, TIMEOUT);\n  };\n\n  function move(e) {\n    let { id, tooltip, target, at } = findAttribute(e.target);\n    setPos(null);\n    setTooltipData(null);\n\n    if (!tooltip) {\n      if (!id) {\n        clearTimeout(timerRef.current);\n        return;\n      } else {\n        tooltip = getTaskText(id);\n      }\n    }\n\n    const clientX = e.clientX;\n\n    debounce(() => {\n      if (id) {\n        setTooltipData(getTaskObj(prepareId(id)));\n      }\n\n      const targetCoords = target.getBoundingClientRect();\n      const areaEl = areaRef.current;\n      const areaRect = areaEl\n        ? areaEl.getBoundingClientRect()\n        : { top: 0, left: 0, right: 0, bottom: 0, width: 0, height: 0 };\n\n      let top, left;\n      if (at === 'left') {\n        top = targetCoords.top + 5 - areaRect.top;\n        left = targetCoords.right + 5 - areaRect.left;\n      } else {\n        top = targetCoords.top + targetCoords.height - areaRect.top;\n        left = clientX - areaRect.left;\n      }\n\n      setAreaCoords(areaRect);\n      setPos({ top, left, text: tooltip });\n    });\n  }\n\n  function getTaskObj(id) {\n    return api?.getTask(prepareId(id)) || null;\n  }\n\n  function getTaskText(id) {\n    return getTaskObj(id)?.text || '';\n  }\n\n  function prepareId(id) {\n    const numId = parseInt(id);\n    return isNaN(numId) ? id : numId;\n  }\n\n  return (\n    <div\n      className=\"wx-KG0Lwsqo wx-tooltip-area\"\n      ref={areaRef}\n      onMouseMove={move}\n    >\n      {pos && (pos.text || Content) ? (\n        <div\n          className=\"wx-KG0Lwsqo wx-gantt-tooltip\"\n          ref={tooltipNodeRef}\n          style={{ top: `${pos.top}px`, left: `${pos.left}px` }}\n        >\n          {Content ? (\n            <Content data={tooltipData} />\n          ) : pos.text ? (\n            <div className=\"wx-KG0Lwsqo wx-gantt-tooltip-text\">{pos.text}</div>\n          ) : null}\n        </div>\n      ) : null}\n\n      {children}\n    </div>\n  );\n}\n\nexport default Tooltip;\n","import { Material as CoreMaterial } from '@svar-ui/react-core';\nimport './Material.css';\n\nfunction Material({ fonts = true, children }) {\n  if (children) {\n    return <CoreMaterial fonts={fonts}>{children()}</CoreMaterial>;\n  } else {\n    return <CoreMaterial fonts={fonts} />;\n  }\n}\n\nexport default Material;\n","import { Willow as CoreWillow } from '@svar-ui/react-core';\nimport './Willow.css';\n\nfunction Willow({ fonts = true, children }) {\n  return children ? (\n    <CoreWillow fonts={fonts}>{children}</CoreWillow>\n  ) : (\n    <CoreWillow fonts={fonts} />\n  );\n}\n\nexport default Willow;\n","import { WillowDark as WillowDarkCore } from '@svar-ui/react-core';\nimport './WillowDark.css';\n\nexport default function WillowDark({ fonts = true, children }) {\n  if (children) {\n    return <WillowDarkCore fonts={fonts}>{children}</WillowDarkCore>;\n  } else {\n    return <WillowDarkCore fonts={fonts} />;\n  }\n}\n"],"names":["store","createContext","getID","node","id","numId","getOffset","relative","ev","box","base","checkSource","SHIFT","reorder","config","source","clone","sid","x","y","detail","touched","touchTimer","down","event","handleTouchstart","locate","handleTouchmove","handleContext","handleTouchend","handleMousedown","handleMousemove","handleMouseup","end","full","move","dx","dy","top","task","up","targetNode","target","tid","line","after","before","TextCell","row","column","getStyle","col","CellComponent","jsxs","jsx","ActionCell","cell","action","useMemo","Grid","props","readonly","compactMode","width","display","columnWidthProp","onTableAPIChange","multiTaskRows","rowMapping","columnWidth","setColumnWidthProp","useWritableProp","tableAPI","setTableAPI","useState","i18n","useContext","context","_","api","storeContext","scrollTopVal","useStore","cellHeightVal","scrollTask","selectedVal","areaVal","rTasksVal","scalesVal","columnsVal","sortVal","calendarVal","durationUnitVal","splitTasksVal","dragTask","setDragTask","tasks","execAction","useCallback","a","onClick","e","locateID","tableRef","useRef","tableContainerRef","gridWidth","setGridWidth","updateFlex","setUpdateFlex","useEffect","update","ro","lastDetailRef","reorderTasks","inProgress","mode","scrollDelta","headerHeight","scrollX","tableStyle","style","allTasks","t","gridRows","rowMap","processedRows","rowId","cols","header","text","ti","c","ai","actionCol","basis","sortMarks","marks","key","order","index","checkFlex","hasFlexCol","fitColumns","filteredColumns","containerWidth","baseColumnWidth","forceReset","actualWidth","acc","k","setColumnWidth","resized","newColumnWidth","adjustColumns","onDblClick","locateAttr","sel","scrollDeltaRef","updateScrollOffset","scrollTop","body","tableEl","bodyEl","focusCell","startReorder","endReorder","moveReorder","handleHotkey","isInput","handlersStateRef","setHandlersState","init","tapi","add","keySort","s","value","v","prepareEditTask","WxGrid","CellGrid","borders","cellWidth","cellHeight","nodeRef","color","setColor","border","grid","Links","onSelectLink","selectedLink","links","criticalPath","selectedLineRef","onClickOutside","css","handler","link","className","BarSegments","type","segmentStyle","i","getSegProgress","segmentIndex","progress","segments","duration","result","seg","clipboardTasks","clipboardBaseDate","clipboardParent","pixelToDate","px","scales","start","lengthUnitWidth","lengthUnit","msPerDay","daysPerUnit","units","date","getCellOffset","baseDate","msPerUnit","addCells","cells","boundsOverlap","left1","right1","left2","right2","Bars","TaskTemplate","marqueeSelect","copyPaste","allowTaskIntersection","summaryBarCounts","rTasksValue","rTasksCounter","useStoreWithCounter","rLinksValue","rLinksCounter","areaValue","scalesValueRaw","taskTypesValue","scalesValue","utcDate","dayOfWeek","daysToMonday","monday","baselinesValue","selectedValue","selectedCounter","scrollTaskStore","tree","schedule","splitTasks","adjustedTasks","rowIndexMap","seenRows","rowIndex","summaryColCounts","childrenMap","summaryIds","counts","summaryId","children","colCounts","child","startCol","endCol","ignoreNextClickRef","linkFrom","setLinkFrom","taskMove","setTaskMove","progressFromRef","setSelectedLink","setTouched","touchTimerRef","totalWidth","setTotalWidth","marquee","setMarquee","marqueeRef","bulkMove","setBulkMove","pasteTargetDate","setPasteTargetDate","pastePreview","setPastePreview","pasteTargetDateRef","lastMouseXRef","containerRef","hasFocus","el","focused","entries","startDrag","endDrag","getMoveMode","segmentNode","left","p","delta","overlappingTaskIds","overlapping","tasksByRow","rowTasks","j","task1","task2","taskYPositions","yMap","rowYPositions","getIntersectingTasks","rect","minX","maxX","minY","maxY","taskLeft","taskRight","taskTop","taskBottom","selectedIds","isTaskSelected","taskId","point","clientX","newTaskMove","segNode","extendDragOptions","mousedown","container","startX","startY","clickDate","marqueeData","originalPositions","touchstart","currentMarquee","intersecting","diff","isFirst","_origPos","origPos","marker","l","w","segment","diffMs","clientY","currentX","prev","currentY","newLeft","isSegmentMoveAllowed","nextTaskMove","taskNode","barNode","mousemove","touchmove","mouseup","touchend","types","getLinkType","fromStart","toStart","alreadyLinked","removeLinkMarker","executePaste","targetDate","parent","history","targetColumnStart","newId","cellOffset","newStart","newEnd","clickedTask","renderedTask","taskStyle","baselineStyle","contextmenu","taskTypeIds","taskTypeCss","forward","isTaskCritical","isLinkMarkerVisible","linkFromSummaryIds","handleCopy","selected","$x","$y","$h","$w","$skip","$level","$index","$y_base","$x_base","$w_base","$h_base","$skip_baseline","$critical","$reorder","clean","durationDays","startDayOfWeek","commonParent","validTasks","min","handleKeyDown","marqueeStyle","height","isOverlapping","barClass","leftLinkClass","rightLinkClass","Fragment","Button","count","h","rowY","TimeScale","highlightTime","onScaleClick","rowIdx","cellIdx","extraClass","isHtml","renderMetrics","useRenderTime","label","startTime","renderCount","rafRef","enabled","metric","Chart","fullWidth","fullHeight","taskTemplate","cellBorders","scrollToCurrentWeek","currentWeekColor","rScrollTop","markers","rScrollTask","zoom","rTasks","chartHeight","setChartHeight","chartRef","zoomAccumulatorRef","hasScrolledToCurrentWeekRef","extraRows","selectStyle","obj","adjustedY","chartGridHeight","onScroll","setScroll","scroll","pos","dataRequest","num","from","showTask","clientWidth","onWheel","offset","dir","getHoliday","holidays","accumulatedLeft","holiday","cleanupRef","hotkeys","now","currentWeekIndex","accumulatedWidth","cellPositions","cellStart","cellEnd","targetIndex","scrollLeft","TimeScales","Resizer","position","size","onMove","onDisplayChange","leftThreshold","rightThreshold","setValue","setDisplay","getBox","val","name","active","setActive","initialPosition","setInitialPosition","startRef","posRef","timeoutRef","displayRef","getEventPos","newPos","nextDisplay","cursor","resetToInitial","handleExpand","direction","newDisplay","handleExpandLeft","handleExpandRight","b","rootClassName","COMPACT_WIDTH","modeObserver","callback","observer","observe","disconnect","Layout","rScales","rCellHeight","rColumns","undo","computedRowMapping","taskRows","setCompactMode","ganttWidth","setGanttWidth","ganttHeight","setGanttHeight","innerWidth","setInnerWidth","lastDisplay","handleResize","gridColumnWidth","scrollSize","uniqueRows","scrollHeight","expandScale","minWidth","ganttDivRef","pseudoRowsRef","latest","scrollToTask","sc","ch","ss","gh","tt","scrollY","ganttDiv","pseudoRows","flushSync","layoutRef","getUnitFormats","normalizeFormatter","calendarLocale","dateToString","prepareScales","format","scale","prepareFormats","formats","unit","prepareColumns","columns","prepareZoom","level","camelize","part","defaultScales","Gantt","forwardRef","taskTypes","defaultTaskTypes","activeTask","defaultColumns","durationUnit","scaleHeight","baselines","highlightTimeProp","autoScale","unscheduledTasks","projectStart","projectEnd","calendar","currentWeekHighlight","restProps","ref","restPropsRef","dataStore","DataStore","writable","words","coreEn","en","i18nCtx","locale","lCalendar","normalizedConfig","normalizeLinks","normalizeZoom","parsedTasksRef","parseTaskDates","buildRowMap","taskList","firstInRoute","lastInRouteRef","EventBusRouter","tableAPIRef","waitRender","res","useImperativeHandle","initOnceRef","isCurrentWeek","weekStart","currentWeekStart","currentWeekEnd","day","classes","StoreContext","Toolbar","items","i18nLocal","_selected","useStoreLater","historyActions","finalItems","fullButtons","getToolbarButtons","item","isHandledAction","it","handleAction","buttons","finalButtons","button","nextButton","WxToolbar","ContextMenu","optionsInit","resolver","filter","at","menuRef","activeIdRef","taskTypesVal","selectedTasksVal","fullOptions","getMenuOptions","applyLocaleFn","opts","op","getOptions","finalOptions","convertOption","o","cOptions","selectedTasks","itemResolver","menuAction","filterMenu","disabled","onContextMenu","content","WxContextMenu","Provider","autoSave","onLinksChange","_activeTask","linksData","setLinksData","getLinksData","inLinks","outLinks","list","deleteLink","group","handleChange","idx","Field","Text","Combo","option","DateTimePicker","time","onchange","onChange","onChangeHandler","handleDateChange","current","DatePicker","TimePicker","registerEditorItem","RichSelect","TwoState","Slider","Counter","Editor","layout","placement","bottomBar","topBar","focus","lFromCtx","i18nData","dateFormat","normalizedTopBar","styleCss","isSegment","baseItems","getEditorItems","linksActionsMap","setLinksActionsMap","setInProgress","editorValues","setEditorValues","editorErrors","setEditorErrors","data","values","comp","prepareEditorItems","localItems","taskData","handleLinksChange","options","editorItems","eItems","editorKeys","saveLinks","deleteTask","hide","changes","normalizeTask","input","save","handleSave","handleValidation","check","defaultHotkeys","Locale","WxEditor","HeaderMenu","HeaderMenuInner","Tooltip","Content","areaRef","tooltipNodeRef","areaCoords","setAreaCoords","tooltipData","setTooltipData","setPos","findAttribute","tooltip","tooltipNode","tooltipCoords","updated","newTop","timerRef","TIMEOUT","debounce","code","getTaskText","getTaskObj","prepareId","targetCoords","areaEl","areaRect","Material","fonts","CoreMaterial","Willow","CoreWillow","WillowDark","WillowDarkCore"],"mappings":"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"}