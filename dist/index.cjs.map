{"version":3,"file":"index.cjs","sources":["../src/context.js","../src/helpers/locate.js","../src/helpers/reorder.js","../src/components/grid/TextCell.jsx","../src/components/grid/ActionCell.jsx","../src/components/grid/Grid.jsx","../src/components/chart/CellGrid.jsx","../src/components/chart/Links.jsx","../src/components/chart/BarSegments.jsx","../src/components/chart/Bars.jsx","../src/components/chart/TimeScale.jsx","../src/helpers/debug.js","../src/components/chart/Chart.jsx","../src/components/Resizer.jsx","../src/helpers/modeResizeObserver.js","../src/components/Layout.jsx","../src/helpers/prepareConfig.js","../src/components/Gantt.jsx","../src/components/Toolbar.jsx","../src/components/ContextMenu.jsx","../src/components/editor/Links.jsx","../src/components/editor/DateTimePicker.jsx","../src/components/Editor.jsx","../src/components/grid/HeaderMenu.jsx","../src/widgets/Tooltip.jsx","../src/themes/Material.jsx","../src/themes/Willow.jsx","../src/themes/WillowDark.jsx"],"sourcesContent":["import { createContext } from 'react';\n\nconst store = createContext(null);\nexport default store;\n","export function getID(node) {\n  const id = node.getAttribute('data-id');\n  const numId = parseInt(id);\n  return isNaN(numId) || numId.toString() != id ? id : numId;\n}\n","import { getID } from './locate';\nimport { locate } from '@svar-ui/lib-dom';\n\nfunction getOffset(node, relative, ev) {\n  const box = node.getBoundingClientRect();\n  const base = relative.querySelector('.wx-body').getBoundingClientRect();\n\n  return {\n    top: box.top - base.top,\n    left: box.left - base.left,\n    dt: box.bottom - ev.clientY,\n    db: ev.clientY - box.top,\n  };\n}\n\nfunction checkSource(node) {\n  return node && node.getAttribute('data-context-id');\n}\n\nconst SHIFT = 5;\n\nexport function reorder(node, config) {\n  let source, clone, sid;\n  let x, y, base, detail;\n  let touched, touchTimer;\n\n  function down(event) {\n    x = event.clientX;\n    y = event.clientY;\n    base = {\n      ...getOffset(source, node, event),\n      y: config.getTask(sid).$y,\n    };\n\n    document.body.style.userSelect = 'none';\n  }\n\n  function handleTouchstart(event) {\n    source = locate(event);\n    if (!checkSource(source)) return;\n\n    sid = getID(source);\n\n    touchTimer = setTimeout(() => {\n      touched = true;\n      if (config && config.touchStart) config.touchStart();\n      down(event.touches[0]);\n    }, 500);\n\n    node.addEventListener('touchmove', handleTouchmove);\n    node.addEventListener('contextmenu', handleContext);\n    window.addEventListener('touchend', handleTouchend);\n  }\n\n  function handleContext(event) {\n    if (touched || touchTimer) {\n      event.preventDefault();\n      return false;\n    }\n  }\n\n  function handleMousedown(event) {\n    if (event.which !== 1) return;\n\n    source = locate(event);\n    if (!checkSource(source)) return;\n\n    sid = getID(source);\n\n    node.addEventListener('mousemove', handleMousemove);\n    window.addEventListener('mouseup', handleMouseup);\n\n    down(event);\n  }\n\n  function end(full) {\n    node.removeEventListener('mousemove', handleMousemove);\n    node.removeEventListener('touchmove', handleTouchmove);\n    document.body.removeEventListener('mouseup', handleMouseup);\n    document.body.removeEventListener('touchend', handleTouchend);\n    document.body.style.userSelect = '';\n\n    if (full) {\n      node.removeEventListener('mousedown', handleMousedown);\n      node.removeEventListener('touchstart', handleTouchstart);\n    }\n  }\n\n  function move(event) {\n    const dx = event.clientX - x;\n    const dy = event.clientY - y;\n    if (!clone) {\n      if (Math.abs(dx) < SHIFT && Math.abs(dy) < SHIFT) return;\n      if (config && config.start) {\n        if (config.start({ id: sid, e: event }) === false) return;\n      }\n\n      clone = source.cloneNode(true);\n      clone.style.pointerEvents = 'none';\n      clone.classList.add('wx-reorder-task');\n      clone.style.position = 'absolute';\n      clone.style.left = base.left + 'px';\n      clone.style.top = base.top + 'px';\n\n      source.style.visibility = 'hidden';\n      source.parentNode.insertBefore(clone, source);\n    }\n\n    if (clone) {\n      const top = Math.round(Math.max(0, base.top + dy));\n\n      if (config && config.move) {\n        if (config.move({ id: sid, top, detail }) === false) return;\n      }\n\n      const task = config.getTask(sid);\n      const y = task.$y;\n      //dnd may be blocked\n      if (!base.start && base.y == y) return up();\n\n      base.start = true;\n      base.y = task.$y - 4;\n      clone.style.top = top + 'px'; //task.$y - scroll\n\n      const targetNode = document.elementFromPoint(\n        event.clientX,\n        event.clientY,\n      );\n      const target = locate(targetNode);\n\n      if (target && target !== source) {\n        const tid = getID(target);\n        const box = target.getBoundingClientRect();\n        const line = box.top + box.height / 2;\n\n        const after =\n          event.clientY + base.db > line &&\n          target.nextElementSibling !== source;\n        const before =\n          event.clientY - base.dt < line &&\n          target.previousElementSibling !== source;\n\n        if (detail?.after == tid || detail?.before == tid) {\n          // avoid duplicate calls\n          detail = null;\n        } else if (after) {\n          // move down\n          detail = { id: sid, after: tid };\n        } else if (before) {\n          // move up\n          detail = { id: sid, before: tid };\n        }\n      }\n    }\n  }\n\n  function handleMousemove(event) {\n    move(event);\n  }\n\n  function handleTouchmove(event) {\n    if (touched) {\n      event.preventDefault();\n      move(event.touches[0]);\n    } else if (touchTimer) {\n      clearTimeout(touchTimer);\n      touchTimer = null;\n    }\n  }\n\n  function handleTouchend() {\n    touched = null;\n    if (touchTimer) {\n      clearTimeout(touchTimer);\n      touchTimer = null;\n    }\n    up();\n  }\n\n  function handleMouseup() {\n    up();\n  }\n\n  function up() {\n    if (source) {\n      source.style.visibility = '';\n    }\n    if (clone) {\n      clone.parentNode.removeChild(clone);\n      if (config && config.end) config.end({ id: sid, top: base.top });\n    }\n\n    sid = source = clone = base = detail = null;\n    end();\n  }\n\n  if (node.style.position !== 'absolute') node.style.position = 'relative';\n\n  node.addEventListener('mousedown', handleMousedown);\n  node.addEventListener('touchstart', handleTouchstart);\n\n  return {\n    destroy() {\n      end(true);\n    },\n  };\n}\n","import './TextCell.css';\n\nfunction TextCell({ row, column }) {\n  function getStyle(row, col) {\n    return {\n      justifyContent: col.align,\n      paddingLeft: `${(row.$level - 1) * 20}px`,\n    };\n  }\n\n  const CellComponent = column && column._cell;\n\n  return (\n    <div className=\"wx-pqc08MHU wx-content\" style={getStyle(row, column)}>\n      {row.data || row.lazy ? (\n        <i\n          className={`wx-pqc08MHU wx-toggle-icon wxi-menu-${row.open ? 'down' : 'right'}`}\n          data-action=\"open-task\"\n        />\n      ) : (\n        <i className=\"wx-pqc08MHU wx-toggle-placeholder\" />\n      )}\n      <div className=\"wx-pqc08MHU wx-text\">\n        {CellComponent ? <CellComponent row={row} column={column} /> : row.text}\n      </div>\n    </div>\n  );\n}\n\nexport default TextCell;\n","import { useMemo } from 'react';\nimport './ActionCell.css';\n\nfunction ActionCell({ column, cell }) {\n  const action = useMemo(() => column.id, [column?.id]);\n\n  return cell || column.id == 'add-task' ? (\n    <div style={{ textAlign: column.align }}>\n      <i\n        className=\"wx-9DAESAHW wx-action-icon wxi-plus\"\n        data-action={action}\n      ></i>\n    </div>\n  ) : null;\n}\n\nexport default ActionCell;\n","import {\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { context } from '@svar-ui/react-core';\nimport { locateID, locateAttr } from '@svar-ui/lib-dom';\nimport { reorder } from '../../helpers/reorder';\nimport { prepareEditTask } from '@svar-ui/gantt-store';\nimport { Grid as WxGrid } from '@svar-ui/react-grid';\nimport TextCell from './TextCell.jsx';\nimport ActionCell from './ActionCell.jsx';\nimport { useWritableProp, useStore } from '@svar-ui/lib-react';\nimport storeContext from '../../context';\nimport './Grid.css';\n\nexport default function Grid(props) {\n  const {\n    readonly,\n    compactMode,\n    width = 0,\n    display = 'all',\n    columnWidth: columnWidthProp = 0,\n    onTableAPIChange,\n    multiTaskRows = false,\n    rowMapping = null,\n  } = props;\n  const [columnWidth, setColumnWidthProp] = useWritableProp(columnWidthProp);\n  const [tableAPI, setTableAPI] = useState();\n\n  const i18n = useContext(context.i18n);\n  const _ = useMemo(() => i18n.getGroup('gantt'), [i18n]);\n  const api = useContext(storeContext);\n\n  const scrollTopVal = useStore(api, 'scrollTop');\n  const cellHeightVal = useStore(api, 'cellHeight');\n  const scrollTask = useStore(api, '_scrollTask');\n  const selectedVal = useStore(api, '_selected');\n  const areaVal = useStore(api, 'area');\n  const rTasksVal = useStore(api, '_tasks');\n  const scalesVal = useStore(api, '_scales');\n  const columnsVal = useStore(api, 'columns');\n  const sortVal = useStore(api, '_sort');\n  const calendarVal = useStore(api, 'calendar');\n  const durationUnitVal = useStore(api, 'durationUnit');\n  const splitTasksVal = useStore(api, 'splitTasks');\n\n  const [dragTask, setDragTask] = useState(null);\n\n  const tasks = useMemo(() => {\n    if (!rTasksVal || !areaVal) return [];\n\n    // When multiTaskRows is enabled, the store's area calculation doesn't account\n    // for reduced row count. Include all tasks and let CSS overflow handle visibility.\n    // This is safe because the container height is already correctly calculated.\n    if (multiTaskRows && rowMapping) {\n      return rTasksVal;\n    }\n\n    return rTasksVal.slice(areaVal.start, areaVal.end);\n  }, [rTasksVal, areaVal, multiTaskRows, rowMapping]);\n\n  const execAction = useCallback(\n    (id, action) => {\n      if (action === 'add-task') {\n        api.exec(action, {\n          target: id,\n          task: { text: _('New Task') },\n          mode: 'child',\n          show: true,\n        });\n      } else if (action === 'open-task') {\n        const task = tasks.find((a) => a.id === id);\n        if (task?.data || task?.lazy)\n          api.exec(action, { id, mode: !task.open });\n      }\n    },\n    [tasks],\n  );\n\n  const onClick = useCallback(\n    (e) => {\n      const id = locateID(e);\n      const action = e.target.dataset.action;\n      if (action) e.preventDefault();\n      if (id) {\n        if (action === 'add-task' || action === 'open-task') {\n          execAction(id, action);\n        } else {\n          api.exec('select-task', {\n            id,\n            toggle: e.ctrlKey || e.metaKey,\n            range: e.shiftKey,\n            show: true,\n          });\n        }\n      } else if (action === 'add-task') {\n        execAction(null, action);\n      }\n    },\n    [api, execAction],\n  );\n\n  const tableRef = useRef(null);\n  const tableContainerRef = useRef(null);\n  const [gridWidth, setGridWidth] = useState(0);\n  const [updateFlex, setUpdateFlex] = useState(false);\n\n  useEffect(() => {\n    const node = tableContainerRef.current;\n    if (!node || typeof ResizeObserver === 'undefined') return;\n    const update = () => setGridWidth(node.clientWidth);\n    update();\n    const ro = new ResizeObserver(update);\n    ro.observe(node);\n    return () => ro.disconnect();\n  }, []);\n\n  const lastDetailRef = useRef(null);\n\n  const reorderTasks = useCallback(\n    (detail) => {\n      const id = detail.id;\n      const { before, after } = detail;\n      const inProgress = detail.onMove;\n\n      let target = before || after;\n      let mode = before ? 'before' : 'after';\n\n      if (inProgress) {\n        if (mode === 'after') {\n          const task = api.getTask(target);\n          if (task.data?.length && task.open) {\n            mode = 'before';\n            target = task.data[0].id;\n          }\n        }\n        lastDetailRef.current = { id, [mode]: target };\n      } else lastDetailRef.current = null;\n\n      api.exec('move-task', {\n        id,\n        mode,\n        target,\n        inProgress,\n      });\n    },\n    [api],\n  );\n\n  // When multiTaskRows is enabled, we show all rows without virtualization, so no offset needed\n  const scrollDelta = useMemo(() => {\n    if (multiTaskRows && rowMapping) return 0;\n    return areaVal?.from ?? 0;\n  }, [areaVal, multiTaskRows, rowMapping]);\n  const headerHeight = useMemo(() => scalesVal?.height ?? 0, [scalesVal]);\n\n  const scrollX = useMemo(() => {\n    if (!compactMode && display !== 'grid') {\n      return (columnWidth ?? 0) > (width ?? 0);\n    } else {\n      return (columnWidth ?? 0) > (gridWidth ?? 0);\n    }\n  }, [compactMode, display, columnWidth, width, gridWidth]);\n\n  const tableStyle = useMemo(() => {\n    const style = {};\n    if ((scrollX && display === 'all') || (display === 'grid' && scrollX)) {\n      style.width = columnWidth;\n    } else if (display === 'grid') {\n      style.width = '100%';\n    }\n    return style;\n  }, [scrollX, display, columnWidth]);\n\n  const allTasks = useMemo(() => {\n    if (dragTask && !tasks.find((t) => t.id === dragTask.id)) {\n      return [...tasks, dragTask];\n    }\n    return tasks;\n  }, [tasks, dragTask]);\n\n  // Aggregate rows when multiTaskRows is enabled\n  const gridRows = useMemo(() => {\n    if (!multiTaskRows || !rowMapping) return allTasks;\n\n    const rowMap = new Map();\n    const processedRows = new Set();\n\n    allTasks.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n\n      if (!processedRows.has(rowId)) {\n        // First task in row - use its properties\n        rowMap.set(rowId, {\n          ...task,\n          $rowTasks: rowMapping.rowMap.get(rowId) || [task.id],\n        });\n        processedRows.add(rowId);\n      }\n    });\n\n    return Array.from(rowMap.values());\n  }, [allTasks, multiTaskRows, rowMapping]);\n\n  const cols = useMemo(() => {\n    let cols = (columnsVal || []).map((col) => {\n      col = { ...col };\n      const header = col.header;\n      if (typeof header === 'object') {\n        const text = header.text && _(header.text);\n        col.header = { ...header, text };\n      } else col.header = _(header);\n      return col;\n    });\n    const ti = cols.findIndex((c) => c.id === 'text');\n    const ai = cols.findIndex((c) => c.id === 'add-task');\n\n    if (ti !== -1) {\n      if (cols[ti].cell) cols[ti]._cell = cols[ti].cell;\n      cols[ti].cell = TextCell;\n    }\n    if (ai !== -1) {\n      cols[ai].cell = cols[ai].cell || ActionCell;\n\n      const header = cols[ai].header;\n      if (typeof header !== 'object') cols[ai].header = { text: header };\n      cols[ai].header.cell = header.cell || ActionCell;\n\n      if (readonly) {\n        cols.splice(ai, 1);\n      } else {\n        if (compactMode) {\n          const [actionCol] = cols.splice(ai, 1);\n          cols.unshift(actionCol);\n        }\n      }\n    }\n\n    if (cols.length > 0) cols[cols.length - 1].resize = false;\n    return cols;\n  }, [columnsVal, _, readonly, compactMode]);\n\n  const basis = useMemo(() => {\n    if (display === 'all') return `${width}px`;\n    if (display === 'grid') return 'calc(100% - 4px)';\n    return cols.find((c) => c.id === 'add-task') ? '50px' : '0';\n  }, [display, width, cols]);\n\n  const sortMarks = useMemo(() => {\n    if (gridRows && sortVal?.length) {\n      const marks = {};\n      sortVal.forEach(({ key, order }, index) => {\n        marks[key] = {\n          order,\n          ...(sortVal.length > 1 && { index }),\n        };\n      });\n      return marks;\n    }\n    return {};\n  }, [gridRows, sortVal]);\n\n  const checkFlex = useCallback(() => {\n    return cols.some((c) => c.flexgrow && !c.hidden);\n  }, []); // cols defined later; will use latest value when invoked\n\n  const hasFlexCol = useMemo(() => {\n    // updateFlex is used to trigger re-evaluation\n    void updateFlex;\n    return checkFlex();\n  }, [checkFlex, updateFlex]);\n\n  const fitColumns = useMemo(() => {\n    let filteredColumns =\n      display === 'chart' ? cols.filter((c) => c.id === 'add-task') : cols;\n\n    const containerWidth = display === 'all' ? width : gridWidth;\n    if (!hasFlexCol) {\n      let baseColumnWidth = columnWidth;\n      let forceReset = false;\n      if (cols.some((c) => c.$width)) {\n        let actualWidth = 0;\n        baseColumnWidth = cols.reduce((acc, col) => {\n          if (!col.hidden) {\n            actualWidth += col.width;\n            acc += col.$width || col.width;\n          }\n          return acc;\n        }, 0);\n\n        if (actualWidth > baseColumnWidth && baseColumnWidth > containerWidth)\n          forceReset = true;\n      }\n\n      if (forceReset || baseColumnWidth < containerWidth) {\n        let k = 1;\n        if (!forceReset)\n          k = (containerWidth - 50) / (baseColumnWidth - 50 || 1);\n        return filteredColumns.map((c) => {\n          if (c.id !== 'add-task' && !c.hidden) {\n            if (!c.$width) c.$width = c.width;\n            c.width = c.$width * k;\n          }\n          return c;\n        });\n      }\n    }\n    return filteredColumns;\n  }, [display, cols, hasFlexCol, columnWidth, width, gridWidth]);\n\n  const setColumnWidth = useCallback(\n    (resized) => {\n      if (!checkFlex()) {\n        const newColumnWidth = fitColumns.reduce((acc, col) => {\n          if (resized && col.$width) col.$width = col.width;\n          return acc + (col.hidden ? 0 : col.width);\n        }, 0);\n        if (newColumnWidth !== columnWidth) setColumnWidthProp(newColumnWidth);\n      }\n      setUpdateFlex(true);\n      setUpdateFlex(false);\n    },\n    [checkFlex, fitColumns, columnWidth, setColumnWidthProp],\n  );\n\n  const adjustColumns = useCallback(() => {\n    const flexCols = cols.filter((c) => c.flexgrow && !c.hidden);\n    if (flexCols.length === 1)\n      cols.forEach((c) => {\n        if (c.$width && !c.flexgrow && !c.hidden) c.width = c.$width;\n      });\n  }, []); // cols defined later; will use latest\n\n  const onDblClick = useCallback(\n    (e) => {\n      if (!readonly) {\n        const id = locateID(e);\n        const column = locateAttr(e, 'data-col-id');\n        const columnObj = column && cols.find((c) => c.id == column);\n        if (!columnObj?.editor && id) api.exec('show-editor', { id });\n      }\n    },\n    [api, readonly], // cols is defined later; relies on latest value at call time\n  );\n\n  const sel = useMemo(\n    () => (Array.isArray(selectedVal) ? selectedVal.map((o) => o.id) : []),\n    [selectedVal],\n  );\n\n  // Direct scroll sync via event listener (bypasses React state for performance)\n  const scrollDeltaRef = useRef(scrollDelta);\n  scrollDeltaRef.current = scrollDelta;\n\n  useEffect(() => {\n    const updateScrollOffset = (scrollTop) => {\n      if (tableRef.current) {\n        const body = tableRef.current.querySelector('.wx-body');\n        if (body) {\n          body.style.top = -((scrollTop ?? 0) - (scrollDeltaRef.current ?? 0)) + 'px';\n        }\n      }\n      if (tableContainerRef.current) tableContainerRef.current.scrollTop = 0;\n    };\n\n    // Initial sync\n    updateScrollOffset(scrollTopVal);\n\n    // Listen directly to scroll-chart events for immediate sync\n    const unsubscribe = api.on('scroll-chart', ({ top }) => {\n      if (top !== undefined) {\n        updateScrollOffset(top);\n      }\n    });\n\n    return unsubscribe;\n  }, [api, scrollTopVal]);\n\n  // Update on scrollDelta change (area virtualization)\n  useEffect(() => {\n    if (tableRef.current) {\n      const body = tableRef.current.querySelector('.wx-body');\n      if (body) {\n        body.style.top = -((scrollTopVal ?? 0) - (scrollDelta ?? 0)) + 'px';\n      }\n    }\n  }, [scrollDelta]);\n\n  useEffect(() => {\n    const tableEl = tableRef.current;\n    if (!tableEl) return;\n    const bodyEl = tableEl.querySelector('.wx-table-box .wx-body');\n    if (!bodyEl || typeof ResizeObserver === 'undefined') return;\n    const ro = new ResizeObserver(() => {\n      // Re-sync scroll offset on resize\n      if (tableRef.current) {\n        const body = tableRef.current.querySelector('.wx-body');\n        if (body) {\n          body.style.top = -((scrollTopVal ?? 0) - (scrollDeltaRef.current ?? 0)) + 'px';\n        }\n      }\n    });\n    ro.observe(bodyEl);\n    return () => {\n      ro.disconnect();\n    };\n  }, [fitColumns, tableStyle, display, basis, gridRows, scrollTopVal]);\n\n  useEffect(() => {\n    if (!scrollTask || !tableAPI) return;\n\n    const { id } = scrollTask;\n    const focusCell = tableAPI.getState().focusCell;\n    if (\n      focusCell &&\n      focusCell.row !== id &&\n      tableRef.current &&\n      tableRef.current.contains(document.activeElement)\n    ) {\n      tableAPI.exec('focus-cell', {\n        row: id,\n        column: focusCell.column,\n      });\n    }\n  }, [scrollTask, tableAPI]);\n\n  const startReorder = useCallback(\n    ({ id }) => {\n      if (readonly) return false;\n\n      if (api.getTask(id).open) api.exec('open-task', { id, mode: false });\n\n      const t = api.getState()._tasks.find((t) => t.id === id);\n      setDragTask(t || null);\n      if (!t) return false;\n    },\n    [api, readonly],\n  );\n\n  const endReorder = useCallback(\n    ({ id, top }) => {\n      if (lastDetailRef.current) {\n        reorderTasks({ ...lastDetailRef.current, onMove: false });\n      } else {\n        api.exec('drag-task', {\n          id,\n          top: top + (scrollDelta ?? 0),\n          inProgress: false,\n        });\n      }\n      setDragTask(null);\n    },\n    [api, reorderTasks, scrollDelta],\n  );\n\n  const moveReorder = useCallback(\n    ({ id, top, detail }) => {\n      if (detail) {\n        reorderTasks({ ...detail, onMove: true });\n      }\n      api.exec('drag-task', {\n        id,\n        top: top + (scrollDelta ?? 0),\n        inProgress: true,\n      });\n    },\n    [api, reorderTasks, scrollDelta],\n  );\n\n  useEffect(() => {\n    const node = tableRef.current;\n    if (!node) return;\n    const action = reorder(node, {\n      start: startReorder,\n      end: endReorder,\n      move: moveReorder,\n      getTask: api.getTask,\n    });\n    return action.destroy;\n  }, [api, startReorder, endReorder, moveReorder]);\n\n  const handleHotkey = useCallback(\n    (ev) => {\n      const { key, isInput } = ev;\n      if (!isInput && (key === 'arrowup' || key === 'arrowdown')) {\n        ev.eventSource = 'grid';\n        api.exec('hotkey', ev);\n        return false;\n      } else if (key === 'enter') {\n        const focusCell = tableAPI?.getState().focusCell;\n        if (focusCell) {\n          const { row, column } = focusCell;\n          if (column === 'add-task') {\n            execAction(row, 'add-task');\n          } else if (column === 'text') {\n            execAction(row, 'open-task');\n          }\n        }\n      }\n    },\n    [api, execAction, tableAPI],\n  );\n\n  // FIXME - temporary hack to provide fresh values to grid's handlers\n  const handlersStateRef = useRef(null);\n  const setHandlersState = () => {\n    handlersStateRef.current = {\n      setTableAPI,\n      handleHotkey,\n      sortVal,\n      api,\n      adjustColumns,\n      setColumnWidth,\n      tasks,\n      calendarVal,\n      durationUnitVal,\n      splitTasksVal,\n      onTableAPIChange,\n    };\n  };\n  setHandlersState();\n  useEffect(() => {\n    setHandlersState();\n  }, [\n    setTableAPI,\n    handleHotkey,\n    sortVal,\n    api,\n    adjustColumns,\n    setColumnWidth,\n    tasks,\n    calendarVal,\n    durationUnitVal,\n    splitTasksVal,\n    onTableAPIChange,\n  ]);\n\n  const init = useCallback((tapi) => {\n    setTableAPI(tapi);\n    tapi.intercept('hotkey', (ev) => handlersStateRef.current.handleHotkey(ev));\n    tapi.intercept('scroll', () => false);\n    tapi.intercept('select-row', () => false);\n    tapi.intercept('sort-rows', (e) => {\n      const sortVal = handlersStateRef.current.sortVal;\n      const { key, add } = e;\n      const keySort = sortVal ? sortVal.find((s) => s.key === key) : null;\n      let order = 'asc';\n      if (keySort) order = !keySort || keySort.order === 'asc' ? 'desc' : 'asc';\n\n      api.exec('sort-tasks', {\n        key,\n        order,\n        add,\n      });\n      return false;\n    });\n\n    tapi.on('resize-column', () => {\n      handlersStateRef.current.setColumnWidth(true);\n    });\n\n    tapi.on('hide-column', (ev) => {\n      if (!ev.mode) handlersStateRef.current.adjustColumns();\n      handlersStateRef.current.setColumnWidth();\n    });\n\n    tapi.intercept('update-cell', (e) => {\n      const { id, column, value } = e;\n      const task = handlersStateRef.current.tasks.find((t) => t.id === id);\n\n      if (task) {\n        const update = { ...task };\n        let v = value;\n        if (v && !isNaN(v) && !(v instanceof Date)) v *= 1;\n        update[column] = v;\n\n        prepareEditTask(\n          update,\n          {\n            calendar: handlersStateRef.current.calendarVal,\n            durationUnit: handlersStateRef.current.durationUnitVal,\n            splitTasks: handlersStateRef.current.splitTasksVal,\n          },\n          column,\n        );\n\n        api.exec('update-task', {\n          id: id,\n          task: update,\n        });\n      }\n      return false;\n    });\n\n    onTableAPIChange && onTableAPIChange(tapi);\n  }, []);\n\n  return (\n    <div\n      className=\"wx-rHj6070p wx-table-container\"\n      style={{ flex: `0 0 ${basis}` }}\n      ref={tableContainerRef}\n    >\n      <div\n        ref={tableRef}\n        style={tableStyle}\n        className=\"wx-rHj6070p wx-table\"\n        onClick={onClick}\n        onDoubleClick={onDblClick}\n      >\n        <WxGrid\n          init={init}\n          sizes={{\n            rowHeight: cellHeightVal,\n            headerHeight: (headerHeight ?? 0) - 1,\n          }}\n          rowStyle={(row) =>\n            row.$reorder ? 'wx-rHj6070p wx-reorder-task' : 'wx-rHj6070p'\n          }\n          columnStyle={(col) =>\n            `wx-rHj6070p wx-text-${col.align}${col.id === 'add-task' ? ' wx-action' : ''}`\n          }\n          data={gridRows}\n          columns={fitColumns}\n          selectedRows={[...sel]}\n          sortMarks={sortMarks}\n        />\n      </div>\n    </div>\n  );\n}\n","import { useContext, useEffect, useRef, useState } from 'react';\nimport storeContext from '../../context';\nimport { grid } from '@svar-ui/gantt-store';\nimport { useStore } from '@svar-ui/lib-react';\n\nfunction CellGrid({ borders = '' }) {\n  const api = useContext(storeContext);\n  const cellWidth = useStore(api, 'cellWidth');\n  const cellHeight = useStore(api, 'cellHeight');\n\n  const nodeRef = useRef(null);\n  const [color, setColor] = useState('#e4e4e4');\n\n  useEffect(() => {\n    if (typeof getComputedStyle !== 'undefined' && nodeRef.current) {\n      const border = getComputedStyle(nodeRef.current).getPropertyValue(\n        '--wx-gantt-border',\n      );\n      setColor(border ? border.substring(border.indexOf('#')) : '#1d1e261a');\n    }\n  }, []);\n\n  const style = {\n    width: '100%',\n    height: '100%',\n    background:\n      cellWidth != null && cellHeight != null\n        ? `url(${grid(cellWidth, cellHeight, color, borders)})`\n        : undefined,\n    position: 'absolute',\n    pointerEvents: 'none',\n  };\n\n  return <div ref={nodeRef} style={style} />;\n}\n\nexport default CellGrid;\n","import { useCallback, useContext, useEffect, useRef } from 'react';\nimport storeContext from '../../context';\nimport { useStore } from '@svar-ui/lib-react';\nimport './Links.css';\n\nexport default function Links({ onSelectLink, selectedLink, readonly }) {\n  const api = useContext(storeContext);\n  const links = useStore(api, '_links');\n  const criticalPath = useStore(api, 'criticalPath');\n\n  const selectedLineRef = useRef(null);\n\n  const onClickOutside = useCallback(\n    (event) => {\n      const css = event?.target?.classList;\n      if (!css?.contains('wx-line') && !css?.contains('wx-delete-button')) {\n        onSelectLink(null);\n      }\n    },\n    [onSelectLink],\n  );\n\n  useEffect(() => {\n    if (!readonly && selectedLink && selectedLineRef.current) {\n      const handler = (event) => {\n        if (\n          selectedLineRef.current &&\n          !selectedLineRef.current.contains(event.target)\n        ) {\n          onClickOutside(event);\n        }\n      };\n      document.addEventListener('click', handler);\n      return () => {\n        document.removeEventListener('click', handler);\n      };\n    }\n  }, [readonly, selectedLink, onClickOutside]);\n\n  return (\n    <svg className=\"wx-dkx3NwEn wx-links\">\n      {(links || []).map((link) => {\n        const className =\n          'wx-dkx3NwEn wx-line' +\n          (criticalPath && link.$critical ? ' wx-critical' : '') +\n          (!readonly ? ' wx-line-selectable' : '');\n        return (\n          <polyline\n            className={className}\n            points={link.$p}\n            key={link.id}\n            onClick={() => !readonly && onSelectLink(link.id)}\n            data-link-id={link.id}\n          />\n        );\n      })}\n      {!readonly && selectedLink && (\n        <polyline\n          ref={selectedLineRef}\n          className=\"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link\"\n          points={selectedLink.$p}\n        />\n      )}\n    </svg>\n  );\n}\n","import './BarSegments.css';\n\nfunction BarSegments(props) {\n  const { task, type } = props;\n\n  function segmentStyle(i) {\n    const s = task.segments[i];\n    return {\n      left: `${s.$x}px`,\n      top: '0px',\n      width: `${s.$w}px`,\n      height: '100%',\n    };\n  }\n\n  function getSegProgress(segmentIndex) {\n    if (!task.progress) return 0;\n\n    const progress = (task.duration * task.progress) / 100;\n    const segments = task.segments;\n    let duration = 0,\n      i = 0,\n      result = null;\n    do {\n      const s = segments[i];\n      if (i === segmentIndex) {\n        if (duration > progress) result = 0;\n        else result = Math.min((progress - duration) / s.duration, 1) * 100;\n      }\n      duration += s.duration;\n      i++;\n    } while (result === null && i < segments.length);\n    return result || 0;\n  }\n\n  return (\n    <div className=\"wx-segments wx-GKbcLEGA\">\n      {task.segments.map((seg, i) => (\n        <div\n          key={i}\n          className={`wx-segment wx-bar wx-${type} wx-GKbcLEGA`}\n          data-segment={i}\n          style={segmentStyle(i)}\n        >\n          {task.progress ? (\n            <div className=\"wx-progress-wrapper\">\n              <div\n                className=\"wx-progress-percent wx-GKbcLEGA\"\n                style={{ width: `${getSegProgress(i)}%` }}\n              ></div>\n            </div>\n          ) : null}\n          <div className=\"wx-content\">{seg.text || ''}</div>\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport default BarSegments;\n","import {\n  Fragment,\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { locate, locateID } from '@svar-ui/lib-dom';\nimport { getID } from '../../helpers/locate';\nimport storeContext from '../../context';\nimport { useStore, useStoreWithCounter } from '@svar-ui/lib-react';\nimport { isSegmentMoveAllowed, extendDragOptions } from '@svar-ui/gantt-store';\nimport { Button } from '@svar-ui/react-core';\nimport Links from './Links.jsx';\nimport BarSegments from './BarSegments.jsx';\nimport './Bars.css';\n\n// Module-level clipboard (persists across renders)\nlet clipboardTasks = [];\nlet clipboardBaseDate = null;\nlet clipboardParent = null;\n\n// Pixel to date conversion helper - snaps to cell start (beginning of week/day/etc)\n// scales.start is normalized to UTC midnight in useMemo above\nconst pixelToDate = (px, scales) => {\n  if (!scales || !scales.start) return null;\n  const { start, lengthUnitWidth, lengthUnit } = scales;\n  const msPerDay = 86400000;\n  const daysPerUnit = lengthUnit === 'week' ? 7 : lengthUnit === 'month' ? 30 : lengthUnit === 'quarter' ? 91 : lengthUnit === 'year' ? 365 : 1;\n  const units = Math.floor(px / lengthUnitWidth);\n  const date = new Date(start.getTime() + units * daysPerUnit * msPerDay);\n  date.setUTCHours(0, 0, 0, 0);\n\n  console.log('[pixelToDate]', {\n    px,\n    units,\n    scalesStart: start.toISOString(),\n    result: date.toISOString(),\n  });\n\n  return date;\n};\n\n// Get cell offset (in whole cells) between two dates\nconst getCellOffset = (date, baseDate, scales) => {\n  if (!scales || !date || !baseDate) return 0;\n  const { lengthUnit } = scales;\n  const msPerDay = 86400000;\n  const daysPerUnit = lengthUnit === 'week' ? 7 : lengthUnit === 'month' ? 30 : lengthUnit === 'quarter' ? 91 : lengthUnit === 'year' ? 365 : 1;\n  const msPerUnit = daysPerUnit * msPerDay;\n  return Math.round((date.getTime() - baseDate.getTime()) / msPerUnit);\n};\n\n// Add cells to a date (returns UTC midnight)\nconst addCells = (date, cells, scales) => {\n  if (!scales || !date) {\n    console.log('[addCells] early return:', { scales: !!scales, date: date?.toISOString?.() });\n    return date;\n  }\n  const { lengthUnit } = scales;\n  const msPerDay = 86400000;\n  const daysPerUnit = lengthUnit === 'week' ? 7 : lengthUnit === 'month' ? 30 : lengthUnit === 'quarter' ? 91 : lengthUnit === 'year' ? 365 : 1;\n  const msPerUnit = daysPerUnit * msPerDay;\n  const result = new Date(date.getTime() + cells * msPerUnit);\n  result.setUTCHours(0, 0, 0, 0);\n  console.log('[addCells]', { date: date.toISOString(), cells, lengthUnit, result: result.toISOString() });\n  return result;\n};\n\n// Check if two horizontal bounds overlap (AABB collision)\nconst boundsOverlap = (left1, right1, left2, right2) => {\n  return left1 < right2 && right1 > left2;\n};\n\nfunction Bars(props) {\n  const {\n    readonly,\n    taskTemplate: TaskTemplate,\n    multiTaskRows = false,\n    rowMapping = null,\n    marqueeSelect = false,\n    copyPaste = false,\n    allowTaskIntersection = true,\n    summaryBarCounts = false,\n  } = props;\n\n  const api = useContext(storeContext);\n\n  const [rTasksValue, rTasksCounter] = useStoreWithCounter(api, '_tasks');\n  const [rLinksValue, rLinksCounter] = useStoreWithCounter(api, '_links');\n  const areaValue = useStore(api, 'area');\n  const scalesValueRaw = useStore(api, '_scales');\n  const taskTypesValue = useStore(api, 'taskTypes');\n\n  // Normalize scales.start to Monday at UTC midnight for consistent positioning\n  // The store may have scales.start at local midnight and/or not on Monday\n  const scalesValue = useMemo(() => {\n    if (!scalesValueRaw || !scalesValueRaw.start) return scalesValueRaw;\n    // First normalize to UTC midnight\n    const utcDate = new Date(Date.UTC(\n      scalesValueRaw.start.getFullYear(),\n      scalesValueRaw.start.getMonth(),\n      scalesValueRaw.start.getDate()\n    ));\n    // Then snap to Monday of that week (ISO week starts Monday)\n    const dayOfWeek = utcDate.getUTCDay(); // 0=Sun, 1=Mon, ..., 6=Sat\n    const daysToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // Sun→-6, Mon→0, Tue→-1, etc.\n    const monday = new Date(utcDate.getTime() + daysToMonday * 86400000);\n    monday.setUTCHours(0, 0, 0, 0);\n    console.log('[scales-normalize]', {\n      raw: scalesValueRaw.start.toISOString(),\n      utc: utcDate.toISOString(),\n      dayOfWeek,\n      daysToMonday,\n      monday: monday.toISOString(),\n    });\n    return { ...scalesValueRaw, start: monday };\n  }, [scalesValueRaw]);\n  const baselinesValue = useStore(api, 'baselines');\n  const [selectedValue, selectedCounter] = useStoreWithCounter(api, '_selected');\n  const scrollTaskStore = useStore(api, '_scrollTask');\n  const criticalPath = useStore(api, 'criticalPath');\n  const tree = useStore(api, 'tasks');\n  const schedule = useStore(api, 'schedule');\n  const splitTasks = useStore(api, 'splitTasks');\n\n  const tasks = useMemo(() => {\n    if (!areaValue || !Array.isArray(rTasksValue)) return [];\n    const start = areaValue.start ?? 0;\n    const end = areaValue.end ?? 0;\n\n    // When multiTaskRows is enabled, the store's area calculation doesn't account\n    // for reduced row count. Include all tasks and let CSS overflow handle visibility.\n    // This is safe because the container height is already correctly calculated.\n    if (multiTaskRows && rowMapping) {\n      return rTasksValue.map((a) => ({ ...a }));\n    }\n\n    return rTasksValue.slice(start, end).map((a) => ({ ...a }));\n  }, [rTasksCounter, areaValue, multiTaskRows, rowMapping]);\n\n  // Adjust task $y positions for multiTaskRows\n  const cellHeight = useStore(api, 'cellHeight');\n  const adjustedTasks = useMemo(() => {\n    if (!multiTaskRows || !rowMapping || !tasks.length) return tasks;\n\n    // Build rowId to rowIndex map\n    const rowIndexMap = new Map();\n    const seenRows = [];\n\n    rTasksValue.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      if (!rowIndexMap.has(rowId)) {\n        rowIndexMap.set(rowId, seenRows.length);\n        seenRows.push(rowId);\n      }\n    });\n\n    // Adjust $y for visible tasks\n    return tasks.map((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      const rowIndex = rowIndexMap.get(rowId) ?? 0;\n      return {\n        ...task,\n        $y: rowIndex * cellHeight,\n        $y_base: task.$y_base !== undefined ? rowIndex * cellHeight : undefined,\n      };\n    });\n  }, [tasks, multiTaskRows, rowMapping, rTasksValue, cellHeight]);\n\n  const lengthUnitWidth = useMemo(\n    () => scalesValue.lengthUnitWidth,\n    [scalesValue],\n  );\n\n  const lengthUnit = useMemo(\n    () => scalesValue.lengthUnit || 'day',\n    [scalesValue],\n  );\n\n  // Compute per-column child task counts for summary bars\n  const summaryColCounts = useMemo(() => {\n    if (!summaryBarCounts || !rTasksValue?.length || !lengthUnitWidth) return null;\n\n    // Build parent→children map\n    const childrenMap = new Map();\n    const summaryIds = new Set();\n    rTasksValue.forEach((task) => {\n      if (task.type === 'summary') {\n        summaryIds.add(task.id);\n      }\n      if (task.parent && task.parent !== 0 && task.type !== 'summary') {\n        if (!childrenMap.has(task.parent)) {\n          childrenMap.set(task.parent, []);\n        }\n        childrenMap.get(task.parent).push(task);\n      }\n    });\n\n    // For each summary, count children per column\n    const counts = new Map(); // summaryId → Map<colIndex, count>\n    summaryIds.forEach((summaryId) => {\n      const children = childrenMap.get(summaryId);\n      if (!children?.length) return;\n\n      const colCounts = new Map();\n      children.forEach((child) => {\n        if (child.$x == null || child.$w == null) return;\n        const startCol = Math.floor(child.$x / lengthUnitWidth);\n        const endCol = Math.ceil((child.$x + child.$w) / lengthUnitWidth);\n        for (let col = startCol; col < endCol; col++) {\n          colCounts.set(col, (colCounts.get(col) || 0) + 1);\n        }\n      });\n\n      if (colCounts.size > 0) {\n        counts.set(summaryId, colCounts);\n      }\n    });\n\n    return counts;\n  }, [summaryBarCounts, rTasksValue, lengthUnitWidth]);\n\n  const ignoreNextClickRef = useRef(false);\n\n  const [linkFrom, setLinkFrom] = useState(undefined);\n  const [taskMove, setTaskMove] = useState(null);\n  const progressFromRef = useRef(null);\n\n  const [selectedLink, setSelectedLink] = useState(null);\n\n  const [touched, setTouched] = useState(undefined);\n  const touchTimerRef = useRef(null);\n\n  const [totalWidth, setTotalWidth] = useState(0);\n\n  // Marquee selection state\n  const [marquee, setMarquee] = useState(null);\n  // Ref to track latest marquee coords (since React state may not update before mouseup)\n  const marqueeRef = useRef(null);\n  // Bulk move state\n  const [bulkMove, setBulkMove] = useState(null);\n  // Paste target position (for copy/paste feature)\n  const [pasteTargetDate, setPasteTargetDate] = useState(null);\n  // Paste preview mode state\n  const [pastePreview, setPastePreview] = useState(null);\n  // Shape: { tasks: [], baseDate, parent, currentX }\n  // Ref for copy/paste handler to avoid stale closure\n  const pasteTargetDateRef = useRef(null);\n  pasteTargetDateRef.current = pasteTargetDate;\n  // Track last mouse X position in container (for paste preview initial position)\n  const lastMouseXRef = useRef(200);\n\n  const containerRef = useRef(null);\n\n  const hasFocus = useMemo(() => {\n    const el = containerRef.current;\n    return !!(\n      selectedValue.length &&\n      el &&\n      el.contains(document.activeElement)\n    );\n  }, [selectedValue, containerRef.current]);\n\n  const focused = useMemo(() => {\n    return hasFocus && selectedValue[selectedValue.length - 1]?.id;\n  }, [hasFocus, selectedValue]);\n\n  useEffect(() => {\n    if (!scrollTaskStore) return;\n    if (hasFocus && scrollTaskStore) {\n      const { id } = scrollTaskStore;\n      const node = containerRef.current?.querySelector(\n        `.wx-bar[data-id='${id}']`,\n      );\n      if (node) node.focus({ preventScroll: true });\n    }\n  }, [scrollTaskStore]);\n\n  useEffect(() => {\n    const el = containerRef.current;\n    if (!el) return;\n    setTotalWidth(el.offsetWidth || 0);\n    if (typeof ResizeObserver !== 'undefined') {\n      const ro = new ResizeObserver((entries) => {\n        if (entries[0]) {\n          setTotalWidth(entries[0].contentRect.width);\n        }\n      });\n      ro.observe(el);\n      return () => ro.disconnect();\n    }\n  }, [containerRef.current]);\n\n  const startDrag = useCallback(() => {\n    document.body.style.userSelect = 'none';\n  }, []);\n\n  const endDrag = useCallback(() => {\n    document.body.style.userSelect = '';\n  }, []);\n\n  const getMoveMode = useCallback(\n    (node, e, task) => {\n      if (e.target.classList.contains('wx-line')) return '';\n      if (!task) task = api.getTask(getID(node));\n      if (task.type === 'milestone' || task.type === 'summary') return '';\n\n      const segmentNode = locate(e, 'data-segment');\n      if (segmentNode) node = segmentNode;\n\n      const { left, width } = node.getBoundingClientRect();\n      const p = (e.clientX - left) / width;\n      let delta = 0.2 / (width > 200 ? width / 200 : 1);\n      if (p < delta) return 'start';\n      if (p > 1 - delta) return 'end';\n      return '';\n    },\n    [api],\n  );\n\n  // Compute which tasks are overlapping with others in the same row\n  // Returns a Set of task IDs that have collisions\n  const overlappingTaskIds = useMemo(() => {\n    const overlapping = new Set();\n\n    // Only check for overlaps if allowTaskIntersection is false and multiTaskRows is enabled\n    if (allowTaskIntersection || !multiTaskRows || !rowMapping) {\n      return overlapping;\n    }\n\n    // Group tasks by row\n    const tasksByRow = new Map();\n    rTasksValue.forEach((task) => {\n      // Skip summary and milestone tasks\n      if (task.type === 'summary' || task.type === 'milestone') return;\n\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      if (!tasksByRow.has(rowId)) {\n        tasksByRow.set(rowId, []);\n      }\n      tasksByRow.get(rowId).push(task);\n    });\n\n    // Check each row for overlaps\n    tasksByRow.forEach((rowTasks) => {\n      if (rowTasks.length < 2) return;\n\n      // Check each pair of tasks in the row\n      for (let i = 0; i < rowTasks.length; i++) {\n        for (let j = i + 1; j < rowTasks.length; j++) {\n          const task1 = rowTasks[i];\n          const task2 = rowTasks[j];\n\n          const left1 = task1.$x;\n          const right1 = task1.$x + task1.$w;\n          const left2 = task2.$x;\n          const right2 = task2.$x + task2.$w;\n\n          if (boundsOverlap(left1, right1, left2, right2)) {\n            overlapping.add(task1.id);\n            overlapping.add(task2.id);\n          }\n        }\n      }\n    });\n\n    return overlapping;\n  }, [allowTaskIntersection, multiTaskRows, rowMapping, rTasksValue, rTasksCounter]);\n\n  // Precompute adjusted Y positions for all tasks (used for marquee intersection)\n  const taskYPositions = useMemo(() => {\n    const yMap = new Map();\n\n    if (!multiTaskRows || !rowMapping) {\n      // No multi-row adjustment - use original $y\n      rTasksValue.forEach((task) => {\n        yMap.set(task.id, task.$y);\n      });\n      return yMap;\n    }\n\n    // Build rowIndex map\n    const rowIndexMap = new Map();\n    const seenRows = [];\n    rTasksValue.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      if (!rowIndexMap.has(rowId)) {\n        rowIndexMap.set(rowId, seenRows.length);\n        seenRows.push(rowId);\n      }\n    });\n\n    // Compute adjusted Y for each task\n    rTasksValue.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      const rowIndex = rowIndexMap.get(rowId) ?? 0;\n      yMap.set(task.id, rowIndex * cellHeight);\n    });\n\n    return yMap;\n  }, [rTasksValue, multiTaskRows, rowMapping, cellHeight]);\n\n  // Map rowId to Y position (for paste preview ghosts)\n  const rowYPositions = useMemo(() => {\n    const yMap = new Map();\n\n    if (!multiTaskRows || !rowMapping) {\n      // Without multiTaskRows, each task is its own row\n      rTasksValue.forEach((task) => {\n        yMap.set(task.id, task.$y);\n        if (task.row !== undefined) {\n          yMap.set(task.row, task.$y);\n        }\n      });\n      return yMap;\n    }\n\n    // Build rowIndex map\n    const rowIndexMap = new Map();\n    const seenRows = [];\n    rTasksValue.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      if (!rowIndexMap.has(rowId)) {\n        rowIndexMap.set(rowId, seenRows.length);\n        seenRows.push(rowId);\n      }\n    });\n\n    // Map rowId to Y position\n    rowIndexMap.forEach((rowIndex, rowId) => {\n      yMap.set(rowId, rowIndex * cellHeight);\n    });\n\n    return yMap;\n  }, [rTasksValue, multiTaskRows, rowMapping, cellHeight]);\n\n  // Get tasks intersecting with a rectangle\n  // Marquee coordinates are already in content-space because getBoundingClientRect()\n  // on a scrolled element returns position accounting for scroll offset\n  const getIntersectingTasks = useCallback(\n    (rect) => {\n      const container = containerRef.current;\n      if (!container) return [];\n\n      // Marquee coords are already content-space (no scroll adjustment needed)\n      // because getBoundingClientRect() on .wx-bars accounts for parent scroll\n      const minX = Math.min(rect.startX, rect.currentX);\n      const maxX = Math.max(rect.startX, rect.currentX);\n      const minY = Math.min(rect.startY, rect.currentY);\n      const maxY = Math.max(rect.startY, rect.currentY);\n\n      return rTasksValue.filter((task) => {\n        const taskLeft = task.$x;\n        const taskRight = task.$x + task.$w;\n        const taskAbsoluteY = taskYPositions.get(task.id) ?? task.$y;\n        const taskTop = taskAbsoluteY;\n        const taskBottom = taskTop + task.$h;\n\n        return (\n          taskLeft < maxX &&\n          taskRight > minX &&\n          taskTop < maxY &&\n          taskBottom > minY\n        );\n      });\n    },\n    [rTasksValue, taskYPositions],\n  );\n\n  // Set of selected task IDs for fast lookup\n  const selectedIds = useMemo(() => {\n    return new Set(selectedValue.map((s) => s.id));\n  }, [selectedValue, selectedCounter]);\n\n  // Check if a task is in the current selection\n  const isTaskSelected = useCallback(\n    (taskId) => {\n      return selectedIds.has(taskId);\n    },\n    [selectedIds],\n  );\n\n  const down = useCallback(\n    (node, point) => {\n      const { clientX } = point;\n      const id = getID(node);\n      const task = api.getTask(id);\n      const css = point.target.classList;\n      if (point.target.closest('.wx-delete-button')) return;\n      if (!readonly) {\n        if (css.contains('wx-progress-marker')) {\n          const { progress } = api.getTask(id);\n          progressFromRef.current = {\n            id,\n            x: clientX,\n            progress,\n            dx: 0,\n            node,\n            marker: point.target,\n          };\n          point.target.classList.add('wx-progress-in-drag');\n        } else {\n          const mode = getMoveMode(node, point, task) || 'move';\n\n          const newTaskMove = {\n            id,\n            mode,\n            x: clientX,\n            dx: 0,\n            l: task.$x,\n            w: task.$w,\n          };\n\n          if (splitTasks && task.segments?.length) {\n            const segNode = locate(point, 'data-segment');\n            if (segNode) {\n              newTaskMove.segmentIndex = segNode.dataset['segment'] * 1;\n              extendDragOptions(task, newTaskMove);\n            }\n          }\n\n          setTaskMove(newTaskMove);\n        }\n        startDrag();\n      }\n    },\n    [api, readonly, getMoveMode, startDrag, splitTasks],\n  );\n\n  const mousedown = useCallback(\n    (e) => {\n      if (e.button !== 0) return;\n\n      // Skip mousedown processing when in paste preview mode\n      // Let onClick handle the paste confirmation\n      if (pastePreview) return;\n\n      const node = locate(e);\n\n      // Marquee selection: click on empty space\n      if (!node && marqueeSelect && !readonly) {\n        const container = containerRef.current;\n        if (!container) return;\n        const rect = container.getBoundingClientRect();\n\n        // Convert viewport coordinates to content-space coordinates\n        // The .wx-bars element spans the full content width, so its bounding rect\n        // already accounts for scroll - no need to add scrollLeft\n        const startX = e.clientX - rect.left;\n        const startY = e.clientY - rect.top;\n\n        // Track click position for paste target (copyPaste feature)\n        // Update ref directly for immediate access (state update may not be ready before Ctrl+V)\n        if (copyPaste) {\n          const clickDate = pixelToDate(startX, scalesValue);\n          if (clickDate) {\n            pasteTargetDateRef.current = clickDate; // Direct ref update for immediate access\n            setPasteTargetDate(clickDate);\n          }\n        }\n\n        const marqueeData = {\n          startX,\n          startY,\n          currentX: startX,\n          currentY: startY,\n          ctrlKey: e.ctrlKey || e.metaKey,\n        };\n        setMarquee(marqueeData);\n        marqueeRef.current = marqueeData;\n        startDrag();\n        return;\n      }\n\n      if (!node) return;\n\n      // Bulk move: click on already-selected task when multiple tasks are selected\n      if (marqueeSelect && !readonly && selectedValue.length > 1) {\n        const id = getID(node);\n        if (isTaskSelected(id)) {\n          const css = e.target.classList;\n          // Don't start bulk move if clicking on link markers, progress marker, or delete buttons\n          if (\n            !css.contains('wx-link') &&\n            !css.contains('wx-progress-marker') &&\n            !e.target.closest('.wx-delete-button')\n          ) {\n            // Check if we're at a resize edge - if so, don't start bulk move\n            const task = api.getTask(id);\n            const mode = getMoveMode(node, e, task);\n            if (!mode) {\n              // Start bulk move\n              const originalPositions = new Map();\n              selectedValue.forEach((sel) => {\n                const t = api.getTask(sel.id);\n                if (t) {\n                  // Skip summary tasks when auto-schedule is on\n                  if (schedule?.auto && t.type === 'summary') return;\n                  originalPositions.set(sel.id, {\n                    $x: t.$x,\n                    $w: t.$w,\n                    start: t.start,\n                    end: t.end,\n                  });\n                }\n              });\n\n              setBulkMove({\n                baseTaskId: id,\n                startX: e.clientX,\n                dx: 0,\n                originalPositions,\n              });\n              startDrag();\n              return;\n            }\n          }\n        }\n      }\n\n      down(node, e);\n    },\n    [down, marqueeSelect, copyPaste, readonly, selectedValue, isTaskSelected, api, getMoveMode, schedule, startDrag, scalesValue, pastePreview],\n  );\n\n  const touchstart = useCallback(\n    (e) => {\n      const node = locate(e);\n      if (node) {\n        touchTimerRef.current = setTimeout(() => {\n          setTouched(true);\n          down(node, e.touches[0]);\n        }, 300);\n      }\n    },\n    [down],\n  );\n\n  const onSelectLink = useCallback(\n    (id) => {\n      setSelectedLink(id && { ...rLinksValue.find((link) => link.id === id) });\n    },\n    [rLinksValue],\n  );\n\n  const up = useCallback(() => {\n    // Handle marquee selection finalization\n    // Use ref instead of state since React may not have flushed state updates yet\n    const currentMarquee = marqueeRef.current;\n    if (currentMarquee) {\n      const intersecting = getIntersectingTasks(currentMarquee);\n\n      if (currentMarquee.ctrlKey) {\n        // Additive selection: toggle each intersecting task\n        intersecting.forEach((task) => {\n          api.exec('select-task', { id: task.id, toggle: true, marquee: true });\n        });\n      } else {\n        // Replace selection: clear first, then select intersecting\n        // First clear any existing selection\n        if (selectedValue.length > 0) {\n          api.exec('select-task', { id: null, marquee: true });\n        }\n        // Then select all intersecting tasks\n        intersecting.forEach((task, index) => {\n          api.exec('select-task', {\n            id: task.id,\n            toggle: index > 0, // First one replaces, rest toggle (add)\n            marquee: true,\n          });\n        });\n      }\n\n      setMarquee(null);\n      marqueeRef.current = null;\n      endDrag();\n      ignoreNextClickRef.current = true;\n      return;\n    }\n\n    // Handle bulk move finalization\n    if (bulkMove) {\n      const { dx, originalPositions } = bulkMove;\n      const diff = Math.round(dx / lengthUnitWidth);\n\n      if (diff !== 0) {\n        let isFirst = true;\n        originalPositions.forEach((_origPos, taskId) => {\n          const task = api.getTask(taskId);\n          if (task) {\n            api.exec('update-task', {\n              id: taskId,\n              diff,\n              task: { start: task.start, end: task.end },\n              skipUndo: !isFirst, // Only first task creates undo entry\n            });\n            isFirst = false;\n          }\n        });\n        ignoreNextClickRef.current = true;\n      } else {\n        // No actual move, reset visual positions\n        originalPositions.forEach((origPos, taskId) => {\n          api.exec('drag-task', {\n            id: taskId,\n            left: origPos.$x,\n            width: origPos.$w,\n            inProgress: false,\n          });\n        });\n      }\n\n      setBulkMove(null);\n      endDrag();\n      return;\n    }\n\n    if (progressFromRef.current) {\n      const { dx, id, marker, value } = progressFromRef.current;\n      progressFromRef.current = null;\n      if (typeof value != 'undefined' && dx)\n        api.exec('update-task', {\n          id,\n          task: { progress: value },\n          inProgress: false,\n        });\n      marker.classList.remove('wx-progress-in-drag');\n\n      ignoreNextClickRef.current = true;\n      endDrag();\n    } else if (taskMove) {\n      const { id, mode, dx, l, w, start, segment, index } = taskMove;\n      setTaskMove(null);\n      if (start) {\n        const diff = Math.round(dx / lengthUnitWidth);\n\n        if (!diff) {\n          api.exec('drag-task', {\n            id,\n            width: w,\n            left: l,\n            inProgress: false,\n            ...(segment && { segmentIndex: index }),\n          });\n        } else {\n          let update = {};\n          let task = api.getTask(id);\n          if (segment) task = task.segments[index];\n\n          // Calculate new dates directly instead of relying on store's diff handling\n          const msPerDay = 24 * 60 * 60 * 1000;\n          const daysPerUnit = lengthUnit === 'week' ? 7 : lengthUnit === 'month' ? 30 : lengthUnit === 'quarter' ? 91 : lengthUnit === 'year' ? 365 : 1;\n          const diffMs = diff * daysPerUnit * msPerDay;\n\n          if (mode === 'move') {\n            update.start = new Date(task.start.getTime() + diffMs);\n            update.end = new Date(task.end.getTime() + diffMs);\n          } else if (mode === 'start') {\n            update.start = new Date(task.start.getTime() + diffMs);\n            update.end = task.end; // Keep end fixed for resize\n          } else if (mode === 'end') {\n            update.start = task.start; // Keep start fixed for resize\n            update.end = new Date(task.end.getTime() + diffMs);\n          }\n\n          api.exec('update-task', {\n            id,\n            task: update,\n            ...(segment && { segmentIndex: index }),\n          });\n        }\n        ignoreNextClickRef.current = true;\n      }\n\n      endDrag();\n    }\n  }, [api, endDrag, taskMove, lengthUnitWidth, lengthUnit, marquee, bulkMove, getIntersectingTasks, selectedValue]);\n\n  const move = useCallback(\n    (e, point) => {\n      const { clientX, clientY } = point;\n\n      // Always track mouse X position for paste preview initial position\n      const container = containerRef.current;\n      if (container) {\n        const rect = container.getBoundingClientRect();\n        lastMouseXRef.current = clientX - rect.left;\n      }\n\n      // Handle paste preview mode - ghosts follow cursor\n      if (pastePreview) {\n        if (!container) return;\n        const rect = container.getBoundingClientRect();\n        const currentX = clientX - rect.left;\n        setPastePreview(prev => ({ ...prev, currentX }));\n        return; // Don't process other interactions\n      }\n\n      if (!readonly) {\n        // Handle marquee selection drag\n        if (marquee) {\n          const container = containerRef.current;\n          if (!container) return;\n          const rect = container.getBoundingClientRect();\n\n          // Convert to content-space coordinates (consistent with task.$x)\n          const currentX = clientX - rect.left;\n          const currentY = clientY - rect.top;\n\n          // Update both state (for rendering) and ref (for immediate access in mouseup)\n          setMarquee((prev) => ({\n            ...prev,\n            currentX,\n            currentY,\n          }));\n          if (marqueeRef.current) {\n            marqueeRef.current.currentX = currentX;\n            marqueeRef.current.currentY = currentY;\n          }\n          return;\n        }\n\n        // Handle bulk move drag\n        if (bulkMove) {\n          const dx = clientX - bulkMove.startX;\n\n          // Apply visual offset to all selected tasks\n          bulkMove.originalPositions.forEach((origPos, taskId) => {\n            const newLeft = origPos.$x + dx;\n            api.exec('drag-task', {\n              id: taskId,\n              left: newLeft,\n              width: origPos.$w,\n              inProgress: true,\n            });\n          });\n\n          setBulkMove((prev) => ({ ...prev, dx }));\n          return;\n        }\n\n        if (progressFromRef.current) {\n          const { node, x, id } = progressFromRef.current;\n          const dx = (progressFromRef.current.dx = clientX - x);\n\n          const diff = Math.round((dx / node.offsetWidth) * 100);\n          let progress = progressFromRef.current.progress + diff;\n          progressFromRef.current.value = progress = Math.min(\n            Math.max(0, progress),\n            100,\n          );\n\n          api.exec('update-task', {\n            id,\n            task: { progress },\n            inProgress: true,\n          });\n        } else if (taskMove) {\n          onSelectLink(null);\n          const { mode, l, w, x, id, start, segment, index } = taskMove;\n          const task = api.getTask(id);\n          const dx = clientX - x;\n          if (\n            (!start && Math.abs(dx) < 20) ||\n            (mode === 'start' && w - dx < lengthUnitWidth) ||\n            (mode === 'end' && w + dx < lengthUnitWidth) ||\n            (mode === 'move' &&\n              ((dx < 0 && l + dx < 0) ||\n                (dx > 0 && l + w + dx > totalWidth))) ||\n            (taskMove.segment && !isSegmentMoveAllowed(task, taskMove))\n          )\n            return;\n\n          const nextTaskMove = { ...taskMove, dx };\n\n          let left, width;\n          if (mode === 'start') {\n            left = l + dx;\n            width = w - dx;\n          } else if (mode === 'end') {\n            left = l;\n            width = w + dx;\n          } else if (mode === 'move') {\n            left = l + dx;\n            width = w;\n          }\n\n          api.exec('drag-task', {\n            id,\n            width: width,\n            left: left,\n            inProgress: true,\n            ...(segment && { segmentIndex: index }),\n          });\n\n          if (\n            !nextTaskMove.start &&\n            ((mode === 'move' && task.$x == l) ||\n              (mode !== 'move' && task.$w == w))\n          ) {\n            ignoreNextClickRef.current = true;\n            up();\n            return;\n          }\n          nextTaskMove.start = true;\n          setTaskMove(nextTaskMove);\n        } else {\n          const taskNode = locate(e);\n          if (taskNode) {\n            const task = api.getTask(getID(taskNode));\n            const segNode = locate(e, 'data-segment');\n            const barNode = segNode || taskNode;\n            const mode = getMoveMode(barNode, point, task);\n            barNode.style.cursor = mode && !readonly ? 'col-resize' : 'pointer';\n          }\n        }\n      }\n    },\n    [\n      api,\n      readonly,\n      taskMove,\n      lengthUnitWidth,\n      totalWidth,\n      getMoveMode,\n      onSelectLink,\n      up,\n      marquee,\n      bulkMove,\n      pastePreview,\n    ],\n  );\n\n  const mousemove = useCallback(\n    (e) => {\n      move(e, e);\n    },\n    [move],\n  );\n\n  const touchmove = useCallback(\n    (e) => {\n      if (touched) {\n        e.preventDefault();\n        move(e, e.touches[0]);\n      } else if (touchTimerRef.current) {\n        clearTimeout(touchTimerRef.current);\n        touchTimerRef.current = null;\n      }\n    },\n    [touched, move],\n  );\n\n  const mouseup = useCallback(() => {\n    up();\n  }, [up]);\n\n  const touchend = useCallback(() => {\n    setTouched(null);\n    if (touchTimerRef.current) {\n      clearTimeout(touchTimerRef.current);\n      touchTimerRef.current = null;\n    }\n    up();\n  }, [up]);\n\n  useEffect(() => {\n    window.addEventListener('mouseup', mouseup);\n    return () => {\n      window.removeEventListener('mouseup', mouseup);\n    };\n  }, [mouseup]);\n\n  const onDblClick = useCallback(\n    (e) => {\n      if (!readonly) {\n        const id = locateID(e.target);\n        if (id && !e.target.classList.contains('wx-link')) {\n          const segmentIndex = locateID(e.target, 'data-segment');\n          api.exec('show-editor', {\n            id,\n            ...(segmentIndex !== null && { segmentIndex }),\n          });\n        }\n      }\n    },\n    [api, readonly],\n  );\n\n  const types = ['e2s', 's2s', 'e2e', 's2e'];\n  const getLinkType = useCallback((fromStart, toStart) => {\n    return types[(fromStart ? 1 : 0) + (toStart ? 0 : 2)];\n  }, []);\n\n  const alreadyLinked = useCallback(\n    (target, toStart) => {\n      const source = linkFrom.id;\n      const fromStart = linkFrom.start;\n\n      if (target === source) return true;\n\n      return !!rLinksValue.find((l) => {\n        return (\n          l.target == target &&\n          l.source == source &&\n          l.type === getLinkType(fromStart, toStart)\n        );\n      });\n    },\n    [linkFrom, rLinksCounter, getLinkType],\n  );\n\n  const removeLinkMarker = useCallback(() => {\n    if (linkFrom) {\n      setLinkFrom(null);\n    }\n  }, [linkFrom]);\n\n  // Execute paste - creates new tasks at target position\n  // Tasks are pasted within the same parent, each task keeps its original row\n  const executePaste = useCallback((targetDate, tasks, parent) => {\n    if (!tasks.length || !targetDate) return;\n    // Note: parent can be 0 (root level), so check for undefined/null specifically\n    if (parent === undefined || parent === null) return;\n\n    console.log('[paste] executePaste called:', {\n      targetDate: targetDate.toISOString(),\n      taskCount: tasks.length,\n      parent,\n    });\n\n    const msPerDay = 86400000;\n    const history = api.getHistory();\n    history?.startBatch();\n\n    // Normalize targetDate to UTC midnight (scales.start is now normalized)\n    const targetColumnStart = new Date(targetDate);\n    targetColumnStart.setUTCHours(0, 0, 0, 0);\n\n    console.log('[paste] scalesValue:', {\n      start: scalesValue?.start?.toISOString?.(),\n      lengthUnit: scalesValue?.lengthUnit,\n      lengthUnitWidth: scalesValue?.lengthUnitWidth,\n    });\n\n    tasks.forEach((task, i) => {\n      const newId = `task-${Date.now()}-${i}`;\n\n      console.log('[paste] task input:', {\n        text: task.text,\n        _startCellOffset: task._startCellOffset,\n        _startDayOfWeek: task._startDayOfWeek,\n        _durationDays: task._durationDays,\n        start: task.start?.toISOString?.(),\n        end: task.end?.toISOString?.(),\n      });\n\n      // Calculate the cell offset from the target column (scales.start is normalized to Monday)\n      const cellOffset = addCells(targetColumnStart, task._startCellOffset || 0, scalesValue);\n      console.log('[paste] cellOffset:', cellOffset?.toISOString?.());\n\n      // Add day-of-week offset (scales.start is Monday, so _startDayOfWeek=0 means Monday)\n      const newStart = new Date(cellOffset.getTime() + (task._startDayOfWeek || 0) * msPerDay);\n      newStart.setUTCHours(0, 0, 0, 0);\n      // Add exact duration in days (not weeks!) to preserve visual width\n      const newEnd = new Date(newStart.getTime() + (task._durationDays || 7) * msPerDay);\n      newEnd.setUTCHours(0, 0, 0, 0);\n      console.log('[paste] task calculated:', {\n        text: task.text,\n        newStart: newStart.toISOString(),\n        newEnd: newEnd.toISOString(),\n        row: task.row,\n      });\n\n      api.exec('add-task', {\n        task: {\n          id: newId,\n          text: task.text,\n          start: newStart,\n          end: newEnd,\n          type: task.type || 'task',\n          parent: parent,\n          row: task.row,\n        },\n        target: parent,\n        mode: 'child',\n        skipUndo: i > 0,\n      });\n    });\n\n    history?.endBatch();\n  }, [api, scalesValue]);\n\n  const onClick = useCallback(\n    (e) => {\n      if (ignoreNextClickRef.current) {\n        ignoreNextClickRef.current = false;\n        return;\n      }\n\n      // Handle paste preview confirm\n      if (pastePreview && pastePreview.currentX != null) {\n        const targetDate = pixelToDate(pastePreview.currentX, scalesValue);\n        if (targetDate) {\n          executePaste(targetDate, pastePreview.tasks, pastePreview.parent);\n        }\n        setPastePreview(null);\n        return;\n      }\n\n      const id = locateID(e.target);\n      if (id) {\n        // Debug: log task info on click\n        const clickedTask = api.getTask(id);\n        const renderedTask = rTasksValue.find(t => t.id === id);\n        console.log('[click] task:', clickedTask?.text, 'id:', id);\n        console.log('[click] api.getTask:', { start: clickedTask?.start, end: clickedTask?.end, duration: clickedTask?.duration });\n        console.log('[click] rendered:', { start: renderedTask?.start, end: renderedTask?.end, $w: renderedTask?.$w, $x: renderedTask?.$x });\n\n        const css = e.target.classList;\n        if (css.contains('wx-link')) {\n          const toStart = css.contains('wx-left');\n          if (!linkFrom) {\n            setLinkFrom({ id, start: toStart });\n            return;\n          }\n\n          if (linkFrom.id !== id && !alreadyLinked(id, toStart)) {\n            api.exec('add-link', {\n              link: {\n                source: linkFrom.id,\n                target: id,\n                type: getLinkType(linkFrom.start, toStart),\n              },\n            });\n          }\n        } else if (css.contains('wx-delete-button-icon')) {\n          api.exec('delete-link', { id: selectedLink.id });\n          setSelectedLink(null);\n        } else {\n          let segmentIndex;\n          const segmentNode = locate(e, 'data-segment');\n          if (segmentNode) segmentIndex = segmentNode.dataset.segment * 1;\n          api.exec('select-task', {\n            id,\n            toggle: e.ctrlKey || e.metaKey,\n            range: e.shiftKey,\n            segmentIndex,\n          });\n        }\n      }\n      removeLinkMarker();\n    },\n    [\n      api,\n      linkFrom,\n      rLinksCounter,\n      selectedLink,\n      alreadyLinked,\n      getLinkType,\n      removeLinkMarker,\n      pastePreview,\n      scalesValue,\n      executePaste,\n    ],\n  );\n\n  const taskStyle = useCallback((task) => {\n    return {\n      left: `${task.$x}px`,\n      top: `${task.$y}px`,\n      width: `${task.$w}px`,\n      height: `${task.$h}px`,\n    };\n  }, []);\n\n  const baselineStyle = useCallback((task) => {\n    return {\n      left: `${task.$x_base}px`,\n      top: `${task.$y_base}px`,\n      width: `${task.$w_base}px`,\n      height: `${task.$h_base}px`,\n    };\n  }, []);\n\n  const contextmenu = useCallback(\n    (ev) => {\n      if (touched || touchTimerRef.current) {\n        ev.preventDefault();\n        return false;\n      }\n    },\n    [touched],\n  );\n\n  const taskTypeIds = useMemo(\n    () => taskTypesValue.map((t) => t.id),\n    [taskTypesValue],\n  );\n\n  const taskTypeCss = useCallback(\n    (type) => {\n      let css = taskTypeIds.includes(type) ? type : 'task';\n      if (!['task', 'milestone', 'summary'].includes(type)) {\n        css = `task ${css}`;\n      }\n      return css;\n    },\n    [taskTypeIds],\n  );\n\n  const forward = useCallback(\n    (ev) => {\n      api.exec(ev.action, ev.data);\n    },\n    [api],\n  );\n\n  const isTaskCritical = useCallback(\n    (taskId) => {\n      return criticalPath && tree.byId(taskId).$critical;\n    },\n    [criticalPath, tree],\n  );\n\n  const isLinkMarkerVisible = useCallback(\n    (id) => {\n      if (schedule?.auto) {\n        const summaryIds = tree.getSummaryId(id, true);\n        const linkFromSummaryIds = tree.getSummaryId(linkFrom.id, true);\n        return (\n          linkFrom?.id &&\n          !(Array.isArray(summaryIds) ? summaryIds : [summaryIds]).includes(\n            linkFrom.id,\n          ) &&\n          !(\n            Array.isArray(linkFromSummaryIds)\n              ? linkFromSummaryIds\n              : [linkFromSummaryIds]\n          ).includes(id)\n        );\n      }\n      return linkFrom;\n    },\n    [schedule, tree, linkFrom],\n  );\n\n  // Copy handler - stores selected tasks in module-level clipboard\n  // Only allows copying tasks from the same parent (company), but different rows are OK\n  // All dates are expected to be UTC - no conversion needed\n  const handleCopy = useCallback(() => {\n    const selected = api.getState()._selected;\n    if (!selected || !selected.length) return;\n\n    const msPerDay = 86400000;\n\n    // Get all selected tasks with their render data from _tasks\n    const tasks = selected.map((sel) => {\n      const task = api.getTask(sel.id);\n      if (!task) return null;\n      // Find the rendered task to get $w (pixel width) and row\n      const renderedTask = rTasksValue.find(t => t.id === sel.id);\n      if (!renderedTask) return null;\n      const { $x, $y, $h, $w, $skip, $level, $index, $y_base, $x_base, $w_base, $h_base, $skip_baseline, $critical, $reorder, ...clean } = renderedTask;\n      // Calculate exact duration in days (not cells!) to preserve visual width\n      const durationDays = renderedTask.end && renderedTask.start\n        ? Math.round((renderedTask.end.getTime() - renderedTask.start.getTime()) / msPerDay)\n        : 0;\n      // Store day-of-week offset (0=Mon, 6=Sun) to preserve position within week\n      // Dates are already UTC\n      const startDayOfWeek = renderedTask.start\n        ? (renderedTask.start.getUTCDay() + 6) % 7  // Convert JS Sun=0 to Mon=0\n        : 0;\n      console.log('[copy] task:', {\n        id: task.id,\n        text: task.text,\n        start: renderedTask.start?.toISOString?.(),\n        end: renderedTask.end?.toISOString?.(),\n        durationDays,\n        startDayOfWeek,\n        $w,\n        $h,\n        row: renderedTask.row,\n        parent: renderedTask.parent,\n      });\n      return { ...clean, _durationDays: durationDays, _startDayOfWeek: startDayOfWeek, _originalWidth: $w, _originalHeight: $h };\n    }).filter(Boolean);\n\n    if (!tasks.length) return;\n\n    // Check that all tasks have the same parent (company)\n    const firstTask = tasks[0];\n    const commonParent = firstTask.parent;\n\n    // Filter to only include tasks with matching parent (different rows OK)\n    const validTasks = tasks.filter(t => t.parent === commonParent);\n\n    if (validTasks.length === 0) return;\n\n    // Store base date (earliest start) - dates are already UTC\n    const baseDate = validTasks.reduce((min, t) => {\n      if (!t.start) return min;\n      return !min || t.start < min ? t.start : min;\n    }, null);\n\n    // Store clipboard data with cell offsets (weeks between tasks)\n    clipboardTasks = validTasks.map(t => ({\n      ...t,\n      _startCellOffset: getCellOffset(t.start, baseDate, scalesValue),\n    }));\n    clipboardParent = commonParent;\n    clipboardBaseDate = baseDate;\n\n    // Log clipboard summary for debugging\n    console.log('[copy] clipboard stored:', {\n      taskCount: clipboardTasks.length,\n      baseDate: baseDate?.toISOString?.(),\n      parent: commonParent,\n      tasks: clipboardTasks.map(t => ({\n        id: t.id,\n        text: t.text,\n        _startCellOffset: t._startCellOffset,\n        _startDayOfWeek: t._startDayOfWeek,\n        _durationDays: t._durationDays,\n      })),\n    });\n  }, [api, scalesValue]);\n\n  // Hotkey intercept for copy/paste\n  useEffect(() => {\n    if (!copyPaste) return;\n\n    const unsub = api.intercept('hotkey', (ev) => {\n      if (ev.key === 'ctrl+c' || ev.key === 'meta+c') {\n        handleCopy();\n        return false;\n      }\n      if (ev.key === 'ctrl+v' || ev.key === 'meta+v') {\n        // Enter paste preview mode instead of immediate paste\n        if (!clipboardTasks.length || !clipboardBaseDate) return false;\n        // Use last tracked mouse position for immediate ghost display\n        setPastePreview({\n          tasks: clipboardTasks,\n          baseDate: clipboardBaseDate,\n          parent: clipboardParent,\n          currentX: lastMouseXRef.current, // Show ghosts at current mouse position\n        });\n        return false;\n      }\n    });\n    return unsub;\n  }, [copyPaste, api, handleCopy]);\n\n  // Escape key to cancel paste preview (separate listener for reliability)\n  useEffect(() => {\n    if (!pastePreview) return;\n\n    const handleKeyDown = (e) => {\n      if (e.key === 'Escape') {\n        e.preventDefault();\n        e.stopPropagation();\n        setPastePreview(null);\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown, true);\n    return () => document.removeEventListener('keydown', handleKeyDown, true);\n  }, [pastePreview]);\n\n  // Compute marquee rectangle style\n  const marqueeStyle = useMemo(() => {\n    if (!marquee) return null;\n    const left = Math.min(marquee.startX, marquee.currentX);\n    const top = Math.min(marquee.startY, marquee.currentY);\n    const width = Math.abs(marquee.currentX - marquee.startX);\n    const height = Math.abs(marquee.currentY - marquee.startY);\n    return {\n      left: `${left}px`,\n      top: `${top}px`,\n      width: `${width}px`,\n      height: `${height}px`,\n    };\n  }, [marquee]);\n\n  return (\n    <div\n      className=\"wx-GKbcLEGA wx-bars\"\n      style={{ lineHeight: `${adjustedTasks.length ? adjustedTasks[0].$h : 0}px` }}\n      ref={containerRef}\n      onContextMenu={contextmenu}\n      onMouseDown={mousedown}\n      onMouseMove={mousemove}\n      onTouchStart={touchstart}\n      onTouchMove={touchmove}\n      onTouchEnd={touchend}\n      onClick={onClick}\n      onDoubleClick={onDblClick}\n      onDragStart={(e) => {\n        e.preventDefault();\n        return false;\n      }}\n    >\n      <Links\n        onSelectLink={onSelectLink}\n        selectedLink={selectedLink}\n        readonly={readonly}\n      />\n      {adjustedTasks.map((task) => {\n        if (task.$skip && task.$skip_baseline) return null;\n        const isOverlapping = overlappingTaskIds.has(task.id);\n        const barClass =\n          `wx-bar wx-${taskTypeCss(task.type)}` +\n          (task.$css ? ` ${task.$css}` : '') +\n          (touched && taskMove && task.id === taskMove.id ? ' wx-touch' : '') +\n          (linkFrom && linkFrom.id === task.id ? ' wx-selected' : '') +\n          (selectedIds.has(task.id) ? ' wx-selected' : '') +\n          (isTaskCritical(task.id) ? ' wx-critical' : '') +\n          (task.$reorder ? ' wx-reorder-task' : '') +\n          (splitTasks && task.segments ? ' wx-split' : '') +\n          (isOverlapping ? ' wx-collision' : '');\n        const leftLinkClass =\n          'wx-link wx-left' +\n          (linkFrom ? ' wx-visible' : '') +\n          (!linkFrom ||\n          (!alreadyLinked(task.id, true) && isLinkMarkerVisible(task.id))\n            ? ' wx-target'\n            : '') +\n          (linkFrom && linkFrom.id === task.id && linkFrom.start\n            ? ' wx-selected'\n            : '') +\n          (isTaskCritical(task.id) ? ' wx-critical' : '');\n        const rightLinkClass =\n          'wx-link wx-right' +\n          (linkFrom ? ' wx-visible' : '') +\n          (!linkFrom ||\n          (!alreadyLinked(task.id, false) && isLinkMarkerVisible(task.id))\n            ? ' wx-target'\n            : '') +\n          (linkFrom && linkFrom.id === task.id && !linkFrom.start\n            ? ' wx-selected'\n            : '') +\n          (isTaskCritical(task.id) ? ' wx-critical' : '');\n        return (\n          <Fragment key={task.id}>\n            {!task.$skip && (\n              <div\n                className={'wx-GKbcLEGA ' + barClass}\n                style={taskStyle(task)}\n                data-tooltip-id={task.id}\n                data-id={task.id}\n                tabIndex={focused === task.id ? 0 : -1}\n              >\n                {!readonly ? (\n                  task.id === selectedLink?.target &&\n                  selectedLink?.type[2] === 's' ? (\n                    <Button\n                      type=\"danger\"\n                      css=\"wx-left wx-delete-button wx-delete-link\"\n                    >\n                      <i className=\"wxi-close wx-delete-button-icon\"></i>\n                    </Button>\n                  ) : (\n                    <div className={'wx-GKbcLEGA ' + leftLinkClass}>\n                      <div className=\"wx-GKbcLEGA wx-inner\"></div>\n                    </div>\n                  )\n                ) : null}\n\n                {task.type !== 'milestone' ? (\n                  <>\n                    {task.progress && !(splitTasks && task.segments) ? (\n                      <div className=\"wx-GKbcLEGA wx-progress-wrapper\">\n                        <div\n                          className=\"wx-GKbcLEGA wx-progress-percent\"\n                          style={{ width: `${task.progress}%` }}\n                        ></div>\n                      </div>\n                    ) : null}\n                    {!readonly && !(splitTasks && task.segments) ? (\n                      <div\n                        className=\"wx-GKbcLEGA wx-progress-marker\"\n                        style={{ left: `calc(${task.progress}% - 10px)` }}\n                      >\n                        {task.progress}\n                      </div>\n                    ) : null}\n                    {TaskTemplate ? (\n                      <TaskTemplate data={task} api={api} onAction={forward} />\n                    ) : splitTasks && task.segments ? (\n                      <BarSegments task={task} type={taskTypeCss(task.type)} />\n                    ) : (\n                      <div className=\"wx-GKbcLEGA wx-content\">\n                        {summaryBarCounts && task.type === 'summary' ? '' : (task.$barText || task.text || '')}\n                      </div>\n                    )}\n                    {isOverlapping && (\n                      <div className=\"wx-GKbcLEGA wx-collision-warning\" title=\"This task overlaps with another task in the same row\">\n                        !\n                      </div>\n                    )}\n                    {summaryColCounts && task.type === 'summary' && (() => {\n                      const colCounts = summaryColCounts.get(task.id);\n                      const startCol = Math.floor(task.$x / lengthUnitWidth);\n                      const endCol = Math.ceil((task.$x + task.$w) / lengthUnitWidth);\n                      return (\n                        <div className=\"wx-GKbcLEGA wx-summary-week-counts\">\n                          {Array.from({ length: endCol - startCol }, (_, i) => {\n                            const col = startCol + i;\n                            const count = colCounts?.get(col) || 0;\n                            return (\n                              <span\n                                key={col}\n                                className={`wx-GKbcLEGA wx-week-count${count === 0 ? ' wx-week-count-zero' : ''}`}\n                                style={{\n                                  position: 'absolute',\n                                  left: `${col * lengthUnitWidth - task.$x}px`,\n                                  width: `${lengthUnitWidth}px`,\n                                  top: 0,\n                                  height: '100%',\n                                  display: 'flex',\n                                  alignItems: 'center',\n                                  justifyContent: 'center',\n                                }}\n                              >\n                                {count}\n                              </span>\n                            );\n                          })}\n                        </div>\n                      );\n                    })()}\n                  </>\n                ) : (\n                  <>\n                    <div className=\"wx-GKbcLEGA wx-content\"></div>\n                    {TaskTemplate ? (\n                      <TaskTemplate data={task} api={api} onAction={forward} />\n                    ) : (\n                      <div className=\"wx-GKbcLEGA wx-text-out\">{task.$barText || task.text}</div>\n                    )}\n                  </>\n                )}\n\n                {!readonly ? (\n                  task.id === selectedLink?.target &&\n                  selectedLink?.type[2] === 'e' ? (\n                    <Button\n                      type=\"danger\"\n                      css=\"wx-right wx-delete-button wx-delete-link\"\n                    >\n                      <i className=\"wxi-close wx-delete-button-icon\"></i>\n                    </Button>\n                  ) : (\n                    <div className={'wx-GKbcLEGA ' + rightLinkClass}>\n                      <div className=\"wx-GKbcLEGA wx-inner\"></div>\n                    </div>\n                  )\n                ) : null}\n              </div>\n            )}\n            {baselinesValue && !task.$skip_baseline ? (\n              <div\n                className={\n                  'wx-GKbcLEGA wx-baseline' +\n                  (task.type === 'milestone' ? ' wx-milestone' : '')\n                }\n                style={baselineStyle(task)}\n              ></div>\n            ) : null}\n          </Fragment>\n        );\n      })}\n      {marquee && marqueeStyle && (\n        <div className=\"wx-GKbcLEGA wx-marquee-selection\" style={marqueeStyle} />\n      )}\n      {pastePreview && pastePreview.currentX != null && (\n        pastePreview.tasks.map((task, i) => {\n          // Calculate ghost x position directly from pixel position (snap to week cell)\n          const cellIndex = Math.floor(pastePreview.currentX / lengthUnitWidth);\n          const x = (cellIndex + (task._startCellOffset || 0)) * lengthUnitWidth;\n          // Use original width and height for accurate ghost size\n          const w = task._originalWidth || lengthUnitWidth;\n          const h = task._originalHeight || cellHeight;\n          // Find row Y position using rowYPositions map or fallback\n          const rowY = rowYPositions.get(task.row) ?? (task.$y || 0);\n          return (\n            <div\n              key={`preview-${i}`}\n              className=\"wx-GKbcLEGA wx-bar wx-task wx-paste-preview\"\n              style={{ left: x, top: rowY, width: w, height: h }}\n            >\n              <div className=\"wx-GKbcLEGA wx-content\">{task.$barText || task.text}</div>\n            </div>\n          );\n        })\n      )}\n    </div>\n  );\n}\n\nexport default Bars;\n","import { useContext } from 'react';\nimport storeContext from '../../context';\nimport { useStore } from '@svar-ui/lib-react';\nimport './TimeScale.css';\n\nfunction TimeScale(props) {\n  const { highlightTime, onScaleClick } = props;\n\n  const api = useContext(storeContext);\n  const scales = useStore(api, '_scales');\n\n  return (\n    <div className=\"wx-ZkvhDKir wx-scale\" style={{ width: scales.width }}>\n      {(scales?.rows || []).map((row, rowIdx) => (\n        <div\n          className=\"wx-ZkvhDKir wx-row\"\n          style={{ height: `${row.height}px` }}\n          key={rowIdx}\n        >\n          {(row.cells || []).map((cell, cellIdx) => {\n            const extraClass = highlightTime\n              ? highlightTime(cell.date, cell.unit)\n              : '';\n            const className =\n              'wx-cell ' + (cell.css || '') + ' ' + (extraClass || '');\n            // Support HTML in scale cell values (for multi-line templates)\n            const isHtml = typeof cell.value === 'string' && cell.value.includes('<');\n            return (\n              <div\n                className={'wx-ZkvhDKir ' + className}\n                style={{ width: `${cell.width}px`, cursor: onScaleClick ? 'pointer' : undefined }}\n                key={cellIdx}\n                onClick={onScaleClick ? (e) => onScaleClick(cell.date, cell.unit, e.nativeEvent) : undefined}\n                {...(isHtml ? { dangerouslySetInnerHTML: { __html: cell.value } } : { children: cell.value })}\n              />\n            );\n          })}\n        </div>\n      ))}\n    </div>\n  );\n}\n\nexport default TimeScale;\n","import { useRef, useEffect } from 'react';\n\nconst renderMetrics = new Map();\n\nexport function useRenderTime(label) {\n  const startTime = useRef(null);\n  const renderCount = useRef(0);\n  const rafRef = useRef(null);\n\n  const enabled =\n    typeof window !== 'undefined' && window.__RENDER_METRICS_ENABLED__;\n\n  if (startTime.current === null) {\n    startTime.current = performance.now();\n  }\n  renderCount.current++;\n\n  useEffect(() => {\n    if (!enabled) return;\n\n    cancelAnimationFrame(rafRef.current);\n\n    rafRef.current = requestAnimationFrame(() => {\n      const metric = {\n        label,\n        time: performance.now() - startTime.current,\n        renders: renderCount.current,\n        timestamp: Date.now(),\n      };\n\n      renderMetrics.set(label, metric);\n\n      window.dispatchEvent(\n        new CustomEvent('render-metric', { detail: metric }),\n      );\n    });\n\n    return () => cancelAnimationFrame(rafRef.current);\n  });\n}\n","import {\n  useState,\n  useEffect,\n  useMemo,\n  useRef,\n  useContext,\n  useCallback,\n} from 'react';\nimport CellGrid from './CellGrid.jsx';\nimport Bars from './Bars.jsx';\nimport { hotkeys } from '@svar-ui/grid-store';\nimport storeContext from '../../context';\nimport { useStore, useStoreWithCounter } from '@svar-ui/lib-react';\nimport './Chart.css';\nimport TimeScales from './TimeScale.jsx';\nimport { useRenderTime } from '../../helpers/debug.js';\n\nfunction Chart(props) {\n  const {\n    readonly,\n    fullWidth,\n    fullHeight,\n    taskTemplate,\n    cellBorders,\n    highlightTime,\n    onScaleClick,\n    multiTaskRows = false,\n    rowMapping = null,\n    marqueeSelect = false,\n    copyPaste = false,\n    scrollToCurrentWeek = false,\n    currentWeekColor = null,\n    allowTaskIntersection = true,\n    summaryBarCounts = false,\n  } = props;\n\n  const api = useContext(storeContext);\n\n  const [selected, selectedCounter] = useStoreWithCounter(api, '_selected');\n  const rScrollTop = useStore(api, 'scrollTop');\n  const cellHeight = useStore(api, 'cellHeight');\n  const cellWidth = useStore(api, 'cellWidth');\n  const scales = useStore(api, '_scales');\n  const markers = useStore(api, '_markers');\n  const rScrollTask = useStore(api, '_scrollTask');\n  const zoom = useStore(api, 'zoom');\n  const rTasks = useStore(api, '_tasks');\n\n  const [chartHeight, setChartHeight] = useState();\n  const chartRef = useRef(null);\n  const zoomAccumulatorRef = useRef(0);\n  const hasScrolledToCurrentWeekRef = useRef(false);\n\n  const extraRows = 1 + (scales?.rows?.length || 0);\n\n  // Compute adjusted Y positions for multiTaskRows\n  const taskYPositions = useMemo(() => {\n    if (!multiTaskRows || !rowMapping || !rTasks?.length) return null;\n\n    const yMap = new Map();\n    const rowIndexMap = new Map();\n    const seenRows = [];\n\n    rTasks.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      if (!rowIndexMap.has(rowId)) {\n        rowIndexMap.set(rowId, seenRows.length);\n        seenRows.push(rowId);\n      }\n    });\n\n    rTasks.forEach((task) => {\n      const rowId = rowMapping.taskRows.get(task.id) ?? task.id;\n      const rowIndex = rowIndexMap.get(rowId) ?? 0;\n      yMap.set(task.id, rowIndex * cellHeight);\n    });\n\n    return yMap;\n  }, [rTasks, multiTaskRows, rowMapping, cellHeight]);\n\n  const selectStyle = useMemo(() => {\n    const t = [];\n    if (selected && selected.length && cellHeight) {\n      selected.forEach((obj) => {\n        // Use adjusted Y if multiTaskRows is enabled\n        const adjustedY = taskYPositions?.get(obj.id) ?? obj.$y;\n        t.push({ height: `${cellHeight}px`, top: `${adjustedY - 3}px` });\n      });\n    }\n    return t;\n  }, [selectedCounter, cellHeight, taskYPositions]);\n\n  const chartGridHeight = useMemo(\n    () => Math.max(chartHeight || 0, fullHeight),\n    [chartHeight, fullHeight],\n  );\n\n  useEffect(() => {\n    const el = chartRef.current;\n    if (!el) return;\n\n    if (typeof rScrollTop === 'number') {\n      el.scrollTop = rScrollTop;\n    }\n  }, [rScrollTop]);\n\n  const onScroll = () => {\n    const scroll = { left: true };\n    setScroll(scroll);\n  };\n\n  function setScroll(scroll) {\n    const el = chartRef.current;\n    if (!el) return;\n    const pos = {};\n    if (scroll.left) pos.left = el.scrollLeft;\n    api.exec('scroll-chart', pos);\n  }\n\n  function dataRequest() {\n    const el = chartRef.current;\n    const clientHeightLocal = chartHeight || 0;\n    const num = Math.ceil(clientHeightLocal / (cellHeight || 1)) + 1;\n    const pos = Math.floor(((el && el.scrollTop) || 0) / (cellHeight || 1));\n    const start = Math.max(0, pos - extraRows);\n    const end = pos + num + extraRows;\n    const from = start * (cellHeight || 0);\n    api.exec('render-data', {\n      start,\n      end,\n      from,\n    });\n  }\n\n  useEffect(() => {\n    dataRequest();\n  }, [chartHeight, rScrollTop]);\n\n  const showTask = useCallback(\n    (value) => {\n      if (!value) return;\n\n      const { id, mode } = value;\n\n      if (mode.toString().indexOf('x') < 0) return;\n      const el = chartRef.current;\n      if (!el) return;\n      const { clientWidth } = el;\n      const task = api.getTask(id);\n      if (task.$x + task.$w < el.scrollLeft) {\n        api.exec('scroll-chart', { left: task.$x - (cellWidth || 0) });\n        el.scrollLeft = task.$x - (cellWidth || 0);\n      } else if (task.$x >= clientWidth + el.scrollLeft) {\n        const width = clientWidth < task.$w ? cellWidth || 0 : task.$w;\n        api.exec('scroll-chart', { left: task.$x - clientWidth + width });\n        el.scrollLeft = task.$x - clientWidth + width;\n      }\n    },\n    [api, cellWidth],\n  );\n\n  useEffect(() => {\n    showTask(rScrollTask);\n  }, [rScrollTask]);\n\n  function onWheel(e) {\n    if (zoom && (e.ctrlKey || e.metaKey)) {\n      e.preventDefault();\n      const el = chartRef.current;\n      const offset = e.clientX - (el ? el.getBoundingClientRect().left : 0);\n\n      // Accumulate delta for smoother zoom (threshold ~3 wheel ticks)\n      zoomAccumulatorRef.current += e.deltaY;\n      const threshold = 150;\n\n      if (Math.abs(zoomAccumulatorRef.current) >= threshold) {\n        const dir = -Math.sign(zoomAccumulatorRef.current);\n        zoomAccumulatorRef.current = 0;\n        api.exec('zoom-scale', {\n          dir,\n          offset,\n        });\n      }\n    }\n  }\n\n  const getHoliday = useCallback((cell) => {\n    const style = highlightTime(cell.date, cell.unit);\n    if (style)\n      return {\n        css: style,\n        width: cell.width,\n      };\n    return null;\n  }, [highlightTime]);\n\n  const holidays = useMemo(() => {\n    if (!scales || !highlightTime) return null;\n    // Support day, hour, and week units for highlighting\n    const supportedUnits = ['hour', 'day', 'week'];\n    if (!supportedUnits.includes(scales.minUnit)) return null;\n\n    // Calculate left positions for each cell\n    let accumulatedLeft = 0;\n    return scales.rows[scales.rows.length - 1].cells.map((cell) => {\n      const holiday = getHoliday(cell);\n      const left = accumulatedLeft;\n      accumulatedLeft += cell.width;\n      if (holiday) {\n        return { ...holiday, left };\n      }\n      return null;\n    });\n  }, [scales, highlightTime, getHoliday]);\n\n  const handleHotkey = useCallback(\n    (ev) => {\n      ev.eventSource = 'chart';\n      api.exec('hotkey', ev);\n    },\n    [api],\n  );\n\n  useEffect(() => {\n    const el = chartRef.current;\n    if (!el) return;\n    const update = () => setChartHeight(el.clientHeight);\n    update();\n    const ro = new ResizeObserver(() => update());\n    ro.observe(el);\n    return () => {\n      ro.disconnect();\n    };\n  }, [chartRef.current]);\n\n  const cleanupRef = useRef(null);\n\n  useEffect(() => {\n    const el = chartRef.current;\n    if (!el) return;\n    if (cleanupRef.current) return;\n    cleanupRef.current = hotkeys(el, {\n      keys: {\n        arrowup: true,\n        arrowdown: true,\n      },\n      exec: (v) => handleHotkey(v),\n    });\n    return () => {\n      cleanupRef.current?.destroy();\n      cleanupRef.current = null;\n    };\n  }, []);\n\n  useEffect(() => {\n    const node = chartRef.current;\n    if (!node) return;\n\n    const handler = onWheel;\n    node.addEventListener('wheel', handler);\n    return () => {\n      node.removeEventListener('wheel', handler);\n    };\n  }, [onWheel]);\n\n  // Scroll to center current week on mount\n  useEffect(() => {\n    if (!scrollToCurrentWeek || hasScrolledToCurrentWeekRef.current) return;\n    if (!scales || !chartRef.current || !chartHeight) return;\n\n    const el = chartRef.current;\n    const { clientWidth } = el;\n\n    // Find current week cell in the bottom scale row\n    const now = new Date();\n    const cells = scales.rows[scales.rows.length - 1]?.cells;\n    if (!cells) return;\n\n    let currentWeekIndex = -1;\n    let accumulatedWidth = 0;\n    const cellPositions = []; // Store {left, width} for each cell\n\n    for (let i = 0; i < cells.length; i++) {\n      const cell = cells[i];\n      cellPositions.push({ left: accumulatedWidth, width: cell.width });\n\n      const cellStart = cell.date;\n      // Week cell: check if now is within 7 days of the cell start (UTC)\n      if (cell.unit === 'week') {\n        const cellEnd = new Date(cellStart);\n        cellEnd.setUTCDate(cellEnd.getUTCDate() + 7);\n        if (now >= cellStart && now < cellEnd) {\n          currentWeekIndex = i;\n        }\n      } else if (cell.unit === 'day') {\n        // Day cell: check if same date (UTC)\n        if (\n          now.getUTCFullYear() === cellStart.getUTCFullYear() &&\n          now.getUTCMonth() === cellStart.getUTCMonth() &&\n          now.getUTCDate() === cellStart.getUTCDate()\n        ) {\n          currentWeekIndex = i;\n        }\n      }\n      accumulatedWidth += cell.width;\n    }\n\n    // Use previous week if current week found\n    let targetIndex = currentWeekIndex;\n    if (currentWeekIndex > 0) {\n      targetIndex = currentWeekIndex - 1; // Previous week\n    }\n\n    if (targetIndex >= 0 && cellPositions[targetIndex]) {\n      const target = cellPositions[targetIndex];\n      // Scroll so previous week is at the left edge of viewport\n      const scrollLeft = Math.max(0, target.left);\n      el.scrollLeft = scrollLeft;\n      api.exec('scroll-chart', { left: scrollLeft });\n      hasScrolledToCurrentWeekRef.current = true;\n    }\n  }, [scrollToCurrentWeek, scales, chartHeight, api]);\n\n  useRenderTime(\"chart\");\n  \n  return (\n    <div\n      className=\"wx-mR7v2Xag wx-chart\"\n      tabIndex={-1}\n      ref={chartRef}\n      onScroll={onScroll}\n    >\n      <TimeScales highlightTime={highlightTime} onScaleClick={onScaleClick} scales={scales} />\n      {markers && markers.length ? (\n        <div\n          className=\"wx-mR7v2Xag wx-markers\"\n          style={{ height: `${chartGridHeight}px` }}\n        >\n          {markers.map((marker, i) => (\n            <div\n              key={i}\n              className={`wx-mR7v2Xag wx-marker ${marker.css || ''}`}\n              style={{ left: `${marker.left}px` }}\n            >\n              <div className=\"wx-mR7v2Xag wx-content\">{marker.text}</div>\n            </div>\n          ))}\n        </div>\n      ) : null}\n\n      <div\n        className=\"wx-mR7v2Xag wx-area\"\n        style={{ width: `${fullWidth}px`, height: `${chartGridHeight}px` }}\n      >\n        {holidays ? (\n          <div\n            className=\"wx-mR7v2Xag wx-gantt-holidays\"\n            style={{ height: '100%' }}\n          >\n            {holidays.map((holiday, i) =>\n              holiday ? (\n                <div\n                  key={i}\n                  className={'wx-mR7v2Xag ' + holiday.css}\n                  style={{\n                    width: `${holiday.width}px`,\n                    left: `${holiday.left}px`,\n                  }}\n                />\n              ) : null,\n            )}\n          </div>\n        ) : null}\n\n        <CellGrid borders={cellBorders} />\n\n        {selected && selected.length\n          ? selected.map((obj, index) =>\n              obj.$y ? (\n                <div\n                  key={obj.id}\n                  className=\"wx-mR7v2Xag wx-selected\"\n                  data-id={obj.id}\n                  style={selectStyle[index]}\n                ></div>\n              ) : null,\n            )\n          : null}\n\n        <Bars\n          readonly={readonly}\n          taskTemplate={taskTemplate}\n          multiTaskRows={multiTaskRows}\n          rowMapping={rowMapping}\n          marqueeSelect={marqueeSelect}\n          copyPaste={copyPaste}\n          allowTaskIntersection={allowTaskIntersection}\n          summaryBarCounts={summaryBarCounts}\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default Chart;\n","import { useState, useMemo, useRef, useCallback, useEffect } from 'react';\nimport { useWritableProp } from '@svar-ui/lib-react';\nimport './Resizer.css';\n\nfunction Resizer(props) {\n  const {\n    position = 'after',\n    size = 4,\n    dir = 'x',\n    onMove,\n    onDisplayChange,\n    compactMode,\n    containerWidth = 0,\n    leftThreshold = 50,\n    rightThreshold = 50,\n  } = props;\n\n  const [value, setValue] = useWritableProp(props.value ?? 0);\n  const [display, setDisplay] = useWritableProp(props.display ?? 'all');\n\n  function getBox(val) {\n    let offset = 0;\n    if (position == 'center') offset = size / 2;\n    else if (position == 'before') offset = size;\n\n    const box = {\n      size: [size + 'px', 'auto'],\n      p: [val - offset + 'px', '0px'],\n      p2: ['auto', '0px'],\n    };\n\n    if (dir != 'x') {\n      for (let name in box) box[name] = box[name].reverse();\n    }\n    return box;\n  }\n\n  const [active, setActive] = useState(false);\n  const [initialPosition, setInitialPosition] = useState(null);\n\n  const startRef = useRef(0);\n  const posRef = useRef();\n  const timeoutRef = useRef();\n  const displayRef = useRef(display);\n\n  useEffect(() => {\n    displayRef.current = display;\n  }, [display]);\n\n  useEffect(() => {\n    if (initialPosition === null && value > 0) {\n      setInitialPosition(value);\n    }\n  }, [initialPosition, value]);\n\n  function getEventPos(ev) {\n    return dir == 'x' ? ev.clientX : ev.clientY;\n  }\n\n  const move = useCallback(\n    (ev) => {\n      const newPos = posRef.current + getEventPos(ev) - startRef.current;\n\n      setValue(newPos);\n      let nextDisplay;\n\n      if (newPos <= leftThreshold) {\n        nextDisplay = 'chart';\n      } else if (containerWidth - newPos <= rightThreshold) {\n        nextDisplay = 'grid';\n      } else {\n        nextDisplay = 'all';\n      }\n\n      if (displayRef.current !== nextDisplay) {\n        setDisplay(nextDisplay);\n        displayRef.current = nextDisplay;\n      }\n\n      if (timeoutRef.current) clearTimeout(timeoutRef.current);\n      timeoutRef.current = setTimeout(() => onMove && onMove(newPos), 100);\n    },\n    [containerWidth, leftThreshold, rightThreshold, onMove],\n  );\n\n  const up = useCallback(() => {\n    document.body.style.cursor = '';\n    document.body.style.userSelect = '';\n    setActive(false);\n    window.removeEventListener('mousemove', move);\n    window.removeEventListener('mouseup', up);\n  }, [move]);\n\n  const cursor = useMemo(\n    () => (display !== 'all' ? 'auto' : dir == 'x' ? 'ew-resize' : 'ns-resize'),\n    [display, dir],\n  );\n\n  const down = useCallback(\n    (ev) => {\n      // Prevent dragging when in normal mode and only one view is visible\n      if (!compactMode && (display === 'grid' || display === 'chart')) {\n        return;\n      }\n\n      startRef.current = getEventPos(ev);\n\n      posRef.current = value;\n      setActive(true);\n\n      document.body.style.cursor = cursor;\n      document.body.style.userSelect = 'none';\n\n      window.addEventListener('mousemove', move);\n      window.addEventListener('mouseup', up);\n    },\n    [cursor, move, up, value, compactMode, display],\n  );\n\n  function resetToInitial() {\n    setDisplay('all');\n    if (initialPosition !== null) {\n      setValue(initialPosition);\n      if (onMove) onMove(initialPosition);\n    }\n  }\n\n  function handleExpand(direction) {\n    if (compactMode) {\n      const newDisplay = display === 'chart' ? 'grid' : 'chart';\n      setDisplay(newDisplay);\n      onDisplayChange(newDisplay);\n    } else {\n      if (display === 'grid' || display === 'chart') {\n        resetToInitial();\n        onDisplayChange('all');\n      } else {\n        const newDisplay = direction === 'left' ? 'chart' : 'grid';\n        setDisplay(newDisplay);\n        onDisplayChange(newDisplay);\n      }\n    }\n  }\n\n  function handleExpandLeft() {\n    handleExpand('left');\n  }\n\n  function handleExpandRight() {\n    handleExpand('right');\n  }\n\n  const b = useMemo(() => getBox(value), [value, position, size, dir]);\n\n  const rootClassName = [\n    'wx-resizer',\n    `wx-resizer-${dir}`,\n    `wx-resizer-display-${display}`,\n    active ? 'wx-resizer-active' : '',\n  ]\n    .filter(Boolean)\n    .join(' ');\n\n  return (\n    <div\n      className={'wx-pFykzMlT ' + rootClassName}\n      onMouseDown={down}\n      style={{ width: b.size[0], height: b.size[1], cursor }}\n    >\n      <div className=\"wx-pFykzMlT wx-button-expand-box\">\n        <div className=\"wx-pFykzMlT wx-button-expand-content wx-button-expand-left\">\n          <i\n            className=\"wx-pFykzMlT wxi-menu-left\"\n            onClick={handleExpandLeft}\n          ></i>\n        </div>\n        <div className=\"wx-pFykzMlT wx-button-expand-content wx-button-expand-right\">\n          <i\n            className=\"wx-pFykzMlT wxi-menu-right\"\n            onClick={handleExpandRight}\n          ></i>\n        </div>\n      </div>\n      <div className=\"wx-pFykzMlT wx-resizer-line\"></div>\n    </div>\n  );\n}\n\nexport default Resizer;\n","const COMPACT_WIDTH = 650;\n\nexport function modeObserver(callback) {\n  let observer;\n\n  function observe() {\n    observer = new ResizeObserver((entries) => {\n      for (let obj of entries) {\n        if (obj.target === document.body) {\n          let mode = obj.contentRect.width <= COMPACT_WIDTH;\n          callback(mode);\n        }\n      }\n    });\n\n    observer.observe(document.body);\n  }\n\n  function disconnect() {\n    if (observer) {\n      observer.disconnect();\n      observer = null;\n    }\n  }\n\n  return {\n    observe,\n    disconnect,\n  };\n}\n","import {\n  useState,\n  useEffect,\n  useMemo,\n  useRef,\n  useCallback,\n  useContext,\n} from 'react';\nimport { hotkeys } from '@svar-ui/grid-store';\nimport Grid from './grid/Grid.jsx';\nimport Chart from './chart/Chart.jsx';\nimport Resizer from './Resizer.jsx';\nimport { modeObserver } from '../helpers/modeResizeObserver';\nimport storeContext from '../context';\nimport { useStore } from '@svar-ui/lib-react';\nimport './Layout.css';\nimport { flushSync } from 'react-dom'\n\nfunction Layout(props) {\n  const {\n    taskTemplate,\n    readonly,\n    cellBorders,\n    highlightTime,\n    onScaleClick,\n    onTableAPIChange,\n    multiTaskRows = false,\n    rowMapping = null,\n    marqueeSelect = false,\n    copyPaste = false,\n    scrollToCurrentWeek = false,\n    currentWeekColor = null,\n    allowTaskIntersection = true,\n    summaryBarCounts = false,\n  } = props;\n\n  const api = useContext(storeContext);\n\n  const rTasks = useStore(api, '_tasks');\n  const rScales = useStore(api, '_scales');\n  const rCellHeight = useStore(api, 'cellHeight');\n  const rColumns = useStore(api, 'columns');\n  const rScrollTask = useStore(api, '_scrollTask');\n  const undo = useStore(api, 'undo');\n\n  // Compute rowMapping using reactive store tasks (updates when tasks are added/removed)\n  const computedRowMapping = useMemo(() => {\n    if (!multiTaskRows) return rowMapping;\n\n    // Build rowMapping from current store tasks\n    const rowMap = new Map(); // rowId -> taskIds[]\n    const taskRows = new Map(); // taskId -> rowId\n\n    rTasks.forEach((task) => {\n      const rowId = task.row ?? task.id;\n      taskRows.set(task.id, rowId);\n\n      if (!rowMap.has(rowId)) {\n        rowMap.set(rowId, []);\n      }\n      rowMap.get(rowId).push(task.id);\n    });\n\n    return { rowMap, taskRows };\n  }, [rTasks, multiTaskRows, rowMapping]);\n  const [compactMode, setCompactMode] = useState(false);\n  let [gridWidth, setGridWidth] = useState(0);\n  const [ganttWidth, setGanttWidth] = useState(0);\n  const [ganttHeight, setGanttHeight] = useState(0);\n  const [innerWidth, setInnerWidth] = useState(undefined);\n  const [display, setDisplay] = useState('all');\n\n  const lastDisplay = useRef(null);\n\n  const handleResize = useCallback(\n    (mode) => {\n      setCompactMode((prev) => {\n        if (mode !== prev) {\n          if (mode) {\n            lastDisplay.current = display;\n            if (display === 'all') setDisplay('grid');\n          } else if (!lastDisplay.current || lastDisplay.current === 'all') {\n            setDisplay('all');\n          }\n        }\n        return mode;\n      });\n    },\n    [display],\n  );\n\n  useEffect(() => {\n    const ro = modeObserver(handleResize);\n    ro.observe();\n    return () => {\n      ro.disconnect();\n    };\n  }, [handleResize]);\n\n  const gridColumnWidth = useMemo(() => {\n    let w;\n    if (rColumns.every((c) => c.width && !c.flexgrow)) {\n      w = rColumns.reduce((acc, c) => acc + parseInt(c.width), 0);\n    } else {\n      if (compactMode && display === 'chart') {\n        w = parseInt(rColumns.find((c) => c.id === 'action')?.width) || 50;\n      } else {\n        w = 440;\n      }\n    }\n    gridWidth = w;\n    return w;\n  }, [rColumns, compactMode, display]);\n\n  useEffect(() => {\n    setGridWidth(gridColumnWidth);\n  }, [gridColumnWidth]);\n\n  const scrollSize = useMemo(\n    () => (ganttWidth ?? 0) - (innerWidth ?? 0),\n    [ganttWidth, innerWidth],\n  );\n  const fullWidth = useMemo(() => rScales.width, [rScales]);\n  const fullHeight = useMemo(() => {\n    if (!multiTaskRows || !computedRowMapping) {\n      return rTasks.length * rCellHeight;\n    }\n    // Count unique rows\n    const uniqueRows = new Set();\n    rTasks.forEach((task) => {\n      const rowId = computedRowMapping.taskRows.get(task.id) ?? task.id;\n      uniqueRows.add(rowId);\n    });\n    return uniqueRows.size * rCellHeight;\n  }, [rTasks, rCellHeight, multiTaskRows, computedRowMapping]);\n  const scrollHeight = useMemo(\n    () => rScales.height + fullHeight + scrollSize,\n    [rScales, fullHeight, scrollSize],\n  );\n  const totalWidth = useMemo(\n    () => gridWidth + fullWidth,\n    [gridWidth, fullWidth],\n  );\n\n  const chartRef = useRef(null);\n  const expandScale = useCallback(() => {\n    Promise.resolve().then(() => {\n      if ((ganttWidth ?? 0) > (totalWidth ?? 0)) {\n        const minWidth = (ganttWidth ?? 0) - gridWidth;\n        api.exec('expand-scale', { minWidth });\n      }\n    });\n  }, [ganttWidth, totalWidth, gridWidth, api]);\n\n  useEffect(() => {\n    let ro;\n    if (chartRef.current) {\n      ro = new ResizeObserver(expandScale);\n      ro.observe(chartRef.current);\n    }\n    return () => {\n      if (ro) ro.disconnect();\n    };\n  }, [chartRef.current, expandScale]);\n\n  useEffect(() => {\n    expandScale();\n  }, [fullWidth]);\n\n  const ganttDivRef = useRef(null);\n  const pseudoRowsRef = useRef(null);\n\n  const onScroll = useCallback(() => {\n    const el = ganttDivRef.current;\n    if (el) {\n      api.exec('scroll-chart', {\n        top: el.scrollTop,\n      });\n    }\n  }, [api]);\n\n  const latest = useRef({\n    rTasks: [],\n    rScales: { height: 0 },\n    rCellHeight: 0,\n    scrollSize: 0,\n    ganttDiv: null,\n    ganttHeight: 0,\n  });\n\n  useEffect(() => {\n    latest.current = {\n      rTasks,\n      rScales,\n      rCellHeight,\n      scrollSize,\n      ganttDiv: ganttDivRef.current,\n      ganttHeight: ganttHeight ?? 0,\n    };\n  }, [rTasks, rScales, rCellHeight, scrollSize, ganttHeight]);\n\n  const scrollToTask = useCallback(\n    (value) => {\n      if (!value) return;\n      const {\n        rTasks: t,\n        rScales: sc,\n        rCellHeight: ch,\n        scrollSize: ss,\n        ganttDiv: el,\n        ganttHeight: gh,\n      } = latest.current;\n      if (!el) return;\n      const { id } = value;\n      const index = t.findIndex((tt) => tt.id === id);\n      if (index > -1) {\n        const height = gh - sc.height;\n        const scrollY = index * ch;\n        const now = el.scrollTop;\n        let top = null;\n        if (scrollY < now) {\n          top = scrollY;\n        } else if (scrollY + ch > now + height) {\n          top = scrollY - height + ch + ss;\n        }\n        if (top !== null) {\n          api.exec('scroll-chart', { top: Math.max(top, 0) });\n          ganttDivRef.current.scrollTop = Math.max(top, 0);\n        }\n      }\n    },\n    [api],\n  );\n\n  useEffect(() => {\n    scrollToTask(rScrollTask);\n  }, [rScrollTask]);\n\n  useEffect(() => {\n    const ganttDiv = ganttDivRef.current;\n    const pseudoRows = pseudoRowsRef.current;\n    if (!ganttDiv || !pseudoRows) return;\n    const update = () => {\n      flushSync(() => {\n        setGanttHeight(ganttDiv.offsetHeight);\n        setGanttWidth(ganttDiv.offsetWidth);\n        setInnerWidth(pseudoRows.offsetWidth);\n      });\n    };\n    const ro = new ResizeObserver(update);\n    ro.observe(ganttDiv);\n    return () => ro.disconnect();\n  }, [ganttDivRef.current]);\n\n  const layoutRef = useRef(null);\n  const cleanupRef = useRef(null);\n\n  useEffect(() => {\n    if (cleanupRef.current) {\n      cleanupRef.current.destroy();\n      cleanupRef.current = null;\n    }\n    const node = layoutRef.current;\n    if (!node) return;\n\n    cleanupRef.current = hotkeys(node, {\n      keys: {\n        'ctrl+c': true,\n        'ctrl+v': true,\n        'ctrl+x': true,\n        'ctrl+d': true,\n        'meta+c': true,\n        'meta+v': true,\n        'meta+x': true,\n        'meta+d': true,\n        backspace: true,\n        'ctrl+z': undo,\n        'ctrl+y': undo,\n        'meta+z': undo,\n        'meta+shift+z': undo,\n      },\n      exec: (ev) => {\n        if (ev.isInput) return;\n\n        // Handle undo/redo keys directly via api.exec\n        // The gantt-store uses exec('undo', {}) for undo\n        const key = ev.key;\n        if (key === 'ctrl+z' || key === 'meta+z') {\n          api.exec('undo', {});\n          return;\n        }\n        if (key === 'ctrl+y' || key === 'meta+shift+z') {\n          api.exec('redo', {});\n          return;\n        }\n\n        api.exec('hotkey', ev);\n      },\n    });\n\n    return () => {\n      cleanupRef.current?.destroy();\n      cleanupRef.current = null;\n    };\n  }, [undo]);\n\n  return (\n    <div className=\"wx-jlbQoHOz wx-gantt\" ref={ganttDivRef} onScroll={onScroll}>\n      <div\n        className=\"wx-jlbQoHOz wx-pseudo-rows\"\n        style={{ height: scrollHeight, width: '100%' }}\n        ref={pseudoRowsRef}\n      >\n        <div\n          className=\"wx-jlbQoHOz wx-stuck\"\n          style={{\n            height: ganttHeight,\n            width: innerWidth,\n          }}\n        >\n          <div tabIndex={0} className=\"wx-jlbQoHOz wx-layout\" ref={layoutRef}>\n            {rColumns.length ? (\n              <>\n                <Grid\n                  display={display}\n                  compactMode={compactMode}\n                  columnWidth={gridColumnWidth}\n                  width={gridWidth}\n                  readonly={readonly}\n                  fullHeight={fullHeight}\n                  onTableAPIChange={onTableAPIChange}\n                  multiTaskRows={multiTaskRows}\n                  rowMapping={computedRowMapping}\n                />\n                <Resizer\n                  value={gridWidth}\n                  display={display}\n                  compactMode={compactMode}\n                  containerWidth={ganttWidth}\n                  onMove={(value) => setGridWidth(value)}\n                  onDisplayChange={(display) => setDisplay(display)}\n                />\n              </>\n            ) : null}\n\n            <div className=\"wx-jlbQoHOz wx-content\" ref={chartRef}>\n              <Chart\n                readonly={readonly}\n                fullWidth={fullWidth}\n                fullHeight={fullHeight}\n                taskTemplate={taskTemplate}\n                cellBorders={cellBorders}\n                highlightTime={highlightTime}\n                onScaleClick={onScaleClick}\n                multiTaskRows={multiTaskRows}\n                rowMapping={computedRowMapping}\n                marqueeSelect={marqueeSelect}\n                copyPaste={copyPaste}\n                scrollToCurrentWeek={scrollToCurrentWeek}\n                currentWeekColor={currentWeekColor}\n                allowTaskIntersection={allowTaskIntersection}\n                summaryBarCounts={summaryBarCounts}\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Layout;\n","import { dateToString } from '@svar-ui/lib-dom';\n\nexport function getUnitFormats(_) {\n  return {\n    year: '%Y',\n    quarter: `${_('Q')} %Q`,\n    month: '%M',\n    week: `${_('Week')} %w`,\n    day: '%M %j',\n    hour: '%H:%i',\n  };\n}\n\nfunction normalizeFormatter(value, calendarLocale) {\n  return typeof value === 'function'\n    ? value\n    : dateToString(value, calendarLocale);\n}\n\nexport function prepareScales(scales, calendarLocale) {\n  return scales.map(({ format, ...scale }) => ({\n    ...scale,\n    format: normalizeFormatter(format, calendarLocale),\n  }));\n}\n\nexport function prepareFormats(calendarLocale, _) {\n  const formats = getUnitFormats(_);\n  for (let unit in formats) {\n    formats[unit] = dateToString(formats[unit], calendarLocale);\n  }\n  return formats;\n}\n\nexport function prepareColumns(columns, calendarLocale) {\n  if (!columns || !columns.length) return columns;\n  const format = dateToString('%d-%m-%Y', calendarLocale);\n\n  return columns.map((col) => {\n    if (col.template) return col;\n\n    if (col.id === 'start' || col.id == 'end') {\n      return {\n        ...col,\n        //store locale template for unscheduled tasks\n        _template: (b) => format(b),\n        template: (b) => format(b),\n      };\n    }\n    if (col.id === 'duration') {\n      return {\n        ...col,\n        _template: (b) => b,\n        template: (b) => b,\n      };\n    }\n    return col;\n  });\n}\n\nexport function prepareZoom(zoom, calendarLocale) {\n  if (!zoom.levels) {\n    return zoom;\n  }\n\n  return {\n    ...zoom,\n    levels: zoom.levels.map((level) => ({\n      ...level,\n      scales: prepareScales(level.scales, calendarLocale),\n    })),\n  };\n}\n","import {\n  forwardRef,\n  useEffect,\n  useMemo,\n  useRef,\n  useImperativeHandle,\n  useState,\n  useContext,\n} from 'react';\n\n// core widgets lib\nimport { context } from '@svar-ui/react-core';\n\n// locales\nimport { locale as l } from '@svar-ui/lib-dom';\nimport { en } from '@svar-ui/gantt-locales';\nimport { en as coreEn } from '@svar-ui/core-locales';\n\n// stores\nimport { EventBusRouter } from '@svar-ui/lib-state';\nimport {\n  DataStore,\n  defaultColumns,\n  defaultTaskTypes,\n  parseTaskDates,\n  normalizeZoom,\n  normalizeLinks,\n} from '@svar-ui/gantt-store';\n\n// context\nimport StoreContext from '../context';\n\n// store factory\nimport { writable } from '@svar-ui/lib-react';\n\n// ui\nimport Layout from './Layout.jsx';\n\n// helpers\nimport {\n  prepareScales,\n  prepareFormats,\n  prepareColumns,\n  prepareZoom,\n} from '../helpers/prepareConfig.js';\n\nconst camelize = (s) =>\n  s\n    .split('-')\n    .map((part) => (part ? part.charAt(0).toUpperCase() + part.slice(1) : ''))\n    .join('');\n\nconst defaultScales = [\n  { unit: 'month', step: 1, format: '%F %Y' },\n  { unit: 'day', step: 1, format: '%j' },\n];\n\nconst Gantt = forwardRef(function Gantt(\n  {\n    taskTemplate = null,\n    markers = [],\n    taskTypes = defaultTaskTypes,\n    tasks = [],\n    selected = [],\n    activeTask = null,\n    links = [],\n    scales = defaultScales,\n    columns = defaultColumns,\n    start = null,\n    end = null,\n    lengthUnit = 'day',\n    durationUnit = 'day',\n    cellWidth = 100,\n    cellHeight = 38,\n    scaleHeight = 36,\n    readonly = false,\n    cellBorders = 'full',\n    zoom = false,\n    baselines = false,\n    highlightTime: highlightTimeProp = null,\n    onScaleClick = null,\n    init = null,\n    autoScale = true,\n    unscheduledTasks = false,\n    criticalPath = null,\n    schedule = { type: 'forward' },\n    projectStart = null,\n    projectEnd = null,\n    calendar = null,\n    undo = false,\n    splitTasks = false,\n    multiTaskRows = false,\n    marqueeSelect = false,\n    copyPaste = false,\n    currentWeekHighlight = false,\n    currentWeekColor = null,\n    scrollToCurrentWeek = false,\n    allowTaskIntersection = true,\n    summaryBarCounts = false,\n    ...restProps\n  },\n  ref,\n) {\n  // keep latest rest props for event routing\n  const restPropsRef = useRef();\n  restPropsRef.current = restProps;\n\n  // init stores\n  const dataStore = useMemo(() => new DataStore(writable), []);\n\n  // locale and formats\n  // uses same logic as the Locale component\n  const words = useMemo(() => ({ ...coreEn, ...en }), []);\n  const i18nCtx = useContext(context.i18n);\n  const locale = useMemo(() => {\n    if (!i18nCtx) return l(words);\n    return i18nCtx.extend(words, true);\n  }, [i18nCtx, words]);\n\n  // prepare configuration objects\n  const lCalendar = useMemo(() => locale.getRaw().calendar, [locale]);\n\n  const normalizedConfig = useMemo(() => {\n    let config = {\n      zoom: prepareZoom(zoom, lCalendar),\n      scales: prepareScales(scales, lCalendar),\n      columns: prepareColumns(columns, lCalendar),\n      links: normalizeLinks(links),\n      cellWidth,\n    };\n    if (config.zoom) {\n      config = {\n        ...config,\n        ...normalizeZoom(\n          config.zoom,\n          prepareFormats(lCalendar, locale.getGroup('gantt')),\n          config.scales,\n          cellWidth,\n        ),\n      };\n    }\n    return config;\n  }, [zoom, scales, columns, links, cellWidth, lCalendar, locale]);\n\n  // parse task dates effect\n  const parsedTasksRef = useRef(null);\n  if (parsedTasksRef.current !== tasks) {\n    parseTaskDates(tasks, { durationUnit, splitTasks, calendar });\n    parsedTasksRef.current = tasks;\n  }\n  useEffect(() => {\n    parseTaskDates(tasks, { durationUnit, splitTasks, calendar });\n  }, [tasks, durationUnit, calendar, splitTasks]);\n\n  // row mapping for multiTaskRows feature\n  const rowMapping = useMemo(() => {\n    if (!multiTaskRows) return null;\n\n    const rowMap = new Map(); // rowId -> taskIds[]\n    const taskRows = new Map(); // taskId -> rowId\n\n    const buildRowMap = (taskList) => {\n      taskList.forEach((task) => {\n        const rowId = task.row ?? task.id;\n        taskRows.set(task.id, rowId);\n\n        if (!rowMap.has(rowId)) {\n          rowMap.set(rowId, []);\n        }\n        rowMap.get(rowId).push(task.id);\n\n        if (task.data && task.data.length > 0) {\n          buildRowMap(task.data);\n        }\n      });\n    };\n\n    buildRowMap(tasks);\n\n    return { rowMap, taskRows };\n  }, [tasks, multiTaskRows]);\n\n  const firstInRoute = useMemo(() => dataStore.in, [dataStore]);\n\n  const lastInRouteRef = useRef(null);\n  if (lastInRouteRef.current === null) {\n    lastInRouteRef.current = new EventBusRouter((a, b) => {\n      const name = 'on' + camelize(a);\n      if (restPropsRef.current && restPropsRef.current[name]) {\n        restPropsRef.current[name](b);\n      }\n    });\n    firstInRoute.setNext(lastInRouteRef.current);\n  }\n\n  // writable prop for two-way binding tableAPI\n  const [tableAPI, setTableAPI] = useState(null);\n  const tableAPIRef = useRef(null);\n  tableAPIRef.current = tableAPI;\n\n  // public API\n  const api = useMemo(\n    () => ({\n      getState: dataStore.getState.bind(dataStore),\n      getReactiveState: dataStore.getReactive.bind(dataStore),\n      getStores: () => ({ data: dataStore }),\n      exec: firstInRoute.exec,\n      setNext: (ev) => {\n        lastInRouteRef.current = lastInRouteRef.current.setNext(ev);\n        return lastInRouteRef.current;\n      },\n      intercept: firstInRoute.intercept.bind(firstInRoute),\n      on: firstInRoute.on.bind(firstInRoute),\n      detach: firstInRoute.detach.bind(firstInRoute),\n      getTask: dataStore.getTask.bind(dataStore),\n      serialize: dataStore.serialize.bind(dataStore),\n      getTable: (waitRender) =>\n        waitRender\n          ? new Promise((res) => setTimeout(() => res(tableAPIRef.current), 1))\n          : tableAPIRef.current,\n      getHistory: () => dataStore.getHistory(),\n    }),\n    [dataStore, firstInRoute],\n  );\n\n  // expose API via ref\n  useImperativeHandle(\n    ref,\n    () => ({\n      ...api,\n    }),\n    [api],\n  );\n\n  const initOnceRef = useRef(0);\n  useEffect(() => {\n    if (!initOnceRef.current) {\n      if (init) init(api);\n    } else {\n      // const prev = dataStore.getState();\n      dataStore.init({\n        tasks,\n        links: normalizedConfig.links,\n        start,\n        columns: normalizedConfig.columns,\n        end,\n        lengthUnit,\n        cellWidth: normalizedConfig.cellWidth,\n        cellHeight,\n        scaleHeight,\n        scales: normalizedConfig.scales,\n        taskTypes,\n        zoom: normalizedConfig.zoom,\n        selected,\n        activeTask,\n        baselines,\n        autoScale,\n        unscheduledTasks,\n        markers,\n        durationUnit,\n        criticalPath,\n        schedule,\n        projectStart,\n        projectEnd,\n        calendar,\n        undo,\n        _weekStart: lCalendar.weekStart,\n        splitTasks,\n      });\n    }\n    initOnceRef.current++;\n  }, [\n    api,\n    init,\n    tasks,\n    normalizedConfig,\n    start,\n    end,\n    lengthUnit,\n    cellHeight,\n    scaleHeight,\n    taskTypes,\n    selected,\n    activeTask,\n    baselines,\n    autoScale,\n    unscheduledTasks,\n    markers,\n    durationUnit,\n    criticalPath,\n    schedule,\n    projectStart,\n    projectEnd,\n    calendar,\n    undo,\n    lCalendar,\n    splitTasks,\n    dataStore,\n  ]);\n\n  if (initOnceRef.current === 0) {\n    dataStore.init({\n      tasks,\n      links: normalizedConfig.links,\n      start,\n      columns: normalizedConfig.columns,\n      end,\n      lengthUnit,\n      cellWidth: normalizedConfig.cellWidth,\n      cellHeight,\n      scaleHeight,\n      scales: normalizedConfig.scales,\n      taskTypes,\n      zoom: normalizedConfig.zoom,\n      selected,\n      activeTask,\n      baselines,\n      autoScale,\n      unscheduledTasks,\n      markers,\n      durationUnit,\n      criticalPath,\n      schedule,\n      projectStart,\n      projectEnd,\n      calendar,\n      undo,\n      _weekStart: lCalendar.weekStart,\n      splitTasks,\n    });\n  }\n\n  // Helper to check if a date is in the current week (UTC)\n  const isCurrentWeek = useMemo(() => {\n    const now = new Date();\n    const weekStart = lCalendar?.weekStart ?? 0; // 0 = Sunday, 1 = Monday\n\n    // Get start of current week (UTC)\n    const currentWeekStart = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate()));\n    const dayOfWeek = currentWeekStart.getUTCDay();\n    const diff = (dayOfWeek - weekStart + 7) % 7;\n    currentWeekStart.setUTCDate(currentWeekStart.getUTCDate() - diff);\n    currentWeekStart.setUTCHours(0, 0, 0, 0);\n\n    // Get end of current week (UTC)\n    const currentWeekEnd = new Date(currentWeekStart);\n    currentWeekEnd.setUTCDate(currentWeekEnd.getUTCDate() + 7);\n\n    return (date) => date >= currentWeekStart && date < currentWeekEnd;\n  }, [lCalendar]);\n\n  // highlightTime from calendar + current week\n  const highlightTime = useMemo(() => {\n    return (day, unit) => {\n      let classes = [];\n\n      // Calendar-based highlighting (weekends)\n      if (calendar) {\n        if (unit == 'day' && !calendar.getDayHours(day)) classes.push('wx-weekend');\n        if (unit == 'hour' && !calendar.getDayHours(day)) classes.push('wx-weekend');\n      } else if (highlightTimeProp) {\n        const result = highlightTimeProp(day, unit);\n        if (result) classes.push(result);\n      }\n\n      // Current week highlighting\n      if (currentWeekHighlight && (unit === 'week' || unit === 'day')) {\n        if (isCurrentWeek(day)) {\n          classes.push('wx-current-week');\n        }\n      }\n\n      return classes.join(' ');\n    };\n  }, [calendar, highlightTimeProp, currentWeekHighlight, isCurrentWeek]);\n\n  return (\n    <context.i18n.Provider value={locale}>\n      <StoreContext.Provider value={api}>\n        <Layout\n          taskTemplate={taskTemplate}\n          readonly={readonly}\n          cellBorders={cellBorders}\n          highlightTime={highlightTime}\n          onScaleClick={onScaleClick}\n          onTableAPIChange={setTableAPI}\n          multiTaskRows={multiTaskRows}\n          rowMapping={rowMapping}\n          marqueeSelect={marqueeSelect}\n          copyPaste={copyPaste}\n          scrollToCurrentWeek={scrollToCurrentWeek}\n          currentWeekColor={currentWeekColor}\n          allowTaskIntersection={allowTaskIntersection}\n          summaryBarCounts={summaryBarCounts}\n        />\n      </StoreContext.Provider>\n    </context.i18n.Provider>\n  );\n});\n\nexport default Gantt;\n","import { useContext, useMemo } from 'react';\nimport { Toolbar as WxToolbar } from '@svar-ui/react-toolbar';\nimport { useStoreLater } from '@svar-ui/lib-react';\nimport {\n  handleAction,\n  getToolbarButtons,\n  isHandledAction,\n} from '@svar-ui/gantt-store';\nimport { locale } from '@svar-ui/lib-dom';\nimport { en } from '@svar-ui/gantt-locales';\nimport { context } from '@svar-ui/react-core';\n\nexport default function Toolbar({ api = null, items = [] }) {\n  const i18nCtx = useContext(context.i18n);\n  const i18nLocal = useMemo(() => (i18nCtx ? i18nCtx : locale(en)), [i18nCtx]);\n  const _ = useMemo(() => i18nLocal.getGroup('gantt'), [i18nLocal]);\n\n  const _selected = useStoreLater(api, '_selected');\n  const undo = useStoreLater(api, 'undo');\n  const history = useStoreLater(api, 'history');\n  const splitTasks = useStoreLater(api, 'splitTasks');\n\n  const historyActions = ['undo', 'redo'];\n\n  const finalItems = useMemo(() => {\n    const fullButtons = getToolbarButtons({ undo: true, splitTasks: true });\n    const buttons = items.length\n      ? items\n      : getToolbarButtons({\n          undo,\n          splitTasks,\n        });\n    return buttons.map((b) => {\n      let item = { ...b, disabled: false };\n      item.handler = isHandledAction(fullButtons, item.id)\n        ? (it) => handleAction(api, it.id, null, _)\n        : item.handler;\n      if (item.text) item.text = _(item.text);\n      if (item.menuText) item.menuText = _(item.menuText);\n      return item;\n    });\n  }, [items, api, _, undo, splitTasks]);\n\n  const buttons = useMemo(() => {\n    const finalButtons = [];\n    finalItems.forEach((item) => {\n      const action = item.id;\n      if (action === 'add-task') {\n        finalButtons.push(item);\n      } else if (!historyActions.includes(action)) {\n        if (!_selected?.length || !api) return;\n        finalButtons.push({\n          ...item,\n          disabled:\n            item.isDisabled &&\n            _selected.some((task) => item.isDisabled(task, api.getState())),\n        });\n      } else if (historyActions.includes(action)) {\n        finalButtons.push({\n          ...item,\n          disabled: item.isDisabled(history),\n        });\n      }\n    });\n    // filter out consecutive separators\n    return finalButtons.filter((button, index) => {\n      if (api && button.isHidden)\n        return !_selected.some((task) => button.isHidden(task, api.getState()));\n      if (button.comp === 'separator') {\n        const nextButton = finalButtons[index + 1];\n        if (!nextButton || nextButton.comp === 'separator') return false;\n      }\n      return true;\n    });\n  }, [api, _selected, history, finalItems]);\n\n  if (!i18nCtx) {\n    return (\n      <context.i18n.Provider value={i18nLocal}>\n        <WxToolbar items={buttons} />\n      </context.i18n.Provider>\n    );\n  }\n\n  return <WxToolbar items={buttons} />;\n}\n","import {\n  useEffect,\n  useMemo,\n  useRef,\n  useCallback,\n  useContext,\n  forwardRef,\n  useImperativeHandle,\n} from 'react';\nimport { ContextMenu as WxContextMenu } from '@svar-ui/react-menu';\nimport { handleAction, getMenuOptions, isHandledAction } from '@svar-ui/gantt-store';\nimport { locale, locateID } from '@svar-ui/lib-dom';\nimport { en } from '@svar-ui/gantt-locales';\nimport { en as coreEn } from '@svar-ui/core-locales';\nimport { context } from '@svar-ui/react-core';\nimport { useStoreLater } from '@svar-ui/lib-react';\nimport './ContextMenu.css';\n\nconst ContextMenu = forwardRef(function ContextMenu(\n  {\n    options: optionsInit = [],\n    api = null,\n    resolver = null,\n    filter = null,\n    at = 'point',\n    children,\n    onClick,\n    css,\n  },\n  ref,\n) {\n  const menuRef = useRef(null);\n  const activeIdRef = useRef(null);\n\n  // i18n context\n  const i18nCtx = useContext(context.i18n);\n  const l = useMemo(() => i18nCtx || locale({ ...en, ...coreEn }), [i18nCtx]);\n  const _ = useMemo(() => l.getGroup('gantt'), [l]);\n\n  const taskTypesVal = useStoreLater(api, 'taskTypes');\n  const selectedVal = useStoreLater(api, 'selected');\n  const selectedTasksVal = useStoreLater(api, '_selected');\n  const splitTasksVal = useStoreLater(api, 'splitTasks');\n\n  const fullOptions = useMemo(() => getMenuOptions({ splitTasks: true }), []);\n\n  useEffect(() => {\n    if (!api) return;\n\n    api.on('scroll-chart', () => {\n      if (menuRef.current && menuRef.current.show) menuRef.current.show();\n    });\n    api.on('drag-task', () => {\n      if (menuRef.current && menuRef.current.show) menuRef.current.show();\n    });\n  }, [api]);\n\n  function applyLocaleFn(opts) {\n    return opts.map((op) => {\n      op = { ...op };\n      if (op.text) op.text = _(op.text);\n      if (op.subtext) op.subtext = _(op.subtext);\n      if (op.data) op.data = applyLocaleFn(op.data);\n      return op;\n    });\n  }\n\n  function getOptions() {\n    const finalOptions = optionsInit.length\n      ? optionsInit\n      : getMenuOptions({ splitTasks: splitTasksVal });\n    const convertOption = finalOptions.find((o) => o.id === 'convert-task');\n    if (convertOption) {\n      convertOption.data = [];\n      (taskTypesVal || []).forEach((t) => {\n        convertOption.data.push(convertOption.dataFactory(t));\n      });\n    }\n    return applyLocaleFn(finalOptions);\n  }\n\n  const cOptions = useMemo(() => {\n    return getOptions();\n  }, [api, optionsInit, taskTypesVal, splitTasksVal, _]);\n\n  const selectedTasks = useMemo(\n    () => (selectedTasksVal && selectedTasksVal.length ? selectedTasksVal : []),\n    [selectedTasksVal],\n  );\n\n  const itemResolver = useCallback(\n    (id, ev) => {\n      let task = id ? api?.getTask(id) : null;\n      if (resolver) {\n        const result = resolver(id, ev);\n        task = result === true ? task : result;\n      }\n      if (task) {\n        const segmentIndex = locateID(ev.target, 'data-segment');\n        if (segmentIndex !== null)\n          activeIdRef.current = { id: task.id, segmentIndex };\n        else activeIdRef.current = task.id;\n\n        if (!Array.isArray(selectedVal) || !selectedVal.includes(task.id)) {\n          api && api.exec && api.exec('select-task', { id: task.id });\n        }\n      }\n      return task;\n    },\n    [api, resolver, selectedVal],\n  );\n\n  const menuAction = useCallback(\n    (ev) => {\n      const action = ev.action;\n      if (action) {\n        const isAction = isHandledAction(fullOptions, action.id);\n        if (isAction) handleAction(api, action.id, activeIdRef.current, _);\n        onClick && onClick(ev);\n      }\n    },\n    [api, _, onClick, fullOptions],\n  );\n\n  const filterMenu = useCallback(\n    (item, task) => {\n      // for single selection from resolver _selected are empty\n      // due to setAsyncState causing _selected to lag\n      const tasks = selectedTasks.length ? selectedTasks : task ? [task] : [];\n\n      let result = filter ? tasks.every((t) => filter(item, t)) : true;\n\n      if (result) {\n        if (item.isHidden)\n          result = !tasks.some((t) =>\n            item.isHidden(t, api.getState(), activeIdRef.current),\n          );\n        if (item.isDisabled) {\n          const disabled = tasks.some((t) =>\n            item.isDisabled(t, api.getState(), activeIdRef.current),\n          );\n          item.disabled = disabled;\n        }\n      }\n      return result;\n    },\n    [filter, selectedTasks, api],\n  );\n\n  useImperativeHandle(ref, () => ({\n    show: (ev, obj) => {\n      if (menuRef.current && menuRef.current.show) {\n        menuRef.current.show(ev, obj);\n      }\n    },\n  }));\n\n  const onContextMenu = useCallback((e) => {\n    if (menuRef.current && menuRef.current.show) {\n      menuRef.current.show(e);\n    }\n  }, []);\n\n  const content = (\n    <>\n      <WxContextMenu\n        filter={filterMenu}\n        options={cOptions}\n        dataKey={'id'}\n        resolver={itemResolver}\n        onClick={menuAction}\n        at={at}\n        ref={menuRef}\n        css={css}\n      />\n      <span onContextMenu={onContextMenu} data-menu-ignore=\"true\">\n        {typeof children === 'function' ? children() : children}\n      </span>\n    </>\n  );\n\n  if (!i18nCtx && context.i18n?.Provider) {\n    const Provider = context.i18n.Provider;\n    return <Provider value={l}>{content}</Provider>;\n  }\n\n  return content;\n});\n\nexport default ContextMenu;\n","import { useState, useEffect, useMemo, useContext } from 'react';\nimport { Field, Combo, Text } from '@svar-ui/react-core';\nimport { context } from '@svar-ui/react-core';\nimport { useStore } from '@svar-ui/lib-react';\nimport './Links.css';\n\nexport default function Links({ api, autoSave, onLinksChange }) {\n  const i18n = useContext(context.i18n);\n  const _ = i18n.getGroup('gantt');\n\n  const activeTask = useStore(api, 'activeTask');\n  const _activeTask = useStore(api, '_activeTask');\n  const links = useStore(api, '_links');\n  const schedule = useStore(api, 'schedule');\n  const unscheduledTasks = useStore(api, 'unscheduledTasks');\n\n  const [linksData, setLinksData] = useState();\n\n  function getLinksData() {\n    if (activeTask) {\n      const inLinks = links\n        .filter((a) => a.target == activeTask)\n        .map((link) => ({ link, task: api.getTask(link.source) }));\n\n      const outLinks = links\n        .filter((a) => a.source == activeTask)\n        .map((link) => ({ link, task: api.getTask(link.target) }));\n\n      return [\n        { title: _('Predecessors'), data: inLinks },\n        { title: _('Successors'), data: outLinks },\n      ];\n    }\n  }\n\n  useEffect(() => {\n    setLinksData(getLinksData());\n  }, [activeTask, links]);\n\n  const list = useMemo(\n    () => [\n      { id: 'e2s', label: _('End-to-start') },\n      { id: 's2s', label: _('Start-to-start') },\n      { id: 'e2e', label: _('End-to-end') },\n      { id: 's2e', label: _('Start-to-end') },\n    ],\n    [_],\n  );\n\n  function deleteLink(id) {\n    if (autoSave) {\n      api.exec('delete-link', { id });\n    } else {\n      setLinksData((prev) =>\n        (prev || []).map((group) => ({\n          ...group,\n          data: group.data.filter((item) => item.link.id !== id),\n        })),\n      );\n      onLinksChange &&\n        onLinksChange({\n          id,\n          action: 'delete-link',\n          data: { id },\n        });\n    }\n  }\n\n  function handleChange(id, update) {\n    if (autoSave) {\n      api.exec('update-link', {\n        id,\n        link: update,\n      });\n    } else {\n      setLinksData((prev) =>\n        (prev || []).map((group) => ({\n          ...group,\n          data: group.data.map((item) =>\n            item.link.id === id\n              ? { ...item, link: { ...item.link, ...update } }\n              : item,\n          ),\n        })),\n      );\n      onLinksChange &&\n        onLinksChange({\n          id,\n          action: 'update-link',\n          data: {\n            id,\n            link: update,\n          },\n        });\n    }\n  }\n\n  return (\n    <>\n      {(linksData || []).map((group, idx) =>\n        group.data.length ? (\n          <div className=\"wx-j93aYGQf wx-links\" key={idx}>\n            <Field label={group.title} position=\"top\">\n              <table>\n                <tbody>\n                  {group.data.map((obj) => (\n                    <tr key={obj.link.id}>\n                      <td className=\"wx-j93aYGQf wx-cell\">\n                        <div className=\"wx-j93aYGQf wx-task-name\">\n                          {obj.task.text || ''}\n                        </div>\n                      </td>\n                      {schedule?.auto && obj.link.type === 'e2s' ? (\n                        <td className=\"wx-j93aYGQf wx-cell wx-link-lag\">\n                          <Text\n                            type=\"number\"\n                            placeholder={_('Lag')}\n                            value={obj.link.lag}\n                            disabled={\n                              unscheduledTasks && _activeTask?.unscheduled\n                            }\n                            onChange={(ev) => {\n                              if (!ev.input)\n                                handleChange(obj.link.id, { lag: ev.value });\n                            }}\n                          />\n                        </td>\n                      ) : null}\n                      <td className=\"wx-j93aYGQf wx-cell\">\n                        <div className=\"wx-j93aYGQf wx-wrapper\">\n                          <Combo\n                            value={obj.link.type}\n                            placeholder={_('Select link type')}\n                            options={list}\n                            onChange={(ev) =>\n                              handleChange(obj.link.id, { type: ev.value })\n                            }\n                          >\n                            {({ option }) => option.label}\n                          </Combo>\n                        </div>\n                      </td>\n\n                      <td className=\"wx-j93aYGQf wx-cell\">\n                        <i\n                          className=\"wx-j93aYGQf wxi-delete wx-delete-icon\"\n                          onClick={() => deleteLink(obj.link.id)}\n                          role=\"button\"\n                        ></i>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </Field>\n          </div>\n        ) : null,\n      )}\n    </>\n  );\n}\n","import { DatePicker, TimePicker } from '@svar-ui/react-core';\nimport './DateTimePicker.css';\n\nexport default function DateTimePicker(props) {\n  const { value, time, format, onchange, onChange, ...restProps } = props;\n  const onChangeHandler = onChange ?? onchange;\n\n  function handleDateChange(ev) {\n    const current = new Date(ev.value);\n    // Preserve time from original value (UTC)\n    current.setUTCHours(value.getUTCHours());\n    current.setUTCMinutes(value.getUTCMinutes());\n\n    onChangeHandler && onChangeHandler({ value: current });\n  }\n\n  return (\n    <div className=\"wx-hFsbgDln date-time-controll\">\n      <DatePicker\n        {...restProps}\n        value={value}\n        onChange={handleDateChange}\n        format={format}\n        buttons={['today']}\n        clear={false}\n      />\n      {time ? (\n        <TimePicker value={value} onChange={onChangeHandler} format={format} />\n      ) : null}\n    </div>\n  );\n}\n","import { useState, useEffect, useMemo, useCallback, useContext } from 'react';\nimport { Editor as WxEditor, registerEditorItem } from '@svar-ui/react-editor';\nimport { Locale, RichSelect, Slider, Counter, TwoState } from '@svar-ui/react-core';\nimport { getEditorItems, prepareEditTask } from '@svar-ui/gantt-store';\nimport { dateToString, locale } from '@svar-ui/lib-dom';\nimport { en } from '@svar-ui/gantt-locales';\nimport { en as coreEn } from '@svar-ui/core-locales';\nimport { context } from '@svar-ui/react-core';\n\nimport Links from './editor/Links.jsx';\nimport DateTimePicker from './editor/DateTimePicker.jsx';\nimport { useStore } from '@svar-ui/lib-react';\n\n// helpers\nimport { modeObserver } from '../helpers/modeResizeObserver';\n\nimport './Editor.css';\n\nregisterEditorItem('select', RichSelect);\nregisterEditorItem('date', DateTimePicker);\nregisterEditorItem('twostate', TwoState);\nregisterEditorItem('slider', Slider);\nregisterEditorItem('counter', Counter);\nregisterEditorItem('links', Links);\n\nfunction Editor({\n  api,\n  items = [],\n  css = '',\n  layout = 'default',\n  readonly = false,\n  placement = 'sidebar',\n  bottomBar = true,\n  topBar = true,\n  autoSave = true,\n  focus = false,\n  hotkeys = {},\n}) {\n  const lFromCtx = useContext(context.i18n);\n  const l = useMemo(() => lFromCtx || locale({ ...en, ...coreEn }), [lFromCtx]);\n  const _ = useMemo(() => l.getGroup('gantt'), [l]);\n  const i18nData = l.getRaw();\n  const dateFormat = useMemo(() => {\n    const f = i18nData.gantt?.dateFormat || i18nData.formats?.dateFormat;\n    return dateToString(f, i18nData.calendar);\n  }, [i18nData]);\n\n  const normalizedTopBar = useMemo(() => {\n    if (topBar === true && !readonly) {\n      const buttons = [\n        { comp: 'icon', icon: 'wxi-close', id: 'close' },\n        { comp: 'spacer' },\n        {\n          comp: 'button',\n          type: 'danger',\n          text: _('Delete'),\n          id: 'delete',\n        },\n      ];\n      if (autoSave) return { items: buttons };\n      return {\n        items: [\n          ...buttons,\n          {\n            comp: 'button',\n            type: 'primary',\n            text: _('Save'),\n            id: 'save',\n          },\n        ],\n      };\n    }\n    return topBar;\n  }, [topBar, readonly, autoSave, _]);\n\n  // resize\n  const [compactMode, setCompactMode] = useState(false);\n  const styleCss = useMemo(\n    () => (compactMode ? 'wx-full-screen' : ''),\n    [compactMode],\n  );\n\n  const handleResize = useCallback((mode) => {\n    setCompactMode(mode);\n  }, []);\n\n  useEffect(() => {\n    const ro = modeObserver(handleResize);\n    ro.observe();\n    return () => {\n      ro.disconnect();\n    };\n  }, [handleResize]);\n\n  const activeTask = useStore(api, '_activeTask');\n  const taskId = useStore(api, 'activeTask');\n  const unscheduledTasks = useStore(api, 'unscheduledTasks');\n  const links = useStore(api, 'links');\n  const splitTasks = useStore(api, 'splitTasks');\n  const segmentIndex = useMemo(\n    () => splitTasks && taskId?.segmentIndex,\n    [splitTasks, taskId],\n  );\n  const isSegment = useMemo(\n    () => segmentIndex || segmentIndex === 0,\n    [segmentIndex],\n  );\n  const baseItems = useMemo(\n    () => getEditorItems({ unscheduledTasks }),\n    [unscheduledTasks],\n  );\n  const undo = useStore(api, 'undo');\n\n  const [linksActionsMap, setLinksActionsMap] = useState({});\n  const [inProgress, setInProgress] = useState(null);\n  const [editorValues, setEditorValues] = useState();\n  const [editorErrors, setEditorErrors] = useState(null);\n\n  const taskTypes = useStore(api, 'taskTypes');\n\n  const task = useMemo(() => {\n    if (!activeTask) return null;\n    let data;\n    if (isSegment && activeTask.segments)\n      data = { ...activeTask.segments[segmentIndex] };\n    else data = { ...activeTask };\n\n    if (readonly) {\n      // preserve parent to differentiate between segment and task\n      let values = { parent: data.parent };\n      baseItems.forEach(({ key, comp }) => {\n        if (comp !== 'links') {\n          const value = data[key];\n          if (comp === 'date' && value instanceof Date) {\n            values[key] = dateFormat(value);\n          } else if (comp === 'slider' && key === 'progress') {\n            values[key] = `${value}%`;\n          } else {\n            values[key] = value;\n          }\n        }\n      });\n      return values;\n    }\n    return data || null;\n  }, [activeTask, isSegment, segmentIndex, readonly, baseItems, dateFormat]);\n\n  useEffect(() => {\n    setEditorValues(task);\n  }, [task]);\n\n  useEffect(() => {\n    setLinksActionsMap({});\n    setEditorErrors(null);\n    setInProgress(null);\n  }, [taskId]);\n\n  function prepareEditorItems(localItems, taskData) {\n    return localItems.map((a) => {\n      const item = { ...a };\n      if (a.config) item.config = { ...item.config };\n      if (item.comp === 'links' && api) {\n        item.api = api;\n        item.autoSave = autoSave;\n        item.onLinksChange = handleLinksChange;\n      }\n      if (item.comp === 'select' && item.key === 'type') {\n        const options = item.options ?? (taskTypes ? taskTypes : []);\n        item.options = options.map((t) => ({\n          ...t,\n          label: _(t.label),\n        }));\n      }\n\n      if (item.comp === 'slider' && item.key === 'progress') {\n        item.labelTemplate = (value) => `${_(item.label)} ${value}%`;\n      }\n\n      if (item.label) item.label = _(item.label);\n      if (item.config?.placeholder)\n        item.config.placeholder = _(item.config.placeholder);\n\n      if (taskData) {\n        if (item.isDisabled && item.isDisabled(taskData, api.getState())) {\n          item.disabled = true;\n        } else delete item.disabled;\n      }\n      return item;\n    });\n  }\n\n  const editorItems = useMemo(() => {\n    let eItems = items.length ? items : baseItems;\n    eItems = prepareEditorItems(eItems, editorValues);\n    if (!editorValues) return eItems;\n    return eItems.filter(\n      (item) => !item.isHidden || !item.isHidden(editorValues, api.getState()),\n    );\n  }, [items, baseItems, editorValues, taskTypes, _, api, autoSave]);\n\n  const editorKeys = useMemo(\n    () => editorItems.map((i) => i.key),\n    [editorItems],\n  );\n\n  function handleLinksChange({ id, action, data }) {\n    setLinksActionsMap((prev) => ({\n      ...prev,\n      [id]: { action, data },\n    }));\n  }\n\n  const saveLinks = useCallback(() => {\n    for (let link in linksActionsMap) {\n      if (links.byId(link)) {\n        const { action, data } = linksActionsMap[link];\n        api.exec(action, data);\n      }\n    }\n  }, [api, linksActionsMap, links]);\n\n  const deleteTask = useCallback(() => {\n    const id = taskId?.id || taskId;\n    if (isSegment) {\n      if (activeTask?.segments) {\n        const segments = activeTask.segments.filter(\n          (s, index) => index !== segmentIndex,\n        );\n        api.exec('update-task', {\n          id,\n          task: { segments },\n        });\n      }\n    } else {\n      api.exec('delete-task', { id });\n    }\n  }, [api, taskId, isSegment, activeTask, segmentIndex]);\n\n  const hide = useCallback(() => {\n    api.exec('show-editor', { id: null });\n  }, [api]);\n\n  const handleAction = useCallback(\n    (ev) => {\n      const { item, changes } = ev;\n      if (item.id === 'delete') {\n        deleteTask();\n      }\n      if (item.id === 'save') {\n        if (!changes.length) saveLinks();\n        else hide();\n      }\n      if (item.comp) hide();\n    },\n    [api, taskId, autoSave, saveLinks, deleteTask, hide],\n  );\n\n  const normalizeTask = useCallback(\n    (t, key, input) => {\n      if (unscheduledTasks && t.type === 'summary') t.unscheduled = false;\n\n      prepareEditTask(t, api.getState(), key);\n      if (!input) setInProgress(false);\n      return t;\n    },\n    [unscheduledTasks, api],\n  );\n\n  const save = useCallback(\n    (values) => {\n      values = {\n        ...values,\n        unscheduled:\n          unscheduledTasks && values.unscheduled && values.type !== 'summary',\n      };\n      delete values.links;\n      delete values.data;\n\n      if (\n        editorKeys.indexOf('duration') === -1 ||\n        (values.segments && !values.duration)\n      )\n        delete values.duration;\n\n      const data = {\n        id: taskId?.id || taskId,\n        task: values,\n        ...(isSegment && { segmentIndex }),\n      };\n      if (autoSave && inProgress) data.inProgress = inProgress;\n\n      api.exec('update-task', data);\n\n      if (!autoSave) saveLinks();\n    },\n    [\n      api,\n      taskId,\n      unscheduledTasks,\n      autoSave,\n      saveLinks,\n      editorKeys,\n      isSegment,\n      segmentIndex,\n      inProgress,\n    ],\n  );\n\n  const handleChange = useCallback(\n    (ev) => {\n      let { update, key, input } = ev;\n\n      if (input) setInProgress(true);\n\n      ev.update = normalizeTask({ ...update }, key, input);\n\n      if (!autoSave) setEditorValues(ev.update);\n      else if (!editorErrors && !input) {\n        const item = editorItems.find((i) => i.key === key);\n        const v = update[key];\n        const isValid = !item.validation || item.validation(v);\n        if (isValid && (!item.required || v)) save(ev.update);\n      }\n    },\n    [autoSave, normalizeTask, editorErrors, editorItems, save],\n  );\n\n  const handleSave = useCallback(\n    (ev) => {\n      if (!autoSave) save(ev.values);\n    },\n    [autoSave, save],\n  );\n\n  const handleValidation = useCallback((check) => {\n    // get all errors after onchange action\n    setEditorErrors(check.errors);\n  }, []);\n\n  const defaultHotkeys = useMemo(\n    () =>\n      undo\n        ? {\n            'ctrl+z': (ev) => {\n              ev.preventDefault();\n              api.exec('undo');\n            },\n            'ctrl+y': (ev) => {\n              ev.preventDefault();\n              api.exec('redo');\n            },\n          }\n        : {},\n    [undo, api],\n  );\n\n  return task ? (\n    <Locale>\n      <WxEditor\n        css={`wx-XkvqDXuw wx-gantt-editor ${styleCss} ${css}`}\n        items={editorItems}\n        values={task}\n        topBar={normalizedTopBar}\n        bottomBar={bottomBar}\n        placement={placement}\n        layout={layout}\n        readonly={readonly}\n        autoSave={autoSave}\n        focus={focus}\n        onAction={handleAction}\n        onSave={handleSave}\n        onValidation={handleValidation}\n        onChange={handleChange}\n        hotkeys={hotkeys && { ...defaultHotkeys, ...hotkeys }}\n      />\n    </Locale>\n  ) : null;\n}\n\nexport default Editor;\n","import { useState, useEffect } from 'react';\nimport { HeaderMenu as HeaderMenuInner } from '@svar-ui/react-grid';\n\nconst HeaderMenu = ({ children, columns = null, api }) => {\n  const [tableAPI, setTableAPI] = useState(null);\n  useEffect(() => {\n    if (!api) return;\n    api.getTable(true).then(setTableAPI);\n  }, [api]);\n\n  return (\n    <HeaderMenuInner api={tableAPI} columns={columns}>\n      {children}\n    </HeaderMenuInner>\n  );\n};\n\nexport default HeaderMenu;\n","import { useState, useEffect, useRef } from 'react';\nimport './Tooltip.css';\n\nfunction Tooltip(props) {\n  const { api, content: Content, children } = props;\n\n  const areaRef = useRef(null);\n  const tooltipNodeRef = useRef(null);\n\n  const [areaCoords, setAreaCoords] = useState({});\n  const [tooltipData, setTooltipData] = useState(null);\n  const [pos, setPos] = useState({});\n\n  function findAttribute(node) {\n    while (node) {\n      if (node.getAttribute) {\n        const id = node.getAttribute('data-tooltip-id');\n        const at = node.getAttribute('data-tooltip-at');\n        const tooltip = node.getAttribute('data-tooltip');\n        if (id || tooltip) return { id, tooltip, target: node, at };\n      }\n      node = node.parentNode;\n    }\n\n    return { id: null, tooltip: null, target: null, at: null };\n  }\n\n  useEffect(() => {\n    const tooltipNode = tooltipNodeRef.current;\n    if (tooltipNode && pos && (pos.text || Content)) {\n      const tooltipCoords = tooltipNode.getBoundingClientRect();\n\n      let updated = false;\n      let newLeft = pos.left;\n      let newTop = pos.top;\n\n      if (tooltipCoords.right >= areaCoords.right) {\n        newLeft = areaCoords.width - tooltipCoords.width - 5;\n        updated = true;\n      }\n      if (tooltipCoords.bottom >= areaCoords.bottom) {\n        newTop = pos.top - (tooltipCoords.bottom - areaCoords.bottom + 2);\n        updated = true;\n      }\n\n      if (updated) {\n        setPos((prev) => {\n          if (!prev) return prev;\n          return { ...prev, left: newLeft, top: newTop };\n        });\n      }\n    }\n  }, [pos, areaCoords, Content]);\n\n  const timerRef = useRef(null);\n  const TIMEOUT = 300;\n  const debounce = (code) => {\n    clearTimeout(timerRef.current);\n    timerRef.current = setTimeout(() => {\n      code();\n    }, TIMEOUT);\n  };\n\n  function move(e) {\n    let { id, tooltip, target, at } = findAttribute(e.target);\n    setPos(null);\n    setTooltipData(null);\n\n    if (!tooltip) {\n      if (!id) {\n        clearTimeout(timerRef.current);\n        return;\n      } else {\n        tooltip = getTaskText(id);\n      }\n    }\n\n    const clientX = e.clientX;\n\n    debounce(() => {\n      if (id) {\n        setTooltipData(getTaskObj(prepareId(id)));\n      }\n\n      const targetCoords = target.getBoundingClientRect();\n      const areaEl = areaRef.current;\n      const areaRect = areaEl\n        ? areaEl.getBoundingClientRect()\n        : { top: 0, left: 0, right: 0, bottom: 0, width: 0, height: 0 };\n\n      let top, left;\n      if (at === 'left') {\n        top = targetCoords.top + 5 - areaRect.top;\n        left = targetCoords.right + 5 - areaRect.left;\n      } else {\n        top = targetCoords.top + targetCoords.height - areaRect.top;\n        left = clientX - areaRect.left;\n      }\n\n      setAreaCoords(areaRect);\n      setPos({ top, left, text: tooltip });\n    });\n  }\n\n  function getTaskObj(id) {\n    return api?.getTask(prepareId(id)) || null;\n  }\n\n  function getTaskText(id) {\n    return getTaskObj(id)?.text || '';\n  }\n\n  function prepareId(id) {\n    const numId = parseInt(id);\n    return isNaN(numId) ? id : numId;\n  }\n\n  return (\n    <div\n      className=\"wx-KG0Lwsqo wx-tooltip-area\"\n      ref={areaRef}\n      onMouseMove={move}\n    >\n      {pos && (pos.text || Content) ? (\n        <div\n          className=\"wx-KG0Lwsqo wx-gantt-tooltip\"\n          ref={tooltipNodeRef}\n          style={{ top: `${pos.top}px`, left: `${pos.left}px` }}\n        >\n          {Content ? (\n            <Content data={tooltipData} />\n          ) : pos.text ? (\n            <div className=\"wx-KG0Lwsqo wx-gantt-tooltip-text\">{pos.text}</div>\n          ) : null}\n        </div>\n      ) : null}\n\n      {children}\n    </div>\n  );\n}\n\nexport default Tooltip;\n","import { Material as CoreMaterial } from '@svar-ui/react-core';\nimport './Material.css';\n\nfunction Material({ fonts = true, children }) {\n  if (children) {\n    return <CoreMaterial fonts={fonts}>{children()}</CoreMaterial>;\n  } else {\n    return <CoreMaterial fonts={fonts} />;\n  }\n}\n\nexport default Material;\n","import { Willow as CoreWillow } from '@svar-ui/react-core';\nimport './Willow.css';\n\nfunction Willow({ fonts = true, children }) {\n  return children ? (\n    <CoreWillow fonts={fonts}>{children}</CoreWillow>\n  ) : (\n    <CoreWillow fonts={fonts} />\n  );\n}\n\nexport default Willow;\n","import { WillowDark as WillowDarkCore } from '@svar-ui/react-core';\nimport './WillowDark.css';\n\nexport default function WillowDark({ fonts = true, children }) {\n  if (children) {\n    return <WillowDarkCore fonts={fonts}>{children}</WillowDarkCore>;\n  } else {\n    return <WillowDarkCore fonts={fonts} />;\n  }\n}\n"],"names":["store","createContext","getID","node","id","numId","getOffset","relative","ev","box","base","checkSource","SHIFT","reorder","config","source","clone","sid","x","y","detail","touched","touchTimer","down","event","handleTouchstart","locate","handleTouchmove","handleContext","handleTouchend","handleMousedown","handleMousemove","handleMouseup","end","full","move","dx","dy","top","task","up","targetNode","target","tid","line","after","before","TextCell","row","column","getStyle","col","CellComponent","jsxs","jsx","ActionCell","cell","action","useMemo","Grid","props","readonly","compactMode","width","display","columnWidthProp","onTableAPIChange","multiTaskRows","rowMapping","columnWidth","setColumnWidthProp","useWritableProp","tableAPI","setTableAPI","useState","i18n","useContext","context","_","api","storeContext","scrollTopVal","useStore","cellHeightVal","scrollTask","selectedVal","areaVal","rTasksVal","scalesVal","columnsVal","sortVal","calendarVal","durationUnitVal","splitTasksVal","dragTask","setDragTask","tasks","execAction","useCallback","a","onClick","e","locateID","tableRef","useRef","tableContainerRef","gridWidth","setGridWidth","updateFlex","setUpdateFlex","useEffect","update","ro","lastDetailRef","reorderTasks","inProgress","mode","scrollDelta","headerHeight","scrollX","tableStyle","style","allTasks","t","gridRows","rowMap","processedRows","rowId","cols","header","text","ti","c","ai","actionCol","basis","sortMarks","marks","key","order","index","checkFlex","hasFlexCol","fitColumns","filteredColumns","containerWidth","baseColumnWidth","forceReset","actualWidth","acc","k","setColumnWidth","resized","newColumnWidth","adjustColumns","onDblClick","locateAttr","sel","o","scrollDeltaRef","updateScrollOffset","scrollTop","body","tableEl","bodyEl","focusCell","startReorder","endReorder","moveReorder","handleHotkey","isInput","handlersStateRef","setHandlersState","init","tapi","add","keySort","s","value","v","prepareEditTask","WxGrid","CellGrid","borders","cellWidth","cellHeight","nodeRef","color","setColor","border","grid","Links","onSelectLink","selectedLink","links","criticalPath","selectedLineRef","onClickOutside","css","handler","link","className","BarSegments","type","segmentStyle","i","getSegProgress","segmentIndex","progress","segments","duration","result","seg","clipboardTasks","clipboardBaseDate","clipboardParent","pixelToDate","px","scales","start","lengthUnitWidth","lengthUnit","msPerDay","daysPerUnit","units","date","getCellOffset","baseDate","msPerUnit","addCells","cells","boundsOverlap","left1","right1","left2","right2","Bars","TaskTemplate","marqueeSelect","copyPaste","allowTaskIntersection","summaryBarCounts","rTasksValue","rTasksCounter","useStoreWithCounter","rLinksValue","rLinksCounter","areaValue","scalesValueRaw","taskTypesValue","scalesValue","utcDate","dayOfWeek","daysToMonday","monday","baselinesValue","selectedValue","selectedCounter","scrollTaskStore","tree","schedule","splitTasks","adjustedTasks","rowIndexMap","seenRows","rowIndex","summaryColCounts","childrenMap","summaryIds","counts","summaryId","children","colCounts","child","startCol","endCol","ignoreNextClickRef","linkFrom","setLinkFrom","taskMove","setTaskMove","progressFromRef","setSelectedLink","setTouched","touchTimerRef","totalWidth","setTotalWidth","marquee","setMarquee","marqueeRef","bulkMove","setBulkMove","pasteTargetDate","setPasteTargetDate","pastePreview","setPastePreview","pasteTargetDateRef","lastMouseXRef","containerRef","hasFocus","el","focused","entries","startDrag","endDrag","getMoveMode","segmentNode","left","p","delta","overlappingTaskIds","overlapping","tasksByRow","rowTasks","j","task1","task2","taskYPositions","yMap","rowYPositions","getIntersectingTasks","rect","minX","maxX","minY","maxY","taskLeft","taskRight","taskTop","taskBottom","selectedIds","isTaskSelected","taskId","point","clientX","newTaskMove","segNode","extendDragOptions","mousedown","container","startX","startY","clickDate","marqueeData","originalPositions","touchstart","currentMarquee","intersecting","diff","isFirst","_origPos","origPos","marker","l","w","segment","diffMs","clientY","currentX","prev","currentY","newLeft","isSegmentMoveAllowed","nextTaskMove","taskNode","barNode","mousemove","touchmove","mouseup","touchend","types","getLinkType","fromStart","toStart","alreadyLinked","removeLinkMarker","executePaste","targetDate","parent","history","targetColumnStart","newId","cellOffset","newStart","newEnd","clickedTask","renderedTask","taskStyle","baselineStyle","contextmenu","taskTypeIds","taskTypeCss","forward","isTaskCritical","isLinkMarkerVisible","linkFromSummaryIds","handleCopy","selected","$x","$y","$h","$w","$skip","$level","$index","$y_base","$x_base","$w_base","$h_base","$skip_baseline","$critical","$reorder","clean","durationDays","startDayOfWeek","commonParent","validTasks","min","handleKeyDown","marqueeStyle","height","isOverlapping","barClass","leftLinkClass","rightLinkClass","Fragment","Button","count","h","rowY","TimeScale","highlightTime","onScaleClick","rowIdx","cellIdx","extraClass","isHtml","renderMetrics","useRenderTime","label","startTime","renderCount","rafRef","enabled","metric","Chart","fullWidth","fullHeight","taskTemplate","cellBorders","scrollToCurrentWeek","currentWeekColor","rScrollTop","markers","rScrollTask","zoom","rTasks","chartHeight","setChartHeight","chartRef","zoomAccumulatorRef","hasScrolledToCurrentWeekRef","extraRows","selectStyle","obj","adjustedY","chartGridHeight","onScroll","setScroll","scroll","pos","dataRequest","num","from","showTask","clientWidth","onWheel","offset","dir","getHoliday","holidays","accumulatedLeft","holiday","cleanupRef","hotkeys","now","currentWeekIndex","accumulatedWidth","cellPositions","cellStart","cellEnd","targetIndex","scrollLeft","TimeScales","Resizer","position","size","onMove","onDisplayChange","leftThreshold","rightThreshold","setValue","setDisplay","getBox","val","name","active","setActive","initialPosition","setInitialPosition","startRef","posRef","timeoutRef","displayRef","getEventPos","newPos","nextDisplay","cursor","resetToInitial","handleExpand","direction","newDisplay","handleExpandLeft","handleExpandRight","b","rootClassName","COMPACT_WIDTH","modeObserver","callback","observer","observe","disconnect","Layout","rScales","rCellHeight","rColumns","undo","computedRowMapping","taskRows","setCompactMode","ganttWidth","setGanttWidth","ganttHeight","setGanttHeight","innerWidth","setInnerWidth","lastDisplay","handleResize","gridColumnWidth","scrollSize","uniqueRows","scrollHeight","expandScale","minWidth","ganttDivRef","pseudoRowsRef","latest","scrollToTask","sc","ch","ss","gh","tt","scrollY","ganttDiv","pseudoRows","flushSync","layoutRef","getUnitFormats","normalizeFormatter","calendarLocale","dateToString","prepareScales","format","scale","prepareFormats","formats","unit","prepareColumns","columns","prepareZoom","level","camelize","part","defaultScales","Gantt","forwardRef","taskTypes","defaultTaskTypes","activeTask","defaultColumns","durationUnit","scaleHeight","baselines","highlightTimeProp","autoScale","unscheduledTasks","projectStart","projectEnd","calendar","currentWeekHighlight","restProps","ref","restPropsRef","dataStore","DataStore","writable","words","coreEn","en","i18nCtx","locale","lCalendar","normalizedConfig","normalizeLinks","normalizeZoom","parsedTasksRef","parseTaskDates","buildRowMap","taskList","firstInRoute","lastInRouteRef","EventBusRouter","tableAPIRef","waitRender","res","useImperativeHandle","initOnceRef","isCurrentWeek","weekStart","currentWeekStart","currentWeekEnd","day","classes","StoreContext","Toolbar","items","i18nLocal","_selected","useStoreLater","historyActions","finalItems","fullButtons","getToolbarButtons","item","isHandledAction","it","handleAction","buttons","finalButtons","button","nextButton","WxToolbar","ContextMenu","optionsInit","resolver","filter","at","menuRef","activeIdRef","taskTypesVal","selectedTasksVal","fullOptions","getMenuOptions","applyLocaleFn","opts","op","getOptions","finalOptions","convertOption","cOptions","selectedTasks","itemResolver","menuAction","filterMenu","disabled","onContextMenu","content","WxContextMenu","Provider","autoSave","onLinksChange","_activeTask","linksData","setLinksData","getLinksData","inLinks","outLinks","list","deleteLink","group","handleChange","idx","Field","Text","Combo","option","DateTimePicker","time","onchange","onChange","onChangeHandler","handleDateChange","current","DatePicker","TimePicker","registerEditorItem","RichSelect","TwoState","Slider","Counter","Editor","layout","placement","bottomBar","topBar","focus","lFromCtx","i18nData","dateFormat","f","normalizedTopBar","styleCss","isSegment","baseItems","getEditorItems","linksActionsMap","setLinksActionsMap","setInProgress","editorValues","setEditorValues","editorErrors","setEditorErrors","data","values","comp","prepareEditorItems","localItems","taskData","handleLinksChange","options","editorItems","eItems","editorKeys","saveLinks","deleteTask","hide","changes","normalizeTask","input","save","handleSave","handleValidation","check","defaultHotkeys","Locale","WxEditor","HeaderMenu","HeaderMenuInner","Tooltip","Content","areaRef","tooltipNodeRef","areaCoords","setAreaCoords","tooltipData","setTooltipData","setPos","findAttribute","tooltip","tooltipNode","tooltipCoords","updated","newTop","timerRef","TIMEOUT","debounce","code","getTaskText","getTaskObj","prepareId","targetCoords","areaEl","areaRect","Material","fonts","CoreMaterial","Willow","CoreWillow","WillowDark","WillowDarkCore"],"mappings":"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"}