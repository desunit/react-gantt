"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("react/jsx-runtime"),e=require("react"),ke=require("@svar-ui/react-core"),Te=require("@svar-ui/lib-dom"),Xe=require("@svar-ui/gantt-locales"),Ve=require("@svar-ui/core-locales"),bt=require("@svar-ui/lib-state"),we=require("@svar-ui/gantt-store"),M=require("@svar-ui/lib-react"),dt=require("@svar-ui/grid-store"),ft=require("@svar-ui/react-grid"),yt=require("react-dom"),rt=require("@svar-ui/react-toolbar"),vt=require("@svar-ui/react-menu"),He=require("@svar-ui/react-editor"),ze=e.createContext(null);function _e(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function Tt(s,n,r){const i=s.getBoundingClientRect(),o=n.querySelector(".wx-body").getBoundingClientRect();return{top:i.top-o.top,left:i.left-o.left,dt:i.bottom-r.clientY,db:r.clientY-i.top}}function ot(s){return s&&s.getAttribute("data-context-id")}const lt=5;function Ct(s,n){let r,i,o,j,m,l,f,A,k;function V(g){j=g.clientX,m=g.clientY,l={...Tt(r,s,g),y:n.getTask(o).$y},document.body.style.userSelect="none"}function $(g){r=Te.locate(g),ot(r)&&(o=_e(r),k=setTimeout(()=>{A=!0,n&&n.touchStart&&n.touchStart(),V(g.touches[0])},500),s.addEventListener("touchmove",L),s.addEventListener("contextmenu",d),window.addEventListener("touchend",_))}function d(g){if(A||k)return g.preventDefault(),!1}function z(g){g.which===1&&(r=Te.locate(g),ot(r)&&(o=_e(r),s.addEventListener("mousemove",U),window.addEventListener("mouseup",R),V(g)))}function h(g){s.removeEventListener("mousemove",U),s.removeEventListener("touchmove",L),document.body.removeEventListener("mouseup",R),document.body.removeEventListener("touchend",_),document.body.style.userSelect="",g&&(s.removeEventListener("mousedown",z),s.removeEventListener("touchstart",$))}function E(g){const Z=g.clientX-j,K=g.clientY-m;if(!i){if(Math.abs(Z)<lt&&Math.abs(K)<lt||n&&n.start&&n.start({id:o,e:g})===!1)return;i=r.cloneNode(!0),i.style.pointerEvents="none",i.classList.add("wx-reorder-task"),i.style.position="absolute",i.style.left=l.left+"px",i.style.top=l.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(i,r)}if(i){const fe=Math.round(Math.max(0,l.top+K));if(n&&n.move&&n.move({id:o,top:fe,detail:f})===!1)return;const H=n.getTask(o),ce=H.$y;if(!l.start&&l.y==ce)return G();l.start=!0,l.y=H.$y-4,i.style.top=fe+"px";const te=document.elementFromPoint(g.clientX,g.clientY),x=Te.locate(te);if(x&&x!==r){const v=_e(x),I=x.getBoundingClientRect(),le=I.top+I.height/2,ee=g.clientY+l.db>le&&x.nextElementSibling!==r,ne=g.clientY-l.dt<le&&x.previousElementSibling!==r;f?.after==v||f?.before==v?f=null:ee?f={id:o,after:v}:ne&&(f={id:o,before:v})}}}function U(g){E(g)}function L(g){A?(g.preventDefault(),E(g.touches[0])):k&&(clearTimeout(k),k=null)}function _(){A=null,k&&(clearTimeout(k),k=null),G()}function R(){G()}function G(){r&&(r.style.visibility=""),i&&(i.parentNode.removeChild(i),n&&n.end&&n.end({id:o,top:l.top})),o=r=i=l=f=null,h()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",z),s.addEventListener("touchstart",$),{destroy(){h(!0)}}}function Mt({row:s,column:n}){function r(o,j){return{justifyContent:j.align,paddingLeft:`${(o.$level-1)*20}px`}}const i=n&&n._cell;return c.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?c.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):c.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),c.jsx("div",{className:"wx-pqc08MHU wx-text",children:i?c.jsx(i,{row:s,column:n}):s.text})]})}function ct({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?c.jsx("div",{style:{textAlign:s.align},children:c.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function St(s){const{readonly:n,compactMode:r,width:i=0,display:o="all",columnWidth:j=0,onTableAPIChange:m,multiTaskRows:l=!1,rowMapping:f=null}=s,[A,k]=M.useWritableProp(j),[V,$]=e.useState(),d=e.useContext(ke.context.i18n),z=e.useMemo(()=>d.getGroup("gantt"),[d]),h=e.useContext(ze),E=M.useStore(h,"scrollTop"),U=M.useStore(h,"cellHeight"),L=M.useStore(h,"_scrollTask"),_=M.useStore(h,"_selected"),R=M.useStore(h,"area"),G=M.useStore(h,"_tasks"),g=M.useStore(h,"_scales"),Z=M.useStore(h,"columns"),K=M.useStore(h,"_sort"),fe=M.useStore(h,"calendar"),H=M.useStore(h,"durationUnit"),ce=M.useStore(h,"splitTasks"),[te,x]=e.useState(null),v=e.useMemo(()=>!G||!R?[]:l&&f?G:G.slice(R.start,R.end),[G,R,l,f]),I=e.useCallback((a,y)=>{if(y==="add-task")h.exec(y,{target:a,task:{text:z("New Task")},mode:"child",show:!0});else if(y==="open-task"){const S=v.find(O=>O.id===a);(S?.data||S?.lazy)&&h.exec(y,{id:a,mode:!S.open})}},[v]),le=e.useCallback(a=>{const y=Te.locateID(a),S=a.target.dataset.action;S&&a.preventDefault(),y?S==="add-task"||S==="open-task"?I(y,S):h.exec("select-task",{id:y,toggle:a.ctrlKey||a.metaKey,range:a.shiftKey,show:!0}):S==="add-task"&&I(null,S)},[h,I]),ee=e.useRef(null),ne=e.useRef(null),[ie,he]=e.useState(0),[Ee,Me]=e.useState(!1);e.useEffect(()=>{const a=ne.current;if(!a||typeof ResizeObserver>"u")return;const y=()=>he(a.clientWidth);y();const S=new ResizeObserver(y);return S.observe(a),()=>S.disconnect()},[]);const je=e.useRef(null),Se=e.useCallback(a=>{const y=a.id,{before:S,after:O}=a,pe=a.onMove;let de=S||O,Ce=S?"before":"after";if(pe){if(Ce==="after"){const Ie=h.getTask(de);Ie.data?.length&&Ie.open&&(Ce="before",de=Ie.data[0].id)}je.current={id:y,[Ce]:de}}else je.current=null;h.exec("move-task",{id:y,mode:Ce,target:de,inProgress:pe})},[h]),W=e.useMemo(()=>l&&f?0:R?.from??0,[R,l,f]),b=e.useMemo(()=>g?.height??0,[g]),N=e.useMemo(()=>!r&&o!=="grid"?(A??0)>(i??0):(A??0)>(ie??0),[r,o,A,i,ie]),Y=e.useMemo(()=>{const a={};return N&&o==="all"||o==="grid"&&N?a.width=A:o==="grid"&&(a.width="100%"),a},[N,o,A]),F=e.useMemo(()=>te&&!v.find(a=>a.id===te.id)?[...v,te]:v,[v,te]),B=e.useMemo(()=>{if(!l||!f)return F;const a=new Map,y=new Set;return F.forEach(S=>{const O=f.taskRows.get(S.id)??S.id;y.has(O)||(a.set(O,{...S,$rowTasks:f.rowMap.get(O)||[S.id]}),y.add(O))}),Array.from(a.values())},[F,l,f]),oe=e.useMemo(()=>{let a=(Z||[]).map(O=>{O={...O};const pe=O.header;if(typeof pe=="object"){const de=pe.text&&z(pe.text);O.header={...pe,text:de}}else O.header=z(pe);return O});const y=a.findIndex(O=>O.id==="text"),S=a.findIndex(O=>O.id==="add-task");if(y!==-1&&(a[y].cell&&(a[y]._cell=a[y].cell),a[y].cell=Mt),S!==-1){a[S].cell=a[S].cell||ct;const O=a[S].header;if(typeof O!="object"&&(a[S].header={text:O}),a[S].header.cell=O.cell||ct,n)a.splice(S,1);else if(r){const[pe]=a.splice(S,1);a.unshift(pe)}}return a.length>0&&(a[a.length-1].resize=!1),a},[Z,z,n,r]),ue=e.useMemo(()=>o==="all"?`${i}px`:o==="grid"?"calc(100% - 4px)":oe.find(a=>a.id==="add-task")?"50px":"0",[o,i,oe]),T=e.useMemo(()=>{if(B&&K?.length){const a={};return K.forEach(({key:y,order:S},O)=>{a[y]={order:S,...K.length>1&&{index:O}}}),a}return{}},[B,K]),Q=e.useCallback(()=>oe.some(a=>a.flexgrow&&!a.hidden),[]),ae=e.useMemo(()=>Q(),[Q,Ee]),xe=e.useMemo(()=>{let a=o==="chart"?oe.filter(S=>S.id==="add-task"):oe;const y=o==="all"?i:ie;if(!ae){let S=A,O=!1;if(oe.some(pe=>pe.$width)){let pe=0;S=oe.reduce((de,Ce)=>(Ce.hidden||(pe+=Ce.width,de+=Ce.$width||Ce.width),de),0),pe>S&&S>y&&(O=!0)}if(O||S<y){let pe=1;return O||(pe=(y-50)/(S-50||1)),a.map(de=>(de.id!=="add-task"&&!de.hidden&&(de.$width||(de.$width=de.width),de.width=de.$width*pe),de))}}return a},[o,oe,ae,A,i,ie]),Re=e.useCallback(a=>{if(!Q()){const y=xe.reduce((S,O)=>(a&&O.$width&&(O.$width=O.width),S+(O.hidden?0:O.width)),0);y!==A&&k(y)}Me(!0),Me(!1)},[Q,xe,A,k]),w=e.useCallback(()=>{oe.filter(y=>y.flexgrow&&!y.hidden).length===1&&oe.forEach(y=>{y.$width&&!y.flexgrow&&!y.hidden&&(y.width=y.$width)})},[]),re=e.useCallback(a=>{if(!n){const y=Te.locateID(a),S=Te.locateAttr(a,"data-col-id");!(S&&oe.find(pe=>pe.id==S))?.editor&&y&&h.exec("show-editor",{id:y})}},[h,n]),me=e.useMemo(()=>Array.isArray(_)?_.map(a=>a.id):[],[_]),X=e.useRef(W);X.current=W,e.useEffect(()=>{const a=S=>{if(ee.current){const O=ee.current.querySelector(".wx-body");O&&(O.style.top=-((S??0)-(X.current??0))+"px")}ne.current&&(ne.current.scrollTop=0)};return a(E),h.on("scroll-chart",({top:S})=>{S!==void 0&&a(S)})},[h,E]),e.useEffect(()=>{if(ee.current){const a=ee.current.querySelector(".wx-body");a&&(a.style.top=-((E??0)-(W??0))+"px")}},[W]),e.useEffect(()=>{const a=ee.current;if(!a)return;const y=a.querySelector(".wx-table-box .wx-body");if(!y||typeof ResizeObserver>"u")return;const S=new ResizeObserver(()=>{if(ee.current){const O=ee.current.querySelector(".wx-body");O&&(O.style.top=-((E??0)-(X.current??0))+"px")}});return S.observe(y),()=>{S.disconnect()}},[xe,Y,o,ue,B,E]),e.useEffect(()=>{if(!L||!V)return;const{id:a}=L,y=V.getState().focusCell;y&&y.row!==a&&ee.current&&ee.current.contains(document.activeElement)&&V.exec("focus-cell",{row:a,column:y.column})},[L,V]);const q=e.useCallback(({id:a})=>{if(n)return!1;h.getTask(a).open&&h.exec("open-task",{id:a,mode:!1});const y=h.getState()._tasks.find(S=>S.id===a);if(x(y||null),!y)return!1},[h,n]),ge=e.useCallback(({id:a,top:y})=>{je.current?Se({...je.current,onMove:!1}):h.exec("drag-task",{id:a,top:y+(W??0),inProgress:!1}),x(null)},[h,Se,W]),be=e.useCallback(({id:a,top:y,detail:S})=>{S&&Se({...S,onMove:!0}),h.exec("drag-task",{id:a,top:y+(W??0),inProgress:!0})},[h,Se,W]);e.useEffect(()=>{const a=ee.current;return a?Ct(a,{start:q,end:ge,move:be,getTask:h.getTask}).destroy:void 0},[h,q,ge,be]);const $e=e.useCallback(a=>{const{key:y,isInput:S}=a;if(!S&&(y==="arrowup"||y==="arrowdown"))return a.eventSource="grid",h.exec("hotkey",a),!1;if(y==="enter"){const O=V?.getState().focusCell;if(O){const{row:pe,column:de}=O;de==="add-task"?I(pe,"add-task"):de==="text"&&I(pe,"open-task")}}},[h,I,V]),ye=e.useRef(null),De=()=>{ye.current={setTableAPI:$,handleHotkey:$e,sortVal:K,api:h,adjustColumns:w,setColumnWidth:Re,tasks:v,calendarVal:fe,durationUnitVal:H,splitTasksVal:ce,onTableAPIChange:m}};De(),e.useEffect(()=>{De()},[$,$e,K,h,w,Re,v,fe,H,ce,m]);const Ge=e.useCallback(a=>{$(a),a.intercept("hotkey",y=>ye.current.handleHotkey(y)),a.intercept("scroll",()=>!1),a.intercept("select-row",()=>!1),a.intercept("sort-rows",y=>{const S=ye.current.sortVal,{key:O,add:pe}=y,de=S?S.find(Ie=>Ie.key===O):null;let Ce="asc";return de&&(Ce=!de||de.order==="asc"?"desc":"asc"),h.exec("sort-tasks",{key:O,order:Ce,add:pe}),!1}),a.on("resize-column",()=>{ye.current.setColumnWidth(!0)}),a.on("hide-column",y=>{y.mode||ye.current.adjustColumns(),ye.current.setColumnWidth()}),a.intercept("update-cell",y=>{const{id:S,column:O,value:pe}=y,de=ye.current.tasks.find(Ce=>Ce.id===S);if(de){const Ce={...de};let Ie=pe;Ie&&!isNaN(Ie)&&!(Ie instanceof Date)&&(Ie*=1),Ce[O]=Ie,we.prepareEditTask(Ce,{calendar:ye.current.calendarVal,durationUnit:ye.current.durationUnitVal,splitTasks:ye.current.splitTasksVal},O),h.exec("update-task",{id:S,task:Ce})}return!1}),m&&m(a)},[]);return c.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ue}`},ref:ne,children:c.jsx("div",{ref:ee,style:Y,className:"wx-rHj6070p wx-table",onClick:le,onDoubleClick:re,children:c.jsx(ft.Grid,{init:Ge,sizes:{rowHeight:U,headerHeight:(b??0)-1},rowStyle:a=>a.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:a=>`wx-rHj6070p wx-text-${a.align}${a.id==="add-task"?" wx-action":""}`,data:B,columns:xe,selectedRows:[...me],sortMarks:T})})})}function Rt({borders:s=""}){const n=e.useContext(ze),r=M.useStore(n,"cellWidth"),i=M.useStore(n,"cellHeight"),o=e.useRef(null),[j,m]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&o.current){const f=getComputedStyle(o.current).getPropertyValue("--wx-gantt-border");m(f?f.substring(f.indexOf("#")):"#1d1e261a")}},[]);const l={width:"100%",height:"100%",background:r!=null&&i!=null?`url(${we.grid(r,i,j,s)})`:void 0,position:"absolute"};return c.jsx("div",{ref:o,style:l})}function Et({onSelectLink:s,selectedLink:n,readonly:r}){const i=e.useContext(ze),o=M.useStore(i,"_links"),j=M.useStore(i,"criticalPath"),m=e.useRef(null),l=e.useCallback(f=>{const A=f?.target?.classList;!A?.contains("wx-line")&&!A?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&m.current){const f=A=>{m.current&&!m.current.contains(A.target)&&l(A)};return document.addEventListener("click",f),()=>{document.removeEventListener("click",f)}}},[r,n,l]),c.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(o||[]).map(f=>{const A="wx-dkx3NwEn wx-line"+(j&&f.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return c.jsx("polyline",{className:A,points:f.$p,onClick:()=>!r&&s(f.id),"data-link-id":f.id},f.id)}),!r&&n&&c.jsx("polyline",{ref:m,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function jt(s){const{task:n,type:r}=s;function i(j){const m=n.segments[j];return{left:`${m.$x}px`,top:"0px",width:`${m.$w}px`,height:"100%"}}function o(j){if(!n.progress)return 0;const m=n.duration*n.progress/100,l=n.segments;let f=0,A=0,k=null;do{const V=l[A];A===j&&(f>m?k=0:k=Math.min((m-f)/V.duration,1)*100),f+=V.duration,A++}while(k===null&&A<l.length);return k||0}return c.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map((j,m)=>c.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":m,style:i(m),children:[n.progress?c.jsx("div",{className:"wx-progress-wrapper",children:c.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${o(m)}%`}})}):null,c.jsx("div",{className:"wx-content",children:j.text||""})]},m))})}let Be=[],it=null,Fe=null;const $t=(s,n)=>{if(!n||!n.start)return null;const{start:r,lengthUnitWidth:i,lengthUnit:o}=n,j=864e5,m=o==="week"?7:o==="month"?30:o==="quarter"?91:o==="year"?365:1,l=Math.floor(s/i);return new Date(r.getTime()+l*m*j)},at=(s,n,r)=>{if(!r||!s||!n)return 0;const{lengthUnit:i}=r,m=(i==="week"?7:i==="month"?30:i==="quarter"?91:i==="year"?365:1)*864e5;return Math.round((s.getTime()-n.getTime())/m)},ut=(s,n,r)=>{if(!r||!s)return s;const{lengthUnit:i}=r,m=(i==="week"?7:i==="month"?30:i==="quarter"?91:i==="year"?365:1)*864e5;return new Date(s.getTime()+n*m)};function Dt(s){const{readonly:n,taskTemplate:r,multiTaskRows:i=!1,rowMapping:o=null,marqueeSelect:j=!1,copyPaste:m=!1}=s,l=e.useContext(ze),[f,A]=M.useStoreWithCounter(l,"_tasks"),[k,V]=M.useStoreWithCounter(l,"_links"),$=M.useStore(l,"area"),d=M.useStore(l,"_scales"),z=M.useStore(l,"taskTypes"),h=M.useStore(l,"baselines"),[E,U]=M.useStoreWithCounter(l,"_selected"),L=M.useStore(l,"_scrollTask"),_=M.useStore(l,"criticalPath"),R=M.useStore(l,"tasks"),G=M.useStore(l,"schedule"),g=M.useStore(l,"splitTasks"),Z=e.useMemo(()=>{if(!$||!Array.isArray(f))return[];const t=$.start??0,u=$.end??0;return i&&o?f.map(p=>({...p})):f.slice(t,u).map(p=>({...p}))},[A,$,i,o]),K=M.useStore(l,"cellHeight"),fe=e.useMemo(()=>{if(!i||!o||!Z.length)return Z;const t=new Map,u=[];return f.forEach(p=>{const D=o.taskRows.get(p.id)??p.id;t.has(D)||(t.set(D,u.length),u.push(D))}),Z.map(p=>{const D=o.taskRows.get(p.id)??p.id,C=t.get(D)??0;return{...p,$y:C*K,$y_base:p.$y_base!==void 0?C*K:void 0}})},[Z,i,o,f,K]),H=e.useMemo(()=>d.lengthUnitWidth,[d]),ce=e.useMemo(()=>d.lengthUnit||"day",[d]),te=e.useRef(!1),[x,v]=e.useState(void 0),[I,le]=e.useState(null),ee=e.useRef(null),[ne,ie]=e.useState(null),[he,Ee]=e.useState(void 0),Me=e.useRef(null),[je,Se]=e.useState(0),[W,b]=e.useState(null),N=e.useRef(null),[Y,F]=e.useState(null),[B,oe]=e.useState(null),ue=e.useRef(null),T=e.useMemo(()=>{const t=ue.current;return!!(E.length&&t&&t.contains(document.activeElement))},[E,ue.current]),Q=e.useMemo(()=>T&&E[E.length-1]?.id,[T,E]);e.useEffect(()=>{if(L&&T&&L){const{id:t}=L,u=ue.current?.querySelector(`.wx-bar[data-id='${t}']`);u&&u.focus({preventScroll:!0})}},[L]),e.useEffect(()=>{const t=ue.current;if(t&&(Se(t.offsetWidth||0),typeof ResizeObserver<"u")){const u=new ResizeObserver(p=>{p[0]&&Se(p[0].contentRect.width)});return u.observe(t),()=>u.disconnect()}},[ue.current]);const ae=e.useCallback(()=>{document.body.style.userSelect="none"},[]),xe=e.useCallback(()=>{document.body.style.userSelect=""},[]),Re=e.useCallback((t,u,p)=>{if(u.target.classList.contains("wx-line")||(p||(p=l.getTask(_e(t))),p.type==="milestone"||p.type==="summary"))return"";const D=Te.locate(u,"data-segment");D&&(t=D);const{left:C,width:J}=t.getBoundingClientRect(),P=(u.clientX-C)/J;let se=.2/(J>200?J/200:1);return P<se?"start":P>1-se?"end":""},[l]),w=e.useMemo(()=>{const t=new Map;if(!i||!o)return f.forEach(D=>{t.set(D.id,D.$y)}),t;const u=new Map,p=[];return f.forEach(D=>{const C=o.taskRows.get(D.id)??D.id;u.has(C)||(u.set(C,p.length),p.push(C))}),f.forEach(D=>{const C=o.taskRows.get(D.id)??D.id,J=u.get(C)??0;t.set(D.id,J*K)}),t},[f,i,o,K]),re=e.useCallback(t=>{if(!ue.current)return[];const p=Math.min(t.startX,t.currentX),D=Math.max(t.startX,t.currentX),C=Math.min(t.startY,t.currentY),J=Math.max(t.startY,t.currentY);return f.filter(P=>{const se=P.$x,ve=P.$x+P.$w,Le=w.get(P.id)??P.$y,Pe=Le+P.$h;return se<D&&ve>p&&Le<J&&Pe>C})},[f,w]),me=e.useMemo(()=>new Set(E.map(t=>t.id)),[E,U]),X=e.useCallback(t=>me.has(t),[me]),q=e.useCallback((t,u)=>{const{clientX:p}=u,D=_e(t),C=l.getTask(D),J=u.target.classList;if(!u.target.closest(".wx-delete-button")&&!n){if(J.contains("wx-progress-marker")){const{progress:P}=l.getTask(D);ee.current={id:D,x:p,progress:P,dx:0,node:t,marker:u.target},u.target.classList.add("wx-progress-in-drag")}else{const P=Re(t,u,C)||"move",se={id:D,mode:P,x:p,dx:0,l:C.$x,w:C.$w};if(g&&C.segments?.length){const ve=Te.locate(u,"data-segment");ve&&(se.segmentIndex=ve.dataset.segment*1,we.extendDragOptions(C,se))}le(se)}ae()}},[l,n,Re,ae,g]),ge=e.useCallback(t=>{if(t.button!==0)return;const u=Te.locate(t);if(!u&&j&&!n){const p=ue.current;if(!p)return;const D=p.getBoundingClientRect(),C=t.clientX-D.left,J=t.clientY-D.top;if(m){const se=p.closest(".wx-chart")||p.parentElement,ve=se?se.scrollLeft:0,Ae=C+ve,Le=$t(Ae,d);Le&&oe(Le)}const P={startX:C,startY:J,currentX:C,currentY:J,ctrlKey:t.ctrlKey||t.metaKey};b(P),N.current=P,ae();return}if(u){if(j&&!n&&E.length>1){const p=_e(u);if(X(p)){const D=t.target.classList;if(!D.contains("wx-link")&&!D.contains("wx-progress-marker")&&!t.target.closest(".wx-delete-button")){const C=l.getTask(p);if(!Re(u,t,C)){const P=new Map;E.forEach(se=>{const ve=l.getTask(se.id);if(ve){if(G?.auto&&ve.type==="summary")return;P.set(se.id,{$x:ve.$x,$w:ve.$w,start:ve.start,end:ve.end})}}),F({baseTaskId:p,startX:t.clientX,dx:0,originalPositions:P}),ae();return}}}}q(u,t)}},[q,j,m,n,E,X,l,Re,G,ae,d]),be=e.useCallback(t=>{const u=Te.locate(t);u&&(Me.current=setTimeout(()=>{Ee(!0),q(u,t.touches[0])},300))},[q]),$e=e.useCallback(t=>{ie(t&&{...k.find(u=>u.id===t)})},[k]),ye=e.useCallback(()=>{const t=N.current;if(t){const u=re(t);t.ctrlKey?u.forEach(p=>{l.exec("select-task",{id:p.id,toggle:!0,marquee:!0})}):u.length>0&&(E.length>0&&l.exec("select-task",{id:null,marquee:!0}),u.forEach((p,D)=>{l.exec("select-task",{id:p.id,toggle:D>0,marquee:!0})})),b(null),N.current=null,xe(),te.current=!0;return}if(Y){const{dx:u,originalPositions:p}=Y,D=Math.round(u/H);if(D!==0){let C=!0;p.forEach((J,P)=>{const se=l.getTask(P);se&&(l.exec("update-task",{id:P,diff:D,task:{start:se.start,end:se.end},skipUndo:!C}),C=!1)}),te.current=!0}else p.forEach((C,J)=>{l.exec("drag-task",{id:J,left:C.$x,width:C.$w,inProgress:!1})});F(null),xe();return}if(ee.current){const{dx:u,id:p,marker:D,value:C}=ee.current;ee.current=null,typeof C<"u"&&u&&l.exec("update-task",{id:p,task:{progress:C},inProgress:!1}),D.classList.remove("wx-progress-in-drag"),te.current=!0,xe()}else if(I){const{id:u,mode:p,dx:D,l:C,w:J,start:P,segment:se,index:ve}=I;if(le(null),P){const Ae=Math.round(D/H);if(!Ae)l.exec("drag-task",{id:u,width:J,left:C,inProgress:!1,...se&&{segmentIndex:ve}});else{let Le={},Pe=l.getTask(u);se&&(Pe=Pe.segments[ve]);const Oe=1440*60*1e3,We=Ae*(ce==="week"?7:ce==="month"?30:ce==="quarter"?91:ce==="year"?365:1)*Oe;p==="move"?(Le.start=new Date(Pe.start.getTime()+We),Le.end=new Date(Pe.end.getTime()+We)):p==="start"?(Le.start=new Date(Pe.start.getTime()+We),Le.end=Pe.end):p==="end"&&(Le.start=Pe.start,Le.end=new Date(Pe.end.getTime()+We)),l.exec("update-task",{id:u,task:Le,...se&&{segmentIndex:ve}})}te.current=!0}xe()}},[l,xe,I,H,ce,W,Y,re,E]),De=e.useCallback((t,u)=>{const{clientX:p,clientY:D}=u;if(!n){if(W){const C=ue.current;if(!C)return;const J=C.getBoundingClientRect(),P=p-J.left,se=D-J.top;b(ve=>({...ve,currentX:P,currentY:se})),N.current&&(N.current.currentX=P,N.current.currentY=se);return}if(Y){const C=p-Y.startX;Y.originalPositions.forEach((J,P)=>{const se=J.$x+C;l.exec("drag-task",{id:P,left:se,width:J.$w,inProgress:!0})}),F(J=>({...J,dx:C}));return}if(ee.current){const{node:C,x:J,id:P}=ee.current,se=ee.current.dx=p-J,ve=Math.round(se/C.offsetWidth*100);let Ae=ee.current.progress+ve;ee.current.value=Ae=Math.min(Math.max(0,Ae),100),l.exec("update-task",{id:P,task:{progress:Ae},inProgress:!0})}else if(I){$e(null);const{mode:C,l:J,w:P,x:se,id:ve,start:Ae,segment:Le,index:Pe}=I,Oe=l.getTask(ve),Ne=p-se;if(!Ae&&Math.abs(Ne)<20||C==="start"&&P-Ne<H||C==="end"&&P+Ne<H||C==="move"&&(Ne<0&&J+Ne<0||Ne>0&&J+P+Ne>je)||I.segment&&!we.isSegmentMoveAllowed(Oe,I))return;const We={...I,dx:Ne};let qe,Ye;if(C==="start"?(qe=J+Ne,Ye=P-Ne):C==="end"?(qe=J,Ye=P+Ne):C==="move"&&(qe=J+Ne,Ye=P),l.exec("drag-task",{id:ve,width:Ye,left:qe,inProgress:!0,...Le&&{segmentIndex:Pe}}),!We.start&&(C==="move"&&Oe.$x==J||C!=="move"&&Oe.$w==P)){te.current=!0,ye();return}We.start=!0,le(We)}else{const C=Te.locate(t);if(C){const J=l.getTask(_e(C)),se=Te.locate(t,"data-segment")||C,ve=Re(se,u,J);se.style.cursor=ve&&!n?"col-resize":"pointer"}}}},[l,n,I,H,je,Re,$e,ye,W,Y]),Ge=e.useCallback(t=>{De(t,t)},[De]),a=e.useCallback(t=>{he?(t.preventDefault(),De(t,t.touches[0])):Me.current&&(clearTimeout(Me.current),Me.current=null)},[he,De]),y=e.useCallback(()=>{ye()},[ye]),S=e.useCallback(()=>{Ee(null),Me.current&&(clearTimeout(Me.current),Me.current=null),ye()},[ye]);e.useEffect(()=>(window.addEventListener("mouseup",y),()=>{window.removeEventListener("mouseup",y)}),[y]);const O=e.useCallback(t=>{if(!n){const u=Te.locateID(t.target);if(u&&!t.target.classList.contains("wx-link")){const p=Te.locateID(t.target,"data-segment");l.exec("show-editor",{id:u,...p!==null&&{segmentIndex:p}})}}},[l,n]),pe=["e2s","s2s","e2e","s2e"],de=e.useCallback((t,u)=>pe[(t?1:0)+(u?0:2)],[]),Ce=e.useCallback((t,u)=>{const p=x.id,D=x.start;return t===p?!0:!!k.find(C=>C.target==t&&C.source==p&&C.type===de(D,u))},[x,V,de]),Ie=e.useCallback(()=>{x&&v(null)},[x]),ht=e.useCallback(t=>{if(te.current){te.current=!1;return}const u=Te.locateID(t.target);if(u){const p=t.target.classList;if(p.contains("wx-link")){const D=p.contains("wx-left");if(!x){v({id:u,start:D});return}x.id!==u&&!Ce(u,D)&&l.exec("add-link",{link:{source:x.id,target:u,type:de(x.start,D)}})}else if(p.contains("wx-delete-button-icon"))l.exec("delete-link",{id:ne.id}),ie(null);else{let D;const C=Te.locate(t,"data-segment");C&&(D=C.dataset.segment*1),l.exec("select-task",{id:u,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:D})}}Ie()},[l,x,V,ne,Ce,de,Ie]),gt=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),wt=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),pt=e.useCallback(t=>{if(he||Me.current)return t.preventDefault(),!1},[he]),Ue=e.useMemo(()=>z.map(t=>t.id),[z]),Qe=e.useCallback(t=>{let u=Ue.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(u=`task ${u}`),u},[Ue]),Ze=e.useCallback(t=>{l.exec(t.action,t.data)},[l]),Ke=e.useCallback(t=>_&&R.byId(t).$critical,[_,R]),Je=e.useCallback(t=>{if(G?.auto){const u=R.getSummaryId(t,!0),p=R.getSummaryId(x.id,!0);return x?.id&&!(Array.isArray(u)?u:[u]).includes(x.id)&&!(Array.isArray(p)?p:[p]).includes(t)}return x},[G,R,x]),et=e.useRef(null);et.current=B;const tt=e.useCallback(()=>{const t=l.getState()._selected;if(!t||!t.length)return;const u=t.map(P=>{const se=l.getTask(P.id);if(!se)return null;const{$x:ve,$y:Ae,$w:Le,$h:Pe,$skip:Oe,$level:Ne,$index:We,$y_base:qe,$x_base:Ye,$w_base:ns,$h_base:rs,$skip_baseline:os,$critical:ls,$reorder:cs,...kt}=se;return kt}).filter(Boolean);if(!u.length)return;const D=u[0].parent,C=u.filter(P=>P.parent===D);if(C.length===0)return;const J=C.reduce((P,se)=>se.start&&(!P||se.start<P)?se.start:P,null);Be=C.map(P=>({...P,_startCellOffset:at(P.start,J,d),_durationCells:at(P.end,P.start,d)})),Fe=D,it=J},[l,d]),st=e.useCallback(()=>{const t=et.current;if(!Be.length||!t||!it||Fe==null)return;const u=l.getHistory();u?.startBatch(),Be.forEach((p,D)=>{const C=`task-${Date.now()}-${D}`,J=ut(t,p._startCellOffset||0,d),P=ut(J,p._durationCells||0,d);l.exec("add-task",{task:{...p,id:C,start:J,end:P,parent:Fe,row:p.row},target:Fe,mode:"child",skipUndo:D>0})}),u?.endBatch()},[l]);e.useEffect(()=>m?l.intercept("hotkey",u=>{if(u.key==="ctrl+c"||u.key==="meta+c")return tt(),!1;if(u.key==="ctrl+v"||u.key==="meta+v")return st(),!1}):void 0,[m,l,tt,st]);const nt=e.useMemo(()=>{if(!W)return null;const t=Math.min(W.startX,W.currentX),u=Math.min(W.startY,W.currentY),p=Math.abs(W.currentX-W.startX),D=Math.abs(W.currentY-W.startY);return{left:`${t}px`,top:`${u}px`,width:`${p}px`,height:`${D}px`}},[W]);return c.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${fe.length?fe[0].$h:0}px`},ref:ue,onContextMenu:pt,onMouseDown:ge,onMouseMove:Ge,onTouchStart:be,onTouchMove:a,onTouchEnd:S,onClick:ht,onDoubleClick:O,onDragStart:t=>(t.preventDefault(),!1),children:[c.jsx(Et,{onSelectLink:$e,selectedLink:ne,readonly:n}),fe.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const u=`wx-bar wx-${Qe(t.type)}`+(he&&I&&t.id===I.id?" wx-touch":"")+(x&&x.id===t.id?" wx-selected":"")+(me.has(t.id)?" wx-selected":"")+(Ke(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(g&&t.segments?" wx-split":""),p="wx-link wx-left"+(x?" wx-visible":"")+(!x||!Ce(t.id,!0)&&Je(t.id)?" wx-target":"")+(x&&x.id===t.id&&x.start?" wx-selected":"")+(Ke(t.id)?" wx-critical":""),D="wx-link wx-right"+(x?" wx-visible":"")+(!x||!Ce(t.id,!1)&&Je(t.id)?" wx-target":"")+(x&&x.id===t.id&&!x.start?" wx-selected":"")+(Ke(t.id)?" wx-critical":"");return c.jsxs(e.Fragment,{children:[!t.$skip&&c.jsxs("div",{className:"wx-GKbcLEGA "+u,style:gt(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:Q===t.id?0:-1,children:[n?null:t.id===ne?.target&&ne?.type[2]==="s"?c.jsx(ke.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+p,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?c.jsxs(c.Fragment,{children:[t.progress&&!(g&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:c.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(g&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?c.jsx(r,{data:t,api:l,onAction:Ze}):g&&t.segments?c.jsx(jt,{task:t,type:Qe(t.type)}):c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?c.jsx(r,{data:t,api:l,onAction:Ze}):c.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===ne?.target&&ne?.type[2]==="e"?c.jsx(ke.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+D,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),h&&!t.$skip_baseline?c.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:wt(t)}):null]},t.id)}),W&&nt&&c.jsx("div",{className:"wx-GKbcLEGA wx-marquee-selection",style:nt})]})}function Lt(s){const{highlightTime:n}=s,r=e.useContext(ze),i=M.useStore(r,"_scales");return c.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:i.width},children:(i?.rows||[]).map((o,j)=>c.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${o.height}px`},children:(o.cells||[]).map((m,l)=>{const f=n?n(m.date,m.unit):"",A="wx-cell "+(m.css||"")+" "+(f||""),k=typeof m.value=="string"&&m.value.includes("<");return c.jsx("div",{className:"wx-ZkvhDKir "+A,style:{width:`${m.width}px`},...k?{dangerouslySetInnerHTML:{__html:m.value}}:{children:m.value}},l)})},j))})}const It=new Map;function Nt(s){const n=e.useRef(null),r=e.useRef(0),i=e.useRef(null),o=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(o)return cancelAnimationFrame(i.current),i.current=requestAnimationFrame(()=>{const j={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};It.set(s,j),window.dispatchEvent(new CustomEvent("render-metric",{detail:j}))}),()=>cancelAnimationFrame(i.current)})}function Pt(s){const{readonly:n,fullWidth:r,fullHeight:i,taskTemplate:o,cellBorders:j,highlightTime:m,multiTaskRows:l=!1,rowMapping:f=null,marqueeSelect:A=!1,copyPaste:k=!1,scrollToCurrentWeek:V=!1,currentWeekColor:$=null}=s,d=e.useContext(ze),[z,h]=M.useStoreWithCounter(d,"_selected"),E=M.useStore(d,"scrollTop"),U=M.useStore(d,"cellHeight"),L=M.useStore(d,"cellWidth"),_=M.useStore(d,"_scales"),R=M.useStore(d,"_markers"),G=M.useStore(d,"_scrollTask"),g=M.useStore(d,"zoom"),Z=M.useStore(d,"_tasks"),[K,fe]=e.useState(),H=e.useRef(null),ce=e.useRef(0),te=e.useRef(!1),x=1+(_?.rows?.length||0),v=e.useMemo(()=>{if(!l||!f||!Z?.length)return null;const b=new Map,N=new Map,Y=[];return Z.forEach(F=>{const B=f.taskRows.get(F.id)??F.id;N.has(B)||(N.set(B,Y.length),Y.push(B))}),Z.forEach(F=>{const B=f.taskRows.get(F.id)??F.id,oe=N.get(B)??0;b.set(F.id,oe*U)}),b},[Z,l,f,U]),I=e.useMemo(()=>{const b=[];return z&&z.length&&U&&z.forEach(N=>{const Y=v?.get(N.id)??N.$y;b.push({height:`${U}px`,top:`${Y-3}px`})}),b},[h,U,v]),le=e.useMemo(()=>Math.max(K||0,i),[K,i]);e.useEffect(()=>{const b=H.current;b&&typeof E=="number"&&(b.scrollTop=E)},[E]);const ee=()=>{ne()};function ne(b){const N=H.current;if(!N)return;const Y={};Y.left=N.scrollLeft,d.exec("scroll-chart",Y)}function ie(){const b=H.current,Y=Math.ceil((K||0)/(U||1))+1,F=Math.floor((b&&b.scrollTop||0)/(U||1)),B=Math.max(0,F-x),oe=F+Y+x,ue=B*(U||0);d.exec("render-data",{start:B,end:oe,from:ue})}e.useEffect(()=>{ie()},[K,E]);const he=e.useCallback(b=>{if(!b)return;const{id:N,mode:Y}=b;if(Y.toString().indexOf("x")<0)return;const F=H.current;if(!F)return;const{clientWidth:B}=F,oe=d.getTask(N);if(oe.$x+oe.$w<F.scrollLeft)d.exec("scroll-chart",{left:oe.$x-(L||0)}),F.scrollLeft=oe.$x-(L||0);else if(oe.$x>=B+F.scrollLeft){const ue=B<oe.$w?L||0:oe.$w;d.exec("scroll-chart",{left:oe.$x-B+ue}),F.scrollLeft=oe.$x-B+ue}},[d,L]);e.useEffect(()=>{he(G)},[G]);function Ee(b){if(g&&(b.ctrlKey||b.metaKey)){b.preventDefault();const N=H.current,Y=b.clientX-(N?N.getBoundingClientRect().left:0);if(ce.current+=b.deltaY,Math.abs(ce.current)>=150){const B=-Math.sign(ce.current);ce.current=0,d.exec("zoom-scale",{dir:B,offset:Y})}}}const Me=e.useCallback(b=>{const N=m(b.date,b.unit);return N?{css:N,width:b.width}:null},[m]),je=e.useMemo(()=>{if(!_||!m||!["hour","day","week"].includes(_.minUnit))return null;let N=0;return _.rows[_.rows.length-1].cells.map(Y=>{const F=Me(Y),B=N;return N+=Y.width,F?{...F,left:B}:null})},[_,m,Me]),Se=e.useCallback(b=>{b.eventSource="chart",d.exec("hotkey",b)},[d]);e.useEffect(()=>{const b=H.current;if(!b)return;const N=()=>fe(b.clientHeight);N();const Y=new ResizeObserver(()=>N());return Y.observe(b),()=>{Y.disconnect()}},[H.current]);const W=e.useRef(null);return e.useEffect(()=>{const b=H.current;if(b&&!W.current)return W.current=dt.hotkeys(b,{keys:{arrowup:!0,arrowdown:!0},exec:N=>Se(N)}),()=>{W.current?.destroy(),W.current=null}},[]),e.useEffect(()=>{const b=H.current;if(!b)return;const N=Ee;return b.addEventListener("wheel",N),()=>{b.removeEventListener("wheel",N)}},[Ee]),e.useEffect(()=>{if(!V||te.current||!_||!H.current||!K)return;const b=H.current,{clientWidth:N}=b,Y=new Date,F=_.rows[_.rows.length-1]?.cells;if(!F)return;let B=-1,oe=0;const ue=[];for(let Q=0;Q<F.length;Q++){const ae=F[Q];ue.push({left:oe,width:ae.width});const xe=ae.date;if(ae.unit==="week"){const Re=new Date(xe);Re.setDate(Re.getDate()+7),Y>=xe&&Y<Re&&(B=Q)}else ae.unit==="day"&&Y.getFullYear()===xe.getFullYear()&&Y.getMonth()===xe.getMonth()&&Y.getDate()===xe.getDate()&&(B=Q);oe+=ae.width}let T=B;if(B>0&&(T=B-1),T>=0&&ue[T]){const Q=ue[T],ae=Math.max(0,Q.left);b.scrollLeft=ae,d.exec("scroll-chart",{left:ae}),te.current=!0}},[V,_,K,d]),Nt("chart"),c.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:H,onScroll:ee,children:[c.jsx(Lt,{highlightTime:m,scales:_}),R&&R.length?c.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${le}px`},children:R.map((b,N)=>c.jsx("div",{className:`wx-mR7v2Xag wx-marker ${b.css||""}`,style:{left:`${b.left}px`},children:c.jsx("div",{className:"wx-mR7v2Xag wx-content",children:b.text})},N))}):null,c.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${le}px`},children:[je?c.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:je.map((b,N)=>b?c.jsx("div",{className:"wx-mR7v2Xag "+b.css,style:{width:`${b.width}px`,left:`${b.left}px`}},N):null)}):null,c.jsx(Rt,{borders:j}),z&&z.length?z.map((b,N)=>b.$y?c.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":b.id,style:I[N]},b.id):null):null,c.jsx(Dt,{readonly:n,taskTemplate:o,multiTaskRows:l,rowMapping:f,marqueeSelect:A,copyPaste:k})]})]})}function At(s){const{position:n="after",size:r=4,dir:i="x",onMove:o,onDisplayChange:j,compactMode:m,containerWidth:l=0,leftThreshold:f=50,rightThreshold:A=50}=s,[k,V]=M.useWritableProp(s.value??0),[$,d]=M.useWritableProp(s.display??"all");function z(ne){let ie=0;n=="center"?ie=r/2:n=="before"&&(ie=r);const he={size:[r+"px","auto"],p:[ne-ie+"px","0px"],p2:["auto","0px"]};if(i!="x")for(let Ee in he)he[Ee]=he[Ee].reverse();return he}const[h,E]=e.useState(!1),[U,L]=e.useState(null),_=e.useRef(0),R=e.useRef(),G=e.useRef(),g=e.useRef($);e.useEffect(()=>{g.current=$},[$]),e.useEffect(()=>{U===null&&k>0&&L(k)},[U,k]);function Z(ne){return i=="x"?ne.clientX:ne.clientY}const K=e.useCallback(ne=>{const ie=R.current+Z(ne)-_.current;V(ie);let he;ie<=f?he="chart":l-ie<=A?he="grid":he="all",g.current!==he&&(d(he),g.current=he),G.current&&clearTimeout(G.current),G.current=setTimeout(()=>o&&o(ie),100)},[l,f,A,o]),fe=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",E(!1),window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",fe)},[K]),H=e.useMemo(()=>$!=="all"?"auto":i=="x"?"ew-resize":"ns-resize",[$,i]),ce=e.useCallback(ne=>{!m&&($==="grid"||$==="chart")||(_.current=Z(ne),R.current=k,E(!0),document.body.style.cursor=H,document.body.style.userSelect="none",window.addEventListener("mousemove",K),window.addEventListener("mouseup",fe))},[H,K,fe,k,m,$]);function te(){d("all"),U!==null&&(V(U),o&&o(U))}function x(ne){if(m){const ie=$==="chart"?"grid":"chart";d(ie),j(ie)}else if($==="grid"||$==="chart")te(),j("all");else{const ie=ne==="left"?"chart":"grid";d(ie),j(ie)}}function v(){x("left")}function I(){x("right")}const le=e.useMemo(()=>z(k),[k,n,r,i]),ee=["wx-resizer",`wx-resizer-${i}`,`wx-resizer-display-${$}`,h?"wx-resizer-active":""].filter(Boolean).join(" ");return c.jsxs("div",{className:"wx-pFykzMlT "+ee,onMouseDown:ce,style:{width:le.size[0],height:le.size[1],cursor:H},children:[c.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:v})}),c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:I})})]}),c.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const Wt=650;function xt(s){let n;function r(){n=new ResizeObserver(o=>{for(let j of o)if(j.target===document.body){let m=j.contentRect.width<=Wt;s(m)}}),n.observe(document.body)}function i(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:i}}function Ht(s){const{taskTemplate:n,readonly:r,cellBorders:i,highlightTime:o,onTableAPIChange:j,multiTaskRows:m=!1,rowMapping:l=null,marqueeSelect:f=!1,copyPaste:A=!1,scrollToCurrentWeek:k=!1,currentWeekColor:V=null}=s,$=e.useContext(ze),d=M.useStore($,"_tasks"),z=M.useStore($,"_scales"),h=M.useStore($,"cellHeight"),E=M.useStore($,"columns"),U=M.useStore($,"_scrollTask"),L=M.useStore($,"undo"),_=e.useMemo(()=>{if(!m)return l;const T=new Map,Q=new Map;return d.forEach(ae=>{const xe=ae.row??ae.id;Q.set(ae.id,xe),T.has(xe)||T.set(xe,[]),T.get(xe).push(ae.id)}),{rowMap:T,taskRows:Q}},[d,m,l]),[R,G]=e.useState(!1);let[g,Z]=e.useState(0);const[K,fe]=e.useState(0),[H,ce]=e.useState(0),[te,x]=e.useState(void 0),[v,I]=e.useState("all"),le=e.useRef(null),ee=e.useCallback(T=>{G(Q=>(T!==Q&&(T?(le.current=v,v==="all"&&I("grid")):(!le.current||le.current==="all")&&I("all")),T))},[v]);e.useEffect(()=>{const T=xt(ee);return T.observe(),()=>{T.disconnect()}},[ee]);const ne=e.useMemo(()=>{let T;return E.every(Q=>Q.width&&!Q.flexgrow)?T=E.reduce((Q,ae)=>Q+parseInt(ae.width),0):R&&v==="chart"?T=parseInt(E.find(Q=>Q.id==="action")?.width)||50:T=440,g=T,T},[E,R,v]);e.useEffect(()=>{Z(ne)},[ne]);const ie=e.useMemo(()=>(K??0)-(te??0),[K,te]),he=e.useMemo(()=>z.width,[z]),Ee=e.useMemo(()=>{if(!m||!_)return d.length*h;const T=new Set;return d.forEach(Q=>{const ae=_.taskRows.get(Q.id)??Q.id;T.add(ae)}),T.size*h},[d,h,m,_]),Me=e.useMemo(()=>z.height+Ee+ie,[z,Ee,ie]),je=e.useMemo(()=>g+he,[g,he]),Se=e.useRef(null),W=e.useCallback(()=>{Promise.resolve().then(()=>{if((K??0)>(je??0)){const T=(K??0)-g;$.exec("expand-scale",{minWidth:T})}})},[K,je,g,$]);e.useEffect(()=>{let T;return Se.current&&(T=new ResizeObserver(W),T.observe(Se.current)),()=>{T&&T.disconnect()}},[Se.current,W]),e.useEffect(()=>{W()},[he]);const b=e.useRef(null),N=e.useRef(null),Y=e.useCallback(()=>{const T=b.current;T&&$.exec("scroll-chart",{top:T.scrollTop})},[$]),F=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{F.current={rTasks:d,rScales:z,rCellHeight:h,scrollSize:ie,ganttDiv:b.current,ganttHeight:H??0}},[d,z,h,ie,H]);const B=e.useCallback(T=>{if(!T)return;const{rTasks:Q,rScales:ae,rCellHeight:xe,scrollSize:Re,ganttDiv:w,ganttHeight:re}=F.current;if(!w)return;const{id:me}=T,X=Q.findIndex(q=>q.id===me);if(X>-1){const q=re-ae.height,ge=X*xe,be=w.scrollTop;let $e=null;ge<be?$e=ge:ge+xe>be+q&&($e=ge-q+xe+Re),$e!==null&&($.exec("scroll-chart",{top:Math.max($e,0)}),b.current.scrollTop=Math.max($e,0))}},[$]);e.useEffect(()=>{B(U)},[U]),e.useEffect(()=>{const T=b.current,Q=N.current;if(!T||!Q)return;const ae=()=>{yt.flushSync(()=>{ce(T.offsetHeight),fe(T.offsetWidth),x(Q.offsetWidth)})},xe=new ResizeObserver(ae);return xe.observe(T),()=>xe.disconnect()},[b.current]);const oe=e.useRef(null),ue=e.useRef(null);return e.useEffect(()=>{ue.current&&(ue.current.destroy(),ue.current=null);const T=oe.current;if(T)return ue.current=dt.hotkeys(T,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,"meta+c":!0,"meta+v":!0,"meta+x":!0,"meta+d":!0,backspace:!0,"ctrl+z":L,"ctrl+y":L,"meta+z":L,"meta+shift+z":L},exec:Q=>{Q.isInput||$.exec("hotkey",Q)}}),()=>{ue.current?.destroy(),ue.current=null}},[L]),c.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:b,onScroll:Y,children:c.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:Me,width:"100%"},ref:N,children:c.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:H,width:te},children:c.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:oe,children:[E.length?c.jsxs(c.Fragment,{children:[c.jsx(St,{display:v,compactMode:R,columnWidth:ne,width:g,readonly:r,fullHeight:Ee,onTableAPIChange:j,multiTaskRows:m,rowMapping:_}),c.jsx(At,{value:g,display:v,compactMode:R,containerWidth:K,onMove:T=>Z(T),onDisplayChange:T=>I(T)})]}):null,c.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:Se,children:c.jsx(Pt,{readonly:r,fullWidth:he,fullHeight:Ee,taskTemplate:n,cellBorders:i,highlightTime:o,multiTaskRows:m,rowMapping:_,marqueeSelect:f,copyPaste:A,scrollToCurrentWeek:k,currentWeekColor:V})})]})})})})}function zt(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function _t(s,n){return typeof s=="function"?s:Te.dateToString(s,n)}function mt(s,n){return s.map(({format:r,...i})=>({...i,format:_t(r,n)}))}function Gt(s,n){const r=zt(n);for(let i in r)r[i]=Te.dateToString(r[i],s);return r}function Ot(s,n){if(!s||!s.length)return s;const r=Te.dateToString("%d-%m-%Y",n);return s.map(i=>i.template?i:i.id==="start"||i.id=="end"?{...i,_template:o=>r(o),template:o=>r(o)}:i.id==="duration"?{...i,_template:o=>o,template:o=>o}:i)}function qt(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:mt(r.scales,n)}))}:s}const Yt=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),Ft=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],Xt=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:i=we.defaultTaskTypes,tasks:o=[],selected:j=[],activeTask:m=null,links:l=[],scales:f=Ft,columns:A=we.defaultColumns,start:k=null,end:V=null,lengthUnit:$="day",durationUnit:d="day",cellWidth:z=100,cellHeight:h=38,scaleHeight:E=36,readonly:U=!1,cellBorders:L="full",zoom:_=!1,baselines:R=!1,highlightTime:G=null,init:g=null,autoScale:Z=!0,unscheduledTasks:K=!1,criticalPath:fe=null,schedule:H={type:"forward"},projectStart:ce=null,projectEnd:te=null,calendar:x=null,undo:v=!1,splitTasks:I=!1,multiTaskRows:le=!1,marqueeSelect:ee=!1,copyPaste:ne=!1,currentWeekHighlight:ie=!1,currentWeekColor:he=null,scrollToCurrentWeek:Ee=!1,...Me},je){const Se=e.useRef();Se.current=Me;const W=e.useMemo(()=>new we.DataStore(M.writable),[]),b=e.useMemo(()=>({...Ve.en,...Xe.en}),[]),N=e.useContext(ke.context.i18n),Y=e.useMemo(()=>N?N.extend(b,!0):Te.locale(b),[N,b]),F=e.useMemo(()=>Y.getRaw().calendar,[Y]),B=e.useMemo(()=>{let q={zoom:qt(_,F),scales:mt(f,F),columns:Ot(A,F),links:we.normalizeLinks(l),cellWidth:z};return q.zoom&&(q={...q,...we.normalizeZoom(q.zoom,Gt(F,Y.getGroup("gantt")),q.scales,z)}),q},[_,f,A,l,z,F,Y]),oe=e.useRef(null);oe.current!==o&&(we.parseTaskDates(o,{durationUnit:d,splitTasks:I,calendar:x}),oe.current=o),e.useEffect(()=>{we.parseTaskDates(o,{durationUnit:d,splitTasks:I,calendar:x})},[o,d,x,I]);const ue=e.useMemo(()=>{if(!le)return null;const q=new Map,ge=new Map,be=$e=>{$e.forEach(ye=>{const De=ye.row??ye.id;ge.set(ye.id,De),q.has(De)||q.set(De,[]),q.get(De).push(ye.id),ye.data&&ye.data.length>0&&be(ye.data)})};return be(o),{rowMap:q,taskRows:ge}},[o,le]),T=e.useMemo(()=>W.in,[W]),Q=e.useRef(null);Q.current===null&&(Q.current=new bt.EventBusRouter((q,ge)=>{const be="on"+Yt(q);Se.current&&Se.current[be]&&Se.current[be](ge)}),T.setNext(Q.current));const[ae,xe]=e.useState(null),Re=e.useRef(null);Re.current=ae;const w=e.useMemo(()=>({getState:W.getState.bind(W),getReactiveState:W.getReactive.bind(W),getStores:()=>({data:W}),exec:T.exec,setNext:q=>(Q.current=Q.current.setNext(q),Q.current),intercept:T.intercept.bind(T),on:T.on.bind(T),detach:T.detach.bind(T),getTask:W.getTask.bind(W),serialize:W.serialize.bind(W),getTable:q=>q?new Promise(ge=>setTimeout(()=>ge(Re.current),1)):Re.current,getHistory:()=>W.getHistory()}),[W,T]);e.useImperativeHandle(je,()=>({...w}),[w]);const re=e.useRef(0);e.useEffect(()=>{re.current?W.init({tasks:o,links:B.links,start:k,columns:B.columns,end:V,lengthUnit:$,cellWidth:B.cellWidth,cellHeight:h,scaleHeight:E,scales:B.scales,taskTypes:i,zoom:B.zoom,selected:j,activeTask:m,baselines:R,autoScale:Z,unscheduledTasks:K,markers:r,durationUnit:d,criticalPath:fe,schedule:H,projectStart:ce,projectEnd:te,calendar:x,undo:v,_weekStart:F.weekStart,splitTasks:I}):g&&g(w),re.current++},[w,g,o,B,k,V,$,h,E,i,j,m,R,Z,K,r,d,fe,H,ce,te,x,v,F,I,W]),re.current===0&&W.init({tasks:o,links:B.links,start:k,columns:B.columns,end:V,lengthUnit:$,cellWidth:B.cellWidth,cellHeight:h,scaleHeight:E,scales:B.scales,taskTypes:i,zoom:B.zoom,selected:j,activeTask:m,baselines:R,autoScale:Z,unscheduledTasks:K,markers:r,durationUnit:d,criticalPath:fe,schedule:H,projectStart:ce,projectEnd:te,calendar:x,undo:v,_weekStart:F.weekStart,splitTasks:I});const me=e.useMemo(()=>{const q=new Date,ge=F?.weekStart??0,be=new Date(q),ye=(be.getDay()-ge+7)%7;be.setDate(be.getDate()-ye),be.setHours(0,0,0,0);const De=new Date(be);return De.setDate(De.getDate()+7),Ge=>Ge>=be&&Ge<De},[F]),X=e.useMemo(()=>(q,ge)=>{let be=[];if(x)ge=="day"&&!x.getDayHours(q)&&be.push("wx-weekend"),ge=="hour"&&!x.getDayHours(q)&&be.push("wx-weekend");else if(G){const $e=G(q,ge);$e&&be.push($e)}return ie&&(ge==="week"||ge==="day")&&me(q)&&be.push("wx-current-week"),be.join(" ")},[x,G,ie,me]);return c.jsx(ke.context.i18n.Provider,{value:Y,children:c.jsx(ze.Provider,{value:w,children:c.jsx(Ht,{taskTemplate:n,readonly:U,cellBorders:L,highlightTime:X,onTableAPIChange:xe,multiTaskRows:le,rowMapping:ue,marqueeSelect:ee,copyPaste:ne,scrollToCurrentWeek:Ee,currentWeekColor:he})})})});function Kt({api:s=null,items:n=[]}){const r=e.useContext(ke.context.i18n),i=e.useMemo(()=>r||Te.locale(Xe.en),[r]),o=e.useMemo(()=>i.getGroup("gantt"),[i]),j=M.useStoreLater(s,"_selected"),m=M.useStoreLater(s,"undo"),l=M.useStoreLater(s,"history"),f=M.useStoreLater(s,"splitTasks"),A=["undo","redo"],k=e.useMemo(()=>{const $=we.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:we.getToolbarButtons({undo:m,splitTasks:f})).map(z=>{let h={...z,disabled:!1};return h.handler=we.isHandledAction($,h.id)?E=>we.handleAction(s,E.id,null,o):h.handler,h.text&&(h.text=o(h.text)),h.menuText&&(h.menuText=o(h.menuText)),h})},[n,s,o,m,f]),V=e.useMemo(()=>{const $=[];return k.forEach(d=>{const z=d.id;if(z==="add-task")$.push(d);else if(A.includes(z))A.includes(z)&&$.push({...d,disabled:d.isDisabled(l)});else{if(!j?.length||!s)return;$.push({...d,disabled:d.isDisabled&&j.some(h=>d.isDisabled(h,s.getState()))})}}),$.filter((d,z)=>{if(s&&d.isHidden)return!j.some(h=>d.isHidden(h,s.getState()));if(d.comp==="separator"){const h=$[z+1];if(!h||h.comp==="separator")return!1}return!0})},[s,j,l,k]);return r?c.jsx(rt.Toolbar,{items:V}):c.jsx(ke.context.i18n.Provider,{value:i,children:c.jsx(rt.Toolbar,{items:V})})}const Bt=e.forwardRef(function({options:n=[],api:r=null,resolver:i=null,filter:o=null,at:j="point",children:m,onClick:l,css:f},A){const k=e.useRef(null),V=e.useRef(null),$=e.useContext(ke.context.i18n),d=e.useMemo(()=>$||Te.locale({...Xe.en,...Ve.en}),[$]),z=e.useMemo(()=>d.getGroup("gantt"),[d]),h=M.useStoreLater(r,"taskTypes"),E=M.useStoreLater(r,"selected"),U=M.useStoreLater(r,"_selected"),L=M.useStoreLater(r,"splitTasks"),_=e.useMemo(()=>we.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{k.current&&k.current.show&&k.current.show()}),r.on("drag-task",()=>{k.current&&k.current.show&&k.current.show()}))},[r]);function R(x){return x.map(v=>(v={...v},v.text&&(v.text=z(v.text)),v.subtext&&(v.subtext=z(v.subtext)),v.data&&(v.data=R(v.data)),v))}function G(){const x=n.length?n:we.getMenuOptions({splitTasks:L}),v=x.find(I=>I.id==="convert-task");return v&&(v.data=[],(h||[]).forEach(I=>{v.data.push(v.dataFactory(I))})),R(x)}const g=e.useMemo(()=>G(),[r,n,h,L,z]),Z=e.useMemo(()=>U&&U.length?U:[],[U]),K=e.useCallback((x,v)=>{let I=x?r?.getTask(x):null;if(i){const le=i(x,v);I=le===!0?I:le}if(I){const le=Te.locateID(v.target,"data-segment");le!==null?V.current={id:I.id,segmentIndex:le}:V.current=I.id,(!Array.isArray(E)||!E.includes(I.id))&&r&&r.exec&&r.exec("select-task",{id:I.id})}return I},[r,i,E]),fe=e.useCallback(x=>{const v=x.action;v&&(we.isHandledAction(_,v.id)&&we.handleAction(r,v.id,V.current,z),l&&l(x))},[r,z,l,_]),H=e.useCallback((x,v)=>{const I=Z.length?Z:v?[v]:[];let le=o?I.every(ee=>o(x,ee)):!0;if(le&&(x.isHidden&&(le=!I.some(ee=>x.isHidden(ee,r.getState(),V.current))),x.isDisabled)){const ee=I.some(ne=>x.isDisabled(ne,r.getState(),V.current));x.disabled=ee}return le},[o,Z,r]);e.useImperativeHandle(A,()=>({show:(x,v)=>{k.current&&k.current.show&&k.current.show(x,v)}}));const ce=e.useCallback(x=>{k.current&&k.current.show&&k.current.show(x)},[]),te=c.jsxs(c.Fragment,{children:[c.jsx(vt.ContextMenu,{filter:H,options:g,dataKey:"id",resolver:K,onClick:fe,at:j,ref:k,css:f}),c.jsx("span",{onContextMenu:ce,"data-menu-ignore":"true",children:typeof m=="function"?m():m})]});if(!$&&ke.context.i18n?.Provider){const x=ke.context.i18n.Provider;return c.jsx(x,{value:d,children:te})}return te});function Vt({api:s,autoSave:n,onLinksChange:r}){const o=e.useContext(ke.context.i18n).getGroup("gantt"),j=M.useStore(s,"activeTask"),m=M.useStore(s,"_activeTask"),l=M.useStore(s,"_links"),f=M.useStore(s,"schedule"),A=M.useStore(s,"unscheduledTasks"),[k,V]=e.useState();function $(){if(j){const E=l.filter(L=>L.target==j).map(L=>({link:L,task:s.getTask(L.source)})),U=l.filter(L=>L.source==j).map(L=>({link:L,task:s.getTask(L.target)}));return[{title:o("Predecessors"),data:E},{title:o("Successors"),data:U}]}}e.useEffect(()=>{V($())},[j,l]);const d=e.useMemo(()=>[{id:"e2s",label:o("End-to-start")},{id:"s2s",label:o("Start-to-start")},{id:"e2e",label:o("End-to-end")},{id:"s2e",label:o("Start-to-end")}],[o]);function z(E){n?s.exec("delete-link",{id:E}):(V(U=>(U||[]).map(L=>({...L,data:L.data.filter(_=>_.link.id!==E)}))),r&&r({id:E,action:"delete-link",data:{id:E}}))}function h(E,U){n?s.exec("update-link",{id:E,link:U}):(V(L=>(L||[]).map(_=>({..._,data:_.data.map(R=>R.link.id===E?{...R,link:{...R.link,...U}}:R)}))),r&&r({id:E,action:"update-link",data:{id:E,link:U}}))}return c.jsx(c.Fragment,{children:(k||[]).map((E,U)=>E.data.length?c.jsx("div",{className:"wx-j93aYGQf wx-links",children:c.jsx(ke.Field,{label:E.title,position:"top",children:c.jsx("table",{children:c.jsx("tbody",{children:E.data.map(L=>c.jsxs("tr",{children:[c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:L.task.text||""})}),f?.auto&&L.link.type==="e2s"?c.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:c.jsx(ke.Text,{type:"number",placeholder:o("Lag"),value:L.link.lag,disabled:A&&m?.unscheduled,onChange:_=>{_.input||h(L.link.id,{lag:_.value})}})}):null,c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:c.jsx(ke.Combo,{value:L.link.type,placeholder:o("Select link type"),options:d,onChange:_=>h(L.link.id,{type:_.value}),children:({option:_})=>_.label})})}),c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>z(L.link.id),role:"button"})})]},L.link.id))})})})},U):null)})}function Ut(s){const{value:n,time:r,format:i,onchange:o,onChange:j,...m}=s,l=j??o;function f(A){const k=new Date(A.value);k.setHours(n.getHours()),k.setMinutes(n.getMinutes()),l&&l({value:k})}return c.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[c.jsx(ke.DatePicker,{...m,value:n,onChange:f,format:i,buttons:["today"],clear:!1}),r?c.jsx(ke.TimePicker,{value:n,onChange:l,format:i}):null]})}He.registerEditorItem("select",ke.RichSelect);He.registerEditorItem("date",Ut);He.registerEditorItem("twostate",ke.TwoState);He.registerEditorItem("slider",ke.Slider);He.registerEditorItem("counter",ke.Counter);He.registerEditorItem("links",Vt);function Qt({api:s,items:n=[],css:r="",layout:i="default",readonly:o=!1,placement:j="sidebar",bottomBar:m=!0,topBar:l=!0,autoSave:f=!0,focus:A=!1,hotkeys:k={}}){const V=e.useContext(ke.context.i18n),$=e.useMemo(()=>V||Te.locale({...Xe.en,...Ve.en}),[V]),d=e.useMemo(()=>$.getGroup("gantt"),[$]),z=$.getRaw(),h=e.useMemo(()=>{const w=z.gantt?.dateFormat||z.formats?.dateFormat;return Te.dateToString(w,z.calendar)},[z]),E=e.useMemo(()=>{if(l===!0&&!o){const w=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:d("Delete"),id:"delete"}];return f?{items:w}:{items:[...w,{comp:"button",type:"primary",text:d("Save"),id:"save"}]}}return l},[l,o,f,d]),[U,L]=e.useState(!1),_=e.useMemo(()=>U?"wx-full-screen":"",[U]),R=e.useCallback(w=>{L(w)},[]);e.useEffect(()=>{const w=xt(R);return w.observe(),()=>{w.disconnect()}},[R]);const G=M.useStore(s,"_activeTask"),g=M.useStore(s,"activeTask"),Z=M.useStore(s,"unscheduledTasks"),K=M.useStore(s,"links"),fe=M.useStore(s,"splitTasks"),H=e.useMemo(()=>fe&&g?.segmentIndex,[fe,g]),ce=e.useMemo(()=>H||H===0,[H]),te=e.useMemo(()=>we.getEditorItems({unscheduledTasks:Z}),[Z]),x=M.useStore(s,"undo"),[v,I]=e.useState({}),[le,ee]=e.useState(null),[ne,ie]=e.useState(),[he,Ee]=e.useState(null),Me=M.useStore(s,"taskTypes"),je=e.useMemo(()=>{if(!G)return null;let w;if(ce&&G.segments?w={...G.segments[H]}:w={...G},o){let re={parent:w.parent};return te.forEach(({key:me,comp:X})=>{if(X!=="links"){const q=w[me];X==="date"&&q instanceof Date?re[me]=h(q):X==="slider"&&me==="progress"?re[me]=`${q}%`:re[me]=q}}),re}return w||null},[G,ce,H,o,te,h]);e.useEffect(()=>{ie(je)},[je]),e.useEffect(()=>{I({}),Ee(null),ee(null)},[g]);function Se(w,re){return w.map(me=>{const X={...me};if(me.config&&(X.config={...X.config}),X.comp==="links"&&s&&(X.api=s,X.autoSave=f,X.onLinksChange=N),X.comp==="select"&&X.key==="type"){const q=X.options??(Me||[]);X.options=q.map(ge=>({...ge,label:d(ge.label)}))}return X.comp==="slider"&&X.key==="progress"&&(X.labelTemplate=q=>`${d(X.label)} ${q}%`),X.label&&(X.label=d(X.label)),X.config?.placeholder&&(X.config.placeholder=d(X.config.placeholder)),re&&(X.isDisabled&&X.isDisabled(re,s.getState())?X.disabled=!0:delete X.disabled),X})}const W=e.useMemo(()=>{let w=n.length?n:te;return w=Se(w,ne),ne?w.filter(re=>!re.isHidden||!re.isHidden(ne,s.getState())):w},[n,te,ne,Me,d,s,f]),b=e.useMemo(()=>W.map(w=>w.key),[W]);function N({id:w,action:re,data:me}){I(X=>({...X,[w]:{action:re,data:me}}))}const Y=e.useCallback(()=>{for(let w in v)if(K.byId(w)){const{action:re,data:me}=v[w];s.exec(re,me)}},[s,v,K]),F=e.useCallback(()=>{const w=g?.id||g;if(ce){if(G?.segments){const re=G.segments.filter((me,X)=>X!==H);s.exec("update-task",{id:w,task:{segments:re}})}}else s.exec("delete-task",{id:w})},[s,g,ce,G,H]),B=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),oe=e.useCallback(w=>{const{item:re,changes:me}=w;re.id==="delete"&&F(),re.id==="save"&&(me.length?B():Y()),re.comp&&B()},[s,g,f,Y,F,B]),ue=e.useCallback((w,re,me)=>(Z&&w.type==="summary"&&(w.unscheduled=!1),we.prepareEditTask(w,s.getState(),re),me||ee(!1),w),[Z,s]),T=e.useCallback(w=>{w={...w,unscheduled:Z&&w.unscheduled&&w.type!=="summary"},delete w.links,delete w.data,(b.indexOf("duration")===-1||w.segments&&!w.duration)&&delete w.duration;const re={id:g?.id||g,task:w,...ce&&{segmentIndex:H}};f&&le&&(re.inProgress=le),s.exec("update-task",re),f||Y()},[s,g,Z,f,Y,b,ce,H,le]),Q=e.useCallback(w=>{let{update:re,key:me,input:X}=w;if(X&&ee(!0),w.update=ue({...re},me,X),!f)ie(w.update);else if(!he&&!X){const q=W.find($e=>$e.key===me),ge=re[me];(!q.validation||q.validation(ge))&&(!q.required||ge)&&T(w.update)}},[f,ue,he,W,T]),ae=e.useCallback(w=>{f||T(w.values)},[f,T]),xe=e.useCallback(w=>{Ee(w.errors)},[]),Re=e.useMemo(()=>x?{"ctrl+z":w=>{w.preventDefault(),s.exec("undo")},"ctrl+y":w=>{w.preventDefault(),s.exec("redo")}}:{},[x,s]);return je?c.jsx(ke.Locale,{children:c.jsx(He.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${_} ${r}`,items:W,values:je,topBar:E,bottomBar:m,placement:j,layout:i,readonly:o,autoSave:f,focus:A,onAction:oe,onSave:ae,onValidation:xe,onChange:Q,hotkeys:k&&{...Re,...k}})}):null}const Zt=({children:s,columns:n=null,api:r})=>{const[i,o]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(o)},[r]),c.jsx(ft.HeaderMenu,{api:i,columns:n,children:s})};function Jt(s){const{api:n,content:r,children:i}=s,o=e.useRef(null),j=e.useRef(null),[m,l]=e.useState({}),[f,A]=e.useState(null),[k,V]=e.useState({});function $(R){for(;R;){if(R.getAttribute){const G=R.getAttribute("data-tooltip-id"),g=R.getAttribute("data-tooltip-at"),Z=R.getAttribute("data-tooltip");if(G||Z)return{id:G,tooltip:Z,target:R,at:g}}R=R.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const R=j.current;if(R&&k&&(k.text||r)){const G=R.getBoundingClientRect();let g=!1,Z=k.left,K=k.top;G.right>=m.right&&(Z=m.width-G.width-5,g=!0),G.bottom>=m.bottom&&(K=k.top-(G.bottom-m.bottom+2),g=!0),g&&V(fe=>fe&&{...fe,left:Z,top:K})}},[k,m,r]);const d=e.useRef(null),z=300,h=R=>{clearTimeout(d.current),d.current=setTimeout(()=>{R()},z)};function E(R){let{id:G,tooltip:g,target:Z,at:K}=$(R.target);if(V(null),A(null),!g)if(G)g=L(G);else{clearTimeout(d.current);return}const fe=R.clientX;h(()=>{G&&A(U(_(G)));const H=Z.getBoundingClientRect(),ce=o.current,te=ce?ce.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let x,v;K==="left"?(x=H.top+5-te.top,v=H.right+5-te.left):(x=H.top+H.height-te.top,v=fe-te.left),l(te),V({top:x,left:v,text:g})})}function U(R){return n?.getTask(_(R))||null}function L(R){return U(R)?.text||""}function _(R){const G=parseInt(R);return isNaN(G)?R:G}return c.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:o,onMouseMove:E,children:[k&&(k.text||r)?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:j,style:{top:`${k.top}px`,left:`${k.left}px`},children:r?c.jsx(r,{data:f}):k.text?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:k.text}):null}):null,i]})}function es({fonts:s=!0,children:n}){return n?c.jsx(ke.Material,{fonts:s,children:n()}):c.jsx(ke.Material,{fonts:s})}function ts({fonts:s=!0,children:n}){return n?c.jsx(ke.Willow,{fonts:s,children:n}):c.jsx(ke.Willow,{fonts:s})}function ss({fonts:s=!0,children:n}){return n?c.jsx(ke.WillowDark,{fonts:s,children:n}):c.jsx(ke.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>we.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>we.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>we.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>we.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>we.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>we.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>we.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>we.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>we.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>He.registerEditorItem});exports.ContextMenu=Bt;exports.Editor=Qt;exports.Gantt=Xt;exports.HeaderMenu=Zt;exports.Material=es;exports.Toolbar=Kt;exports.Tooltip=Jt;exports.Willow=ts;exports.WillowDark=ss;
//# sourceMappingURL=index.cjs.map
