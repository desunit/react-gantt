"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("react/jsx-runtime"),e=require("react"),be=require("@svar-ui/react-core"),Me=require("@svar-ui/lib-dom"),Ke=require("@svar-ui/gantt-locales"),Ue=require("@svar-ui/core-locales"),pt=require("@svar-ui/lib-state"),ge=require("@svar-ui/gantt-store"),v=require("@svar-ui/lib-react"),at=require("@svar-ui/grid-store"),ut=require("@svar-ui/react-grid"),bt=require("react-dom"),ot=require("@svar-ui/react-toolbar"),kt=require("@svar-ui/react-menu"),Ae=require("@svar-ui/react-editor"),We=e.createContext(null);function He(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function yt(s,n,r){const a=s.getBoundingClientRect(),o=n.querySelector(".wx-body").getBoundingClientRect();return{top:a.top-o.top,left:a.left-o.left,dt:a.bottom-r.clientY,db:r.clientY-a.top}}function lt(s){return s&&s.getAttribute("data-context-id")}const ct=5;function Tt(s,n){let r,a,o,D,g,l,x,I,p;function K(b){D=b.clientX,g=b.clientY,l={...yt(r,s,b),y:n.getTask(o).$y},document.body.style.userSelect="none"}function R(b){r=Me.locate(b),lt(r)&&(o=He(r),p=setTimeout(()=>{I=!0,n&&n.touchStart&&n.touchStart(),K(b.touches[0])},500),s.addEventListener("touchmove",L),s.addEventListener("contextmenu",h),window.addEventListener("touchend",A))}function h(b){if(I||p)return b.preventDefault(),!1}function P(b){b.which===1&&(r=Me.locate(b),lt(r)&&(o=He(r),s.addEventListener("mousemove",B),window.addEventListener("mouseup",j),K(b)))}function m(b){s.removeEventListener("mousemove",B),s.removeEventListener("touchmove",L),document.body.removeEventListener("mouseup",j),document.body.removeEventListener("touchend",A),document.body.style.userSelect="",b&&(s.removeEventListener("mousedown",P),s.removeEventListener("touchstart",R))}function E(b){const Q=b.clientX-D,V=b.clientY-g;if(!a){if(Math.abs(Q)<ct&&Math.abs(V)<ct||n&&n.start&&n.start({id:o,e:b})===!1)return;a=r.cloneNode(!0),a.style.pointerEvents="none",a.classList.add("wx-reorder-task"),a.style.position="absolute",a.style.left=l.left+"px",a.style.top=l.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(a,r)}if(a){const ie=Math.round(Math.max(0,l.top+V));if(n&&n.move&&n.move({id:o,top:ie,detail:x})===!1)return;const z=n.getTask(o),le=z.$y;if(!l.start&&l.y==le)return N();l.start=!0,l.y=z.$y-4,a.style.top=ie+"px";const ne=document.elementFromPoint(b.clientX,b.clientY),M=Me.locate(ne);if(M&&M!==r){const u=He(M),Y=M.getBoundingClientRect(),Z=Y.top+Y.height/2,ce=b.clientY+l.db>Z&&M.nextElementSibling!==r,te=b.clientY-l.dt<Z&&M.previousElementSibling!==r;x?.after==u||x?.before==u?x=null:ce?x={id:o,after:u}:te&&(x={id:o,before:u})}}}function B(b){E(b)}function L(b){I?(b.preventDefault(),E(b.touches[0])):p&&(clearTimeout(p),p=null)}function A(){I=null,p&&(clearTimeout(p),p=null),N()}function j(){N()}function N(){r&&(r.style.visibility=""),a&&(a.parentNode.removeChild(a),n&&n.end&&n.end({id:o,top:l.top})),o=r=a=l=x=null,m()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",P),s.addEventListener("touchstart",R),{destroy(){m(!0)}}}function vt({row:s,column:n}){function r(o,D){return{justifyContent:D.align,paddingLeft:`${(o.$level-1)*20}px`}}const a=n&&n._cell;return c.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?c.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):c.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),c.jsx("div",{className:"wx-pqc08MHU wx-text",children:a?c.jsx(a,{row:s,column:n}):s.text})]})}function it({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?c.jsx("div",{style:{textAlign:s.align},children:c.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function Mt(s){const{readonly:n,compactMode:r,width:a=0,display:o="all",columnWidth:D=0,onTableAPIChange:g,multiTaskRows:l=!1,rowMapping:x=null}=s,[I,p]=v.useWritableProp(D),[K,R]=e.useState(),h=e.useContext(be.context.i18n),P=e.useMemo(()=>h.getGroup("gantt"),[h]),m=e.useContext(We),E=v.useStore(m,"scrollTop"),B=v.useStore(m,"cellHeight"),L=v.useStore(m,"_scrollTask"),A=v.useStore(m,"_selected"),j=v.useStore(m,"area"),N=v.useStore(m,"_tasks"),b=v.useStore(m,"_scales"),Q=v.useStore(m,"columns"),V=v.useStore(m,"_sort"),ie=v.useStore(m,"calendar"),z=v.useStore(m,"durationUnit"),le=v.useStore(m,"splitTasks"),[ne,M]=e.useState(null),u=e.useMemo(()=>!N||!j?[]:l&&x?N:N.slice(j.start,j.end),[N,j,l,x]),Y=e.useCallback((i,k)=>{if(k==="add-task")m.exec(k,{target:i,task:{text:P("New Task")},mode:"child",show:!0});else if(k==="open-task"){const S=u.find(H=>H.id===i);(S?.data||S?.lazy)&&m.exec(k,{id:i,mode:!S.open})}},[u]),Z=e.useCallback(i=>{const k=Me.locateID(i),S=i.target.dataset.action;S&&i.preventDefault(),k?S==="add-task"||S==="open-task"?Y(k,S):m.exec("select-task",{id:k,toggle:i.ctrlKey||i.metaKey,range:i.shiftKey,show:!0}):S==="add-task"&&Y(null,S)},[m,Y]),ce=e.useRef(null),te=e.useRef(null),[se,pe]=e.useState(0),[Ce,Le]=e.useState(!1);e.useEffect(()=>{const i=te.current;if(!i||typeof ResizeObserver>"u")return;const k=()=>pe(i.clientWidth);k();const S=new ResizeObserver(k);return S.observe(i),()=>S.disconnect()},[]);const Te=e.useRef(null),Re=e.useCallback(i=>{const k=i.id,{before:S,after:H}=i,we=i.onMove;let de=S||H,Ee=S?"before":"after";if(we){if(Ee==="after"){const Ne=m.getTask(de);Ne.data?.length&&Ne.open&&(Ee="before",de=Ne.data[0].id)}Te.current={id:k,[Ee]:de}}else Te.current=null;m.exec("move-task",{id:k,mode:Ee,target:de,inProgress:we})},[m]),ee=e.useMemo(()=>l&&x?0:j?.from??0,[j,l,x]),f=e.useMemo(()=>b?.height??0,[b]),W=e.useMemo(()=>!r&&o!=="grid"?(I??0)>(a??0):(I??0)>(se??0),[r,o,I,a,se]),_=e.useMemo(()=>{const i={};return W&&o==="all"||o==="grid"&&W?i.width=I:o==="grid"&&(i.width="100%"),i},[W,o,I]),O=e.useMemo(()=>ne&&!u.find(i=>i.id===ne.id)?[...u,ne]:u,[u,ne]),F=e.useMemo(()=>{if(!l||!x)return O;const i=new Map,k=new Set;return O.forEach(S=>{const H=x.taskRows.get(S.id)??S.id;k.has(H)||(i.set(H,{...S,$rowTasks:x.rowMap.get(H)||[S.id]}),k.add(H))}),Array.from(i.values())},[O,l,x]),oe=e.useMemo(()=>{let i=(Q||[]).map(H=>{H={...H};const we=H.header;if(typeof we=="object"){const de=we.text&&P(we.text);H.header={...we,text:de}}else H.header=P(we);return H});const k=i.findIndex(H=>H.id==="text"),S=i.findIndex(H=>H.id==="add-task");if(k!==-1&&(i[k].cell&&(i[k]._cell=i[k].cell),i[k].cell=vt),S!==-1){i[S].cell=i[S].cell||it;const H=i[S].header;if(typeof H!="object"&&(i[S].header={text:H}),i[S].header.cell=H.cell||it,n)i.splice(S,1);else if(r){const[we]=i.splice(S,1);i.unshift(we)}}return i.length>0&&(i[i.length-1].resize=!1),i},[Q,P,n,r]),ue=e.useMemo(()=>o==="all"?`${a}px`:o==="grid"?"calc(100% - 4px)":oe.find(i=>i.id==="add-task")?"50px":"0",[o,a,oe]),y=e.useMemo(()=>{if(F&&V?.length){const i={};return V.forEach(({key:k,order:S},H)=>{i[k]={order:S,...V.length>1&&{index:H}}}),i}return{}},[F,V]),U=e.useCallback(()=>oe.some(i=>i.flexgrow&&!i.hidden),[]),ae=e.useMemo(()=>U(),[U,Ce]),fe=e.useMemo(()=>{let i=o==="chart"?oe.filter(S=>S.id==="add-task"):oe;const k=o==="all"?a:se;if(!ae){let S=I,H=!1;if(oe.some(we=>we.$width)){let we=0;S=oe.reduce((de,Ee)=>(Ee.hidden||(we+=Ee.width,de+=Ee.$width||Ee.width),de),0),we>S&&S>k&&(H=!0)}if(H||S<k){let we=1;return H||(we=(k-50)/(S-50||1)),i.map(de=>(de.id!=="add-task"&&!de.hidden&&(de.$width||(de.$width=de.width),de.width=de.$width*we),de))}}return i},[o,oe,ae,I,a,se]),je=e.useCallback(i=>{if(!U()){const k=fe.reduce((S,H)=>(i&&H.$width&&(H.$width=H.width),S+(H.hidden?0:H.width)),0);k!==I&&p(k)}Le(!0),Le(!1)},[U,fe,I,p]),w=e.useCallback(()=>{oe.filter(k=>k.flexgrow&&!k.hidden).length===1&&oe.forEach(k=>{k.$width&&!k.flexgrow&&!k.hidden&&(k.width=k.$width)})},[]),re=e.useCallback(i=>{if(!n){const k=Me.locateID(i),S=Me.locateAttr(i,"data-col-id");!(S&&oe.find(we=>we.id==S))?.editor&&k&&m.exec("show-editor",{id:k})}},[m,n]),xe=e.useMemo(()=>Array.isArray(A)?A.map(i=>i.id):[],[A]),q=e.useRef(ee);q.current=ee,e.useEffect(()=>{const i=S=>{if(ce.current){const H=ce.current.querySelector(".wx-body");H&&(H.style.top=-((S??0)-(q.current??0))+"px")}te.current&&(te.current.scrollTop=0)};return i(E),m.on("scroll-chart",({top:S})=>{S!==void 0&&i(S)})},[m,E]),e.useEffect(()=>{if(ce.current){const i=ce.current.querySelector(".wx-body");i&&(i.style.top=-((E??0)-(ee??0))+"px")}},[ee]),e.useEffect(()=>{const i=ce.current;if(!i)return;const k=i.querySelector(".wx-table-box .wx-body");if(!k||typeof ResizeObserver>"u")return;const S=new ResizeObserver(()=>{if(ce.current){const H=ce.current.querySelector(".wx-body");H&&(H.style.top=-((E??0)-(q.current??0))+"px")}});return S.observe(k),()=>{S.disconnect()}},[fe,_,o,ue,F,E]),e.useEffect(()=>{if(!L||!K)return;const{id:i}=L,k=K.getState().focusCell;k&&k.row!==i&&ce.current&&ce.current.contains(document.activeElement)&&K.exec("focus-cell",{row:i,column:k.column})},[L,K]);const G=e.useCallback(({id:i})=>{if(n)return!1;m.getTask(i).open&&m.exec("open-task",{id:i,mode:!1});const k=m.getState()._tasks.find(S=>S.id===i);if(M(k||null),!k)return!1},[m,n]),he=e.useCallback(({id:i,top:k})=>{Te.current?Re({...Te.current,onMove:!1}):m.exec("drag-task",{id:i,top:k+(ee??0),inProgress:!1}),M(null)},[m,Re,ee]),ke=e.useCallback(({id:i,top:k,detail:S})=>{S&&Re({...S,onMove:!0}),m.exec("drag-task",{id:i,top:k+(ee??0),inProgress:!0})},[m,Re,ee]);e.useEffect(()=>{const i=ce.current;return i?Tt(i,{start:G,end:he,move:ke,getTask:m.getTask}).destroy:void 0},[m,G,he,ke]);const De=e.useCallback(i=>{const{key:k,isInput:S}=i;if(!S&&(k==="arrowup"||k==="arrowdown"))return i.eventSource="grid",m.exec("hotkey",i),!1;if(k==="enter"){const H=K?.getState().focusCell;if(H){const{row:we,column:de}=H;de==="add-task"?Y(we,"add-task"):de==="text"&&Y(we,"open-task")}}},[m,Y,K]),ye=e.useRef(null),Ie=()=>{ye.current={setTableAPI:R,handleHotkey:De,sortVal:V,api:m,adjustColumns:w,setColumnWidth:je,tasks:u,calendarVal:ie,durationUnitVal:z,splitTasksVal:le,onTableAPIChange:g}};Ie(),e.useEffect(()=>{Ie()},[R,De,V,m,w,je,u,ie,z,le,g]);const ze=e.useCallback(i=>{R(i),i.intercept("hotkey",k=>ye.current.handleHotkey(k)),i.intercept("scroll",()=>!1),i.intercept("select-row",()=>!1),i.intercept("sort-rows",k=>{const S=ye.current.sortVal,{key:H,add:we}=k,de=S?S.find(Ne=>Ne.key===H):null;let Ee="asc";return de&&(Ee=!de||de.order==="asc"?"desc":"asc"),m.exec("sort-tasks",{key:H,order:Ee,add:we}),!1}),i.on("resize-column",()=>{ye.current.setColumnWidth(!0)}),i.on("hide-column",k=>{k.mode||ye.current.adjustColumns(),ye.current.setColumnWidth()}),i.intercept("update-cell",k=>{const{id:S,column:H,value:we}=k,de=ye.current.tasks.find(Ee=>Ee.id===S);if(de){const Ee={...de};let Ne=we;Ne&&!isNaN(Ne)&&!(Ne instanceof Date)&&(Ne*=1),Ee[H]=Ne,ge.prepareEditTask(Ee,{calendar:ye.current.calendarVal,durationUnit:ye.current.durationUnitVal,splitTasks:ye.current.splitTasksVal},H),m.exec("update-task",{id:S,task:Ee})}return!1}),g&&g(i)},[]);return c.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ue}`},ref:te,children:c.jsx("div",{ref:ce,style:_,className:"wx-rHj6070p wx-table",onClick:Z,onDoubleClick:re,children:c.jsx(ut.Grid,{init:ze,sizes:{rowHeight:B,headerHeight:(f??0)-1},rowStyle:i=>i.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:i=>`wx-rHj6070p wx-text-${i.align}${i.id==="add-task"?" wx-action":""}`,data:F,columns:fe,selectedRows:[...xe],sortMarks:y})})})}function St({borders:s=""}){const n=e.useContext(We),r=v.useStore(n,"cellWidth"),a=v.useStore(n,"cellHeight"),o=e.useRef(null),[D,g]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&o.current){const x=getComputedStyle(o.current).getPropertyValue("--wx-gantt-border");g(x?x.substring(x.indexOf("#")):"#1d1e261a")}},[]);const l={width:"100%",height:"100%",background:r!=null&&a!=null?`url(${ge.grid(r,a,D,s)})`:void 0,position:"absolute"};return c.jsx("div",{ref:o,style:l})}function Ct({onSelectLink:s,selectedLink:n,readonly:r}){const a=e.useContext(We),o=v.useStore(a,"_links"),D=v.useStore(a,"criticalPath"),g=e.useRef(null),l=e.useCallback(x=>{const I=x?.target?.classList;!I?.contains("wx-line")&&!I?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&g.current){const x=I=>{g.current&&!g.current.contains(I.target)&&l(I)};return document.addEventListener("click",x),()=>{document.removeEventListener("click",x)}}},[r,n,l]),c.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(o||[]).map(x=>{const I="wx-dkx3NwEn wx-line"+(D&&x.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return c.jsx("polyline",{className:I,points:x.$p,onClick:()=>!r&&s(x.id),"data-link-id":x.id},x.id)}),!r&&n&&c.jsx("polyline",{ref:g,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function Et(s){const{task:n,type:r}=s;function a(D){const g=n.segments[D];return{left:`${g.$x}px`,top:"0px",width:`${g.$w}px`,height:"100%"}}function o(D){if(!n.progress)return 0;const g=n.duration*n.progress/100,l=n.segments;let x=0,I=0,p=null;do{const K=l[I];I===D&&(x>g?p=0:p=Math.min((g-x)/K.duration,1)*100),x+=K.duration,I++}while(p===null&&I<l.length);return p||0}return c.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map((D,g)=>c.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":g,style:a(g),children:[n.progress?c.jsx("div",{className:"wx-progress-wrapper",children:c.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${o(g)}%`}})}):null,c.jsx("div",{className:"wx-content",children:D.text||""})]},g))})}let Xe=[],Ve=null,Fe=null;const Rt=(s,n)=>{if(!n||!n.start)return null;const{start:r,lengthUnitWidth:a,lengthUnit:o}=n,D=864e5,g=o==="week"?7:o==="month"?30:o==="quarter"?91:o==="year"?365:1,l=Math.floor(s/a);return new Date(r.getTime()+l*g*D)};function jt(s){const{readonly:n,taskTemplate:r,multiTaskRows:a=!1,rowMapping:o=null,marqueeSelect:D=!1,copyPaste:g=!1}=s,l=e.useContext(We),[x,I]=v.useStoreWithCounter(l,"_tasks"),[p,K]=v.useStoreWithCounter(l,"_links"),R=v.useStore(l,"area"),h=v.useStore(l,"_scales"),P=v.useStore(l,"taskTypes"),m=v.useStore(l,"baselines"),[E,B]=v.useStoreWithCounter(l,"_selected"),L=v.useStore(l,"_scrollTask"),A=v.useStore(l,"scrollTop"),j=v.useStore(l,"criticalPath"),N=v.useStore(l,"tasks"),b=v.useStore(l,"schedule"),Q=v.useStore(l,"splitTasks"),V=e.useMemo(()=>{if(!R||!Array.isArray(x))return[];const t=R.start??0,d=R.end??0;return a&&o?x.map(T=>({...T})):x.slice(t,d).map(T=>({...T}))},[I,R,a,o]),ie=v.useStore(l,"cellHeight"),z=e.useMemo(()=>{if(!a||!o||!V.length)return V;const t=new Map,d=[];return x.forEach(T=>{const C=o.taskRows.get(T.id)??T.id;t.has(C)||(t.set(C,d.length),d.push(C))}),V.map(T=>{const C=o.taskRows.get(T.id)??T.id,$=t.get(C)??0;return{...T,$y:$*ie,$y_base:T.$y_base!==void 0?$*ie:void 0}})},[V,a,o,x,ie]),le=e.useMemo(()=>h.lengthUnitWidth,[h]),ne=e.useMemo(()=>h.lengthUnit||"day",[h]),M=e.useRef(!1),[u,Y]=e.useState(void 0),[Z,ce]=e.useState(null),te=e.useRef(null),[se,pe]=e.useState(null),[Ce,Le]=e.useState(void 0),Te=e.useRef(null),[Re,ee]=e.useState(0),[f,W]=e.useState(null),[_,O]=e.useState(null),[F,oe]=e.useState(null),ue=e.useRef(null),y=e.useMemo(()=>{const t=ue.current;return!!(E.length&&t&&t.contains(document.activeElement))},[E,ue.current]),U=e.useMemo(()=>y&&E[E.length-1]?.id,[y,E]);e.useEffect(()=>{if(L&&y&&L){const{id:t}=L,d=ue.current?.querySelector(`.wx-bar[data-id='${t}']`);d&&d.focus({preventScroll:!0})}},[L]),e.useEffect(()=>{const t=ue.current;if(t&&(ee(t.offsetWidth||0),typeof ResizeObserver<"u")){const d=new ResizeObserver(T=>{T[0]&&ee(T[0].contentRect.width)});return d.observe(t),()=>d.disconnect()}},[ue.current]);const ae=e.useCallback(()=>{document.body.style.userSelect="none"},[]),fe=e.useCallback(()=>{document.body.style.userSelect=""},[]),je=e.useCallback((t,d,T)=>{if(d.target.classList.contains("wx-line")||(T||(T=l.getTask(He(t))),T.type==="milestone"||T.type==="summary"))return"";const C=Me.locate(d,"data-segment");C&&(t=C);const{left:$,width:X}=t.getBoundingClientRect(),J=(d.clientX-$)/X;let me=.2/(X>200?X/200:1);return J<me?"start":J>1-me?"end":""},[l]),w=e.useMemo(()=>{const t=new Map;if(!a||!o)return x.forEach(C=>{t.set(C.id,C.$y)}),t;const d=new Map,T=[];return x.forEach(C=>{const $=o.taskRows.get(C.id)??C.id;d.has($)||(d.set($,T.length),T.push($))}),x.forEach(C=>{const $=o.taskRows.get(C.id)??C.id,X=d.get($)??0;t.set(C.id,X*ie)}),t},[x,a,o,ie]),re=e.useCallback(t=>{const d=ue.current;if(!d)return[];const C=d.parentElement?.parentElement?.scrollLeft||0,$=a&&o?0:A||0,X=Math.min(t.startX,t.currentX),J=Math.max(t.startX,t.currentX),me=Math.min(t.startY,t.currentY),ve=Math.max(t.startY,t.currentY);return x.filter(Se=>{const Pe=Se.$x-C,Ge=Se.$x+Se.$w-C,$e=(w.get(Se.id)??Se.$y)-$,Oe=$e+Se.$h;return Pe<J&&Ge>X&&$e<ve&&Oe>me})},[x,w,a,o,A]),xe=e.useMemo(()=>new Set(E.map(t=>t.id)),[E,B]),q=e.useCallback(t=>xe.has(t),[xe]),G=e.useCallback((t,d)=>{const{clientX:T}=d,C=He(t),$=l.getTask(C),X=d.target.classList;if(!d.target.closest(".wx-delete-button")&&!n){if(X.contains("wx-progress-marker")){const{progress:J}=l.getTask(C);te.current={id:C,x:T,progress:J,dx:0,node:t,marker:d.target},d.target.classList.add("wx-progress-in-drag")}else{const J=je(t,d,$)||"move",me={id:C,mode:J,x:T,dx:0,l:$.$x,w:$.$w};if(Q&&$.segments?.length){const ve=Me.locate(d,"data-segment");ve&&(me.segmentIndex=ve.dataset.segment*1,ge.extendDragOptions($,me))}ce(me)}ae()}},[l,n,je,ae,Q]),he=e.useCallback(t=>{if(t.button!==0)return;const d=Me.locate(t);if(!d&&D&&!n){const T=ue.current;if(!T)return;const C=T.getBoundingClientRect(),$=t.clientX-C.left,X=t.clientY-C.top;if(g){const me=T.parentElement?.parentElement?.scrollLeft||0,ve=$+me,Se=Rt(ve,h);Se&&oe(Se)}W({startX:$,startY:X,currentX:$,currentY:X,ctrlKey:t.ctrlKey||t.metaKey}),ae();return}if(d){if(D&&!n&&E.length>1){const T=He(d);if(q(T)){const C=t.target.classList;if(!C.contains("wx-link")&&!C.contains("wx-progress-marker")&&!t.target.closest(".wx-delete-button")){const $=l.getTask(T);if(!je(d,t,$)){const J=new Map;E.forEach(me=>{const ve=l.getTask(me.id);if(ve){if(b?.auto&&ve.type==="summary")return;J.set(me.id,{$x:ve.$x,$w:ve.$w,start:ve.start,end:ve.end})}}),O({baseTaskId:T,startX:t.clientX,dx:0,originalPositions:J}),ae();return}}}}G(d,t)}},[G,D,g,n,E,q,l,je,b,ae,h]),ke=e.useCallback(t=>{const d=Me.locate(t);d&&(Te.current=setTimeout(()=>{Le(!0),G(d,t.touches[0])},300))},[G]),De=e.useCallback(t=>{pe(t&&{...p.find(d=>d.id===t)})},[p]),ye=e.useCallback(()=>{if(f){const t=re(f);f.ctrlKey?t.forEach(d=>{l.exec("select-task",{id:d.id,toggle:!0,marquee:!0})}):(E.length>0&&l.exec("select-task",{id:null,marquee:!0}),t.forEach((d,T)=>{l.exec("select-task",{id:d.id,toggle:T>0,marquee:!0})})),W(null),fe(),M.current=!0;return}if(_){const{dx:t,originalPositions:d}=_,T=Math.round(t/le);if(T!==0){let C=!0;d.forEach(($,X)=>{const J=l.getTask(X);J&&(l.exec("update-task",{id:X,diff:T,task:{start:J.start,end:J.end},skipUndo:!C}),C=!1)}),M.current=!0}else d.forEach((C,$)=>{l.exec("drag-task",{id:$,left:C.$x,width:C.$w,inProgress:!1})});O(null),fe();return}if(te.current){const{dx:t,id:d,marker:T,value:C}=te.current;te.current=null,typeof C<"u"&&t&&l.exec("update-task",{id:d,task:{progress:C},inProgress:!1}),T.classList.remove("wx-progress-in-drag"),M.current=!0,fe()}else if(Z){const{id:t,mode:d,dx:T,l:C,w:$,start:X,segment:J,index:me}=Z;if(ce(null),X){const ve=Math.round(T/le);if(!ve)l.exec("drag-task",{id:t,width:$,left:C,inProgress:!1,...J&&{segmentIndex:me}});else{let Se={},Pe=l.getTask(t);J&&(Pe=Pe.segments[me]);const Ge=1440*60*1e3,$e=ve*(ne==="week"?7:ne==="month"?30:ne==="quarter"?91:ne==="year"?365:1)*Ge;d==="move"?(Se.start=new Date(Pe.start.getTime()+$e),Se.end=new Date(Pe.end.getTime()+$e)):d==="start"?(Se.start=new Date(Pe.start.getTime()+$e),Se.end=Pe.end):d==="end"&&(Se.start=Pe.start,Se.end=new Date(Pe.end.getTime()+$e)),l.exec("update-task",{id:t,task:Se,...J&&{segmentIndex:me}})}M.current=!0}fe()}},[l,fe,Z,le,ne,f,_,re,E]),Ie=e.useCallback((t,d)=>{const{clientX:T,clientY:C}=d;if(!n){if(f){const $=ue.current;if(!$)return;const X=$.getBoundingClientRect(),J=T-X.left,me=C-X.top;W(ve=>({...ve,currentX:J,currentY:me}));return}if(_){const $=T-_.startX;_.originalPositions.forEach((X,J)=>{const me=X.$x+$;l.exec("drag-task",{id:J,left:me,width:X.$w,inProgress:!0})}),O(X=>({...X,dx:$}));return}if(te.current){const{node:$,x:X,id:J}=te.current,me=te.current.dx=T-X,ve=Math.round(me/$.offsetWidth*100);let Se=te.current.progress+ve;te.current.value=Se=Math.min(Math.max(0,Se),100),l.exec("update-task",{id:J,task:{progress:Se},inProgress:!0})}else if(Z){De(null);const{mode:$,l:X,w:J,x:me,id:ve,start:Se,segment:Pe,index:Ge}=Z,_e=l.getTask(ve),$e=T-me;if(!Se&&Math.abs($e)<20||$==="start"&&J-$e<le||$==="end"&&J+$e<le||$==="move"&&($e<0&&X+$e<0||$e>0&&X+J+$e>Re)||Z.segment&&!ge.isSegmentMoveAllowed(_e,Z))return;const Oe={...Z,dx:$e};let qe,Ye;if($==="start"?(qe=X+$e,Ye=J-$e):$==="end"?(qe=X,Ye=J+$e):$==="move"&&(qe=X+$e,Ye=J),l.exec("drag-task",{id:ve,width:Ye,left:qe,inProgress:!0,...Pe&&{segmentIndex:Ge}}),!Oe.start&&($==="move"&&_e.$x==X||$!=="move"&&_e.$w==J)){M.current=!0,ye();return}Oe.start=!0,ce(Oe)}else{const $=Me.locate(t);if($){const X=l.getTask(He($)),me=Me.locate(t,"data-segment")||$,ve=je(me,d,X);me.style.cursor=ve&&!n?"col-resize":"pointer"}}}},[l,n,Z,le,Re,je,De,ye,f,_]),ze=e.useCallback(t=>{Ie(t,t)},[Ie]),i=e.useCallback(t=>{Ce?(t.preventDefault(),Ie(t,t.touches[0])):Te.current&&(clearTimeout(Te.current),Te.current=null)},[Ce,Ie]),k=e.useCallback(()=>{ye()},[ye]),S=e.useCallback(()=>{Le(null),Te.current&&(clearTimeout(Te.current),Te.current=null),ye()},[ye]);e.useEffect(()=>(window.addEventListener("mouseup",k),()=>{window.removeEventListener("mouseup",k)}),[k]);const H=e.useCallback(t=>{if(!n){const d=Me.locateID(t.target);if(d&&!t.target.classList.contains("wx-link")){const T=Me.locateID(t.target,"data-segment");l.exec("show-editor",{id:d,...T!==null&&{segmentIndex:T}})}}},[l,n]),we=["e2s","s2s","e2e","s2e"],de=e.useCallback((t,d)=>we[(t?1:0)+(d?0:2)],[]),Ee=e.useCallback((t,d)=>{const T=u.id,C=u.start;return t===T?!0:!!p.find($=>$.target==t&&$.source==T&&$.type===de(C,d))},[u,K,de]),Ne=e.useCallback(()=>{u&&Y(null)},[u]),xt=e.useCallback(t=>{if(M.current){M.current=!1;return}const d=Me.locateID(t.target);if(d){const T=t.target.classList;if(T.contains("wx-link")){const C=T.contains("wx-left");if(!u){Y({id:d,start:C});return}u.id!==d&&!Ee(d,C)&&l.exec("add-link",{link:{source:u.id,target:d,type:de(u.start,C)}})}else if(T.contains("wx-delete-button-icon"))l.exec("delete-link",{id:se.id}),pe(null);else{let C;const $=Me.locate(t,"data-segment");$&&(C=$.dataset.segment*1),l.exec("select-task",{id:d,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:C})}}Ne()},[l,u,K,se,Ee,de,Ne]),mt=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),ht=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),gt=e.useCallback(t=>{if(Ce||Te.current)return t.preventDefault(),!1},[Ce]),Qe=e.useMemo(()=>P.map(t=>t.id),[P]),Ze=e.useCallback(t=>{let d=Qe.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(d=`task ${d}`),d},[Qe]),Je=e.useCallback(t=>{l.exec(t.action,t.data)},[l]),Be=e.useCallback(t=>j&&N.byId(t).$critical,[j,N]),et=e.useCallback(t=>{if(b?.auto){const d=N.getSummaryId(t,!0),T=N.getSummaryId(u.id,!0);return u?.id&&!(Array.isArray(d)?d:[d]).includes(u.id)&&!(Array.isArray(T)?T:[T]).includes(t)}return u},[b,N,u]),tt=e.useRef(null);tt.current=F;const st=e.useCallback(()=>{const t=l.getState()._selected;if(!t||!t.length)return;const d=t.map(X=>{const J=l.getTask(X.id);if(!J)return null;const{$x:me,$y:ve,$w:Se,$h:Pe,$skip:Ge,$level:_e,$index:$e,$y_base:Oe,$x_base:qe,$w_base:Ye,$h_base:ts,$skip_baseline:ss,$critical:ns,$reorder:rs,...wt}=J;return wt}).filter(Boolean);if(!d.length)return;const C=d[0].parent,$=d.filter(X=>X.parent===C);$.length!==0&&(Xe=$,Fe=C,Ve=Xe.reduce((X,J)=>J.start&&(!X||J.start<X)?J.start:X,null))},[l]),nt=e.useCallback(()=>{const t=tt.current;if(!Xe.length||!t||!Ve||Fe==null)return;const d=t.getTime()-Ve.getTime(),T=l.getHistory();T?.startBatch(),Xe.forEach((C,$)=>{const X=`task-${Date.now()}-${$}`,J=C.start?new Date(C.start.getTime()+d):null,me=C.end?new Date(C.end.getTime()+d):null;l.exec("add-task",{task:{...C,id:X,start:J,end:me,parent:Fe,row:C.row},target:Fe,mode:"child",skipUndo:$>0})}),T?.endBatch()},[l]);e.useEffect(()=>g?l.intercept("hotkey",d=>{if(d.key==="ctrl+c"||d.key==="meta+c")return st(),!1;if(d.key==="ctrl+v"||d.key==="meta+v")return nt(),!1}):void 0,[g,l,st,nt]);const rt=e.useMemo(()=>{if(!f)return null;const t=Math.min(f.startX,f.currentX),d=Math.min(f.startY,f.currentY),T=Math.abs(f.currentX-f.startX),C=Math.abs(f.currentY-f.startY);return{left:`${t}px`,top:`${d}px`,width:`${T}px`,height:`${C}px`}},[f]);return c.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${z.length?z[0].$h:0}px`},ref:ue,onContextMenu:gt,onMouseDown:he,onMouseMove:ze,onTouchStart:ke,onTouchMove:i,onTouchEnd:S,onClick:xt,onDoubleClick:H,onDragStart:t=>(t.preventDefault(),!1),children:[c.jsx(Ct,{onSelectLink:De,selectedLink:se,readonly:n}),z.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const d=`wx-bar wx-${Ze(t.type)}`+(Ce&&Z&&t.id===Z.id?" wx-touch":"")+(u&&u.id===t.id?" wx-selected":"")+(xe.has(t.id)?" wx-selected":"")+(Be(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(Q&&t.segments?" wx-split":""),T="wx-link wx-left"+(u?" wx-visible":"")+(!u||!Ee(t.id,!0)&&et(t.id)?" wx-target":"")+(u&&u.id===t.id&&u.start?" wx-selected":"")+(Be(t.id)?" wx-critical":""),C="wx-link wx-right"+(u?" wx-visible":"")+(!u||!Ee(t.id,!1)&&et(t.id)?" wx-target":"")+(u&&u.id===t.id&&!u.start?" wx-selected":"")+(Be(t.id)?" wx-critical":"");return c.jsxs(e.Fragment,{children:[!t.$skip&&c.jsxs("div",{className:"wx-GKbcLEGA "+d,style:mt(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:U===t.id?0:-1,children:[n?null:t.id===se?.target&&se?.type[2]==="s"?c.jsx(be.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+T,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?c.jsxs(c.Fragment,{children:[t.progress&&!(Q&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:c.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(Q&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?c.jsx(r,{data:t,api:l,onAction:Je}):Q&&t.segments?c.jsx(Et,{task:t,type:Ze(t.type)}):c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?c.jsx(r,{data:t,api:l,onAction:Je}):c.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===se?.target&&se?.type[2]==="e"?c.jsx(be.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+C,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),m&&!t.$skip_baseline?c.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:ht(t)}):null]},t.id)}),f&&rt&&c.jsx("div",{className:"wx-GKbcLEGA wx-marquee-selection",style:rt})]})}function $t(s){const{highlightTime:n}=s,r=e.useContext(We),a=v.useStore(r,"_scales");return c.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:a.width},children:(a?.rows||[]).map((o,D)=>c.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${o.height}px`},children:(o.cells||[]).map((g,l)=>{const x=n?n(g.date,g.unit):"",I="wx-cell "+(g.css||"")+" "+(x||""),p=typeof g.value=="string"&&g.value.includes("<");return c.jsx("div",{className:"wx-ZkvhDKir "+I,style:{width:`${g.width}px`},...p?{dangerouslySetInnerHTML:{__html:g.value}}:{children:g.value}},l)})},D))})}const Dt=new Map;function Lt(s){const n=e.useRef(null),r=e.useRef(0),a=e.useRef(null),o=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(o)return cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{const D={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};Dt.set(s,D),window.dispatchEvent(new CustomEvent("render-metric",{detail:D}))}),()=>cancelAnimationFrame(a.current)})}function It(s){const{readonly:n,fullWidth:r,fullHeight:a,taskTemplate:o,cellBorders:D,highlightTime:g,multiTaskRows:l=!1,rowMapping:x=null,marqueeSelect:I=!1,copyPaste:p=!1,scrollToCurrentWeek:K=!1,currentWeekColor:R=null}=s,h=e.useContext(We),[P,m]=v.useStoreWithCounter(h,"_selected"),E=v.useStore(h,"scrollTop"),B=v.useStore(h,"cellHeight"),L=v.useStore(h,"cellWidth"),A=v.useStore(h,"_scales"),j=v.useStore(h,"_markers"),N=v.useStore(h,"_scrollTask"),b=v.useStore(h,"zoom"),Q=v.useStore(h,"_tasks"),[V,ie]=e.useState(),z=e.useRef(null),le=e.useRef(0),ne=e.useRef(!1),M=1+(A?.rows?.length||0),u=e.useMemo(()=>{if(!l||!x||!Q?.length)return null;const f=new Map,W=new Map,_=[];return Q.forEach(O=>{const F=x.taskRows.get(O.id)??O.id;W.has(F)||(W.set(F,_.length),_.push(F))}),Q.forEach(O=>{const F=x.taskRows.get(O.id)??O.id,oe=W.get(F)??0;f.set(O.id,oe*B)}),f},[Q,l,x,B]),Y=e.useMemo(()=>{const f=[];return P&&P.length&&B&&P.forEach(W=>{const _=u?.get(W.id)??W.$y;f.push({height:`${B}px`,top:`${_-3}px`})}),f},[m,B,u]),Z=e.useMemo(()=>Math.max(V||0,a),[V,a]);e.useEffect(()=>{const f=z.current;f&&typeof E=="number"&&(f.scrollTop=E)},[E]);const ce=()=>{te()};function te(f){const W=z.current;if(!W)return;const _={};_.left=W.scrollLeft,h.exec("scroll-chart",_)}function se(){const f=z.current,_=Math.ceil((V||0)/(B||1))+1,O=Math.floor((f&&f.scrollTop||0)/(B||1)),F=Math.max(0,O-M),oe=O+_+M,ue=F*(B||0);h.exec("render-data",{start:F,end:oe,from:ue})}e.useEffect(()=>{se()},[V,E]);const pe=e.useCallback(f=>{if(!f)return;const{id:W,mode:_}=f;if(_.toString().indexOf("x")<0)return;const O=z.current;if(!O)return;const{clientWidth:F}=O,oe=h.getTask(W);if(oe.$x+oe.$w<O.scrollLeft)h.exec("scroll-chart",{left:oe.$x-(L||0)}),O.scrollLeft=oe.$x-(L||0);else if(oe.$x>=F+O.scrollLeft){const ue=F<oe.$w?L||0:oe.$w;h.exec("scroll-chart",{left:oe.$x-F+ue}),O.scrollLeft=oe.$x-F+ue}},[h,L]);e.useEffect(()=>{pe(N)},[N]);function Ce(f){if(b&&(f.ctrlKey||f.metaKey)){f.preventDefault();const W=z.current,_=f.clientX-(W?W.getBoundingClientRect().left:0);if(le.current+=f.deltaY,Math.abs(le.current)>=150){const F=-Math.sign(le.current);le.current=0,h.exec("zoom-scale",{dir:F,offset:_})}}}const Le=e.useCallback(f=>{const W=g(f.date,f.unit);return W?{css:W,width:f.width}:null},[g]),Te=e.useMemo(()=>{if(!A||!g||!["hour","day","week"].includes(A.minUnit))return null;let W=0;return A.rows[A.rows.length-1].cells.map(_=>{const O=Le(_),F=W;return W+=_.width,O?{...O,left:F}:null})},[A,g,Le]),Re=e.useCallback(f=>{f.eventSource="chart",h.exec("hotkey",f)},[h]);e.useEffect(()=>{const f=z.current;if(!f)return;const W=()=>ie(f.clientHeight);W();const _=new ResizeObserver(()=>W());return _.observe(f),()=>{_.disconnect()}},[z.current]);const ee=e.useRef(null);return e.useEffect(()=>{const f=z.current;if(f&&!ee.current)return ee.current=at.hotkeys(f,{keys:{arrowup:!0,arrowdown:!0},exec:W=>Re(W)}),()=>{ee.current?.destroy(),ee.current=null}},[]),e.useEffect(()=>{const f=z.current;if(!f)return;const W=Ce;return f.addEventListener("wheel",W),()=>{f.removeEventListener("wheel",W)}},[Ce]),e.useEffect(()=>{if(!K||ne.current||!A||!z.current||!V)return;const f=z.current,{clientWidth:W}=f,_=new Date,O=A.rows[A.rows.length-1]?.cells;if(!O)return;let F=-1,oe=0;const ue=[];for(let U=0;U<O.length;U++){const ae=O[U];ue.push({left:oe,width:ae.width});const fe=ae.date;if(ae.unit==="week"){const je=new Date(fe);je.setDate(je.getDate()+7),_>=fe&&_<je&&(F=U)}else ae.unit==="day"&&_.getFullYear()===fe.getFullYear()&&_.getMonth()===fe.getMonth()&&_.getDate()===fe.getDate()&&(F=U);oe+=ae.width}let y=F;if(F>0&&(y=F-1),y>=0&&ue[y]){const U=ue[y],ae=Math.max(0,U.left);f.scrollLeft=ae,h.exec("scroll-chart",{left:ae}),ne.current=!0}},[K,A,V,h]),Lt("chart"),c.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:z,onScroll:ce,children:[c.jsx($t,{highlightTime:g,scales:A}),j&&j.length?c.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${Z}px`},children:j.map((f,W)=>c.jsx("div",{className:`wx-mR7v2Xag wx-marker ${f.css||""}`,style:{left:`${f.left}px`},children:c.jsx("div",{className:"wx-mR7v2Xag wx-content",children:f.text})},W))}):null,c.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${Z}px`},children:[Te?c.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:Te.map((f,W)=>f?c.jsx("div",{className:"wx-mR7v2Xag "+f.css,style:{width:`${f.width}px`,left:`${f.left}px`}},W):null)}):null,c.jsx(St,{borders:D}),P&&P.length?P.map((f,W)=>f.$y?c.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":f.id,style:Y[W]},f.id):null):null,c.jsx(jt,{readonly:n,taskTemplate:o,multiTaskRows:l,rowMapping:x,marqueeSelect:I,copyPaste:p})]})]})}function Nt(s){const{position:n="after",size:r=4,dir:a="x",onMove:o,onDisplayChange:D,compactMode:g,containerWidth:l=0,leftThreshold:x=50,rightThreshold:I=50}=s,[p,K]=v.useWritableProp(s.value??0),[R,h]=v.useWritableProp(s.display??"all");function P(te){let se=0;n=="center"?se=r/2:n=="before"&&(se=r);const pe={size:[r+"px","auto"],p:[te-se+"px","0px"],p2:["auto","0px"]};if(a!="x")for(let Ce in pe)pe[Ce]=pe[Ce].reverse();return pe}const[m,E]=e.useState(!1),[B,L]=e.useState(null),A=e.useRef(0),j=e.useRef(),N=e.useRef(),b=e.useRef(R);e.useEffect(()=>{b.current=R},[R]),e.useEffect(()=>{B===null&&p>0&&L(p)},[B,p]);function Q(te){return a=="x"?te.clientX:te.clientY}const V=e.useCallback(te=>{const se=j.current+Q(te)-A.current;K(se);let pe;se<=x?pe="chart":l-se<=I?pe="grid":pe="all",b.current!==pe&&(h(pe),b.current=pe),N.current&&clearTimeout(N.current),N.current=setTimeout(()=>o&&o(se),100)},[l,x,I,o]),ie=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",E(!1),window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",ie)},[V]),z=e.useMemo(()=>R!=="all"?"auto":a=="x"?"ew-resize":"ns-resize",[R,a]),le=e.useCallback(te=>{!g&&(R==="grid"||R==="chart")||(A.current=Q(te),j.current=p,E(!0),document.body.style.cursor=z,document.body.style.userSelect="none",window.addEventListener("mousemove",V),window.addEventListener("mouseup",ie))},[z,V,ie,p,g,R]);function ne(){h("all"),B!==null&&(K(B),o&&o(B))}function M(te){if(g){const se=R==="chart"?"grid":"chart";h(se),D(se)}else if(R==="grid"||R==="chart")ne(),D("all");else{const se=te==="left"?"chart":"grid";h(se),D(se)}}function u(){M("left")}function Y(){M("right")}const Z=e.useMemo(()=>P(p),[p,n,r,a]),ce=["wx-resizer",`wx-resizer-${a}`,`wx-resizer-display-${R}`,m?"wx-resizer-active":""].filter(Boolean).join(" ");return c.jsxs("div",{className:"wx-pFykzMlT "+ce,onMouseDown:le,style:{width:Z.size[0],height:Z.size[1],cursor:z},children:[c.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:u})}),c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:Y})})]}),c.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const Pt=650;function dt(s){let n;function r(){n=new ResizeObserver(o=>{for(let D of o)if(D.target===document.body){let g=D.contentRect.width<=Pt;s(g)}}),n.observe(document.body)}function a(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:a}}function At(s){const{taskTemplate:n,readonly:r,cellBorders:a,highlightTime:o,onTableAPIChange:D,multiTaskRows:g=!1,rowMapping:l=null,marqueeSelect:x=!1,copyPaste:I=!1,scrollToCurrentWeek:p=!1,currentWeekColor:K=null}=s,R=e.useContext(We),h=v.useStore(R,"_tasks"),P=v.useStore(R,"_scales"),m=v.useStore(R,"cellHeight"),E=v.useStore(R,"columns"),B=v.useStore(R,"_scrollTask"),L=v.useStore(R,"undo"),A=e.useMemo(()=>{if(!g)return l;const y=new Map,U=new Map;return h.forEach(ae=>{const fe=ae.row??ae.id;U.set(ae.id,fe),y.has(fe)||y.set(fe,[]),y.get(fe).push(ae.id)}),{rowMap:y,taskRows:U}},[h,g,l]),[j,N]=e.useState(!1);let[b,Q]=e.useState(0);const[V,ie]=e.useState(0),[z,le]=e.useState(0),[ne,M]=e.useState(void 0),[u,Y]=e.useState("all"),Z=e.useRef(null),ce=e.useCallback(y=>{N(U=>(y!==U&&(y?(Z.current=u,u==="all"&&Y("grid")):(!Z.current||Z.current==="all")&&Y("all")),y))},[u]);e.useEffect(()=>{const y=dt(ce);return y.observe(),()=>{y.disconnect()}},[ce]);const te=e.useMemo(()=>{let y;return E.every(U=>U.width&&!U.flexgrow)?y=E.reduce((U,ae)=>U+parseInt(ae.width),0):j&&u==="chart"?y=parseInt(E.find(U=>U.id==="action")?.width)||50:y=440,b=y,y},[E,j,u]);e.useEffect(()=>{Q(te)},[te]);const se=e.useMemo(()=>(V??0)-(ne??0),[V,ne]),pe=e.useMemo(()=>P.width,[P]),Ce=e.useMemo(()=>{if(!g||!A)return h.length*m;const y=new Set;return h.forEach(U=>{const ae=A.taskRows.get(U.id)??U.id;y.add(ae)}),y.size*m},[h,m,g,A]),Le=e.useMemo(()=>P.height+Ce+se,[P,Ce,se]),Te=e.useMemo(()=>b+pe,[b,pe]),Re=e.useRef(null),ee=e.useCallback(()=>{Promise.resolve().then(()=>{if((V??0)>(Te??0)){const y=(V??0)-b;R.exec("expand-scale",{minWidth:y})}})},[V,Te,b,R]);e.useEffect(()=>{let y;return Re.current&&(y=new ResizeObserver(ee),y.observe(Re.current)),()=>{y&&y.disconnect()}},[Re.current,ee]),e.useEffect(()=>{ee()},[pe]);const f=e.useRef(null),W=e.useRef(null),_=e.useCallback(()=>{const y=f.current;y&&R.exec("scroll-chart",{top:y.scrollTop})},[R]),O=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{O.current={rTasks:h,rScales:P,rCellHeight:m,scrollSize:se,ganttDiv:f.current,ganttHeight:z??0}},[h,P,m,se,z]);const F=e.useCallback(y=>{if(!y)return;const{rTasks:U,rScales:ae,rCellHeight:fe,scrollSize:je,ganttDiv:w,ganttHeight:re}=O.current;if(!w)return;const{id:xe}=y,q=U.findIndex(G=>G.id===xe);if(q>-1){const G=re-ae.height,he=q*fe,ke=w.scrollTop;let De=null;he<ke?De=he:he+fe>ke+G&&(De=he-G+fe+je),De!==null&&(R.exec("scroll-chart",{top:Math.max(De,0)}),f.current.scrollTop=Math.max(De,0))}},[R]);e.useEffect(()=>{F(B)},[B]),e.useEffect(()=>{const y=f.current,U=W.current;if(!y||!U)return;const ae=()=>{bt.flushSync(()=>{le(y.offsetHeight),ie(y.offsetWidth),M(U.offsetWidth)})},fe=new ResizeObserver(ae);return fe.observe(y),()=>fe.disconnect()},[f.current]);const oe=e.useRef(null),ue=e.useRef(null);return e.useEffect(()=>{ue.current&&(ue.current.destroy(),ue.current=null);const y=oe.current;if(y)return ue.current=at.hotkeys(y,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,"meta+c":!0,"meta+v":!0,"meta+x":!0,"meta+d":!0,backspace:!0,"ctrl+z":L,"ctrl+y":L,"meta+z":L,"meta+shift+z":L},exec:U=>{U.isInput||R.exec("hotkey",U)}}),()=>{ue.current?.destroy(),ue.current=null}},[L]),c.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:f,onScroll:_,children:c.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:Le,width:"100%"},ref:W,children:c.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:z,width:ne},children:c.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:oe,children:[E.length?c.jsxs(c.Fragment,{children:[c.jsx(Mt,{display:u,compactMode:j,columnWidth:te,width:b,readonly:r,fullHeight:Ce,onTableAPIChange:D,multiTaskRows:g,rowMapping:A}),c.jsx(Nt,{value:b,display:u,compactMode:j,containerWidth:V,onMove:y=>Q(y),onDisplayChange:y=>Y(y)})]}):null,c.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:Re,children:c.jsx(It,{readonly:r,fullWidth:pe,fullHeight:Ce,taskTemplate:n,cellBorders:a,highlightTime:o,multiTaskRows:g,rowMapping:A,marqueeSelect:x,copyPaste:I,scrollToCurrentWeek:p,currentWeekColor:K})})]})})})})}function Wt(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function Ht(s,n){return typeof s=="function"?s:Me.dateToString(s,n)}function ft(s,n){return s.map(({format:r,...a})=>({...a,format:Ht(r,n)}))}function zt(s,n){const r=Wt(n);for(let a in r)r[a]=Me.dateToString(r[a],s);return r}function Gt(s,n){if(!s||!s.length)return s;const r=Me.dateToString("%d-%m-%Y",n);return s.map(a=>a.template?a:a.id==="start"||a.id=="end"?{...a,_template:o=>r(o),template:o=>r(o)}:a.id==="duration"?{...a,_template:o=>o,template:o=>o}:a)}function _t(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:ft(r.scales,n)}))}:s}const Ot=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),qt=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],Yt=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:a=ge.defaultTaskTypes,tasks:o=[],selected:D=[],activeTask:g=null,links:l=[],scales:x=qt,columns:I=ge.defaultColumns,start:p=null,end:K=null,lengthUnit:R="day",durationUnit:h="day",cellWidth:P=100,cellHeight:m=38,scaleHeight:E=36,readonly:B=!1,cellBorders:L="full",zoom:A=!1,baselines:j=!1,highlightTime:N=null,init:b=null,autoScale:Q=!0,unscheduledTasks:V=!1,criticalPath:ie=null,schedule:z={type:"forward"},projectStart:le=null,projectEnd:ne=null,calendar:M=null,undo:u=!1,splitTasks:Y=!1,multiTaskRows:Z=!1,marqueeSelect:ce=!1,copyPaste:te=!1,currentWeekHighlight:se=!1,currentWeekColor:pe=null,scrollToCurrentWeek:Ce=!1,...Le},Te){const Re=e.useRef();Re.current=Le;const ee=e.useMemo(()=>new ge.DataStore(v.writable),[]),f=e.useMemo(()=>({...Ue.en,...Ke.en}),[]),W=e.useContext(be.context.i18n),_=e.useMemo(()=>W?W.extend(f,!0):Me.locale(f),[W,f]),O=e.useMemo(()=>_.getRaw().calendar,[_]),F=e.useMemo(()=>{let G={zoom:_t(A,O),scales:ft(x,O),columns:Gt(I,O),links:ge.normalizeLinks(l),cellWidth:P};return G.zoom&&(G={...G,...ge.normalizeZoom(G.zoom,zt(O,_.getGroup("gantt")),G.scales,P)}),G},[A,x,I,l,P,O,_]),oe=e.useRef(null);oe.current!==o&&(ge.parseTaskDates(o,{durationUnit:h,splitTasks:Y,calendar:M}),oe.current=o),e.useEffect(()=>{ge.parseTaskDates(o,{durationUnit:h,splitTasks:Y,calendar:M})},[o,h,M,Y]);const ue=e.useMemo(()=>{if(!Z)return null;const G=new Map,he=new Map,ke=De=>{De.forEach(ye=>{const Ie=ye.row??ye.id;he.set(ye.id,Ie),G.has(Ie)||G.set(Ie,[]),G.get(Ie).push(ye.id),ye.data&&ye.data.length>0&&ke(ye.data)})};return ke(o),{rowMap:G,taskRows:he}},[o,Z]),y=e.useMemo(()=>ee.in,[ee]),U=e.useRef(null);U.current===null&&(U.current=new pt.EventBusRouter((G,he)=>{const ke="on"+Ot(G);Re.current&&Re.current[ke]&&Re.current[ke](he)}),y.setNext(U.current));const[ae,fe]=e.useState(null),je=e.useRef(null);je.current=ae;const w=e.useMemo(()=>({getState:ee.getState.bind(ee),getReactiveState:ee.getReactive.bind(ee),getStores:()=>({data:ee}),exec:y.exec,setNext:G=>(U.current=U.current.setNext(G),U.current),intercept:y.intercept.bind(y),on:y.on.bind(y),detach:y.detach.bind(y),getTask:ee.getTask.bind(ee),serialize:ee.serialize.bind(ee),getTable:G=>G?new Promise(he=>setTimeout(()=>he(je.current),1)):je.current,getHistory:()=>ee.getHistory()}),[ee,y]);e.useImperativeHandle(Te,()=>({...w}),[w]);const re=e.useRef(0);e.useEffect(()=>{re.current?ee.init({tasks:o,links:F.links,start:p,columns:F.columns,end:K,lengthUnit:R,cellWidth:F.cellWidth,cellHeight:m,scaleHeight:E,scales:F.scales,taskTypes:a,zoom:F.zoom,selected:D,activeTask:g,baselines:j,autoScale:Q,unscheduledTasks:V,markers:r,durationUnit:h,criticalPath:ie,schedule:z,projectStart:le,projectEnd:ne,calendar:M,undo:u,_weekStart:O.weekStart,splitTasks:Y}):b&&b(w),re.current++},[w,b,o,F,p,K,R,m,E,a,D,g,j,Q,V,r,h,ie,z,le,ne,M,u,O,Y,ee]),re.current===0&&ee.init({tasks:o,links:F.links,start:p,columns:F.columns,end:K,lengthUnit:R,cellWidth:F.cellWidth,cellHeight:m,scaleHeight:E,scales:F.scales,taskTypes:a,zoom:F.zoom,selected:D,activeTask:g,baselines:j,autoScale:Q,unscheduledTasks:V,markers:r,durationUnit:h,criticalPath:ie,schedule:z,projectStart:le,projectEnd:ne,calendar:M,undo:u,_weekStart:O.weekStart,splitTasks:Y});const xe=e.useMemo(()=>{const G=new Date,he=O?.weekStart??0,ke=new Date(G),ye=(ke.getDay()-he+7)%7;ke.setDate(ke.getDate()-ye),ke.setHours(0,0,0,0);const Ie=new Date(ke);return Ie.setDate(Ie.getDate()+7),ze=>ze>=ke&&ze<Ie},[O]),q=e.useMemo(()=>(G,he)=>{let ke=[];if(M)he=="day"&&!M.getDayHours(G)&&ke.push("wx-weekend"),he=="hour"&&!M.getDayHours(G)&&ke.push("wx-weekend");else if(N){const De=N(G,he);De&&ke.push(De)}return se&&(he==="week"||he==="day")&&xe(G)&&ke.push("wx-current-week"),ke.join(" ")},[M,N,se,xe]);return c.jsx(be.context.i18n.Provider,{value:_,children:c.jsx(We.Provider,{value:w,children:c.jsx(At,{taskTemplate:n,readonly:B,cellBorders:L,highlightTime:q,onTableAPIChange:fe,multiTaskRows:Z,rowMapping:ue,marqueeSelect:ce,copyPaste:te,scrollToCurrentWeek:Ce,currentWeekColor:pe})})})});function Ft({api:s=null,items:n=[]}){const r=e.useContext(be.context.i18n),a=e.useMemo(()=>r||Me.locale(Ke.en),[r]),o=e.useMemo(()=>a.getGroup("gantt"),[a]),D=v.useStoreLater(s,"_selected"),g=v.useStoreLater(s,"undo"),l=v.useStoreLater(s,"history"),x=v.useStoreLater(s,"splitTasks"),I=["undo","redo"],p=e.useMemo(()=>{const R=ge.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:ge.getToolbarButtons({undo:g,splitTasks:x})).map(P=>{let m={...P,disabled:!1};return m.handler=ge.isHandledAction(R,m.id)?E=>ge.handleAction(s,E.id,null,o):m.handler,m.text&&(m.text=o(m.text)),m.menuText&&(m.menuText=o(m.menuText)),m})},[n,s,o,g,x]),K=e.useMemo(()=>{const R=[];return p.forEach(h=>{const P=h.id;if(P==="add-task")R.push(h);else if(I.includes(P))I.includes(P)&&R.push({...h,disabled:h.isDisabled(l)});else{if(!D?.length||!s)return;R.push({...h,disabled:h.isDisabled&&D.some(m=>h.isDisabled(m,s.getState()))})}}),R.filter((h,P)=>{if(s&&h.isHidden)return!D.some(m=>h.isHidden(m,s.getState()));if(h.comp==="separator"){const m=R[P+1];if(!m||m.comp==="separator")return!1}return!0})},[s,D,l,p]);return r?c.jsx(ot.Toolbar,{items:K}):c.jsx(be.context.i18n.Provider,{value:a,children:c.jsx(ot.Toolbar,{items:K})})}const Xt=e.forwardRef(function({options:n=[],api:r=null,resolver:a=null,filter:o=null,at:D="point",children:g,onClick:l,css:x},I){const p=e.useRef(null),K=e.useRef(null),R=e.useContext(be.context.i18n),h=e.useMemo(()=>R||Me.locale({...Ke.en,...Ue.en}),[R]),P=e.useMemo(()=>h.getGroup("gantt"),[h]),m=v.useStoreLater(r,"taskTypes"),E=v.useStoreLater(r,"selected"),B=v.useStoreLater(r,"_selected"),L=v.useStoreLater(r,"splitTasks"),A=e.useMemo(()=>ge.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{p.current&&p.current.show&&p.current.show()}),r.on("drag-task",()=>{p.current&&p.current.show&&p.current.show()}))},[r]);function j(M){return M.map(u=>(u={...u},u.text&&(u.text=P(u.text)),u.subtext&&(u.subtext=P(u.subtext)),u.data&&(u.data=j(u.data)),u))}function N(){const M=n.length?n:ge.getMenuOptions({splitTasks:L}),u=M.find(Y=>Y.id==="convert-task");return u&&(u.data=[],(m||[]).forEach(Y=>{u.data.push(u.dataFactory(Y))})),j(M)}const b=e.useMemo(()=>N(),[r,n,m,L,P]),Q=e.useMemo(()=>B&&B.length?B:[],[B]),V=e.useCallback((M,u)=>{let Y=M?r?.getTask(M):null;if(a){const Z=a(M,u);Y=Z===!0?Y:Z}if(Y){const Z=Me.locateID(u.target,"data-segment");Z!==null?K.current={id:Y.id,segmentIndex:Z}:K.current=Y.id,(!Array.isArray(E)||!E.includes(Y.id))&&r&&r.exec&&r.exec("select-task",{id:Y.id})}return Y},[r,a,E]),ie=e.useCallback(M=>{const u=M.action;u&&(ge.isHandledAction(A,u.id)&&ge.handleAction(r,u.id,K.current,P),l&&l(M))},[r,P,l,A]),z=e.useCallback((M,u)=>{const Y=Q.length?Q:u?[u]:[];let Z=o?Y.every(ce=>o(M,ce)):!0;if(Z&&(M.isHidden&&(Z=!Y.some(ce=>M.isHidden(ce,r.getState(),K.current))),M.isDisabled)){const ce=Y.some(te=>M.isDisabled(te,r.getState(),K.current));M.disabled=ce}return Z},[o,Q,r]);e.useImperativeHandle(I,()=>({show:(M,u)=>{p.current&&p.current.show&&p.current.show(M,u)}}));const le=e.useCallback(M=>{p.current&&p.current.show&&p.current.show(M)},[]),ne=c.jsxs(c.Fragment,{children:[c.jsx(kt.ContextMenu,{filter:z,options:b,dataKey:"id",resolver:V,onClick:ie,at:D,ref:p,css:x}),c.jsx("span",{onContextMenu:le,"data-menu-ignore":"true",children:typeof g=="function"?g():g})]});if(!R&&be.context.i18n?.Provider){const M=be.context.i18n.Provider;return c.jsx(M,{value:h,children:ne})}return ne});function Kt({api:s,autoSave:n,onLinksChange:r}){const o=e.useContext(be.context.i18n).getGroup("gantt"),D=v.useStore(s,"activeTask"),g=v.useStore(s,"_activeTask"),l=v.useStore(s,"_links"),x=v.useStore(s,"schedule"),I=v.useStore(s,"unscheduledTasks"),[p,K]=e.useState();function R(){if(D){const E=l.filter(L=>L.target==D).map(L=>({link:L,task:s.getTask(L.source)})),B=l.filter(L=>L.source==D).map(L=>({link:L,task:s.getTask(L.target)}));return[{title:o("Predecessors"),data:E},{title:o("Successors"),data:B}]}}e.useEffect(()=>{K(R())},[D,l]);const h=e.useMemo(()=>[{id:"e2s",label:o("End-to-start")},{id:"s2s",label:o("Start-to-start")},{id:"e2e",label:o("End-to-end")},{id:"s2e",label:o("Start-to-end")}],[o]);function P(E){n?s.exec("delete-link",{id:E}):(K(B=>(B||[]).map(L=>({...L,data:L.data.filter(A=>A.link.id!==E)}))),r&&r({id:E,action:"delete-link",data:{id:E}}))}function m(E,B){n?s.exec("update-link",{id:E,link:B}):(K(L=>(L||[]).map(A=>({...A,data:A.data.map(j=>j.link.id===E?{...j,link:{...j.link,...B}}:j)}))),r&&r({id:E,action:"update-link",data:{id:E,link:B}}))}return c.jsx(c.Fragment,{children:(p||[]).map((E,B)=>E.data.length?c.jsx("div",{className:"wx-j93aYGQf wx-links",children:c.jsx(be.Field,{label:E.title,position:"top",children:c.jsx("table",{children:c.jsx("tbody",{children:E.data.map(L=>c.jsxs("tr",{children:[c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:L.task.text||""})}),x?.auto&&L.link.type==="e2s"?c.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:c.jsx(be.Text,{type:"number",placeholder:o("Lag"),value:L.link.lag,disabled:I&&g?.unscheduled,onChange:A=>{A.input||m(L.link.id,{lag:A.value})}})}):null,c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:c.jsx(be.Combo,{value:L.link.type,placeholder:o("Select link type"),options:h,onChange:A=>m(L.link.id,{type:A.value}),children:({option:A})=>A.label})})}),c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>P(L.link.id),role:"button"})})]},L.link.id))})})})},B):null)})}function Bt(s){const{value:n,time:r,format:a,onchange:o,onChange:D,...g}=s,l=D??o;function x(I){const p=new Date(I.value);p.setHours(n.getHours()),p.setMinutes(n.getMinutes()),l&&l({value:p})}return c.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[c.jsx(be.DatePicker,{...g,value:n,onChange:x,format:a,buttons:["today"],clear:!1}),r?c.jsx(be.TimePicker,{value:n,onChange:l,format:a}):null]})}Ae.registerEditorItem("select",be.RichSelect);Ae.registerEditorItem("date",Bt);Ae.registerEditorItem("twostate",be.TwoState);Ae.registerEditorItem("slider",be.Slider);Ae.registerEditorItem("counter",be.Counter);Ae.registerEditorItem("links",Kt);function Vt({api:s,items:n=[],css:r="",layout:a="default",readonly:o=!1,placement:D="sidebar",bottomBar:g=!0,topBar:l=!0,autoSave:x=!0,focus:I=!1,hotkeys:p={}}){const K=e.useContext(be.context.i18n),R=e.useMemo(()=>K||Me.locale({...Ke.en,...Ue.en}),[K]),h=e.useMemo(()=>R.getGroup("gantt"),[R]),P=R.getRaw(),m=e.useMemo(()=>{const w=P.gantt?.dateFormat||P.formats?.dateFormat;return Me.dateToString(w,P.calendar)},[P]),E=e.useMemo(()=>{if(l===!0&&!o){const w=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:h("Delete"),id:"delete"}];return x?{items:w}:{items:[...w,{comp:"button",type:"primary",text:h("Save"),id:"save"}]}}return l},[l,o,x,h]),[B,L]=e.useState(!1),A=e.useMemo(()=>B?"wx-full-screen":"",[B]),j=e.useCallback(w=>{L(w)},[]);e.useEffect(()=>{const w=dt(j);return w.observe(),()=>{w.disconnect()}},[j]);const N=v.useStore(s,"_activeTask"),b=v.useStore(s,"activeTask"),Q=v.useStore(s,"unscheduledTasks"),V=v.useStore(s,"links"),ie=v.useStore(s,"splitTasks"),z=e.useMemo(()=>ie&&b?.segmentIndex,[ie,b]),le=e.useMemo(()=>z||z===0,[z]),ne=e.useMemo(()=>ge.getEditorItems({unscheduledTasks:Q}),[Q]),M=v.useStore(s,"undo"),[u,Y]=e.useState({}),[Z,ce]=e.useState(null),[te,se]=e.useState(),[pe,Ce]=e.useState(null),Le=v.useStore(s,"taskTypes"),Te=e.useMemo(()=>{if(!N)return null;let w;if(le&&N.segments?w={...N.segments[z]}:w={...N},o){let re={parent:w.parent};return ne.forEach(({key:xe,comp:q})=>{if(q!=="links"){const G=w[xe];q==="date"&&G instanceof Date?re[xe]=m(G):q==="slider"&&xe==="progress"?re[xe]=`${G}%`:re[xe]=G}}),re}return w||null},[N,le,z,o,ne,m]);e.useEffect(()=>{se(Te)},[Te]),e.useEffect(()=>{Y({}),Ce(null),ce(null)},[b]);function Re(w,re){return w.map(xe=>{const q={...xe};if(xe.config&&(q.config={...q.config}),q.comp==="links"&&s&&(q.api=s,q.autoSave=x,q.onLinksChange=W),q.comp==="select"&&q.key==="type"){const G=q.options??(Le||[]);q.options=G.map(he=>({...he,label:h(he.label)}))}return q.comp==="slider"&&q.key==="progress"&&(q.labelTemplate=G=>`${h(q.label)} ${G}%`),q.label&&(q.label=h(q.label)),q.config?.placeholder&&(q.config.placeholder=h(q.config.placeholder)),re&&(q.isDisabled&&q.isDisabled(re,s.getState())?q.disabled=!0:delete q.disabled),q})}const ee=e.useMemo(()=>{let w=n.length?n:ne;return w=Re(w,te),te?w.filter(re=>!re.isHidden||!re.isHidden(te,s.getState())):w},[n,ne,te,Le,h,s,x]),f=e.useMemo(()=>ee.map(w=>w.key),[ee]);function W({id:w,action:re,data:xe}){Y(q=>({...q,[w]:{action:re,data:xe}}))}const _=e.useCallback(()=>{for(let w in u)if(V.byId(w)){const{action:re,data:xe}=u[w];s.exec(re,xe)}},[s,u,V]),O=e.useCallback(()=>{const w=b?.id||b;if(le){if(N?.segments){const re=N.segments.filter((xe,q)=>q!==z);s.exec("update-task",{id:w,task:{segments:re}})}}else s.exec("delete-task",{id:w})},[s,b,le,N,z]),F=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),oe=e.useCallback(w=>{const{item:re,changes:xe}=w;re.id==="delete"&&O(),re.id==="save"&&(xe.length?F():_()),re.comp&&F()},[s,b,x,_,O,F]),ue=e.useCallback((w,re,xe)=>(Q&&w.type==="summary"&&(w.unscheduled=!1),ge.prepareEditTask(w,s.getState(),re),xe||ce(!1),w),[Q,s]),y=e.useCallback(w=>{w={...w,unscheduled:Q&&w.unscheduled&&w.type!=="summary"},delete w.links,delete w.data,(f.indexOf("duration")===-1||w.segments&&!w.duration)&&delete w.duration;const re={id:b?.id||b,task:w,...le&&{segmentIndex:z}};x&&Z&&(re.inProgress=Z),s.exec("update-task",re),x||_()},[s,b,Q,x,_,f,le,z,Z]),U=e.useCallback(w=>{let{update:re,key:xe,input:q}=w;if(q&&ce(!0),w.update=ue({...re},xe,q),!x)se(w.update);else if(!pe&&!q){const G=ee.find(De=>De.key===xe),he=re[xe];(!G.validation||G.validation(he))&&(!G.required||he)&&y(w.update)}},[x,ue,pe,ee,y]),ae=e.useCallback(w=>{x||y(w.values)},[x,y]),fe=e.useCallback(w=>{Ce(w.errors)},[]),je=e.useMemo(()=>M?{"ctrl+z":w=>{w.preventDefault(),s.exec("undo")},"ctrl+y":w=>{w.preventDefault(),s.exec("redo")}}:{},[M,s]);return Te?c.jsx(be.Locale,{children:c.jsx(Ae.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${A} ${r}`,items:ee,values:Te,topBar:E,bottomBar:g,placement:D,layout:a,readonly:o,autoSave:x,focus:I,onAction:oe,onSave:ae,onValidation:fe,onChange:U,hotkeys:p&&{...je,...p}})}):null}const Ut=({children:s,columns:n=null,api:r})=>{const[a,o]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(o)},[r]),c.jsx(ut.HeaderMenu,{api:a,columns:n,children:s})};function Qt(s){const{api:n,content:r,children:a}=s,o=e.useRef(null),D=e.useRef(null),[g,l]=e.useState({}),[x,I]=e.useState(null),[p,K]=e.useState({});function R(j){for(;j;){if(j.getAttribute){const N=j.getAttribute("data-tooltip-id"),b=j.getAttribute("data-tooltip-at"),Q=j.getAttribute("data-tooltip");if(N||Q)return{id:N,tooltip:Q,target:j,at:b}}j=j.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const j=D.current;if(j&&p&&(p.text||r)){const N=j.getBoundingClientRect();let b=!1,Q=p.left,V=p.top;N.right>=g.right&&(Q=g.width-N.width-5,b=!0),N.bottom>=g.bottom&&(V=p.top-(N.bottom-g.bottom+2),b=!0),b&&K(ie=>ie&&{...ie,left:Q,top:V})}},[p,g,r]);const h=e.useRef(null),P=300,m=j=>{clearTimeout(h.current),h.current=setTimeout(()=>{j()},P)};function E(j){let{id:N,tooltip:b,target:Q,at:V}=R(j.target);if(K(null),I(null),!b)if(N)b=L(N);else{clearTimeout(h.current);return}const ie=j.clientX;m(()=>{N&&I(B(A(N)));const z=Q.getBoundingClientRect(),le=o.current,ne=le?le.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let M,u;V==="left"?(M=z.top+5-ne.top,u=z.right+5-ne.left):(M=z.top+z.height-ne.top,u=ie-ne.left),l(ne),K({top:M,left:u,text:b})})}function B(j){return n?.getTask(A(j))||null}function L(j){return B(j)?.text||""}function A(j){const N=parseInt(j);return isNaN(N)?j:N}return c.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:o,onMouseMove:E,children:[p&&(p.text||r)?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:D,style:{top:`${p.top}px`,left:`${p.left}px`},children:r?c.jsx(r,{data:x}):p.text?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:p.text}):null}):null,a]})}function Zt({fonts:s=!0,children:n}){return n?c.jsx(be.Material,{fonts:s,children:n()}):c.jsx(be.Material,{fonts:s})}function Jt({fonts:s=!0,children:n}){return n?c.jsx(be.Willow,{fonts:s,children:n}):c.jsx(be.Willow,{fonts:s})}function es({fonts:s=!0,children:n}){return n?c.jsx(be.WillowDark,{fonts:s,children:n}):c.jsx(be.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>ge.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>ge.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>ge.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>ge.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>ge.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>ge.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>ge.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>ge.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>ge.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>Ae.registerEditorItem});exports.ContextMenu=Xt;exports.Editor=Vt;exports.Gantt=Yt;exports.HeaderMenu=Ut;exports.Material=Zt;exports.Toolbar=Ft;exports.Tooltip=Qt;exports.Willow=Jt;exports.WillowDark=es;
//# sourceMappingURL=index.cjs.map
