"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("react/jsx-runtime"),e=require("react"),be=require("@svar-ui/react-core"),ve=require("@svar-ui/lib-dom"),Ke=require("@svar-ui/gantt-locales"),Ue=require("@svar-ui/core-locales"),wt=require("@svar-ui/lib-state"),pe=require("@svar-ui/gantt-store"),M=require("@svar-ui/lib-react"),at=require("@svar-ui/grid-store"),ut=require("@svar-ui/react-grid"),pt=require("react-dom"),ot=require("@svar-ui/react-toolbar"),kt=require("@svar-ui/react-menu"),We=require("@svar-ui/react-editor"),He=e.createContext(null);function ze(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function bt(s,n,r){const a=s.getBoundingClientRect(),o=n.querySelector(".wx-body").getBoundingClientRect();return{top:a.top-o.top,left:a.left-o.left,dt:a.bottom-r.clientY,db:r.clientY-a.top}}function lt(s){return s&&s.getAttribute("data-context-id")}const ct=5;function yt(s,n){let r,a,o,D,h,l,f,A,p;function X(g){D=g.clientX,h=g.clientY,l={...bt(r,s,g),y:n.getTask(o).$y},document.body.style.userSelect="none"}function E(g){r=ve.locate(g),lt(r)&&(o=ze(r),p=setTimeout(()=>{A=!0,n&&n.touchStart&&n.touchStart(),X(g.touches[0])},500),s.addEventListener("touchmove",L),s.addEventListener("contextmenu",m),window.addEventListener("touchend",z))}function m(g){if(A||p)return g.preventDefault(),!1}function H(g){g.which===1&&(r=ve.locate(g),lt(r)&&(o=ze(r),s.addEventListener("mousemove",K),window.addEventListener("mouseup",S),X(g)))}function x(g){s.removeEventListener("mousemove",K),s.removeEventListener("touchmove",L),document.body.removeEventListener("mouseup",S),document.body.removeEventListener("touchend",z),document.body.style.userSelect="",g&&(s.removeEventListener("mousedown",H),s.removeEventListener("touchstart",E))}function R(g){const ee=g.clientX-D,Y=g.clientY-h;if(!a){if(Math.abs(ee)<ct&&Math.abs(Y)<ct||n&&n.start&&n.start({id:o,e:g})===!1)return;a=r.cloneNode(!0),a.style.pointerEvents="none",a.classList.add("wx-reorder-task"),a.style.position="absolute",a.style.left=l.left+"px",a.style.top=l.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(a,r)}if(a){const de=Math.round(Math.max(0,l.top+Y));if(n&&n.move&&n.move({id:o,top:de,detail:f})===!1)return;const W=n.getTask(o),le=W.$y;if(!l.start&&l.y==le)return G();l.start=!0,l.y=W.$y-4,a.style.top=de+"px";const te=document.elementFromPoint(g.clientX,g.clientY),d=ve.locate(te);if(d&&d!==r){const T=ze(d),I=d.getBoundingClientRect(),oe=I.top+I.height/2,re=g.clientY+l.db>oe&&d.nextElementSibling!==r,se=g.clientY-l.dt<oe&&d.previousElementSibling!==r;f?.after==T||f?.before==T?f=null:re?f={id:o,after:T}:se&&(f={id:o,before:T})}}}function K(g){R(g)}function L(g){A?(g.preventDefault(),R(g.touches[0])):p&&(clearTimeout(p),p=null)}function z(){A=null,p&&(clearTimeout(p),p=null),G()}function S(){G()}function G(){r&&(r.style.visibility=""),a&&(a.parentNode.removeChild(a),n&&n.end&&n.end({id:o,top:l.top})),o=r=a=l=f=null,x()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",H),s.addEventListener("touchstart",E),{destroy(){x(!0)}}}function Tt({row:s,column:n}){function r(o,D){return{justifyContent:D.align,paddingLeft:`${(o.$level-1)*20}px`}}const a=n&&n._cell;return c.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?c.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):c.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),c.jsx("div",{className:"wx-pqc08MHU wx-text",children:a?c.jsx(a,{row:s,column:n}):s.text})]})}function it({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?c.jsx("div",{style:{textAlign:s.align},children:c.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function vt(s){const{readonly:n,compactMode:r,width:a=0,display:o="all",columnWidth:D=0,onTableAPIChange:h,multiTaskRows:l=!1,rowMapping:f=null}=s,[A,p]=M.useWritableProp(D),[X,E]=e.useState(),m=e.useContext(be.context.i18n),H=e.useMemo(()=>m.getGroup("gantt"),[m]),x=e.useContext(He),R=M.useStore(x,"scrollTop"),K=M.useStore(x,"cellHeight"),L=M.useStore(x,"_scrollTask"),z=M.useStore(x,"_selected"),S=M.useStore(x,"area"),G=M.useStore(x,"_tasks"),g=M.useStore(x,"_scales"),ee=M.useStore(x,"columns"),Y=M.useStore(x,"_sort"),de=M.useStore(x,"calendar"),W=M.useStore(x,"durationUnit"),le=M.useStore(x,"splitTasks"),[te,d]=e.useState(null),T=e.useMemo(()=>!G||!S?[]:l&&f?G:G.slice(S.start,S.end),[G,S,l,f]),I=e.useCallback((i,b)=>{if(b==="add-task")x.exec(b,{target:i,task:{text:H("New Task")},mode:"child",show:!0});else if(b==="open-task"){const j=T.find(U=>U.id===i);(j?.data||j?.lazy)&&x.exec(b,{id:i,mode:!j.open})}},[T]),oe=e.useCallback(i=>{const b=ve.locateID(i),j=i.target.dataset.action;j&&i.preventDefault(),b?j==="add-task"||j==="open-task"?I(b,j):x.exec("select-task",{id:b,toggle:i.ctrlKey||i.metaKey,range:i.shiftKey,show:!0}):j==="add-task"&&I(null,j)},[x,I]),re=e.useRef(null),se=e.useRef(null),[ce,me]=e.useState(0),[Re,Ce]=e.useState(!1);e.useEffect(()=>{const i=se.current;if(!i||typeof ResizeObserver>"u")return;const b=()=>me(i.clientWidth);b();const j=new ResizeObserver(b);return j.observe(i),()=>j.disconnect()},[]);const je=e.useRef(null),Se=e.useCallback(i=>{const b=i.id,{before:j,after:U}=i,fe=i.onMove;let ue=j||U,Ee=j?"before":"after";if(fe){if(Ee==="after"){const Ne=x.getTask(ue);Ne.data?.length&&Ne.open&&(Ee="before",ue=Ne.data[0].id)}je.current={id:b,[Ee]:ue}}else je.current=null;x.exec("move-task",{id:b,mode:Ee,target:ue,inProgress:fe})},[x]),N=e.useMemo(()=>S?.from??0,[S]),k=e.useMemo(()=>g?.height??0,[g]),P=e.useMemo(()=>!r&&o!=="grid"?(A??0)>(a??0):(A??0)>(ce??0),[r,o,A,a,ce]),Z=e.useMemo(()=>{const i={};return P&&o==="all"||o==="grid"&&P?i.width=A:o==="grid"&&(i.width="100%"),i},[P,o,A]),B=e.useMemo(()=>te&&!T.find(i=>i.id===te.id)?[...T,te]:T,[T,te]),O=e.useMemo(()=>{if(!l||!f)return B;const i=new Map,b=new Set;return B.forEach(j=>{const U=f.taskRows.get(j.id)??j.id;b.has(U)||(i.set(U,{...j,$rowTasks:f.rowMap.get(U)||[j.id]}),b.add(U))}),Array.from(i.values())},[B,l,f]),Q=e.useMemo(()=>{let i=(ee||[]).map(U=>{U={...U};const fe=U.header;if(typeof fe=="object"){const ue=fe.text&&H(fe.text);U.header={...fe,text:ue}}else U.header=H(fe);return U});const b=i.findIndex(U=>U.id==="text"),j=i.findIndex(U=>U.id==="add-task");if(b!==-1&&(i[b].cell&&(i[b]._cell=i[b].cell),i[b].cell=Tt),j!==-1){i[j].cell=i[j].cell||it;const U=i[j].header;if(typeof U!="object"&&(i[j].header={text:U}),i[j].header.cell=U.cell||it,n)i.splice(j,1);else if(r){const[fe]=i.splice(j,1);i.unshift(fe)}}return i.length>0&&(i[i.length-1].resize=!1),i},[ee,H,n,r]),ye=e.useMemo(()=>o==="all"?`${a}px`:o==="grid"?"calc(100% - 4px)":Q.find(i=>i.id==="add-task")?"50px":"0",[o,a,Q]),v=e.useMemo(()=>{if(O&&Y?.length){const i={};return Y.forEach(({key:b,order:j},U)=>{i[b]={order:j,...Y.length>1&&{index:U}}}),i}return{}},[O,Y]),q=e.useCallback(()=>Q.some(i=>i.flexgrow&&!i.hidden),[]),ie=e.useMemo(()=>q(),[q,Re]),ae=e.useMemo(()=>{let i=o==="chart"?Q.filter(j=>j.id==="add-task"):Q;const b=o==="all"?a:ce;if(!ie){let j=A,U=!1;if(Q.some(fe=>fe.$width)){let fe=0;j=Q.reduce((ue,Ee)=>(Ee.hidden||(fe+=Ee.width,ue+=Ee.$width||Ee.width),ue),0),fe>j&&j>b&&(U=!0)}if(U||j<b){let fe=1;return U||(fe=(b-50)/(j-50||1)),i.map(ue=>(ue.id!=="add-task"&&!ue.hidden&&(ue.$width||(ue.$width=ue.width),ue.width=ue.$width*fe),ue))}}return i},[o,Q,ie,A,a,ce]),De=e.useCallback(i=>{if(!q()){const b=ae.reduce((j,U)=>(i&&U.$width&&(U.$width=U.width),j+(U.hidden?0:U.width)),0);b!==A&&p(b)}Ce(!0),Ce(!1)},[q,ae,A,p]),w=e.useCallback(()=>{Q.filter(b=>b.flexgrow&&!b.hidden).length===1&&Q.forEach(b=>{b.$width&&!b.flexgrow&&!b.hidden&&(b.width=b.$width)})},[]),ne=e.useCallback(i=>{if(!n){const b=ve.locateID(i),j=ve.locateAttr(i,"data-col-id");!(j&&Q.find(fe=>fe.id==j))?.editor&&b&&x.exec("show-editor",{id:b})}},[x,n]),he=e.useMemo(()=>Array.isArray(z)?z.map(i=>i.id):[],[z]),_=e.useCallback(()=>{if(re.current&&O!==null){const i=re.current.querySelector(".wx-body");i&&(i.style.top=-((R??0)-(N??0))+"px")}se.current&&(se.current.scrollTop=0)},[O,R,N]);e.useEffect(()=>{re.current&&_()},[R,N,_]),e.useEffect(()=>{const i=re.current;if(!i)return;const b=i.querySelector(".wx-table-box .wx-body");if(!b||typeof ResizeObserver>"u")return;const j=new ResizeObserver(()=>{_()});return j.observe(b),()=>{j.disconnect()}},[ae,Z,o,ye,O,_]),e.useEffect(()=>{if(!L||!X)return;const{id:i}=L,b=X.getState().focusCell;b&&b.row!==i&&re.current&&re.current.contains(document.activeElement)&&X.exec("focus-cell",{row:i,column:b.column})},[L,X]);const V=e.useCallback(({id:i})=>{if(n)return!1;x.getTask(i).open&&x.exec("open-task",{id:i,mode:!1});const b=x.getState()._tasks.find(j=>j.id===i);if(d(b||null),!b)return!1},[x,n]),we=e.useCallback(({id:i,top:b})=>{je.current?Se({...je.current,onMove:!1}):x.exec("drag-task",{id:i,top:b+(N??0),inProgress:!1}),d(null)},[x,Se,N]),ke=e.useCallback(({id:i,top:b,detail:j})=>{j&&Se({...j,onMove:!0}),x.exec("drag-task",{id:i,top:b+(N??0),inProgress:!0})},[x,Se,N]);e.useEffect(()=>{const i=re.current;return i?yt(i,{start:V,end:we,move:ke,getTask:x.getTask}).destroy:void 0},[x,V,we,ke]);const Me=e.useCallback(i=>{const{key:b,isInput:j}=i;if(!j&&(b==="arrowup"||b==="arrowdown"))return i.eventSource="grid",x.exec("hotkey",i),!1;if(b==="enter"){const U=X?.getState().focusCell;if(U){const{row:fe,column:ue}=U;ue==="add-task"?I(fe,"add-task"):ue==="text"&&I(fe,"open-task")}}},[x,I,X]),Te=e.useRef(null),Ie=()=>{Te.current={setTableAPI:E,handleHotkey:Me,sortVal:Y,api:x,adjustColumns:w,setColumnWidth:De,tasks:T,calendarVal:de,durationUnitVal:W,splitTasksVal:le,onTableAPIChange:h}};Ie(),e.useEffect(()=>{Ie()},[E,Me,Y,x,w,De,T,de,W,le,h]);const Ge=e.useCallback(i=>{E(i),i.intercept("hotkey",b=>Te.current.handleHotkey(b)),i.intercept("scroll",()=>!1),i.intercept("select-row",()=>!1),i.intercept("sort-rows",b=>{const j=Te.current.sortVal,{key:U,add:fe}=b,ue=j?j.find(Ne=>Ne.key===U):null;let Ee="asc";return ue&&(Ee=!ue||ue.order==="asc"?"desc":"asc"),x.exec("sort-tasks",{key:U,order:Ee,add:fe}),!1}),i.on("resize-column",()=>{Te.current.setColumnWidth(!0)}),i.on("hide-column",b=>{b.mode||Te.current.adjustColumns(),Te.current.setColumnWidth()}),i.intercept("update-cell",b=>{const{id:j,column:U,value:fe}=b,ue=Te.current.tasks.find(Ee=>Ee.id===j);if(ue){const Ee={...ue};let Ne=fe;Ne&&!isNaN(Ne)&&!(Ne instanceof Date)&&(Ne*=1),Ee[U]=Ne,pe.prepareEditTask(Ee,{calendar:Te.current.calendarVal,durationUnit:Te.current.durationUnitVal,splitTasks:Te.current.splitTasksVal},U),x.exec("update-task",{id:j,task:Ee})}return!1}),h&&h(i)},[]);return c.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ye}`},ref:se,children:c.jsx("div",{ref:re,style:Z,className:"wx-rHj6070p wx-table",onClick:oe,onDoubleClick:ne,children:c.jsx(ut.Grid,{init:Ge,sizes:{rowHeight:K,headerHeight:(k??0)-1},rowStyle:i=>i.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:i=>`wx-rHj6070p wx-text-${i.align}${i.id==="add-task"?" wx-action":""}`,data:O,columns:ae,selectedRows:[...he],sortMarks:v})})})}function Mt({borders:s=""}){const n=e.useContext(He),r=M.useStore(n,"cellWidth"),a=M.useStore(n,"cellHeight"),o=e.useRef(null),[D,h]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&o.current){const f=getComputedStyle(o.current).getPropertyValue("--wx-gantt-border");h(f?f.substring(f.indexOf("#")):"#1d1e261a")}},[]);const l={width:"100%",height:"100%",background:r!=null&&a!=null?`url(${pe.grid(r,a,D,s)})`:void 0,position:"absolute"};return c.jsx("div",{ref:o,style:l})}function Ct({onSelectLink:s,selectedLink:n,readonly:r}){const a=e.useContext(He),o=M.useStore(a,"_links"),D=M.useStore(a,"criticalPath"),h=e.useRef(null),l=e.useCallback(f=>{const A=f?.target?.classList;!A?.contains("wx-line")&&!A?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&h.current){const f=A=>{h.current&&!h.current.contains(A.target)&&l(A)};return document.addEventListener("click",f),()=>{document.removeEventListener("click",f)}}},[r,n,l]),c.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(o||[]).map(f=>{const A="wx-dkx3NwEn wx-line"+(D&&f.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return c.jsx("polyline",{className:A,points:f.$p,onClick:()=>!r&&s(f.id),"data-link-id":f.id},f.id)}),!r&&n&&c.jsx("polyline",{ref:h,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function St(s){const{task:n,type:r}=s;function a(D){const h=n.segments[D];return{left:`${h.$x}px`,top:"0px",width:`${h.$w}px`,height:"100%"}}function o(D){if(!n.progress)return 0;const h=n.duration*n.progress/100,l=n.segments;let f=0,A=0,p=null;do{const X=l[A];A===D&&(f>h?p=0:p=Math.min((h-f)/X.duration,1)*100),f+=X.duration,A++}while(p===null&&A<l.length);return p||0}return c.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map((D,h)=>c.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":h,style:a(h),children:[n.progress?c.jsx("div",{className:"wx-progress-wrapper",children:c.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${o(h)}%`}})}):null,c.jsx("div",{className:"wx-content",children:D.text||""})]},h))})}let Xe=[],Ve=null,Ye=null;const Et=(s,n)=>{if(!n||!n.start)return null;const{start:r,lengthUnitWidth:a,lengthUnit:o}=n,D=864e5,h=o==="week"?7:o==="month"?30:o==="quarter"?91:o==="year"?365:1,l=Math.floor(s/a);return new Date(r.getTime()+l*h*D)};function Rt(s){const{readonly:n,taskTemplate:r,multiTaskRows:a=!1,rowMapping:o=null,marqueeSelect:D=!1,copyPaste:h=!1}=s,l=e.useContext(He),[f,A]=M.useStoreWithCounter(l,"_tasks"),[p,X]=M.useStoreWithCounter(l,"_links"),E=M.useStore(l,"area"),m=M.useStore(l,"_scales"),H=M.useStore(l,"taskTypes"),x=M.useStore(l,"baselines"),[R,K]=M.useStoreWithCounter(l,"_selected"),L=M.useStore(l,"_scrollTask"),z=M.useStore(l,"criticalPath"),S=M.useStore(l,"tasks"),G=M.useStore(l,"schedule"),g=M.useStore(l,"splitTasks"),ee=e.useMemo(()=>{if(!E||!Array.isArray(f))return[];const t=E.start??0,u=E.end??0;return a&&o?f.map(y=>({...y})):f.slice(t,u).map(y=>({...y}))},[A,E,a,o]),Y=M.useStore(l,"cellHeight"),de=e.useMemo(()=>{if(!a||!o||!ee.length)return ee;const t=new Map,u=[];return f.forEach(y=>{const C=o.taskRows.get(y.id)??y.id;t.has(C)||(t.set(C,u.length),u.push(C))}),ee.map(y=>{const C=o.taskRows.get(y.id)??y.id,$=t.get(C)??0;return{...y,$y:$*Y,$y_base:y.$y_base!==void 0?$*Y:void 0}})},[ee,a,o,f,Y]),W=e.useMemo(()=>m.lengthUnitWidth,[m]),le=e.useMemo(()=>m.lengthUnit||"day",[m]),te=e.useRef(!1),[d,T]=e.useState(void 0),[I,oe]=e.useState(null),re=e.useRef(null),[se,ce]=e.useState(null),[me,Re]=e.useState(void 0),Ce=e.useRef(null),[je,Se]=e.useState(0),[N,k]=e.useState(null),[P,Z]=e.useState(null),[B,O]=e.useState(null),Q=e.useRef(null),ye=e.useMemo(()=>{const t=Q.current;return!!(R.length&&t&&t.contains(document.activeElement))},[R,Q.current]),v=e.useMemo(()=>ye&&R[R.length-1]?.id,[ye,R]);e.useEffect(()=>{if(L&&ye&&L){const{id:t}=L,u=Q.current?.querySelector(`.wx-bar[data-id='${t}']`);u&&u.focus({preventScroll:!0})}},[L]),e.useEffect(()=>{const t=Q.current;if(t&&(Se(t.offsetWidth||0),typeof ResizeObserver<"u")){const u=new ResizeObserver(y=>{y[0]&&Se(y[0].contentRect.width)});return u.observe(t),()=>u.disconnect()}},[Q.current]);const q=e.useCallback(()=>{document.body.style.userSelect="none"},[]),ie=e.useCallback(()=>{document.body.style.userSelect=""},[]),ae=e.useCallback((t,u,y)=>{if(u.target.classList.contains("wx-line")||(y||(y=l.getTask(ze(t))),y.type==="milestone"||y.type==="summary"))return"";const C=ve.locate(u,"data-segment");C&&(t=C);const{left:$,width:F}=t.getBoundingClientRect(),J=(u.clientX-$)/F;let ge=.2/(F>200?F/200:1);return J<ge?"start":J>1-ge?"end":""},[l]),De=e.useMemo(()=>{const t=new Map;if(!a||!o)return f.forEach(C=>{t.set(C.id,C.$y)}),t;const u=new Map,y=[];return f.forEach(C=>{const $=o.taskRows.get(C.id)??C.id;u.has($)||(u.set($,y.length),y.push($))}),f.forEach(C=>{const $=o.taskRows.get(C.id)??C.id,F=u.get($)??0;t.set(C.id,F*Y)}),t},[f,a,o,Y]),w=e.useCallback(t=>{const u=Q.current;if(!u)return[];const y=u.parentElement?.scrollLeft||0,C=u.parentElement?.parentElement?.scrollTop||0,$=Math.min(t.startX,t.currentX),F=Math.max(t.startX,t.currentX),J=Math.min(t.startY,t.currentY),ge=Math.max(t.startY,t.currentY);return f.filter(xe=>{const Le=xe.$x-y,Pe=xe.$x+xe.$w-y,Ae=(De.get(xe.id)??xe.$y)-C,$e=Ae+xe.$h;return Le<F&&Pe>$&&Ae<ge&&$e>J})},[f,De]),ne=e.useMemo(()=>new Set(R.map(t=>t.id)),[R,K]),he=e.useCallback(t=>ne.has(t),[ne]),_=e.useCallback((t,u)=>{const{clientX:y}=u,C=ze(t),$=l.getTask(C),F=u.target.classList;if(!u.target.closest(".wx-delete-button")&&!n){if(F.contains("wx-progress-marker")){const{progress:J}=l.getTask(C);re.current={id:C,x:y,progress:J,dx:0,node:t,marker:u.target},u.target.classList.add("wx-progress-in-drag")}else{const J=ae(t,u,$)||"move",ge={id:C,mode:J,x:y,dx:0,l:$.$x,w:$.$w};if(g&&$.segments?.length){const xe=ve.locate(u,"data-segment");xe&&(ge.segmentIndex=xe.dataset.segment*1,pe.extendDragOptions($,ge))}oe(ge)}q()}},[l,n,ae,q,g]),V=e.useCallback(t=>{if(t.button!==0)return;const u=ve.locate(t);if(!u&&D&&!n){const y=Q.current;if(!y)return;const C=y.getBoundingClientRect(),$=t.clientX-C.left,F=t.clientY-C.top;if(h){const J=y.parentElement?.scrollLeft||0,ge=$+J,xe=Et(ge,m);xe&&O(xe)}k({startX:$,startY:F,currentX:$,currentY:F,ctrlKey:t.ctrlKey||t.metaKey}),q();return}if(u){if(D&&!n&&R.length>1){const y=ze(u);if(he(y)){const C=t.target.classList;if(!C.contains("wx-link")&&!C.contains("wx-progress-marker")&&!t.target.closest(".wx-delete-button")){const $=l.getTask(y);if(!ae(u,t,$)){const J=new Map;R.forEach(ge=>{const xe=l.getTask(ge.id);if(xe){if(G?.auto&&xe.type==="summary")return;J.set(ge.id,{$x:xe.$x,$w:xe.$w,start:xe.start,end:xe.end})}}),Z({baseTaskId:y,startX:t.clientX,dx:0,originalPositions:J}),q();return}}}}_(u,t)}},[_,D,h,n,R,he,l,ae,G,q,m]),we=e.useCallback(t=>{const u=ve.locate(t);u&&(Ce.current=setTimeout(()=>{Re(!0),_(u,t.touches[0])},300))},[_]),ke=e.useCallback(t=>{ce(t&&{...p.find(u=>u.id===t)})},[p]),Me=e.useCallback(()=>{if(N){const t=w(N);N.ctrlKey?t.forEach(u=>{l.exec("select-task",{id:u.id,toggle:!0,marquee:!0})}):(R.length>0&&l.exec("select-task",{id:null,marquee:!0}),t.forEach((u,y)=>{l.exec("select-task",{id:u.id,toggle:y>0,marquee:!0})})),k(null),ie(),te.current=!0;return}if(P){const{dx:t,originalPositions:u}=P,y=Math.round(t/W);if(y!==0){let C=!0;u.forEach(($,F)=>{const J=l.getTask(F);J&&(l.exec("update-task",{id:F,diff:y,task:{start:J.start,end:J.end},skipUndo:!C}),C=!1)}),te.current=!0}else u.forEach((C,$)=>{l.exec("drag-task",{id:$,left:C.$x,width:C.$w,inProgress:!1})});Z(null),ie();return}if(re.current){const{dx:t,id:u,marker:y,value:C}=re.current;re.current=null,typeof C<"u"&&t&&l.exec("update-task",{id:u,task:{progress:C},inProgress:!1}),y.classList.remove("wx-progress-in-drag"),te.current=!0,ie()}else if(I){const{id:t,mode:u,dx:y,l:C,w:$,start:F,segment:J,index:ge}=I;if(oe(null),F){const xe=Math.round(y/W);if(!xe)l.exec("drag-task",{id:t,width:$,left:C,inProgress:!1,...J&&{segmentIndex:ge}});else{let Le={},Pe=l.getTask(t);J&&(Pe=Pe.segments[ge]);const _e=1440*60*1e3,$e=xe*(le==="week"?7:le==="month"?30:le==="quarter"?91:le==="year"?365:1)*_e;u==="move"?(Le.start=new Date(Pe.start.getTime()+$e),Le.end=new Date(Pe.end.getTime()+$e)):u==="start"?(Le.start=new Date(Pe.start.getTime()+$e),Le.end=Pe.end):u==="end"&&(Le.start=Pe.start,Le.end=new Date(Pe.end.getTime()+$e)),l.exec("update-task",{id:t,task:Le,...J&&{segmentIndex:ge}})}te.current=!0}ie()}},[l,ie,I,W,le,N,P,w,R]),Te=e.useCallback((t,u)=>{const{clientX:y,clientY:C}=u;if(!n){if(N){const $=Q.current;if(!$)return;const F=$.getBoundingClientRect(),J=y-F.left,ge=C-F.top;k(xe=>({...xe,currentX:J,currentY:ge}));return}if(P){const $=y-P.startX;P.originalPositions.forEach((F,J)=>{const ge=F.$x+$;l.exec("drag-task",{id:J,left:ge,width:F.$w,inProgress:!0})}),Z(F=>({...F,dx:$}));return}if(re.current){const{node:$,x:F,id:J}=re.current,ge=re.current.dx=y-F,xe=Math.round(ge/$.offsetWidth*100);let Le=re.current.progress+xe;re.current.value=Le=Math.min(Math.max(0,Le),100),l.exec("update-task",{id:J,task:{progress:Le},inProgress:!0})}else if(I){ke(null);const{mode:$,l:F,w:J,x:ge,id:xe,start:Le,segment:Pe,index:_e}=I,Ae=l.getTask(xe),$e=y-ge;if(!Le&&Math.abs($e)<20||$==="start"&&J-$e<W||$==="end"&&J+$e<W||$==="move"&&($e<0&&F+$e<0||$e>0&&F+J+$e>je)||I.segment&&!pe.isSegmentMoveAllowed(Ae,I))return;const Fe={...I,dx:$e};let Oe,qe;if($==="start"?(Oe=F+$e,qe=J-$e):$==="end"?(Oe=F,qe=J+$e):$==="move"&&(Oe=F+$e,qe=J),l.exec("drag-task",{id:xe,width:qe,left:Oe,inProgress:!0,...Pe&&{segmentIndex:_e}}),!Fe.start&&($==="move"&&Ae.$x==F||$!=="move"&&Ae.$w==J)){te.current=!0,Me();return}Fe.start=!0,oe(Fe)}else{const $=ve.locate(t);if($){const F=l.getTask(ze($)),ge=ve.locate(t,"data-segment")||$,xe=ae(ge,u,F);ge.style.cursor=xe&&!n?"col-resize":"pointer"}}}},[l,n,I,W,je,ae,ke,Me,N,P]),Ie=e.useCallback(t=>{Te(t,t)},[Te]),Ge=e.useCallback(t=>{me?(t.preventDefault(),Te(t,t.touches[0])):Ce.current&&(clearTimeout(Ce.current),Ce.current=null)},[me,Te]),i=e.useCallback(()=>{Me()},[Me]),b=e.useCallback(()=>{Re(null),Ce.current&&(clearTimeout(Ce.current),Ce.current=null),Me()},[Me]);e.useEffect(()=>(window.addEventListener("mouseup",i),()=>{window.removeEventListener("mouseup",i)}),[i]);const j=e.useCallback(t=>{if(!n){const u=ve.locateID(t.target);if(u&&!t.target.classList.contains("wx-link")){const y=ve.locateID(t.target,"data-segment");l.exec("show-editor",{id:u,...y!==null&&{segmentIndex:y}})}}},[l,n]),U=["e2s","s2s","e2e","s2e"],fe=e.useCallback((t,u)=>U[(t?1:0)+(u?0:2)],[]),ue=e.useCallback((t,u)=>{const y=d.id,C=d.start;return t===y?!0:!!p.find($=>$.target==t&&$.source==y&&$.type===fe(C,u))},[d,X,fe]),Ee=e.useCallback(()=>{d&&T(null)},[d]),Ne=e.useCallback(t=>{if(te.current){te.current=!1;return}const u=ve.locateID(t.target);if(u){const y=t.target.classList;if(y.contains("wx-link")){const C=y.contains("wx-left");if(!d){T({id:u,start:C});return}d.id!==u&&!ue(u,C)&&l.exec("add-link",{link:{source:d.id,target:u,type:fe(d.start,C)}})}else if(y.contains("wx-delete-button-icon"))l.exec("delete-link",{id:se.id}),ce(null);else{let C;const $=ve.locate(t,"data-segment");$&&(C=$.dataset.segment*1),l.exec("select-task",{id:u,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:C})}}Ee()},[l,d,X,se,ue,fe,Ee]),xt=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),mt=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),ht=e.useCallback(t=>{if(me||Ce.current)return t.preventDefault(),!1},[me]),Qe=e.useMemo(()=>H.map(t=>t.id),[H]),Ze=e.useCallback(t=>{let u=Qe.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(u=`task ${u}`),u},[Qe]),Je=e.useCallback(t=>{l.exec(t.action,t.data)},[l]),Be=e.useCallback(t=>z&&S.byId(t).$critical,[z,S]),et=e.useCallback(t=>{if(G?.auto){const u=S.getSummaryId(t,!0),y=S.getSummaryId(d.id,!0);return d?.id&&!(Array.isArray(u)?u:[u]).includes(d.id)&&!(Array.isArray(y)?y:[y]).includes(t)}return d},[G,S,d]),tt=e.useRef(null);tt.current=B;const st=e.useCallback(()=>{const t=l.getState()._selected;if(!t||!t.length)return;const u=t.map(F=>{const J=l.getTask(F.id);if(!J)return null;const{$x:ge,$y:xe,$w:Le,$h:Pe,$skip:_e,$level:Ae,$index:$e,$y_base:Fe,$x_base:Oe,$w_base:qe,$h_base:es,$skip_baseline:ts,$critical:ss,$reorder:ns,...gt}=J;return gt}).filter(Boolean);if(!u.length)return;const C=u[0].parent,$=u.filter(F=>F.parent===C);$.length!==0&&(Xe=$,Ye=C,Ve=Xe.reduce((F,J)=>J.start&&(!F||J.start<F)?J.start:F,null))},[l]),nt=e.useCallback(()=>{const t=tt.current;if(!Xe.length||!t||!Ve||Ye==null)return;const u=t.getTime()-Ve.getTime(),y=l.getHistory();y?.startBatch(),Xe.forEach((C,$)=>{const F=`task-${Date.now()}-${$}`,J=C.start?new Date(C.start.getTime()+u):null,ge=C.end?new Date(C.end.getTime()+u):null;l.exec("add-task",{task:{...C,id:F,start:J,end:ge,parent:Ye,row:C.row},target:Ye,mode:"child",skipUndo:$>0})}),y?.endBatch()},[l]);e.useEffect(()=>h?l.intercept("hotkey",u=>{if(u.key==="ctrl+c"||u.key==="meta+c")return st(),!1;if(u.key==="ctrl+v"||u.key==="meta+v")return nt(),!1}):void 0,[h,l,st,nt]);const rt=e.useMemo(()=>{if(!N)return null;const t=Math.min(N.startX,N.currentX),u=Math.min(N.startY,N.currentY),y=Math.abs(N.currentX-N.startX),C=Math.abs(N.currentY-N.startY);return{left:`${t}px`,top:`${u}px`,width:`${y}px`,height:`${C}px`}},[N]);return c.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${de.length?de[0].$h:0}px`},ref:Q,onContextMenu:ht,onMouseDown:V,onMouseMove:Ie,onTouchStart:we,onTouchMove:Ge,onTouchEnd:b,onClick:Ne,onDoubleClick:j,onDragStart:t=>(t.preventDefault(),!1),children:[c.jsx(Ct,{onSelectLink:ke,selectedLink:se,readonly:n}),de.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const u=`wx-bar wx-${Ze(t.type)}`+(me&&I&&t.id===I.id?" wx-touch":"")+(d&&d.id===t.id?" wx-selected":"")+(ne.has(t.id)?" wx-selected":"")+(Be(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(g&&t.segments?" wx-split":""),y="wx-link wx-left"+(d?" wx-visible":"")+(!d||!ue(t.id,!0)&&et(t.id)?" wx-target":"")+(d&&d.id===t.id&&d.start?" wx-selected":"")+(Be(t.id)?" wx-critical":""),C="wx-link wx-right"+(d?" wx-visible":"")+(!d||!ue(t.id,!1)&&et(t.id)?" wx-target":"")+(d&&d.id===t.id&&!d.start?" wx-selected":"")+(Be(t.id)?" wx-critical":"");return c.jsxs(e.Fragment,{children:[!t.$skip&&c.jsxs("div",{className:"wx-GKbcLEGA "+u,style:xt(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:v===t.id?0:-1,children:[n?null:t.id===se?.target&&se?.type[2]==="s"?c.jsx(be.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+y,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?c.jsxs(c.Fragment,{children:[t.progress&&!(g&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:c.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(g&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?c.jsx(r,{data:t,api:l,onAction:Je}):g&&t.segments?c.jsx(St,{task:t,type:Ze(t.type)}):c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?c.jsx(r,{data:t,api:l,onAction:Je}):c.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===se?.target&&se?.type[2]==="e"?c.jsx(be.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+C,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),x&&!t.$skip_baseline?c.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:mt(t)}):null]},t.id)}),N&&rt&&c.jsx("div",{className:"wx-GKbcLEGA wx-marquee-selection",style:rt})]})}function jt(s){const{highlightTime:n}=s,r=e.useContext(He),a=M.useStore(r,"_scales");return c.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:a.width},children:(a?.rows||[]).map((o,D)=>c.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${o.height}px`},children:(o.cells||[]).map((h,l)=>{const f=n?n(h.date,h.unit):"",A="wx-cell "+(h.css||"")+" "+(f||""),p=typeof h.value=="string"&&h.value.includes("<");return c.jsx("div",{className:"wx-ZkvhDKir "+A,style:{width:`${h.width}px`},...p?{dangerouslySetInnerHTML:{__html:h.value}}:{children:h.value}},l)})},D))})}const $t=new Map;function Dt(s){const n=e.useRef(null),r=e.useRef(0),a=e.useRef(null),o=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(o)return cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{const D={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};$t.set(s,D),window.dispatchEvent(new CustomEvent("render-metric",{detail:D}))}),()=>cancelAnimationFrame(a.current)})}function Lt(s){const{readonly:n,fullWidth:r,fullHeight:a,taskTemplate:o,cellBorders:D,highlightTime:h,multiTaskRows:l=!1,rowMapping:f=null,marqueeSelect:A=!1,copyPaste:p=!1,scrollToCurrentWeek:X=!1,currentWeekColor:E=null}=s,m=e.useContext(He),[H,x]=M.useStoreWithCounter(m,"_selected"),R=M.useStore(m,"scrollTop"),K=M.useStore(m,"cellHeight"),L=M.useStore(m,"cellWidth"),z=M.useStore(m,"_scales"),S=M.useStore(m,"_markers"),G=M.useStore(m,"_scrollTask"),g=M.useStore(m,"zoom"),ee=M.useStore(m,"_tasks"),[Y,de]=e.useState(),W=e.useRef(null),le=e.useRef(0),te=e.useRef(!1),d=1+(z?.rows?.length||0),T=e.useMemo(()=>{if(!l||!f||!ee?.length)return null;const k=new Map,P=new Map,Z=[];return ee.forEach(B=>{const O=f.taskRows.get(B.id)??B.id;P.has(O)||(P.set(O,Z.length),Z.push(O))}),ee.forEach(B=>{const O=f.taskRows.get(B.id)??B.id,Q=P.get(O)??0;k.set(B.id,Q*K)}),k},[ee,l,f,K]),I=e.useMemo(()=>{const k=[];return H&&H.length&&K&&H.forEach(P=>{const Z=T?.get(P.id)??P.$y;k.push({height:`${K}px`,top:`${Z-3}px`})}),k},[x,K,T]),oe=e.useMemo(()=>Math.max(Y||0,a),[Y,a]);e.useEffect(()=>{const k=W.current;k&&typeof R=="number"&&(k.scrollTop=R)},[R]);const re=()=>{se()};function se(k){const P=W.current;if(!P)return;const Z={};Z.left=P.scrollLeft,m.exec("scroll-chart",Z)}function ce(){const k=W.current,Z=Math.ceil((Y||0)/(K||1))+1,B=Math.floor((k&&k.scrollTop||0)/(K||1)),O=Math.max(0,B-d),Q=B+Z+d,ye=O*(K||0);m.exec("render-data",{start:O,end:Q,from:ye})}e.useEffect(()=>{ce()},[Y,R]);const me=e.useCallback(k=>{if(!k)return;const{id:P,mode:Z}=k;if(Z.toString().indexOf("x")<0)return;const B=W.current;if(!B)return;const{clientWidth:O}=B,Q=m.getTask(P);if(Q.$x+Q.$w<B.scrollLeft)m.exec("scroll-chart",{left:Q.$x-(L||0)}),B.scrollLeft=Q.$x-(L||0);else if(Q.$x>=O+B.scrollLeft){const ye=O<Q.$w?L||0:Q.$w;m.exec("scroll-chart",{left:Q.$x-O+ye}),B.scrollLeft=Q.$x-O+ye}},[m,L]);e.useEffect(()=>{me(G)},[G]);function Re(k){if(g&&(k.ctrlKey||k.metaKey)){k.preventDefault();const P=W.current,Z=k.clientX-(P?P.getBoundingClientRect().left:0);if(le.current+=k.deltaY,Math.abs(le.current)>=150){const O=-Math.sign(le.current);le.current=0,m.exec("zoom-scale",{dir:O,offset:Z})}}}const Ce=e.useCallback(k=>{const P=h(k.date,k.unit);return P?{css:P,width:k.width}:null},[h]),je=e.useMemo(()=>{if(!z||!h||!["hour","day","week"].includes(z.minUnit))return null;let P=0;return z.rows[z.rows.length-1].cells.map(Z=>{const B=Ce(Z),O=P;return P+=Z.width,B?{...B,left:O}:null})},[z,h,Ce]),Se=e.useCallback(k=>{k.eventSource="chart",m.exec("hotkey",k)},[m]);e.useEffect(()=>{const k=W.current;if(!k)return;const P=()=>de(k.clientHeight);P();const Z=new ResizeObserver(()=>P());return Z.observe(k),()=>{Z.disconnect()}},[W.current]);const N=e.useRef(null);return e.useEffect(()=>{const k=W.current;if(k&&!N.current)return N.current=at.hotkeys(k,{keys:{arrowup:!0,arrowdown:!0},exec:P=>Se(P)}),()=>{N.current?.destroy(),N.current=null}},[]),e.useEffect(()=>{const k=W.current;if(!k)return;const P=Re;return k.addEventListener("wheel",P),()=>{k.removeEventListener("wheel",P)}},[Re]),e.useEffect(()=>{if(!X||te.current||!z||!W.current||!Y)return;const k=W.current,{clientWidth:P}=k,Z=new Date,B=z.rows[z.rows.length-1]?.cells;if(!B)return;let O=-1,Q=0;const ye=[];for(let q=0;q<B.length;q++){const ie=B[q];ye.push({left:Q,width:ie.width});const ae=ie.date;if(ie.unit==="week"){const De=new Date(ae);De.setDate(De.getDate()+7),Z>=ae&&Z<De&&(O=q)}else ie.unit==="day"&&Z.getFullYear()===ae.getFullYear()&&Z.getMonth()===ae.getMonth()&&Z.getDate()===ae.getDate()&&(O=q);Q+=ie.width}let v=O;if(O>0&&(v=O-1),v>=0&&ye[v]){const q=ye[v],ie=Math.max(0,q.left);k.scrollLeft=ie,m.exec("scroll-chart",{left:ie}),te.current=!0}},[X,z,Y,m]),Dt("chart"),c.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:W,onScroll:re,children:[c.jsx(jt,{highlightTime:h,scales:z}),S&&S.length?c.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${oe}px`},children:S.map((k,P)=>c.jsx("div",{className:`wx-mR7v2Xag wx-marker ${k.css||""}`,style:{left:`${k.left}px`},children:c.jsx("div",{className:"wx-mR7v2Xag wx-content",children:k.text})},P))}):null,c.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${oe}px`},children:[je?c.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:je.map((k,P)=>k?c.jsx("div",{className:"wx-mR7v2Xag "+k.css,style:{width:`${k.width}px`,left:`${k.left}px`}},P):null)}):null,c.jsx(Mt,{borders:D}),H&&H.length?H.map((k,P)=>k.$y?c.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":k.id,style:I[P]},k.id):null):null,c.jsx(Rt,{readonly:n,taskTemplate:o,multiTaskRows:l,rowMapping:f,marqueeSelect:A,copyPaste:p})]})]})}function It(s){const{position:n="after",size:r=4,dir:a="x",onMove:o,onDisplayChange:D,compactMode:h,containerWidth:l=0,leftThreshold:f=50,rightThreshold:A=50}=s,[p,X]=M.useWritableProp(s.value??0),[E,m]=M.useWritableProp(s.display??"all");function H(se){let ce=0;n=="center"?ce=r/2:n=="before"&&(ce=r);const me={size:[r+"px","auto"],p:[se-ce+"px","0px"],p2:["auto","0px"]};if(a!="x")for(let Re in me)me[Re]=me[Re].reverse();return me}const[x,R]=e.useState(!1),[K,L]=e.useState(null),z=e.useRef(0),S=e.useRef(),G=e.useRef(),g=e.useRef(E);e.useEffect(()=>{g.current=E},[E]),e.useEffect(()=>{K===null&&p>0&&L(p)},[K,p]);function ee(se){return a=="x"?se.clientX:se.clientY}const Y=e.useCallback(se=>{const ce=S.current+ee(se)-z.current;X(ce);let me;ce<=f?me="chart":l-ce<=A?me="grid":me="all",g.current!==me&&(m(me),g.current=me),G.current&&clearTimeout(G.current),G.current=setTimeout(()=>o&&o(ce),100)},[l,f,A,o]),de=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",R(!1),window.removeEventListener("mousemove",Y),window.removeEventListener("mouseup",de)},[Y]),W=e.useMemo(()=>E!=="all"?"auto":a=="x"?"ew-resize":"ns-resize",[E,a]),le=e.useCallback(se=>{!h&&(E==="grid"||E==="chart")||(z.current=ee(se),S.current=p,R(!0),document.body.style.cursor=W,document.body.style.userSelect="none",window.addEventListener("mousemove",Y),window.addEventListener("mouseup",de))},[W,Y,de,p,h,E]);function te(){m("all"),K!==null&&(X(K),o&&o(K))}function d(se){if(h){const ce=E==="chart"?"grid":"chart";m(ce),D(ce)}else if(E==="grid"||E==="chart")te(),D("all");else{const ce=se==="left"?"chart":"grid";m(ce),D(ce)}}function T(){d("left")}function I(){d("right")}const oe=e.useMemo(()=>H(p),[p,n,r,a]),re=["wx-resizer",`wx-resizer-${a}`,`wx-resizer-display-${E}`,x?"wx-resizer-active":""].filter(Boolean).join(" ");return c.jsxs("div",{className:"wx-pFykzMlT "+re,onMouseDown:le,style:{width:oe.size[0],height:oe.size[1],cursor:W},children:[c.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:T})}),c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:I})})]}),c.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const Nt=650;function dt(s){let n;function r(){n=new ResizeObserver(o=>{for(let D of o)if(D.target===document.body){let h=D.contentRect.width<=Nt;s(h)}}),n.observe(document.body)}function a(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:a}}function Pt(s){const{taskTemplate:n,readonly:r,cellBorders:a,highlightTime:o,onTableAPIChange:D,multiTaskRows:h=!1,rowMapping:l=null,marqueeSelect:f=!1,copyPaste:A=!1,scrollToCurrentWeek:p=!1,currentWeekColor:X=null}=s,E=e.useContext(He),m=M.useStore(E,"_tasks"),H=M.useStore(E,"_scales"),x=M.useStore(E,"cellHeight"),R=M.useStore(E,"columns"),K=M.useStore(E,"_scrollTask"),L=M.useStore(E,"undo"),z=e.useMemo(()=>{if(!h)return l;const v=new Map,q=new Map;return m.forEach(ie=>{const ae=ie.row??ie.id;q.set(ie.id,ae),v.has(ae)||v.set(ae,[]),v.get(ae).push(ie.id)}),{rowMap:v,taskRows:q}},[m,h,l]),[S,G]=e.useState(!1);let[g,ee]=e.useState(0);const[Y,de]=e.useState(0),[W,le]=e.useState(0),[te,d]=e.useState(void 0),[T,I]=e.useState("all"),oe=e.useRef(null),re=e.useCallback(v=>{G(q=>(v!==q&&(v?(oe.current=T,T==="all"&&I("grid")):(!oe.current||oe.current==="all")&&I("all")),v))},[T]);e.useEffect(()=>{const v=dt(re);return v.observe(),()=>{v.disconnect()}},[re]);const se=e.useMemo(()=>{let v;return R.every(q=>q.width&&!q.flexgrow)?v=R.reduce((q,ie)=>q+parseInt(ie.width),0):S&&T==="chart"?v=parseInt(R.find(q=>q.id==="action")?.width)||50:v=440,g=v,v},[R,S,T]);e.useEffect(()=>{ee(se)},[se]);const ce=e.useMemo(()=>(Y??0)-(te??0),[Y,te]),me=e.useMemo(()=>H.width,[H]),Re=e.useMemo(()=>{if(!h||!z)return m.length*x;const v=new Set;return m.forEach(q=>{const ie=z.taskRows.get(q.id)??q.id;v.add(ie)}),v.size*x},[m,x,h,z]),Ce=e.useMemo(()=>H.height+Re+ce,[H,Re,ce]),je=e.useMemo(()=>g+me,[g,me]),Se=e.useRef(null),N=e.useCallback(()=>{Promise.resolve().then(()=>{if((Y??0)>(je??0)){const v=(Y??0)-g;E.exec("expand-scale",{minWidth:v})}})},[Y,je,g,E]);e.useEffect(()=>{let v;return Se.current&&(v=new ResizeObserver(N),v.observe(Se.current)),()=>{v&&v.disconnect()}},[Se.current,N]),e.useEffect(()=>{N()},[me]);const k=e.useRef(null),P=e.useRef(null),Z=e.useCallback(()=>{const v=k.current;v&&E.exec("scroll-chart",{top:v.scrollTop})},[E]),B=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{B.current={rTasks:m,rScales:H,rCellHeight:x,scrollSize:ce,ganttDiv:k.current,ganttHeight:W??0}},[m,H,x,ce,W]);const O=e.useCallback(v=>{if(!v)return;const{rTasks:q,rScales:ie,rCellHeight:ae,scrollSize:De,ganttDiv:w,ganttHeight:ne}=B.current;if(!w)return;const{id:he}=v,_=q.findIndex(V=>V.id===he);if(_>-1){const V=ne-ie.height,we=_*ae,ke=w.scrollTop;let Me=null;we<ke?Me=we:we+ae>ke+V&&(Me=we-V+ae+De),Me!==null&&(E.exec("scroll-chart",{top:Math.max(Me,0)}),k.current.scrollTop=Math.max(Me,0))}},[E]);e.useEffect(()=>{O(K)},[K]),e.useEffect(()=>{const v=k.current,q=P.current;if(!v||!q)return;const ie=()=>{pt.flushSync(()=>{le(v.offsetHeight),de(v.offsetWidth),d(q.offsetWidth)})},ae=new ResizeObserver(ie);return ae.observe(v),()=>ae.disconnect()},[k.current]);const Q=e.useRef(null),ye=e.useRef(null);return e.useEffect(()=>{ye.current&&(ye.current.destroy(),ye.current=null);const v=Q.current;if(v)return ye.current=at.hotkeys(v,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,"meta+c":!0,"meta+v":!0,"meta+x":!0,"meta+d":!0,backspace:!0,"ctrl+z":L,"ctrl+y":L,"meta+z":L,"meta+shift+z":L},exec:q=>{q.isInput||E.exec("hotkey",q)}}),()=>{ye.current?.destroy(),ye.current=null}},[L]),c.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:k,onScroll:Z,children:c.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:Ce,width:"100%"},ref:P,children:c.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:W,width:te},children:c.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:Q,children:[R.length?c.jsxs(c.Fragment,{children:[c.jsx(vt,{display:T,compactMode:S,columnWidth:se,width:g,readonly:r,fullHeight:Re,onTableAPIChange:D,multiTaskRows:h,rowMapping:z}),c.jsx(It,{value:g,display:T,compactMode:S,containerWidth:Y,onMove:v=>ee(v),onDisplayChange:v=>I(v)})]}):null,c.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:Se,children:c.jsx(Lt,{readonly:r,fullWidth:me,fullHeight:Re,taskTemplate:n,cellBorders:a,highlightTime:o,multiTaskRows:h,rowMapping:z,marqueeSelect:f,copyPaste:A,scrollToCurrentWeek:p,currentWeekColor:X})})]})})})})}function At(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function Wt(s,n){return typeof s=="function"?s:ve.dateToString(s,n)}function ft(s,n){return s.map(({format:r,...a})=>({...a,format:Wt(r,n)}))}function Ht(s,n){const r=At(n);for(let a in r)r[a]=ve.dateToString(r[a],s);return r}function zt(s,n){if(!s||!s.length)return s;const r=ve.dateToString("%d-%m-%Y",n);return s.map(a=>a.template?a:a.id==="start"||a.id=="end"?{...a,_template:o=>r(o),template:o=>r(o)}:a.id==="duration"?{...a,_template:o=>o,template:o=>o}:a)}function Gt(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:ft(r.scales,n)}))}:s}const _t=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),Ot=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],qt=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:a=pe.defaultTaskTypes,tasks:o=[],selected:D=[],activeTask:h=null,links:l=[],scales:f=Ot,columns:A=pe.defaultColumns,start:p=null,end:X=null,lengthUnit:E="day",durationUnit:m="day",cellWidth:H=100,cellHeight:x=38,scaleHeight:R=36,readonly:K=!1,cellBorders:L="full",zoom:z=!1,baselines:S=!1,highlightTime:G=null,init:g=null,autoScale:ee=!0,unscheduledTasks:Y=!1,criticalPath:de=null,schedule:W={type:"forward"},projectStart:le=null,projectEnd:te=null,calendar:d=null,undo:T=!1,splitTasks:I=!1,multiTaskRows:oe=!1,marqueeSelect:re=!1,copyPaste:se=!1,currentWeekHighlight:ce=!1,currentWeekColor:me=null,scrollToCurrentWeek:Re=!1,...Ce},je){const Se=e.useRef();Se.current=Ce;const N=e.useMemo(()=>new pe.DataStore(M.writable),[]),k=e.useMemo(()=>({...Ue.en,...Ke.en}),[]),P=e.useContext(be.context.i18n),Z=e.useMemo(()=>P?P.extend(k,!0):ve.locale(k),[P,k]),B=e.useMemo(()=>Z.getRaw().calendar,[Z]),O=e.useMemo(()=>{let V={zoom:Gt(z,B),scales:ft(f,B),columns:zt(A,B),links:pe.normalizeLinks(l),cellWidth:H};return V.zoom&&(V={...V,...pe.normalizeZoom(V.zoom,Ht(B,Z.getGroup("gantt")),V.scales,H)}),V},[z,f,A,l,H,B,Z]),Q=e.useRef(null);Q.current!==o&&(pe.parseTaskDates(o,{durationUnit:m,splitTasks:I,calendar:d}),Q.current=o),e.useEffect(()=>{pe.parseTaskDates(o,{durationUnit:m,splitTasks:I,calendar:d})},[o,m,d,I]);const ye=e.useMemo(()=>{if(!oe)return null;const V=new Map,we=new Map,ke=Me=>{Me.forEach(Te=>{const Ie=Te.row??Te.id;we.set(Te.id,Ie),V.has(Ie)||V.set(Ie,[]),V.get(Ie).push(Te.id),Te.data&&Te.data.length>0&&ke(Te.data)})};return ke(o),{rowMap:V,taskRows:we}},[o,oe]),v=e.useMemo(()=>N.in,[N]),q=e.useRef(null);q.current===null&&(q.current=new wt.EventBusRouter((V,we)=>{const ke="on"+_t(V);Se.current&&Se.current[ke]&&Se.current[ke](we)}),v.setNext(q.current));const[ie,ae]=e.useState(null),De=e.useRef(null);De.current=ie;const w=e.useMemo(()=>({getState:N.getState.bind(N),getReactiveState:N.getReactive.bind(N),getStores:()=>({data:N}),exec:v.exec,setNext:V=>(q.current=q.current.setNext(V),q.current),intercept:v.intercept.bind(v),on:v.on.bind(v),detach:v.detach.bind(v),getTask:N.getTask.bind(N),serialize:N.serialize.bind(N),getTable:V=>V?new Promise(we=>setTimeout(()=>we(De.current),1)):De.current,getHistory:()=>N.getHistory()}),[N,v]);e.useImperativeHandle(je,()=>({...w}),[w]);const ne=e.useRef(0);e.useEffect(()=>{ne.current?N.init({tasks:o,links:O.links,start:p,columns:O.columns,end:X,lengthUnit:E,cellWidth:O.cellWidth,cellHeight:x,scaleHeight:R,scales:O.scales,taskTypes:a,zoom:O.zoom,selected:D,activeTask:h,baselines:S,autoScale:ee,unscheduledTasks:Y,markers:r,durationUnit:m,criticalPath:de,schedule:W,projectStart:le,projectEnd:te,calendar:d,undo:T,_weekStart:B.weekStart,splitTasks:I}):g&&g(w),ne.current++},[w,g,o,O,p,X,E,x,R,a,D,h,S,ee,Y,r,m,de,W,le,te,d,T,B,I,N]),ne.current===0&&N.init({tasks:o,links:O.links,start:p,columns:O.columns,end:X,lengthUnit:E,cellWidth:O.cellWidth,cellHeight:x,scaleHeight:R,scales:O.scales,taskTypes:a,zoom:O.zoom,selected:D,activeTask:h,baselines:S,autoScale:ee,unscheduledTasks:Y,markers:r,durationUnit:m,criticalPath:de,schedule:W,projectStart:le,projectEnd:te,calendar:d,undo:T,_weekStart:B.weekStart,splitTasks:I});const he=e.useMemo(()=>{const V=new Date,we=B?.weekStart??0,ke=new Date(V),Te=(ke.getDay()-we+7)%7;ke.setDate(ke.getDate()-Te),ke.setHours(0,0,0,0);const Ie=new Date(ke);return Ie.setDate(Ie.getDate()+7),Ge=>Ge>=ke&&Ge<Ie},[B]),_=e.useMemo(()=>(V,we)=>{let ke=[];if(d)we=="day"&&!d.getDayHours(V)&&ke.push("wx-weekend"),we=="hour"&&!d.getDayHours(V)&&ke.push("wx-weekend");else if(G){const Me=G(V,we);Me&&ke.push(Me)}return ce&&(we==="week"||we==="day")&&he(V)&&ke.push("wx-current-week"),ke.join(" ")},[d,G,ce,he]);return c.jsx(be.context.i18n.Provider,{value:Z,children:c.jsx(He.Provider,{value:w,children:c.jsx(Pt,{taskTemplate:n,readonly:K,cellBorders:L,highlightTime:_,onTableAPIChange:ae,multiTaskRows:oe,rowMapping:ye,marqueeSelect:re,copyPaste:se,scrollToCurrentWeek:Re,currentWeekColor:me})})})});function Yt({api:s=null,items:n=[]}){const r=e.useContext(be.context.i18n),a=e.useMemo(()=>r||ve.locale(Ke.en),[r]),o=e.useMemo(()=>a.getGroup("gantt"),[a]),D=M.useStoreLater(s,"_selected"),h=M.useStoreLater(s,"undo"),l=M.useStoreLater(s,"history"),f=M.useStoreLater(s,"splitTasks"),A=["undo","redo"],p=e.useMemo(()=>{const E=pe.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:pe.getToolbarButtons({undo:h,splitTasks:f})).map(H=>{let x={...H,disabled:!1};return x.handler=pe.isHandledAction(E,x.id)?R=>pe.handleAction(s,R.id,null,o):x.handler,x.text&&(x.text=o(x.text)),x.menuText&&(x.menuText=o(x.menuText)),x})},[n,s,o,h,f]),X=e.useMemo(()=>{const E=[];return p.forEach(m=>{const H=m.id;if(H==="add-task")E.push(m);else if(A.includes(H))A.includes(H)&&E.push({...m,disabled:m.isDisabled(l)});else{if(!D?.length||!s)return;E.push({...m,disabled:m.isDisabled&&D.some(x=>m.isDisabled(x,s.getState()))})}}),E.filter((m,H)=>{if(s&&m.isHidden)return!D.some(x=>m.isHidden(x,s.getState()));if(m.comp==="separator"){const x=E[H+1];if(!x||x.comp==="separator")return!1}return!0})},[s,D,l,p]);return r?c.jsx(ot.Toolbar,{items:X}):c.jsx(be.context.i18n.Provider,{value:a,children:c.jsx(ot.Toolbar,{items:X})})}const Ft=e.forwardRef(function({options:n=[],api:r=null,resolver:a=null,filter:o=null,at:D="point",children:h,onClick:l,css:f},A){const p=e.useRef(null),X=e.useRef(null),E=e.useContext(be.context.i18n),m=e.useMemo(()=>E||ve.locale({...Ke.en,...Ue.en}),[E]),H=e.useMemo(()=>m.getGroup("gantt"),[m]),x=M.useStoreLater(r,"taskTypes"),R=M.useStoreLater(r,"selected"),K=M.useStoreLater(r,"_selected"),L=M.useStoreLater(r,"splitTasks"),z=e.useMemo(()=>pe.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{p.current&&p.current.show&&p.current.show()}),r.on("drag-task",()=>{p.current&&p.current.show&&p.current.show()}))},[r]);function S(d){return d.map(T=>(T={...T},T.text&&(T.text=H(T.text)),T.subtext&&(T.subtext=H(T.subtext)),T.data&&(T.data=S(T.data)),T))}function G(){const d=n.length?n:pe.getMenuOptions({splitTasks:L}),T=d.find(I=>I.id==="convert-task");return T&&(T.data=[],(x||[]).forEach(I=>{T.data.push(T.dataFactory(I))})),S(d)}const g=e.useMemo(()=>G(),[r,n,x,L,H]),ee=e.useMemo(()=>K&&K.length?K:[],[K]),Y=e.useCallback((d,T)=>{let I=d?r?.getTask(d):null;if(a){const oe=a(d,T);I=oe===!0?I:oe}if(I){const oe=ve.locateID(T.target,"data-segment");oe!==null?X.current={id:I.id,segmentIndex:oe}:X.current=I.id,(!Array.isArray(R)||!R.includes(I.id))&&r&&r.exec&&r.exec("select-task",{id:I.id})}return I},[r,a,R]),de=e.useCallback(d=>{const T=d.action;T&&(pe.isHandledAction(z,T.id)&&pe.handleAction(r,T.id,X.current,H),l&&l(d))},[r,H,l,z]),W=e.useCallback((d,T)=>{const I=ee.length?ee:T?[T]:[];let oe=o?I.every(re=>o(d,re)):!0;if(oe&&(d.isHidden&&(oe=!I.some(re=>d.isHidden(re,r.getState(),X.current))),d.isDisabled)){const re=I.some(se=>d.isDisabled(se,r.getState(),X.current));d.disabled=re}return oe},[o,ee,r]);e.useImperativeHandle(A,()=>({show:(d,T)=>{p.current&&p.current.show&&p.current.show(d,T)}}));const le=e.useCallback(d=>{p.current&&p.current.show&&p.current.show(d)},[]),te=c.jsxs(c.Fragment,{children:[c.jsx(kt.ContextMenu,{filter:W,options:g,dataKey:"id",resolver:Y,onClick:de,at:D,ref:p,css:f}),c.jsx("span",{onContextMenu:le,"data-menu-ignore":"true",children:typeof h=="function"?h():h})]});if(!E&&be.context.i18n?.Provider){const d=be.context.i18n.Provider;return c.jsx(d,{value:m,children:te})}return te});function Xt({api:s,autoSave:n,onLinksChange:r}){const o=e.useContext(be.context.i18n).getGroup("gantt"),D=M.useStore(s,"activeTask"),h=M.useStore(s,"_activeTask"),l=M.useStore(s,"_links"),f=M.useStore(s,"schedule"),A=M.useStore(s,"unscheduledTasks"),[p,X]=e.useState();function E(){if(D){const R=l.filter(L=>L.target==D).map(L=>({link:L,task:s.getTask(L.source)})),K=l.filter(L=>L.source==D).map(L=>({link:L,task:s.getTask(L.target)}));return[{title:o("Predecessors"),data:R},{title:o("Successors"),data:K}]}}e.useEffect(()=>{X(E())},[D,l]);const m=e.useMemo(()=>[{id:"e2s",label:o("End-to-start")},{id:"s2s",label:o("Start-to-start")},{id:"e2e",label:o("End-to-end")},{id:"s2e",label:o("Start-to-end")}],[o]);function H(R){n?s.exec("delete-link",{id:R}):(X(K=>(K||[]).map(L=>({...L,data:L.data.filter(z=>z.link.id!==R)}))),r&&r({id:R,action:"delete-link",data:{id:R}}))}function x(R,K){n?s.exec("update-link",{id:R,link:K}):(X(L=>(L||[]).map(z=>({...z,data:z.data.map(S=>S.link.id===R?{...S,link:{...S.link,...K}}:S)}))),r&&r({id:R,action:"update-link",data:{id:R,link:K}}))}return c.jsx(c.Fragment,{children:(p||[]).map((R,K)=>R.data.length?c.jsx("div",{className:"wx-j93aYGQf wx-links",children:c.jsx(be.Field,{label:R.title,position:"top",children:c.jsx("table",{children:c.jsx("tbody",{children:R.data.map(L=>c.jsxs("tr",{children:[c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:L.task.text||""})}),f?.auto&&L.link.type==="e2s"?c.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:c.jsx(be.Text,{type:"number",placeholder:o("Lag"),value:L.link.lag,disabled:A&&h?.unscheduled,onChange:z=>{z.input||x(L.link.id,{lag:z.value})}})}):null,c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:c.jsx(be.Combo,{value:L.link.type,placeholder:o("Select link type"),options:m,onChange:z=>x(L.link.id,{type:z.value}),children:({option:z})=>z.label})})}),c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>H(L.link.id),role:"button"})})]},L.link.id))})})})},K):null)})}function Kt(s){const{value:n,time:r,format:a,onchange:o,onChange:D,...h}=s,l=D??o;function f(A){const p=new Date(A.value);p.setHours(n.getHours()),p.setMinutes(n.getMinutes()),l&&l({value:p})}return c.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[c.jsx(be.DatePicker,{...h,value:n,onChange:f,format:a,buttons:["today"],clear:!1}),r?c.jsx(be.TimePicker,{value:n,onChange:l,format:a}):null]})}We.registerEditorItem("select",be.RichSelect);We.registerEditorItem("date",Kt);We.registerEditorItem("twostate",be.TwoState);We.registerEditorItem("slider",be.Slider);We.registerEditorItem("counter",be.Counter);We.registerEditorItem("links",Xt);function Bt({api:s,items:n=[],css:r="",layout:a="default",readonly:o=!1,placement:D="sidebar",bottomBar:h=!0,topBar:l=!0,autoSave:f=!0,focus:A=!1,hotkeys:p={}}){const X=e.useContext(be.context.i18n),E=e.useMemo(()=>X||ve.locale({...Ke.en,...Ue.en}),[X]),m=e.useMemo(()=>E.getGroup("gantt"),[E]),H=E.getRaw(),x=e.useMemo(()=>{const w=H.gantt?.dateFormat||H.formats?.dateFormat;return ve.dateToString(w,H.calendar)},[H]),R=e.useMemo(()=>{if(l===!0&&!o){const w=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:m("Delete"),id:"delete"}];return f?{items:w}:{items:[...w,{comp:"button",type:"primary",text:m("Save"),id:"save"}]}}return l},[l,o,f,m]),[K,L]=e.useState(!1),z=e.useMemo(()=>K?"wx-full-screen":"",[K]),S=e.useCallback(w=>{L(w)},[]);e.useEffect(()=>{const w=dt(S);return w.observe(),()=>{w.disconnect()}},[S]);const G=M.useStore(s,"_activeTask"),g=M.useStore(s,"activeTask"),ee=M.useStore(s,"unscheduledTasks"),Y=M.useStore(s,"links"),de=M.useStore(s,"splitTasks"),W=e.useMemo(()=>de&&g?.segmentIndex,[de,g]),le=e.useMemo(()=>W||W===0,[W]),te=e.useMemo(()=>pe.getEditorItems({unscheduledTasks:ee}),[ee]),d=M.useStore(s,"undo"),[T,I]=e.useState({}),[oe,re]=e.useState(null),[se,ce]=e.useState(),[me,Re]=e.useState(null),Ce=M.useStore(s,"taskTypes"),je=e.useMemo(()=>{if(!G)return null;let w;if(le&&G.segments?w={...G.segments[W]}:w={...G},o){let ne={parent:w.parent};return te.forEach(({key:he,comp:_})=>{if(_!=="links"){const V=w[he];_==="date"&&V instanceof Date?ne[he]=x(V):_==="slider"&&he==="progress"?ne[he]=`${V}%`:ne[he]=V}}),ne}return w||null},[G,le,W,o,te,x]);e.useEffect(()=>{ce(je)},[je]),e.useEffect(()=>{I({}),Re(null),re(null)},[g]);function Se(w,ne){return w.map(he=>{const _={...he};if(he.config&&(_.config={..._.config}),_.comp==="links"&&s&&(_.api=s,_.autoSave=f,_.onLinksChange=P),_.comp==="select"&&_.key==="type"){const V=_.options??(Ce||[]);_.options=V.map(we=>({...we,label:m(we.label)}))}return _.comp==="slider"&&_.key==="progress"&&(_.labelTemplate=V=>`${m(_.label)} ${V}%`),_.label&&(_.label=m(_.label)),_.config?.placeholder&&(_.config.placeholder=m(_.config.placeholder)),ne&&(_.isDisabled&&_.isDisabled(ne,s.getState())?_.disabled=!0:delete _.disabled),_})}const N=e.useMemo(()=>{let w=n.length?n:te;return w=Se(w,se),se?w.filter(ne=>!ne.isHidden||!ne.isHidden(se,s.getState())):w},[n,te,se,Ce,m,s,f]),k=e.useMemo(()=>N.map(w=>w.key),[N]);function P({id:w,action:ne,data:he}){I(_=>({..._,[w]:{action:ne,data:he}}))}const Z=e.useCallback(()=>{for(let w in T)if(Y.byId(w)){const{action:ne,data:he}=T[w];s.exec(ne,he)}},[s,T,Y]),B=e.useCallback(()=>{const w=g?.id||g;if(le){if(G?.segments){const ne=G.segments.filter((he,_)=>_!==W);s.exec("update-task",{id:w,task:{segments:ne}})}}else s.exec("delete-task",{id:w})},[s,g,le,G,W]),O=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),Q=e.useCallback(w=>{const{item:ne,changes:he}=w;ne.id==="delete"&&B(),ne.id==="save"&&(he.length?O():Z()),ne.comp&&O()},[s,g,f,Z,B,O]),ye=e.useCallback((w,ne,he)=>(ee&&w.type==="summary"&&(w.unscheduled=!1),pe.prepareEditTask(w,s.getState(),ne),he||re(!1),w),[ee,s]),v=e.useCallback(w=>{w={...w,unscheduled:ee&&w.unscheduled&&w.type!=="summary"},delete w.links,delete w.data,(k.indexOf("duration")===-1||w.segments&&!w.duration)&&delete w.duration;const ne={id:g?.id||g,task:w,...le&&{segmentIndex:W}};f&&oe&&(ne.inProgress=oe),s.exec("update-task",ne),f||Z()},[s,g,ee,f,Z,k,le,W,oe]),q=e.useCallback(w=>{let{update:ne,key:he,input:_}=w;if(_&&re(!0),w.update=ye({...ne},he,_),!f)ce(w.update);else if(!me&&!_){const V=N.find(Me=>Me.key===he),we=ne[he];(!V.validation||V.validation(we))&&(!V.required||we)&&v(w.update)}},[f,ye,me,N,v]),ie=e.useCallback(w=>{f||v(w.values)},[f,v]),ae=e.useCallback(w=>{Re(w.errors)},[]),De=e.useMemo(()=>d?{"ctrl+z":w=>{w.preventDefault(),s.exec("undo")},"ctrl+y":w=>{w.preventDefault(),s.exec("redo")}}:{},[d,s]);return je?c.jsx(be.Locale,{children:c.jsx(We.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${z} ${r}`,items:N,values:je,topBar:R,bottomBar:h,placement:D,layout:a,readonly:o,autoSave:f,focus:A,onAction:Q,onSave:ie,onValidation:ae,onChange:q,hotkeys:p&&{...De,...p}})}):null}const Vt=({children:s,columns:n=null,api:r})=>{const[a,o]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(o)},[r]),c.jsx(ut.HeaderMenu,{api:a,columns:n,children:s})};function Ut(s){const{api:n,content:r,children:a}=s,o=e.useRef(null),D=e.useRef(null),[h,l]=e.useState({}),[f,A]=e.useState(null),[p,X]=e.useState({});function E(S){for(;S;){if(S.getAttribute){const G=S.getAttribute("data-tooltip-id"),g=S.getAttribute("data-tooltip-at"),ee=S.getAttribute("data-tooltip");if(G||ee)return{id:G,tooltip:ee,target:S,at:g}}S=S.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const S=D.current;if(S&&p&&(p.text||r)){const G=S.getBoundingClientRect();let g=!1,ee=p.left,Y=p.top;G.right>=h.right&&(ee=h.width-G.width-5,g=!0),G.bottom>=h.bottom&&(Y=p.top-(G.bottom-h.bottom+2),g=!0),g&&X(de=>de&&{...de,left:ee,top:Y})}},[p,h,r]);const m=e.useRef(null),H=300,x=S=>{clearTimeout(m.current),m.current=setTimeout(()=>{S()},H)};function R(S){let{id:G,tooltip:g,target:ee,at:Y}=E(S.target);if(X(null),A(null),!g)if(G)g=L(G);else{clearTimeout(m.current);return}const de=S.clientX;x(()=>{G&&A(K(z(G)));const W=ee.getBoundingClientRect(),le=o.current,te=le?le.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let d,T;Y==="left"?(d=W.top+5-te.top,T=W.right+5-te.left):(d=W.top+W.height-te.top,T=de-te.left),l(te),X({top:d,left:T,text:g})})}function K(S){return n?.getTask(z(S))||null}function L(S){return K(S)?.text||""}function z(S){const G=parseInt(S);return isNaN(G)?S:G}return c.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:o,onMouseMove:R,children:[p&&(p.text||r)?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:D,style:{top:`${p.top}px`,left:`${p.left}px`},children:r?c.jsx(r,{data:f}):p.text?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:p.text}):null}):null,a]})}function Qt({fonts:s=!0,children:n}){return n?c.jsx(be.Material,{fonts:s,children:n()}):c.jsx(be.Material,{fonts:s})}function Zt({fonts:s=!0,children:n}){return n?c.jsx(be.Willow,{fonts:s,children:n}):c.jsx(be.Willow,{fonts:s})}function Jt({fonts:s=!0,children:n}){return n?c.jsx(be.WillowDark,{fonts:s,children:n}):c.jsx(be.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>pe.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>pe.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>pe.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>pe.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>pe.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>pe.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>pe.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>pe.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>pe.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>We.registerEditorItem});exports.ContextMenu=Ft;exports.Editor=Bt;exports.Gantt=qt;exports.HeaderMenu=Vt;exports.Material=Qt;exports.Toolbar=Yt;exports.Tooltip=Ut;exports.Willow=Zt;exports.WillowDark=Jt;
//# sourceMappingURL=index.cjs.map
