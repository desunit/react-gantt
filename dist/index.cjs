"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("react/jsx-runtime"),e=require("react"),le=require("@svar-ui/react-core"),ae=require("@svar-ui/lib-dom"),He=require("@svar-ui/gantt-locales"),We=require("@svar-ui/core-locales"),Xe=require("@svar-ui/lib-state"),re=require("@svar-ui/gantt-store"),T=require("@svar-ui/lib-react"),Ve=require("@svar-ui/grid-store"),qe=require("@svar-ui/react-grid"),Ye=require("react-dom"),Pe=require("@svar-ui/react-toolbar"),Qe=require("@svar-ui/react-menu"),Se=require("@svar-ui/react-editor"),Me=e.createContext(null);function $e(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function Ue(s,n,r){const a=s.getBoundingClientRect(),l=n.querySelector(".wx-body").getBoundingClientRect();return{top:a.top-l.top,left:a.left-l.left,dt:a.bottom-r.clientY,db:r.clientY-a.top}}function _e(s){return s&&s.getAttribute("data-context-id")}const Oe=5;function Ze(s,n){let r,a,l,u,w,M,m,g,x;function H(C){u=C.clientX,w=C.clientY,M={...Ue(r,s,C),y:n.getTask(l).$y},document.body.style.userSelect="none"}function L(C){r=ae.locate(C),_e(r)&&(l=$e(r),x=setTimeout(()=>{g=!0,n&&n.touchStart&&n.touchStart(),H(C.touches[0])},500),s.addEventListener("touchmove",P),s.addEventListener("contextmenu",R),window.addEventListener("touchend",A))}function R(C){if(g||x)return C.preventDefault(),!1}function D(C){C.which===1&&(r=ae.locate(C),_e(r)&&(l=$e(r),s.addEventListener("mousemove",z),window.addEventListener("mouseup",E),H(C)))}function d(C){s.removeEventListener("mousemove",z),s.removeEventListener("touchmove",P),document.body.removeEventListener("mouseup",E),document.body.removeEventListener("touchend",A),document.body.style.userSelect="",C&&(s.removeEventListener("mousedown",D),s.removeEventListener("touchstart",L))}function O(C){const F=C.clientX-u,B=C.clientY-w;if(!a){if(Math.abs(F)<Oe&&Math.abs(B)<Oe||n&&n.start&&n.start({id:l,e:C})===!1)return;a=r.cloneNode(!0),a.style.pointerEvents="none",a.classList.add("wx-reorder-task"),a.style.position="absolute",a.style.left=M.left+"px",a.style.top=M.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(a,r)}if(a){const j=Math.round(Math.max(0,M.top+B));if(n&&n.move&&n.move({id:l,top:j,detail:m})===!1)return;const X=n.getTask(l),q=X.$y;if(!M.start&&M.y==q)return $();M.start=!0,M.y=X.$y-4,a.style.top=j+"px";const U=document.elementFromPoint(C.clientX,C.clientY),k=ae.locate(U);if(k&&k!==r){const y=$e(k),G=k.getBoundingClientRect(),Y=G.top+G.height/2,J=C.clientY+M.db>Y&&k.nextElementSibling!==r,f=C.clientY-M.dt<Y&&k.previousElementSibling!==r;m?.after==y||m?.before==y?m=null:J?m={id:l,after:y}:f&&(m={id:l,before:y})}}}function z(C){O(C)}function P(C){g?(C.preventDefault(),O(C.touches[0])):x&&(clearTimeout(x),x=null)}function A(){g=null,x&&(clearTimeout(x),x=null),$()}function E(){$()}function $(){r&&(r.style.visibility=""),a&&(a.parentNode.removeChild(a),n&&n.end&&n.end({id:l,top:M.top})),l=r=a=M=m=null,d()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",D),s.addEventListener("touchstart",L),{destroy(){d(!0)}}}function Je({row:s,column:n}){function r(l,u){return{justifyContent:u.align,paddingLeft:`${(l.$level-1)*20}px`}}const a=n&&n._cell;return o.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?o.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):o.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),o.jsx("div",{className:"wx-pqc08MHU wx-text",children:a?o.jsx(a,{row:s,column:n}):s.text})]})}function Fe({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?o.jsx("div",{style:{textAlign:s.align},children:o.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function et(s){const{readonly:n,compactMode:r,width:a=0,display:l="all",columnWidth:u=0,onTableAPIChange:w,multiTaskRows:M=!1,rowMapping:m=null}=s,[g,x]=T.useWritableProp(u),[H,L]=e.useState(),R=e.useContext(le.context.i18n),D=e.useMemo(()=>R.getGroup("gantt"),[R]),d=e.useContext(Me),O=T.useStore(d,"scrollTop"),z=T.useStore(d,"cellHeight"),P=T.useStore(d,"_scrollTask"),A=T.useStore(d,"_selected"),E=T.useStore(d,"area"),$=T.useStore(d,"_tasks"),C=T.useStore(d,"_scales"),F=T.useStore(d,"columns"),B=T.useStore(d,"_sort"),j=T.useStore(d,"calendar"),X=T.useStore(d,"durationUnit"),q=T.useStore(d,"splitTasks"),[U,k]=e.useState(null),y=e.useMemo(()=>!$||!E?[]:$.slice(E.start,E.end),[$,E]),G=e.useCallback((i,p)=>{if(p==="add-task")d.exec(p,{target:i,task:{text:D("New Task")},mode:"child",show:!0});else if(p==="open-task"){const t=y.find(c=>c.id===i);(t?.data||t?.lazy)&&d.exec(p,{id:i,mode:!t.open})}},[y]),Y=e.useCallback(i=>{const p=ae.locateID(i),t=i.target.dataset.action;t&&i.preventDefault(),p?t==="add-task"||t==="open-task"?G(p,t):d.exec("select-task",{id:p,toggle:i.ctrlKey||i.metaKey,range:i.shiftKey,show:!0}):t==="add-task"&&G(null,t)},[d,G]),J=e.useRef(null),f=e.useRef(null),[S,I]=e.useState(0),[Q,ie]=e.useState(!1);e.useEffect(()=>{const i=f.current;if(!i||typeof ResizeObserver>"u")return;const p=()=>I(i.clientWidth);p();const t=new ResizeObserver(p);return t.observe(i),()=>t.disconnect()},[]);const te=e.useRef(null),ce=e.useCallback(i=>{const p=i.id,{before:t,after:c}=i,v=i.onMove;let b=t||c,_=t?"before":"after";if(v){if(_==="after"){const ne=d.getTask(b);ne.data?.length&&ne.open&&(_="before",b=ne.data[0].id)}te.current={id:p,[_]:b}}else te.current=null;d.exec("move-task",{id:p,mode:_,target:b,inProgress:v})},[d]),se=e.useMemo(()=>E?.from??0,[E]),pe=e.useMemo(()=>C?.height??0,[C]),fe=e.useMemo(()=>!r&&l!=="grid"?(g??0)>(a??0):(g??0)>(S??0),[r,l,g,a,S]),N=e.useMemo(()=>{const i={};return fe&&l==="all"||l==="grid"&&fe?i.width=g:l==="grid"&&(i.width="100%"),i},[fe,l,g]),Z=e.useMemo(()=>U&&!y.find(i=>i.id===U.id)?[...y,U]:y,[y,U]),ue=e.useMemo(()=>{if(!M||!m)return Z;const i=new Map,p=new Set;return Z.forEach(t=>{const c=m.taskRows.get(t.id)??t.id;p.has(c)||(i.set(c,{...t,$rowTasks:m.rowMap.get(c)||[t.id]}),p.add(c))}),Array.from(i.values())},[Z,M,m]),oe=e.useMemo(()=>{let i=(F||[]).map(c=>{c={...c};const v=c.header;if(typeof v=="object"){const b=v.text&&D(v.text);c.header={...v,text:b}}else c.header=D(v);return c});const p=i.findIndex(c=>c.id==="text"),t=i.findIndex(c=>c.id==="add-task");if(p!==-1&&(i[p].cell&&(i[p]._cell=i[p].cell),i[p].cell=Je),t!==-1){i[t].cell=i[t].cell||Fe;const c=i[t].header;if(typeof c!="object"&&(i[t].header={text:c}),i[t].header.cell=c.cell||Fe,n)i.splice(t,1);else if(r){const[v]=i.splice(t,1);i.unshift(v)}}return i.length>0&&(i[i.length-1].resize=!1),i},[F,D,n,r]),we=e.useMemo(()=>l==="all"?`${a}px`:l==="grid"?"calc(100% - 4px)":oe.find(i=>i.id==="add-task")?"50px":"0",[l,a,oe]),xe=e.useMemo(()=>{if(ue&&B?.length){const i={};return B.forEach(({key:p,order:t},c)=>{i[p]={order:t,...B.length>1&&{index:c}}}),i}return{}},[ue,B]),be=e.useCallback(()=>oe.some(i=>i.flexgrow&&!i.hidden),[]),ye=e.useMemo(()=>be(),[be,Q]),ee=e.useMemo(()=>{let i=l==="chart"?oe.filter(t=>t.id==="add-task"):oe;const p=l==="all"?a:S;if(!ye){let t=g,c=!1;if(oe.some(v=>v.$width)){let v=0;t=oe.reduce((b,_)=>(_.hidden||(v+=_.width,b+=_.$width||_.width),b),0),v>t&&t>p&&(c=!0)}if(c||t<p){let v=1;return c||(v=(p-50)/(t-50||1)),i.map(b=>(b.id!=="add-task"&&!b.hidden&&(b.$width||(b.$width=b.width),b.width=b.$width*v),b))}}return i},[l,oe,ye,g,a,S]),de=e.useCallback(i=>{if(!be()){const p=ee.reduce((t,c)=>(i&&c.$width&&(c.$width=c.width),t+(c.hidden?0:c.width)),0);p!==g&&x(p)}ie(!0),ie(!1)},[be,ee,g,x]),h=e.useCallback(()=>{oe.filter(p=>p.flexgrow&&!p.hidden).length===1&&oe.forEach(p=>{p.$width&&!p.flexgrow&&!p.hidden&&(p.width=p.$width)})},[]),K=e.useCallback(i=>{if(!n){const p=ae.locateID(i),t=ae.locateAttr(i,"data-col-id");!(t&&oe.find(v=>v.id==t))?.editor&&p&&d.exec("show-editor",{id:p})}},[d,n]),V=e.useMemo(()=>Array.isArray(A)?A.map(i=>i.id):[],[A]),W=e.useCallback(()=>{if(J.current&&ue!==null){const i=J.current.querySelector(".wx-body");i&&(i.style.top=-((O??0)-(se??0))+"px")}f.current&&(f.current.scrollTop=0)},[ue,O,se]);e.useEffect(()=>{J.current&&W()},[O,se,W]),e.useEffect(()=>{const i=J.current;if(!i)return;const p=i.querySelector(".wx-table-box .wx-body");if(!p||typeof ResizeObserver>"u")return;const t=new ResizeObserver(()=>{W()});return t.observe(p),()=>{t.disconnect()}},[ee,N,l,we,ue,W]),e.useEffect(()=>{if(!P||!H)return;const{id:i}=P,p=H.getState().focusCell;p&&p.row!==i&&J.current&&J.current.contains(document.activeElement)&&H.exec("focus-cell",{row:i,column:p.column})},[P,H]);const me=e.useCallback(({id:i})=>{if(n)return!1;d.getTask(i).open&&d.exec("open-task",{id:i,mode:!1});const p=d.getState()._tasks.find(t=>t.id===i);if(k(p||null),!p)return!1},[d,n]),Te=e.useCallback(({id:i,top:p})=>{te.current?ce({...te.current,onMove:!1}):d.exec("drag-task",{id:i,top:p+(se??0),inProgress:!1}),k(null)},[d,ce,se]),Ne=e.useCallback(({id:i,top:p,detail:t})=>{t&&ce({...t,onMove:!0}),d.exec("drag-task",{id:i,top:p+(se??0),inProgress:!0})},[d,ce,se]);e.useEffect(()=>{const i=J.current;return i?Ze(i,{start:me,end:Te,move:Ne,getTask:d.getTask}).destroy:void 0},[d,me,Te,Ne]);const Re=e.useCallback(i=>{const{key:p,isInput:t}=i;if(!t&&(p==="arrowup"||p==="arrowdown"))return i.eventSource="grid",d.exec("hotkey",i),!1;if(p==="enter"){const c=H?.getState().focusCell;if(c){const{row:v,column:b}=c;b==="add-task"?G(v,"add-task"):b==="text"&&G(v,"open-task")}}},[d,G,H]),ke=e.useRef(null),Le=()=>{ke.current={setTableAPI:L,handleHotkey:Re,sortVal:B,api:d,adjustColumns:h,setColumnWidth:de,tasks:y,calendarVal:j,durationUnitVal:X,splitTasksVal:q,onTableAPIChange:w}};Le(),e.useEffect(()=>{Le()},[L,Re,B,d,h,de,y,j,X,q,w]);const Ie=e.useCallback(i=>{L(i),i.intercept("hotkey",p=>ke.current.handleHotkey(p)),i.intercept("scroll",()=>!1),i.intercept("select-row",()=>!1),i.intercept("sort-rows",p=>{const t=ke.current.sortVal,{key:c,add:v}=p,b=t?t.find(ne=>ne.key===c):null;let _="asc";return b&&(_=!b||b.order==="asc"?"desc":"asc"),d.exec("sort-tasks",{key:c,order:_,add:v}),!1}),i.on("resize-column",()=>{ke.current.setColumnWidth(!0)}),i.on("hide-column",p=>{p.mode||ke.current.adjustColumns(),ke.current.setColumnWidth()}),i.intercept("update-cell",p=>{const{id:t,column:c,value:v}=p,b=ke.current.tasks.find(_=>_.id===t);if(b){const _={...b};let ne=v;ne&&!isNaN(ne)&&!(ne instanceof Date)&&(ne*=1),_[c]=ne,re.prepareEditTask(_,{calendar:ke.current.calendarVal,durationUnit:ke.current.durationUnitVal,splitTasks:ke.current.splitTasksVal},c),d.exec("update-task",{id:t,task:_})}return!1}),w&&w(i)},[]);return o.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${we}`},ref:f,children:o.jsx("div",{ref:J,style:N,className:"wx-rHj6070p wx-table",onClick:Y,onDoubleClick:K,children:o.jsx(qe.Grid,{init:Ie,sizes:{rowHeight:z,headerHeight:(pe??0)-1},rowStyle:i=>i.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:i=>`wx-rHj6070p wx-text-${i.align}${i.id==="add-task"?" wx-action":""}`,data:ue,columns:ee,selectedRows:[...V],sortMarks:xe})})})}function tt({borders:s=""}){const n=e.useContext(Me),r=T.useStore(n,"cellWidth"),a=T.useStore(n,"cellHeight"),l=e.useRef(null),[u,w]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&l.current){const m=getComputedStyle(l.current).getPropertyValue("--wx-gantt-border");w(m?m.substring(m.indexOf("#")):"#1d1e261a")}},[]);const M={width:"100%",height:"100%",background:r!=null&&a!=null?`url(${re.grid(r,a,u,s)})`:void 0,position:"absolute"};return o.jsx("div",{ref:l,style:M})}function st({onSelectLink:s,selectedLink:n,readonly:r}){const a=e.useContext(Me),l=T.useStore(a,"_links"),u=T.useStore(a,"criticalPath"),w=e.useRef(null),M=e.useCallback(m=>{const g=m?.target?.classList;!g?.contains("wx-line")&&!g?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&w.current){const m=g=>{w.current&&!w.current.contains(g.target)&&M(g)};return document.addEventListener("click",m),()=>{document.removeEventListener("click",m)}}},[r,n,M]),o.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(l||[]).map(m=>{const g="wx-dkx3NwEn wx-line"+(u&&m.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return o.jsx("polyline",{className:g,points:m.$p,onClick:()=>!r&&s(m.id),"data-link-id":m.id},m.id)}),!r&&n&&o.jsx("polyline",{ref:w,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function nt(s){const{task:n,type:r}=s;function a(u){const w=n.segments[u];return{left:`${w.$x}px`,top:"0px",width:`${w.$w}px`,height:"100%"}}function l(u){if(!n.progress)return 0;const w=n.duration*n.progress/100,M=n.segments;let m=0,g=0,x=null;do{const H=M[g];g===u&&(m>w?x=0:x=Math.min((w-m)/H.duration,1)*100),m+=H.duration,g++}while(x===null&&g<M.length);return x||0}return o.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map((u,w)=>o.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":w,style:a(w),children:[n.progress?o.jsx("div",{className:"wx-progress-wrapper",children:o.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${l(w)}%`}})}):null,o.jsx("div",{className:"wx-content",children:u.text||""})]},w))})}function rt(s){const{readonly:n,taskTemplate:r,multiTaskRows:a=!1,rowMapping:l=null}=s,u=e.useContext(Me),[w,M]=T.useStoreWithCounter(u,"_tasks"),[m,g]=T.useStoreWithCounter(u,"_links"),x=T.useStore(u,"area"),H=T.useStore(u,"_scales"),L=T.useStore(u,"taskTypes"),R=T.useStore(u,"baselines"),D=T.useStore(u,"_selected"),d=T.useStore(u,"_scrollTask"),O=T.useStore(u,"criticalPath"),z=T.useStore(u,"tasks"),P=T.useStore(u,"schedule"),A=T.useStore(u,"splitTasks"),E=e.useMemo(()=>{if(!x||!Array.isArray(w))return[];const t=x.start??0,c=x.end??0;return w.slice(t,c).map(v=>({...v}))},[M,x]),$=T.useStore(u,"cellHeight"),C=e.useMemo(()=>{if(!a||!l||!E.length)return E;const t=new Map,c=[];return w.forEach(v=>{const b=l.taskRows.get(v.id)??v.id;t.has(b)||(t.set(b,c.length),c.push(b))}),E.map(v=>{const b=l.taskRows.get(v.id)??v.id,_=t.get(b)??0;return{...v,$y:_*$,$y_base:v.$y_base!==void 0?_*$:void 0}})},[E,a,l,w,$]),F=e.useMemo(()=>H.lengthUnitWidth,[H]),B=e.useRef(!1),[j,X]=e.useState(void 0),[q,U]=e.useState(null),k=e.useRef(null),[y,G]=e.useState(null),[Y,J]=e.useState(void 0),f=e.useRef(null),[S,I]=e.useState(0),Q=e.useRef(null),ie=e.useMemo(()=>{const t=Q.current;return!!(D.length&&t&&t.contains(document.activeElement))},[D,Q.current]),te=e.useMemo(()=>ie&&D[D.length-1]?.id,[ie,D]);e.useEffect(()=>{if(d&&ie&&d){const{id:t}=d,c=Q.current?.querySelector(`.wx-bar[data-id='${t}']`);c&&c.focus({preventScroll:!0})}},[d]),e.useEffect(()=>{const t=Q.current;if(t&&(I(t.offsetWidth||0),typeof ResizeObserver<"u")){const c=new ResizeObserver(v=>{v[0]&&I(v[0].contentRect.width)});return c.observe(t),()=>c.disconnect()}},[Q.current]);const ce=e.useCallback(()=>{document.body.style.userSelect="none"},[]),se=e.useCallback(()=>{document.body.style.userSelect=""},[]),pe=e.useCallback((t,c,v)=>{if(c.target.classList.contains("wx-line")||(v||(v=u.getTask($e(t))),v.type==="milestone"||v.type==="summary"))return"";const b=ae.locate(c,"data-segment");b&&(t=b);const{left:_,width:ne}=t.getBoundingClientRect(),he=(c.clientX-_)/ne;let ge=.2/(ne>200?ne/200:1);return he<ge?"start":he>1-ge?"end":""},[u]),fe=e.useCallback((t,c)=>{const{clientX:v}=c,b=$e(t),_=u.getTask(b),ne=c.target.classList;if(!c.target.closest(".wx-delete-button")&&!n){if(ne.contains("wx-progress-marker")){const{progress:he}=u.getTask(b);k.current={id:b,x:v,progress:he,dx:0,node:t,marker:c.target},c.target.classList.add("wx-progress-in-drag")}else{const he=pe(t,c,_)||"move",ge={id:b,mode:he,x:v,dx:0,l:_.$x,w:_.$w};if(A&&_.segments?.length){const Ce=ae.locate(c,"data-segment");Ce&&(ge.segmentIndex=Ce.dataset.segment*1,re.extendDragOptions(_,ge))}U(ge)}ce()}},[u,n,pe,ce,A]),N=e.useCallback(t=>{if(t.button!==0)return;const c=ae.locate(t);c&&fe(c,t)},[fe]),Z=e.useCallback(t=>{const c=ae.locate(t);c&&(f.current=setTimeout(()=>{J(!0),fe(c,t.touches[0])},300))},[fe]),ue=e.useCallback(t=>{G(t&&{...m.find(c=>c.id===t)})},[m]),oe=e.useCallback(()=>{if(k.current){const{dx:t,id:c,marker:v,value:b}=k.current;k.current=null,typeof b<"u"&&t&&u.exec("update-task",{id:c,task:{progress:b},inProgress:!1}),v.classList.remove("wx-progress-in-drag"),B.current=!0,se()}else if(q){const{id:t,mode:c,dx:v,l:b,w:_,start:ne,segment:he,index:ge}=q;if(U(null),ne){const Ce=Math.round(v/F);if(!Ce)u.exec("drag-task",{id:t,width:_,left:b,inProgress:!1,...he&&{segmentIndex:ge}});else{let Ee={},je=u.getTask(t);he&&(je=je.segments[ge]),c==="move"?(Ee.start=je.start,Ee.end=je.end):Ee[c]=je[c],u.exec("update-task",{id:t,diff:Ce,task:Ee,...he&&{segmentIndex:ge}})}B.current=!0}se()}},[u,se,q,F]),we=e.useCallback((t,c)=>{const{clientX:v}=c;if(!n)if(k.current){const{node:b,x:_,id:ne}=k.current,he=k.current.dx=v-_,ge=Math.round(he/b.offsetWidth*100);let Ce=k.current.progress+ge;k.current.value=Ce=Math.min(Math.max(0,Ce),100),u.exec("update-task",{id:ne,task:{progress:Ce},inProgress:!0})}else if(q){ue(null);const{mode:b,l:_,w:ne,x:he,id:ge,start:Ce,segment:Ee,index:je}=q,ze=u.getTask(ge),ve=v-he;if(!Ce&&Math.abs(ve)<20||b==="start"&&ne-ve<F||b==="end"&&ne+ve<F||b==="move"&&(ve<0&&_+ve<0||ve>0&&_+ne+ve>S)||q.segment&&!re.isSegmentMoveAllowed(ze,q))return;const Ge={...q,dx:ve};let De,Ae;if(b==="start"?(De=_+ve,Ae=ne-ve):b==="end"?(De=_,Ae=ne+ve):b==="move"&&(De=_+ve,Ae=ne),u.exec("drag-task",{id:ge,width:Ae,left:De,inProgress:!0,...Ee&&{segmentIndex:je}}),!Ge.start&&(b==="move"&&ze.$x==_||b!=="move"&&ze.$w==ne)){B.current=!0,oe();return}Ge.start=!0,U(Ge)}else{const b=ae.locate(t);if(b){const _=u.getTask($e(b)),he=ae.locate(t,"data-segment")||b,ge=pe(he,c,_);he.style.cursor=ge&&!n?"col-resize":"pointer"}}},[u,n,q,F,S,pe,ue,oe]),xe=e.useCallback(t=>{we(t,t)},[we]),be=e.useCallback(t=>{Y?(t.preventDefault(),we(t,t.touches[0])):f.current&&(clearTimeout(f.current),f.current=null)},[Y,we]),ye=e.useCallback(()=>{oe()},[oe]),ee=e.useCallback(()=>{J(null),f.current&&(clearTimeout(f.current),f.current=null),oe()},[oe]);e.useEffect(()=>(window.addEventListener("mouseup",ye),()=>{window.removeEventListener("mouseup",ye)}),[ye]);const de=e.useCallback(t=>{if(!n){const c=ae.locateID(t.target);if(c&&!t.target.classList.contains("wx-link")){const v=ae.locateID(t.target,"data-segment");u.exec("show-editor",{id:c,...v!==null&&{segmentIndex:v}})}}},[u,n]),h=["e2s","s2s","e2e","s2e"],K=e.useCallback((t,c)=>h[(t?1:0)+(c?0:2)],[]),V=e.useCallback((t,c)=>{const v=j.id,b=j.start;return t===v?!0:!!m.find(_=>_.target==t&&_.source==v&&_.type===K(b,c))},[j,g,K]),W=e.useCallback(()=>{j&&X(null)},[j]),me=e.useCallback(t=>{if(B.current){B.current=!1;return}const c=ae.locateID(t.target);if(c){const v=t.target.classList;if(v.contains("wx-link")){const b=v.contains("wx-left");if(!j){X({id:c,start:b});return}j.id!==c&&!V(c,b)&&u.exec("add-link",{link:{source:j.id,target:c,type:K(j.start,b)}})}else if(v.contains("wx-delete-button-icon"))u.exec("delete-link",{id:y.id}),G(null);else{let b;const _=ae.locate(t,"data-segment");_&&(b=_.dataset.segment*1),u.exec("select-task",{id:c,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:b})}}W()},[u,j,g,y,V,K,W]),Te=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),Ne=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),Re=e.useCallback(t=>{if(Y||f.current)return t.preventDefault(),!1},[Y]),ke=e.useMemo(()=>L.map(t=>t.id),[L]),Le=e.useCallback(t=>{let c=ke.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(c=`task ${c}`),c},[ke]),Ie=e.useCallback(t=>{u.exec(t.action,t.data)},[u]),i=e.useCallback(t=>O&&z.byId(t).$critical,[O,z]),p=e.useCallback(t=>{if(P?.auto){const c=z.getSummaryId(t,!0),v=z.getSummaryId(j.id,!0);return j?.id&&!(Array.isArray(c)?c:[c]).includes(j.id)&&!(Array.isArray(v)?v:[v]).includes(t)}return j},[P,z,j]);return o.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${C.length?C[0].$h:0}px`},ref:Q,onContextMenu:Re,onMouseDown:N,onMouseMove:xe,onTouchStart:Z,onTouchMove:be,onTouchEnd:ee,onClick:me,onDoubleClick:de,onDragStart:t=>(t.preventDefault(),!1),children:[o.jsx(st,{onSelectLink:ue,selectedLink:y,readonly:n}),C.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const c=`wx-bar wx-${Le(t.type)}`+(Y&&q&&t.id===q.id?" wx-touch":"")+(j&&j.id===t.id?" wx-selected":"")+(i(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(A&&t.segments?" wx-split":""),v="wx-link wx-left"+(j?" wx-visible":"")+(!j||!V(t.id,!0)&&p(t.id)?" wx-target":"")+(j&&j.id===t.id&&j.start?" wx-selected":"")+(i(t.id)?" wx-critical":""),b="wx-link wx-right"+(j?" wx-visible":"")+(!j||!V(t.id,!1)&&p(t.id)?" wx-target":"")+(j&&j.id===t.id&&!j.start?" wx-selected":"")+(i(t.id)?" wx-critical":"");return o.jsxs(e.Fragment,{children:[!t.$skip&&o.jsxs("div",{className:"wx-GKbcLEGA "+c,style:Te(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:te===t.id?0:-1,children:[n?null:t.id===y?.target&&y?.type[2]==="s"?o.jsx(le.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:o.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):o.jsx("div",{className:"wx-GKbcLEGA "+v,children:o.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?o.jsxs(o.Fragment,{children:[t.progress&&!(A&&t.segments)?o.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:o.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(A&&t.segments)?o.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?o.jsx(r,{data:t,api:u,onAction:Ie}):A&&t.segments?o.jsx(nt,{task:t,type:Le(t.type)}):o.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?o.jsx(r,{data:t,api:u,onAction:Ie}):o.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===y?.target&&y?.type[2]==="e"?o.jsx(le.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:o.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):o.jsx("div",{className:"wx-GKbcLEGA "+b,children:o.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),R&&!t.$skip_baseline?o.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:Ne(t)}):null]},t.id)})]})}function ot(s){const{highlightTime:n}=s,r=e.useContext(Me),a=T.useStore(r,"_scales");return o.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:a.width},children:(a?.rows||[]).map((l,u)=>o.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${l.height}px`},children:(l.cells||[]).map((w,M)=>{const m=n?n(w.date,w.unit):"",g="wx-cell "+(w.css||"")+" "+(m||"");return o.jsx("div",{className:"wx-ZkvhDKir "+g,style:{width:`${w.width}px`},children:w.value},M)})},u))})}const lt=new Map;function ct(s){const n=e.useRef(null),r=e.useRef(0),a=e.useRef(null),l=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(l)return cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{const u={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};lt.set(s,u),window.dispatchEvent(new CustomEvent("render-metric",{detail:u}))}),()=>cancelAnimationFrame(a.current)})}function it(s){const{readonly:n,fullWidth:r,fullHeight:a,taskTemplate:l,cellBorders:u,highlightTime:w,multiTaskRows:M=!1,rowMapping:m=null}=s,g=e.useContext(Me),[x,H]=T.useStoreWithCounter(g,"_selected"),L=T.useStore(g,"scrollTop"),R=T.useStore(g,"cellHeight"),D=T.useStore(g,"cellWidth"),d=T.useStore(g,"_scales"),O=T.useStore(g,"_markers"),z=T.useStore(g,"_scrollTask"),P=T.useStore(g,"zoom"),[A,E]=e.useState(),$=e.useRef(null),C=1+(d?.rows?.length||0),F=e.useMemo(()=>{const f=[];return x&&x.length&&R&&x.forEach(S=>{f.push({height:`${R}px`,top:`${S.$y-3}px`})}),f},[H,R]),B=e.useMemo(()=>Math.max(A||0,a),[A,a]);e.useEffect(()=>{const f=$.current;f&&typeof L=="number"&&(f.scrollTop=L)},[L]);const j=()=>{X()};function X(f){const S=$.current;if(!S)return;const I={};I.left=S.scrollLeft,g.exec("scroll-chart",I)}function q(){const f=$.current,I=Math.ceil((A||0)/(R||1))+1,Q=Math.floor((f&&f.scrollTop||0)/(R||1)),ie=Math.max(0,Q-C),te=Q+I+C,ce=ie*(R||0);g.exec("render-data",{start:ie,end:te,from:ce})}e.useEffect(()=>{q()},[A,L]);const U=e.useCallback(f=>{if(!f)return;const{id:S,mode:I}=f;if(I.toString().indexOf("x")<0)return;const Q=$.current;if(!Q)return;const{clientWidth:ie}=Q,te=g.getTask(S);if(te.$x+te.$w<Q.scrollLeft)g.exec("scroll-chart",{left:te.$x-(D||0)}),Q.scrollLeft=te.$x-(D||0);else if(te.$x>=ie+Q.scrollLeft){const ce=ie<te.$w?D||0:te.$w;g.exec("scroll-chart",{left:te.$x-ie+ce}),Q.scrollLeft=te.$x-ie+ce}},[g,D]);e.useEffect(()=>{U(z)},[z]);function k(f){if(P&&(f.ctrlKey||f.metaKey)){f.preventDefault();const S=$.current,I=-Math.sign(f.deltaY),Q=f.clientX-(S?S.getBoundingClientRect().left:0);g.exec("zoom-scale",{dir:I,offset:Q})}}function y(f){const S=w(f.date,f.unit);return S?{css:S,width:f.width}:null}const G=e.useMemo(()=>d&&(d.minUnit==="hour"||d.minUnit==="day")&&w?d.rows[d.rows.length-1].cells.map(y):null,[d,w]),Y=e.useCallback(f=>{f.eventSource="chart",g.exec("hotkey",f)},[g]);e.useEffect(()=>{const f=$.current;if(!f)return;const S=()=>E(f.clientHeight);S();const I=new ResizeObserver(()=>S());return I.observe(f),()=>{I.disconnect()}},[$.current]);const J=e.useRef(null);return e.useEffect(()=>{const f=$.current;if(f&&!J.current)return J.current=Ve.hotkeys(f,{keys:{arrowup:!0,arrowdown:!0},exec:S=>Y(S)}),()=>{J.current?.destroy(),J.current=null}},[]),e.useEffect(()=>{const f=$.current;if(!f)return;const S=k;return f.addEventListener("wheel",S),()=>{f.removeEventListener("wheel",S)}},[k]),ct("chart"),o.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:$,onScroll:j,children:[o.jsx(ot,{highlightTime:w,scales:d}),O&&O.length?o.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${B}px`},children:O.map((f,S)=>o.jsx("div",{className:`wx-mR7v2Xag wx-marker ${f.css||""}`,style:{left:`${f.left}px`},children:o.jsx("div",{className:"wx-mR7v2Xag wx-content",children:f.text})},S))}):null,o.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${B}px`},children:[G?o.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:G.map((f,S)=>f?o.jsx("div",{className:"wx-mR7v2Xag "+f.css,style:{width:`${f.width}px`,left:`${S*f.width}px`}},S):null)}):null,o.jsx(tt,{borders:u}),x&&x.length?x.map((f,S)=>f.$y?o.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":f.id,style:F[S]},f.id):null):null,o.jsx(rt,{readonly:n,taskTemplate:l,multiTaskRows:M,rowMapping:m})]})]})}function at(s){const{position:n="after",size:r=4,dir:a="x",onMove:l,onDisplayChange:u,compactMode:w,containerWidth:M=0,leftThreshold:m=50,rightThreshold:g=50}=s,[x,H]=T.useWritableProp(s.value??0),[L,R]=T.useWritableProp(s.display??"all");function D(f){let S=0;n=="center"?S=r/2:n=="before"&&(S=r);const I={size:[r+"px","auto"],p:[f-S+"px","0px"],p2:["auto","0px"]};if(a!="x")for(let Q in I)I[Q]=I[Q].reverse();return I}const[d,O]=e.useState(!1),[z,P]=e.useState(null),A=e.useRef(0),E=e.useRef(),$=e.useRef(),C=e.useRef(L);e.useEffect(()=>{C.current=L},[L]),e.useEffect(()=>{z===null&&x>0&&P(x)},[z,x]);function F(f){return a=="x"?f.clientX:f.clientY}const B=e.useCallback(f=>{const S=E.current+F(f)-A.current;H(S);let I;S<=m?I="chart":M-S<=g?I="grid":I="all",C.current!==I&&(R(I),C.current=I),$.current&&clearTimeout($.current),$.current=setTimeout(()=>l&&l(S),100)},[M,m,g,l]),j=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",O(!1),window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",j)},[B]),X=e.useMemo(()=>L!=="all"?"auto":a=="x"?"ew-resize":"ns-resize",[L,a]),q=e.useCallback(f=>{!w&&(L==="grid"||L==="chart")||(A.current=F(f),E.current=x,O(!0),document.body.style.cursor=X,document.body.style.userSelect="none",window.addEventListener("mousemove",B),window.addEventListener("mouseup",j))},[X,B,j,x,w,L]);function U(){R("all"),z!==null&&(H(z),l&&l(z))}function k(f){if(w){const S=L==="chart"?"grid":"chart";R(S),u(S)}else if(L==="grid"||L==="chart")U(),u("all");else{const S=f==="left"?"chart":"grid";R(S),u(S)}}function y(){k("left")}function G(){k("right")}const Y=e.useMemo(()=>D(x),[x,n,r,a]),J=["wx-resizer",`wx-resizer-${a}`,`wx-resizer-display-${L}`,d?"wx-resizer-active":""].filter(Boolean).join(" ");return o.jsxs("div",{className:"wx-pFykzMlT "+J,onMouseDown:q,style:{width:Y.size[0],height:Y.size[1],cursor:X},children:[o.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[o.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:o.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:y})}),o.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:o.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:G})})]}),o.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const ut=650;function Ke(s){let n;function r(){n=new ResizeObserver(l=>{for(let u of l)if(u.target===document.body){let w=u.contentRect.width<=ut;s(w)}}),n.observe(document.body)}function a(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:a}}function dt(s){const{taskTemplate:n,readonly:r,cellBorders:a,highlightTime:l,onTableAPIChange:u,multiTaskRows:w=!1,rowMapping:M=null}=s,m=e.useContext(Me),g=T.useStore(m,"_tasks"),x=T.useStore(m,"_scales"),H=T.useStore(m,"cellHeight"),L=T.useStore(m,"columns"),R=T.useStore(m,"_scrollTask"),D=T.useStore(m,"undo"),[d,O]=e.useState(!1);let[z,P]=e.useState(0);const[A,E]=e.useState(0),[$,C]=e.useState(0),[F,B]=e.useState(void 0),[j,X]=e.useState("all"),q=e.useRef(null),U=e.useCallback(N=>{O(Z=>(N!==Z&&(N?(q.current=j,j==="all"&&X("grid")):(!q.current||q.current==="all")&&X("all")),N))},[j]);e.useEffect(()=>{const N=Ke(U);return N.observe(),()=>{N.disconnect()}},[U]);const k=e.useMemo(()=>{let N;return L.every(Z=>Z.width&&!Z.flexgrow)?N=L.reduce((Z,ue)=>Z+parseInt(ue.width),0):d&&j==="chart"?N=parseInt(L.find(Z=>Z.id==="action")?.width)||50:N=440,z=N,N},[L,d,j]);e.useEffect(()=>{P(k)},[k]);const y=e.useMemo(()=>(A??0)-(F??0),[A,F]),G=e.useMemo(()=>x.width,[x]),Y=e.useMemo(()=>{if(!w||!M)return g.length*H;const N=new Set;return g.forEach(Z=>{const ue=M.taskRows.get(Z.id)??Z.id;N.add(ue)}),N.size*H},[g,H,w,M]),J=e.useMemo(()=>x.height+Y+y,[x,Y,y]),f=e.useMemo(()=>z+G,[z,G]),S=e.useRef(null),I=e.useCallback(()=>{Promise.resolve().then(()=>{if((A??0)>(f??0)){const N=(A??0)-z;m.exec("expand-scale",{minWidth:N})}})},[A,f,z,m]);e.useEffect(()=>{let N;return S.current&&(N=new ResizeObserver(I),N.observe(S.current)),()=>{N&&N.disconnect()}},[S.current,I]),e.useEffect(()=>{I()},[G]);const Q=e.useRef(null),ie=e.useRef(null),te=e.useCallback(()=>{const N=Q.current;N&&m.exec("scroll-chart",{top:N.scrollTop})},[m]),ce=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{ce.current={rTasks:g,rScales:x,rCellHeight:H,scrollSize:y,ganttDiv:Q.current,ganttHeight:$??0}},[g,x,H,y,$]);const se=e.useCallback(N=>{if(!N)return;const{rTasks:Z,rScales:ue,rCellHeight:oe,scrollSize:we,ganttDiv:xe,ganttHeight:be}=ce.current;if(!xe)return;const{id:ye}=N,ee=Z.findIndex(de=>de.id===ye);if(ee>-1){const de=be-ue.height,h=ee*oe,K=xe.scrollTop;let V=null;h<K?V=h:h+oe>K+de&&(V=h-de+oe+we),V!==null&&(m.exec("scroll-chart",{top:Math.max(V,0)}),Q.current.scrollTop=Math.max(V,0))}},[m]);e.useEffect(()=>{se(R)},[R]),e.useEffect(()=>{const N=Q.current,Z=ie.current;if(!N||!Z)return;const ue=()=>{Ye.flushSync(()=>{C(N.offsetHeight),E(N.offsetWidth),B(Z.offsetWidth)})},oe=new ResizeObserver(ue);return oe.observe(N),()=>oe.disconnect()},[Q.current]);const pe=e.useRef(null),fe=e.useRef(null);return e.useEffect(()=>{fe.current&&(fe.current.destroy(),fe.current=null);const N=pe.current;if(N)return fe.current=Ve.hotkeys(N,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,backspace:!0,"ctrl+z":D,"ctrl+y":D},exec:Z=>{Z.isInput||m.exec("hotkey",Z)}}),()=>{fe.current?.destroy(),fe.current=null}},[D]),o.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:Q,onScroll:te,children:o.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:J,width:"100%"},ref:ie,children:o.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:$,width:F},children:o.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:pe,children:[L.length?o.jsxs(o.Fragment,{children:[o.jsx(et,{display:j,compactMode:d,columnWidth:k,width:z,readonly:r,fullHeight:Y,onTableAPIChange:u,multiTaskRows:w,rowMapping:M}),o.jsx(at,{value:z,display:j,compactMode:d,containerWidth:A,onMove:N=>P(N),onDisplayChange:N=>X(N)})]}):null,o.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:S,children:o.jsx(it,{readonly:r,fullWidth:G,fullHeight:Y,taskTemplate:n,cellBorders:a,highlightTime:l,multiTaskRows:w,rowMapping:M})})]})})})})}function ft(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function xt(s,n){return typeof s=="function"?s:ae.dateToString(s,n)}function Be(s,n){return s.map(({format:r,...a})=>({...a,format:xt(r,n)}))}function mt(s,n){const r=ft(n);for(let a in r)r[a]=ae.dateToString(r[a],s);return r}function ht(s,n){if(!s||!s.length)return s;const r=ae.dateToString("%d-%m-%Y",n);return s.map(a=>a.template?a:a.id==="start"||a.id=="end"?{...a,_template:l=>r(l),template:l=>r(l)}:a.id==="duration"?{...a,_template:l=>l,template:l=>l}:a)}function gt(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:Be(r.scales,n)}))}:s}const wt=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),pt=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],bt=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:a=re.defaultTaskTypes,tasks:l=[],selected:u=[],activeTask:w=null,links:M=[],scales:m=pt,columns:g=re.defaultColumns,start:x=null,end:H=null,lengthUnit:L="day",durationUnit:R="day",cellWidth:D=100,cellHeight:d=38,scaleHeight:O=36,readonly:z=!1,cellBorders:P="full",zoom:A=!1,baselines:E=!1,highlightTime:$=null,init:C=null,autoScale:F=!0,unscheduledTasks:B=!1,criticalPath:j=null,schedule:X={type:"forward"},projectStart:q=null,projectEnd:U=null,calendar:k=null,undo:y=!1,splitTasks:G=!1,multiTaskRows:Y=!1,...J},f){const S=e.useRef();S.current=J;const I=e.useMemo(()=>new re.DataStore(T.writable),[]),Q=e.useMemo(()=>({...We.en,...He.en}),[]),ie=e.useContext(le.context.i18n),te=e.useMemo(()=>ie?ie.extend(Q,!0):ae.locale(Q),[ie,Q]),ce=e.useMemo(()=>te.getRaw().calendar,[te]),se=e.useMemo(()=>{let ee={zoom:gt(A,ce),scales:Be(m,ce),columns:ht(g,ce),links:re.normalizeLinks(M),cellWidth:D};return ee.zoom&&(ee={...ee,...re.normalizeZoom(ee.zoom,mt(ce,te.getGroup("gantt")),ee.scales,D)}),ee},[A,m,g,M,D,ce,te]),pe=e.useRef(null);pe.current!==l&&(re.parseTaskDates(l,{durationUnit:R,splitTasks:G,calendar:k}),pe.current=l),e.useEffect(()=>{re.parseTaskDates(l,{durationUnit:R,splitTasks:G,calendar:k})},[l,R,k,G]);const fe=e.useMemo(()=>{if(!Y)return null;const ee=new Map,de=new Map,h=K=>{K.forEach(V=>{const W=V.row??V.id;de.set(V.id,W),ee.has(W)||ee.set(W,[]),ee.get(W).push(V.id),V.data&&V.data.length>0&&h(V.data)})};return h(l),{rowMap:ee,taskRows:de}},[l,Y]),N=e.useMemo(()=>I.in,[I]),Z=e.useRef(null);Z.current===null&&(Z.current=new Xe.EventBusRouter((ee,de)=>{const h="on"+wt(ee);S.current&&S.current[h]&&S.current[h](de)}),N.setNext(Z.current));const[ue,oe]=e.useState(null),we=e.useRef(null);we.current=ue;const xe=e.useMemo(()=>({getState:I.getState.bind(I),getReactiveState:I.getReactive.bind(I),getStores:()=>({data:I}),exec:N.exec,setNext:ee=>(Z.current=Z.current.setNext(ee),Z.current),intercept:N.intercept.bind(N),on:N.on.bind(N),detach:N.detach.bind(N),getTask:I.getTask.bind(I),serialize:I.serialize.bind(I),getTable:ee=>ee?new Promise(de=>setTimeout(()=>de(we.current),1)):we.current,getHistory:()=>I.getHistory()}),[I,N]);e.useImperativeHandle(f,()=>({...xe}),[xe]);const be=e.useRef(0);e.useEffect(()=>{be.current?I.init({tasks:l,links:se.links,start:x,columns:se.columns,end:H,lengthUnit:L,cellWidth:se.cellWidth,cellHeight:d,scaleHeight:O,scales:se.scales,taskTypes:a,zoom:se.zoom,selected:u,activeTask:w,baselines:E,autoScale:F,unscheduledTasks:B,markers:r,durationUnit:R,criticalPath:j,schedule:X,projectStart:q,projectEnd:U,calendar:k,undo:y,_weekStart:ce.weekStart,splitTasks:G}):C&&C(xe),be.current++},[xe,C,l,se,x,H,L,d,O,a,u,w,E,F,B,r,R,j,X,q,U,k,y,ce,G,I]),be.current===0&&I.init({tasks:l,links:se.links,start:x,columns:se.columns,end:H,lengthUnit:L,cellWidth:se.cellWidth,cellHeight:d,scaleHeight:O,scales:se.scales,taskTypes:a,zoom:se.zoom,selected:u,activeTask:w,baselines:E,autoScale:F,unscheduledTasks:B,markers:r,durationUnit:R,criticalPath:j,schedule:X,projectStart:q,projectEnd:U,calendar:k,undo:y,_weekStart:ce.weekStart,splitTasks:G});const ye=e.useMemo(()=>k?(ee,de)=>de=="day"&&!k.getDayHours(ee)||de=="hour"&&!k.getDayHours(ee)?"wx-weekend":"":$,[k,$]);return o.jsx(le.context.i18n.Provider,{value:te,children:o.jsx(Me.Provider,{value:xe,children:o.jsx(dt,{taskTemplate:n,readonly:z,cellBorders:P,highlightTime:ye,onTableAPIChange:oe,multiTaskRows:Y,rowMapping:fe})})})});function kt({api:s=null,items:n=[]}){const r=e.useContext(le.context.i18n),a=e.useMemo(()=>r||ae.locale(He.en),[r]),l=e.useMemo(()=>a.getGroup("gantt"),[a]),u=T.useStoreLater(s,"_selected"),w=T.useStoreLater(s,"undo"),M=T.useStoreLater(s,"history"),m=T.useStoreLater(s,"splitTasks"),g=["undo","redo"],x=e.useMemo(()=>{const L=re.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:re.getToolbarButtons({undo:w,splitTasks:m})).map(D=>{let d={...D,disabled:!1};return d.handler=re.isHandledAction(L,d.id)?O=>re.handleAction(s,O.id,null,l):d.handler,d.text&&(d.text=l(d.text)),d.menuText&&(d.menuText=l(d.menuText)),d})},[n,s,l,w,m]),H=e.useMemo(()=>{const L=[];return x.forEach(R=>{const D=R.id;if(D==="add-task")L.push(R);else if(g.includes(D))g.includes(D)&&L.push({...R,disabled:R.isDisabled(M)});else{if(!u?.length||!s)return;L.push({...R,disabled:R.isDisabled&&u.some(d=>R.isDisabled(d,s.getState()))})}}),L.filter((R,D)=>{if(s&&R.isHidden)return!u.some(d=>R.isHidden(d,s.getState()));if(R.comp==="separator"){const d=L[D+1];if(!d||d.comp==="separator")return!1}return!0})},[s,u,M,x]);return r?o.jsx(Pe.Toolbar,{items:H}):o.jsx(le.context.i18n.Provider,{value:a,children:o.jsx(Pe.Toolbar,{items:H})})}const yt=e.forwardRef(function({options:n=[],api:r=null,resolver:a=null,filter:l=null,at:u="point",children:w,onClick:M,css:m},g){const x=e.useRef(null),H=e.useRef(null),L=e.useContext(le.context.i18n),R=e.useMemo(()=>L||ae.locale({...He.en,...We.en}),[L]),D=e.useMemo(()=>R.getGroup("gantt"),[R]),d=T.useStoreLater(r,"taskTypes"),O=T.useStoreLater(r,"selected"),z=T.useStoreLater(r,"_selected"),P=T.useStoreLater(r,"splitTasks"),A=e.useMemo(()=>re.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{x.current&&x.current.show&&x.current.show()}),r.on("drag-task",()=>{x.current&&x.current.show&&x.current.show()}))},[r]);function E(k){return k.map(y=>(y={...y},y.text&&(y.text=D(y.text)),y.subtext&&(y.subtext=D(y.subtext)),y.data&&(y.data=E(y.data)),y))}function $(){const k=n.length?n:re.getMenuOptions({splitTasks:P}),y=k.find(G=>G.id==="convert-task");return y&&(y.data=[],(d||[]).forEach(G=>{y.data.push(y.dataFactory(G))})),E(k)}const C=e.useMemo(()=>$(),[r,n,d,P,D]),F=e.useMemo(()=>z&&z.length?z:[],[z]),B=e.useCallback((k,y)=>{let G=k?r?.getTask(k):null;if(a){const Y=a(k,y);G=Y===!0?G:Y}if(G){const Y=ae.locateID(y.target,"data-segment");Y!==null?H.current={id:G.id,segmentIndex:Y}:H.current=G.id,(!Array.isArray(O)||!O.includes(G.id))&&r&&r.exec&&r.exec("select-task",{id:G.id})}return G},[r,a,O]),j=e.useCallback(k=>{const y=k.action;y&&(re.isHandledAction(A,y.id)&&re.handleAction(r,y.id,H.current,D),M&&M(k))},[r,D,M,A]),X=e.useCallback((k,y)=>{const G=F.length?F:y?[y]:[];let Y=l?G.every(J=>l(k,J)):!0;if(Y&&(k.isHidden&&(Y=!G.some(J=>k.isHidden(J,r.getState(),H.current))),k.isDisabled)){const J=G.some(f=>k.isDisabled(f,r.getState(),H.current));k.disabled=J}return Y},[l,F,r]);e.useImperativeHandle(g,()=>({show:(k,y)=>{x.current&&x.current.show&&x.current.show(k,y)}}));const q=e.useCallback(k=>{x.current&&x.current.show&&x.current.show(k)},[]),U=o.jsxs(o.Fragment,{children:[o.jsx(Qe.ContextMenu,{filter:X,options:C,dataKey:"id",resolver:B,onClick:j,at:u,ref:x,css:m}),o.jsx("span",{onContextMenu:q,"data-menu-ignore":"true",children:typeof w=="function"?w():w})]});if(!L&&le.context.i18n?.Provider){const k=le.context.i18n.Provider;return o.jsx(k,{value:R,children:U})}return U});function vt({api:s,autoSave:n,onLinksChange:r}){const l=e.useContext(le.context.i18n).getGroup("gantt"),u=T.useStore(s,"activeTask"),w=T.useStore(s,"_activeTask"),M=T.useStore(s,"_links"),m=T.useStore(s,"schedule"),g=T.useStore(s,"unscheduledTasks"),[x,H]=e.useState();function L(){if(u){const O=M.filter(P=>P.target==u).map(P=>({link:P,task:s.getTask(P.source)})),z=M.filter(P=>P.source==u).map(P=>({link:P,task:s.getTask(P.target)}));return[{title:l("Predecessors"),data:O},{title:l("Successors"),data:z}]}}e.useEffect(()=>{H(L())},[u,M]);const R=e.useMemo(()=>[{id:"e2s",label:l("End-to-start")},{id:"s2s",label:l("Start-to-start")},{id:"e2e",label:l("End-to-end")},{id:"s2e",label:l("Start-to-end")}],[l]);function D(O){n?s.exec("delete-link",{id:O}):(H(z=>(z||[]).map(P=>({...P,data:P.data.filter(A=>A.link.id!==O)}))),r&&r({id:O,action:"delete-link",data:{id:O}}))}function d(O,z){n?s.exec("update-link",{id:O,link:z}):(H(P=>(P||[]).map(A=>({...A,data:A.data.map(E=>E.link.id===O?{...E,link:{...E.link,...z}}:E)}))),r&&r({id:O,action:"update-link",data:{id:O,link:z}}))}return o.jsx(o.Fragment,{children:(x||[]).map((O,z)=>O.data.length?o.jsx("div",{className:"wx-j93aYGQf wx-links",children:o.jsx(le.Field,{label:O.title,position:"top",children:o.jsx("table",{children:o.jsx("tbody",{children:O.data.map(P=>o.jsxs("tr",{children:[o.jsx("td",{className:"wx-j93aYGQf wx-cell",children:o.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:P.task.text||""})}),m?.auto&&P.link.type==="e2s"?o.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:o.jsx(le.Text,{type:"number",placeholder:l("Lag"),value:P.link.lag,disabled:g&&w?.unscheduled,onChange:A=>{A.input||d(P.link.id,{lag:A.value})}})}):null,o.jsx("td",{className:"wx-j93aYGQf wx-cell",children:o.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:o.jsx(le.Combo,{value:P.link.type,placeholder:l("Select link type"),options:R,onChange:A=>d(P.link.id,{type:A.value}),children:({option:A})=>A.label})})}),o.jsx("td",{className:"wx-j93aYGQf wx-cell",children:o.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>D(P.link.id),role:"button"})})]},P.link.id))})})})},z):null)})}function Ct(s){const{value:n,time:r,format:a,onchange:l,onChange:u,...w}=s,M=u??l;function m(g){const x=new Date(g.value);x.setHours(n.getHours()),x.setMinutes(n.getMinutes()),M&&M({value:x})}return o.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[o.jsx(le.DatePicker,{...w,value:n,onChange:m,format:a,buttons:["today"],clear:!1}),r?o.jsx(le.TimePicker,{value:n,onChange:M,format:a}):null]})}Se.registerEditorItem("select",le.RichSelect);Se.registerEditorItem("date",Ct);Se.registerEditorItem("twostate",le.TwoState);Se.registerEditorItem("slider",le.Slider);Se.registerEditorItem("counter",le.Counter);Se.registerEditorItem("links",vt);function Tt({api:s,items:n=[],css:r="",layout:a="default",readonly:l=!1,placement:u="sidebar",bottomBar:w=!0,topBar:M=!0,autoSave:m=!0,focus:g=!1,hotkeys:x={}}){const H=e.useContext(le.context.i18n),L=e.useMemo(()=>H||ae.locale({...He.en,...We.en}),[H]),R=e.useMemo(()=>L.getGroup("gantt"),[L]),D=L.getRaw(),d=e.useMemo(()=>{const h=D.gantt?.dateFormat||D.formats?.dateFormat;return ae.dateToString(h,D.calendar)},[D]),O=e.useMemo(()=>{if(M===!0&&!l){const h=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:R("Delete"),id:"delete"}];return m?{items:h}:{items:[...h,{comp:"button",type:"primary",text:R("Save"),id:"save"}]}}return M},[M,l,m,R]),[z,P]=e.useState(!1),A=e.useMemo(()=>z?"wx-full-screen":"",[z]),E=e.useCallback(h=>{P(h)},[]);e.useEffect(()=>{const h=Ke(E);return h.observe(),()=>{h.disconnect()}},[E]);const $=T.useStore(s,"_activeTask"),C=T.useStore(s,"activeTask"),F=T.useStore(s,"unscheduledTasks"),B=T.useStore(s,"links"),j=T.useStore(s,"splitTasks"),X=e.useMemo(()=>j&&C?.segmentIndex,[j,C]),q=e.useMemo(()=>X||X===0,[X]),U=e.useMemo(()=>re.getEditorItems({unscheduledTasks:F}),[F]),k=T.useStore(s,"undo"),[y,G]=e.useState({}),[Y,J]=e.useState(null),[f,S]=e.useState(),[I,Q]=e.useState(null),ie=T.useStore(s,"taskTypes"),te=e.useMemo(()=>{if(!$)return null;let h;if(q&&$.segments?h={...$.segments[X]}:h={...$},l){let K={parent:h.parent};return U.forEach(({key:V,comp:W})=>{if(W!=="links"){const me=h[V];W==="date"&&me instanceof Date?K[V]=d(me):W==="slider"&&V==="progress"?K[V]=`${me}%`:K[V]=me}}),K}return h||null},[$,q,X,l,U,d]);e.useEffect(()=>{S(te)},[te]),e.useEffect(()=>{G({}),Q(null),J(null)},[C]);function ce(h,K){return h.map(V=>{const W={...V};if(V.config&&(W.config={...W.config}),W.comp==="links"&&s&&(W.api=s,W.autoSave=m,W.onLinksChange=fe),W.comp==="select"&&W.key==="type"){const me=W.options??(ie||[]);W.options=me.map(Te=>({...Te,label:R(Te.label)}))}return W.comp==="slider"&&W.key==="progress"&&(W.labelTemplate=me=>`${R(W.label)} ${me}%`),W.label&&(W.label=R(W.label)),W.config?.placeholder&&(W.config.placeholder=R(W.config.placeholder)),K&&(W.isDisabled&&W.isDisabled(K,s.getState())?W.disabled=!0:delete W.disabled),W})}const se=e.useMemo(()=>{let h=n.length?n:U;return h=ce(h,f),f?h.filter(K=>!K.isHidden||!K.isHidden(f,s.getState())):h},[n,U,f,ie,R,s,m]),pe=e.useMemo(()=>se.map(h=>h.key),[se]);function fe({id:h,action:K,data:V}){G(W=>({...W,[h]:{action:K,data:V}}))}const N=e.useCallback(()=>{for(let h in y)if(B.byId(h)){const{action:K,data:V}=y[h];s.exec(K,V)}},[s,y,B]),Z=e.useCallback(()=>{const h=C?.id||C;if(q){if($?.segments){const K=$.segments.filter((V,W)=>W!==X);s.exec("update-task",{id:h,task:{segments:K}})}}else s.exec("delete-task",{id:h})},[s,C,q,$,X]),ue=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),oe=e.useCallback(h=>{const{item:K,changes:V}=h;K.id==="delete"&&Z(),K.id==="save"&&(V.length?ue():N()),K.comp&&ue()},[s,C,m,N,Z,ue]),we=e.useCallback((h,K,V)=>(F&&h.type==="summary"&&(h.unscheduled=!1),re.prepareEditTask(h,s.getState(),K),V||J(!1),h),[F,s]),xe=e.useCallback(h=>{h={...h,unscheduled:F&&h.unscheduled&&h.type!=="summary"},delete h.links,delete h.data,(pe.indexOf("duration")===-1||h.segments&&!h.duration)&&delete h.duration;const K={id:C?.id||C,task:h,...q&&{segmentIndex:X}};m&&Y&&(K.inProgress=Y),s.exec("update-task",K),m||N()},[s,C,F,m,N,pe,q,X,Y]),be=e.useCallback(h=>{let{update:K,key:V,input:W}=h;if(W&&J(!0),h.update=we({...K},V,W),!m)S(h.update);else if(!I&&!W){const me=se.find(Re=>Re.key===V),Te=K[V];(!me.validation||me.validation(Te))&&(!me.required||Te)&&xe(h.update)}},[m,we,I,se,xe]),ye=e.useCallback(h=>{m||xe(h.values)},[m,xe]),ee=e.useCallback(h=>{Q(h.errors)},[]),de=e.useMemo(()=>k?{"ctrl+z":h=>{h.preventDefault(),s.exec("undo")},"ctrl+y":h=>{h.preventDefault(),s.exec("redo")}}:{},[k,s]);return te?o.jsx(le.Locale,{children:o.jsx(Se.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${A} ${r}`,items:se,values:te,topBar:O,bottomBar:w,placement:u,layout:a,readonly:l,autoSave:m,focus:g,onAction:oe,onSave:ye,onValidation:ee,onChange:be,hotkeys:x&&{...de,...x}})}):null}const St=({children:s,columns:n=null,api:r})=>{const[a,l]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(l)},[r]),o.jsx(qe.HeaderMenu,{api:a,columns:n,children:s})};function Mt(s){const{api:n,content:r,children:a}=s,l=e.useRef(null),u=e.useRef(null),[w,M]=e.useState({}),[m,g]=e.useState(null),[x,H]=e.useState({});function L(E){for(;E;){if(E.getAttribute){const $=E.getAttribute("data-tooltip-id"),C=E.getAttribute("data-tooltip-at"),F=E.getAttribute("data-tooltip");if($||F)return{id:$,tooltip:F,target:E,at:C}}E=E.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const E=u.current;if(E&&x&&(x.text||r)){const $=E.getBoundingClientRect();let C=!1,F=x.left,B=x.top;$.right>=w.right&&(F=w.width-$.width-5,C=!0),$.bottom>=w.bottom&&(B=x.top-($.bottom-w.bottom+2),C=!0),C&&H(j=>j&&{...j,left:F,top:B})}},[x,w,r]);const R=e.useRef(null),D=300,d=E=>{clearTimeout(R.current),R.current=setTimeout(()=>{E()},D)};function O(E){let{id:$,tooltip:C,target:F,at:B}=L(E.target);if(H(null),g(null),!C)if($)C=P($);else{clearTimeout(R.current);return}const j=E.clientX;d(()=>{$&&g(z(A($)));const X=F.getBoundingClientRect(),q=l.current,U=q?q.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let k,y;B==="left"?(k=X.top+5-U.top,y=X.right+5-U.left):(k=X.top+X.height-U.top,y=j-U.left),M(U),H({top:k,left:y,text:C})})}function z(E){return n?.getTask(A(E))||null}function P(E){return z(E)?.text||""}function A(E){const $=parseInt(E);return isNaN($)?E:$}return o.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:l,onMouseMove:O,children:[x&&(x.text||r)?o.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:u,style:{top:`${x.top}px`,left:`${x.left}px`},children:r?o.jsx(r,{data:m}):x.text?o.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:x.text}):null}):null,a]})}function jt({fonts:s=!0,children:n}){return n?o.jsx(le.Material,{fonts:s,children:n()}):o.jsx(le.Material,{fonts:s})}function Rt({fonts:s=!0,children:n}){return n?o.jsx(le.Willow,{fonts:s,children:n}):o.jsx(le.Willow,{fonts:s})}function Et({fonts:s=!0,children:n}){return n?o.jsx(le.WillowDark,{fonts:s,children:n}):o.jsx(le.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>re.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>re.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>re.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>re.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>re.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>re.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>re.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>re.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>re.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>Se.registerEditorItem});exports.ContextMenu=yt;exports.Editor=Tt;exports.Gantt=bt;exports.HeaderMenu=St;exports.Material=jt;exports.Toolbar=kt;exports.Tooltip=Mt;exports.Willow=Rt;exports.WillowDark=Et;
//# sourceMappingURL=index.cjs.map
