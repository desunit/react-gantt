"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("react/jsx-runtime"),e=require("react"),Te=require("@svar-ui/react-core"),Ee=require("@svar-ui/lib-dom"),Be=require("@svar-ui/gantt-locales"),Je=require("@svar-ui/core-locales"),jt=require("@svar-ui/lib-state"),pe=require("@svar-ui/gantt-store"),D=require("@svar-ui/lib-react"),gt=require("@svar-ui/grid-store"),wt=require("@svar-ui/react-grid"),Dt=require("react-dom"),ut=require("@svar-ui/react-toolbar"),$t=require("@svar-ui/react-menu"),Ae=require("@svar-ui/react-editor"),ze=e.createContext(null);function Ge(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function It(s,n,r){const i=s.getBoundingClientRect(),l=n.querySelector(".wx-body").getBoundingClientRect();return{top:i.top-l.top,left:i.left-l.left,dt:i.bottom-r.clientY,db:r.clientY-i.top}}function dt(s){return s&&s.getAttribute("data-context-id")}const ft=5;function Lt(s,n){let r,i,l,I,h,T,o,b,g;function X(M){I=M.clientX,h=M.clientY,T={...It(r,s,M),y:n.getTask(l).$y},document.body.style.userSelect="none"}function F(M){r=Ee.locate(M),dt(r)&&(l=Ge(r),g=setTimeout(()=>{b=!0,n&&n.touchStart&&n.touchStart(),X(M.touches[0])},500),s.addEventListener("touchmove",_),s.addEventListener("contextmenu",v),window.addEventListener("touchend",B))}function v(M){if(b||g)return M.preventDefault(),!1}function p(M){M.which===1&&(r=Ee.locate(M),dt(r)&&(l=Ge(r),s.addEventListener("mousemove",O),window.addEventListener("mouseup",C),X(M)))}function f(M){s.removeEventListener("mousemove",O),s.removeEventListener("touchmove",_),document.body.removeEventListener("mouseup",C),document.body.removeEventListener("touchend",B),document.body.style.userSelect="",M&&(s.removeEventListener("mousedown",p),s.removeEventListener("touchstart",F))}function U(M){const Q=M.clientX-I,ne=M.clientY-h;if(!i){if(Math.abs(Q)<ft&&Math.abs(ne)<ft||n&&n.start&&n.start({id:l,e:M})===!1)return;i=r.cloneNode(!0),i.style.pointerEvents="none",i.classList.add("wx-reorder-task"),i.style.position="absolute",i.style.left=T.left+"px",i.style.top=T.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(i,r)}if(i){const Z=Math.round(Math.max(0,T.top+ne));if(n&&n.move&&n.move({id:l,top:Z,detail:o})===!1)return;const ae=n.getTask(l),K=ae.$y;if(!T.start&&T.y==K)return P();T.start=!0,T.y=ae.$y-4,i.style.top=Z+"px";const ce=document.elementFromPoint(M.clientX,M.clientY),E=Ee.locate(ce);if(E&&E!==r){const x=Ge(E),A=E.getBoundingClientRect(),te=A.top+A.height/2,ue=M.clientY+T.db>te&&E.nextElementSibling!==r,re=M.clientY-T.dt<te&&E.previousElementSibling!==r;o?.after==x||o?.before==x?o=null:ue?o={id:l,after:x}:re&&(o={id:l,before:x})}}}function O(M){U(M)}function _(M){b?(M.preventDefault(),U(M.touches[0])):g&&(clearTimeout(g),g=null)}function B(){b=null,g&&(clearTimeout(g),g=null),P()}function C(){P()}function P(){r&&(r.style.visibility=""),i&&(i.parentNode.removeChild(i),n&&n.end&&n.end({id:l,top:T.top})),l=r=i=T=o=null,f()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",p),s.addEventListener("touchstart",F),{destroy(){f(!0)}}}function Nt({row:s,column:n}){function r(l,I){return{justifyContent:I.align,paddingLeft:`${(l.$level-1)*20}px`}}const i=n&&n._cell;return c.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?c.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):c.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),c.jsx("div",{className:"wx-pqc08MHU wx-text",children:i?c.jsx(i,{row:s,column:n}):s.text})]})}function xt({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?c.jsx("div",{style:{textAlign:s.align},children:c.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function Pt(s){const{readonly:n,compactMode:r,width:i=0,display:l="all",columnWidth:I=0,onTableAPIChange:h,multiTaskRows:T=!1,rowMapping:o=null}=s,[b,g]=D.useWritableProp(I),[X,F]=e.useState(),v=e.useContext(Te.context.i18n),p=e.useMemo(()=>v.getGroup("gantt"),[v]),f=e.useContext(ze),U=D.useStore(f,"scrollTop"),O=D.useStore(f,"cellHeight"),_=D.useStore(f,"_scrollTask"),B=D.useStore(f,"_selected"),C=D.useStore(f,"area"),P=D.useStore(f,"_tasks"),M=D.useStore(f,"_scales"),Q=D.useStore(f,"columns"),ne=D.useStore(f,"_sort"),Z=D.useStore(f,"calendar"),ae=D.useStore(f,"durationUnit"),K=D.useStore(f,"splitTasks"),[ce,E]=e.useState(null),x=e.useMemo(()=>!P||!C?[]:T&&o?P:P.slice(C.start,C.end),[P,C,T,o]),A=e.useCallback((a,y)=>{if(y==="add-task")f.exec(y,{target:a,task:{text:p("New Task")},mode:"child",show:!0});else if(y==="open-task"){const $=x.find(H=>H.id===a);($?.data||$?.lazy)&&f.exec(y,{id:a,mode:!$.open})}},[x]),te=e.useCallback(a=>{const y=Ee.locateID(a),$=a.target.dataset.action;$&&a.preventDefault(),y?$==="add-task"||$==="open-task"?A(y,$):f.exec("select-task",{id:y,toggle:a.ctrlKey||a.metaKey,range:a.shiftKey,show:!0}):$==="add-task"&&A(null,$)},[f,A]),ue=e.useRef(null),re=e.useRef(null),[ie,be]=e.useState(0),[Re,$e]=e.useState(!1);e.useEffect(()=>{const a=re.current;if(!a||typeof ResizeObserver>"u")return;const y=()=>be(a.clientWidth);y();const $=new ResizeObserver(y);return $.observe(a),()=>$.disconnect()},[]);const ve=e.useRef(null),Le=e.useCallback(a=>{const y=a.id,{before:$,after:H}=a,he=a.onMove;let me=$||H,De=$?"before":"after";if(he){if(De==="after"){const Oe=f.getTask(me);Oe.data?.length&&Oe.open&&(De="before",me=Oe.data[0].id)}ve.current={id:y,[De]:me}}else ve.current=null;f.exec("move-task",{id:y,mode:De,target:me,inProgress:he})},[f]),ke=e.useMemo(()=>T&&o?0:C?.from??0,[C,T,o]),ee=e.useMemo(()=>M?.height??0,[M]),k=e.useMemo(()=>!r&&l!=="grid"?(b??0)>(i??0):(b??0)>(ie??0),[r,l,b,i,ie]),W=e.useMemo(()=>{const a={};return k&&l==="all"||l==="grid"&&k?a.width=b:l==="grid"&&(a.width="100%"),a},[k,l,b]),V=e.useMemo(()=>ce&&!x.find(a=>a.id===ce.id)?[...x,ce]:x,[x,ce]),q=e.useMemo(()=>{if(!T||!o)return V;const a=new Map,y=new Set;return V.forEach($=>{const H=o.taskRows.get($.id)??$.id;y.has(H)||(a.set(H,{...$,$rowTasks:o.rowMap.get(H)||[$.id]}),y.add(H))}),Array.from(a.values())},[V,T,o]),z=e.useMemo(()=>{let a=(Q||[]).map(H=>{H={...H};const he=H.header;if(typeof he=="object"){const me=he.text&&p(he.text);H.header={...he,text:me}}else H.header=p(he);return H});const y=a.findIndex(H=>H.id==="text"),$=a.findIndex(H=>H.id==="add-task");if(y!==-1&&(a[y].cell&&(a[y]._cell=a[y].cell),a[y].cell=Nt),$!==-1){a[$].cell=a[$].cell||xt;const H=a[$].header;if(typeof H!="object"&&(a[$].header={text:H}),a[$].header.cell=H.cell||xt,n)a.splice($,1);else if(r){const[he]=a.splice($,1);a.unshift(he)}}return a.length>0&&(a[a.length-1].resize=!1),a},[Q,p,n,r]),ge=e.useMemo(()=>l==="all"?`${i}px`:l==="grid"?"calc(100% - 4px)":z.find(a=>a.id==="add-task")?"50px":"0",[l,i,z]),oe=e.useMemo(()=>{if(q&&ne?.length){const a={};return ne.forEach(({key:y,order:$},H)=>{a[y]={order:$,...ne.length>1&&{index:H}}}),a}return{}},[q,ne]),S=e.useCallback(()=>z.some(a=>a.flexgrow&&!a.hidden),[]),J=e.useMemo(()=>S(),[S,Re]),de=e.useMemo(()=>{let a=l==="chart"?z.filter($=>$.id==="add-task"):z;const y=l==="all"?i:ie;if(!J){let $=b,H=!1;if(z.some(he=>he.$width)){let he=0;$=z.reduce((me,De)=>(De.hidden||(he+=De.width,me+=De.$width||De.width),me),0),he>$&&$>y&&(H=!0)}if(H||$<y){let he=1;return H||(he=(y-50)/($-50||1)),a.map(me=>(me.id!=="add-task"&&!me.hidden&&(me.$width||(me.$width=me.width),me.width=me.$width*he),me))}}return a},[l,z,J,b,i,ie]),fe=e.useCallback(a=>{if(!S()){const y=de.reduce(($,H)=>(a&&H.$width&&(H.$width=H.width),$+(H.hidden?0:H.width)),0);y!==b&&g(y)}$e(!0),$e(!1)},[S,de,b,g]),m=e.useCallback(()=>{z.filter(y=>y.flexgrow&&!y.hidden).length===1&&z.forEach(y=>{y.$width&&!y.flexgrow&&!y.hidden&&(y.width=y.$width)})},[]),le=e.useCallback(a=>{if(!n){const y=Ee.locateID(a),$=Ee.locateAttr(a,"data-col-id");!($&&z.find(he=>he.id==$))?.editor&&y&&f.exec("show-editor",{id:y})}},[f,n]),xe=e.useMemo(()=>Array.isArray(B)?B.map(a=>a.id):[],[B]),G=e.useRef(ke);G.current=ke,e.useEffect(()=>{const a=$=>{if(ue.current){const H=ue.current.querySelector(".wx-body");H&&(H.style.top=-(($??0)-(G.current??0))+"px")}re.current&&(re.current.scrollTop=0)};return a(U),f.on("scroll-chart",({top:$})=>{$!==void 0&&a($)})},[f,U]),e.useEffect(()=>{if(ue.current){const a=ue.current.querySelector(".wx-body");a&&(a.style.top=-((U??0)-(ke??0))+"px")}},[ke]),e.useEffect(()=>{const a=ue.current;if(!a)return;const y=a.querySelector(".wx-table-box .wx-body");if(!y||typeof ResizeObserver>"u")return;const $=new ResizeObserver(()=>{if(ue.current){const H=ue.current.querySelector(".wx-body");H&&(H.style.top=-((U??0)-(G.current??0))+"px")}});return $.observe(y),()=>{$.disconnect()}},[de,W,l,ge,q,U]),e.useEffect(()=>{if(!_||!X)return;const{id:a}=_,y=X.getState().focusCell;y&&y.row!==a&&ue.current&&ue.current.contains(document.activeElement)&&X.exec("focus-cell",{row:a,column:y.column})},[_,X]);const Ce=e.useCallback(({id:a})=>{if(n)return!1;f.getTask(a).open&&f.exec("open-task",{id:a,mode:!1});const y=f.getState()._tasks.find($=>$.id===a);if(E(y||null),!y)return!1},[f,n]),se=e.useCallback(({id:a,top:y})=>{ve.current?Le({...ve.current,onMove:!1}):f.exec("drag-task",{id:a,top:y+(ke??0),inProgress:!1}),E(null)},[f,Le,ke]),Se=e.useCallback(({id:a,top:y,detail:$})=>{$&&Le({...$,onMove:!0}),f.exec("drag-task",{id:a,top:y+(ke??0),inProgress:!0})},[f,Le,ke]);e.useEffect(()=>{const a=ue.current;return a?Lt(a,{start:Ce,end:se,move:Se,getTask:f.getTask}).destroy:void 0},[f,Ce,se,Se]);const ye=e.useCallback(a=>{const{key:y,isInput:$}=a;if(!$&&(y==="arrowup"||y==="arrowdown"))return a.eventSource="grid",f.exec("hotkey",a),!1;if(y==="enter"){const H=X?.getState().focusCell;if(H){const{row:he,column:me}=H;me==="add-task"?A(he,"add-task"):me==="text"&&A(he,"open-task")}}},[f,A,X]),Me=e.useRef(null),Ne=()=>{Me.current={setTableAPI:F,handleHotkey:ye,sortVal:ne,api:f,adjustColumns:m,setColumnWidth:fe,tasks:x,calendarVal:Z,durationUnitVal:ae,splitTasksVal:K,onTableAPIChange:h}};Ne(),e.useEffect(()=>{Ne()},[F,ye,ne,f,m,fe,x,Z,ae,K,h]);const We=e.useCallback(a=>{F(a),a.intercept("hotkey",y=>Me.current.handleHotkey(y)),a.intercept("scroll",()=>!1),a.intercept("select-row",()=>!1),a.intercept("sort-rows",y=>{const $=Me.current.sortVal,{key:H,add:he}=y,me=$?$.find(Oe=>Oe.key===H):null;let De="asc";return me&&(De=!me||me.order==="asc"?"desc":"asc"),f.exec("sort-tasks",{key:H,order:De,add:he}),!1}),a.on("resize-column",()=>{Me.current.setColumnWidth(!0)}),a.on("hide-column",y=>{y.mode||Me.current.adjustColumns(),Me.current.setColumnWidth()}),a.intercept("update-cell",y=>{const{id:$,column:H,value:he}=y,me=Me.current.tasks.find(De=>De.id===$);if(me){const De={...me};let Oe=he;Oe&&!isNaN(Oe)&&!(Oe instanceof Date)&&(Oe*=1),De[H]=Oe,pe.prepareEditTask(De,{calendar:Me.current.calendarVal,durationUnit:Me.current.durationUnitVal,splitTasks:Me.current.splitTasksVal},H),f.exec("update-task",{id:$,task:De})}return!1}),h&&h(a)},[]);return c.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ge}`},ref:re,children:c.jsx("div",{ref:ue,style:W,className:"wx-rHj6070p wx-table",onClick:te,onDoubleClick:le,children:c.jsx(wt.Grid,{init:We,sizes:{rowHeight:O,headerHeight:(ee??0)-1},rowStyle:a=>a.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:a=>`wx-rHj6070p wx-text-${a.align}${a.id==="add-task"?" wx-action":""}`,data:q,columns:de,selectedRows:[...xe],sortMarks:oe})})})}function Wt({borders:s=""}){const n=e.useContext(ze),r=D.useStore(n,"cellWidth"),i=D.useStore(n,"cellHeight"),l=e.useRef(null),[I,h]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&l.current){const o=getComputedStyle(l.current).getPropertyValue("--wx-gantt-border");h(o?o.substring(o.indexOf("#")):"#1d1e261a")}},[]);const T={width:"100%",height:"100%",background:r!=null&&i!=null?`url(${pe.grid(r,i,I,s)})`:void 0,position:"absolute",pointerEvents:"none"};return c.jsx("div",{ref:l,style:T})}function Ot({onSelectLink:s,selectedLink:n,readonly:r}){const i=e.useContext(ze),l=D.useStore(i,"_links"),I=D.useStore(i,"criticalPath"),h=e.useRef(null),T=e.useCallback(o=>{const b=o?.target?.classList;!b?.contains("wx-line")&&!b?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&h.current){const o=b=>{h.current&&!h.current.contains(b.target)&&T(b)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}}},[r,n,T]),c.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(l||[]).map(o=>{const b="wx-dkx3NwEn wx-line"+(I&&o.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return c.jsx("polyline",{className:b,points:o.$p,onClick:()=>!r&&s(o.id),"data-link-id":o.id},o.id)}),!r&&n&&c.jsx("polyline",{ref:h,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function _t(s){const{task:n,type:r}=s;function i(I){const h=n.segments[I];return{left:`${h.$x}px`,top:"0px",width:`${h.$w}px`,height:"100%"}}function l(I){if(!n.progress)return 0;const h=n.duration*n.progress/100,T=n.segments;let o=0,b=0,g=null;do{const X=T[b];b===I&&(o>h?g=0:g=Math.min((h-o)/X.duration,1)*100),o+=X.duration,b++}while(g===null&&b<T.length);return g||0}return c.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map((I,h)=>c.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":h,style:i(h),children:[n.progress?c.jsx("div",{className:"wx-progress-wrapper",children:c.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${l(h)}%`}})}):null,c.jsx("div",{className:"wx-content",children:I.text||""})]},h))})}let Ye=[],Ze=null,ht=null;const mt=(s,n)=>{if(!n||!n.start)return null;const{start:r,lengthUnitWidth:i,lengthUnit:l}=n,I=864e5,h=l==="week"?7:l==="month"?30:l==="quarter"?91:l==="year"?365:1,T=Math.floor(s/i);let o=r;if(l==="week"){const g=r.getUTCDay(),X=g===0?-6:1-g;o=new Date(r.getTime()+X*I),o.setUTCHours(0,0,0,0)}const b=new Date(o.getTime()+T*h*I);return b.setUTCHours(0,0,0,0),console.log("[pixelToDate]",{px:s,units:T,scalesStart:r.toISOString(),scalesStartDayOfWeek:r.getUTCDay(),alignedStart:o.toISOString(),result:b.toISOString()}),b},Ht=(s,n,r)=>{if(!r||!s||!n)return 0;const{lengthUnit:i}=r,h=(i==="week"?7:i==="month"?30:i==="quarter"?91:i==="year"?365:1)*864e5;return Math.round((s.getTime()-n.getTime())/h)},At=(s,n,r)=>{if(!r||!s)return s;const{lengthUnit:i}=r,h=(i==="week"?7:i==="month"?30:i==="quarter"?91:i==="year"?365:1)*864e5,T=new Date(s.getTime()+n*h);return T.setUTCHours(0,0,0,0),T},zt=(s,n,r,i)=>s<i&&n>r;function Gt(s){const{readonly:n,taskTemplate:r,multiTaskRows:i=!1,rowMapping:l=null,marqueeSelect:I=!1,copyPaste:h=!1,allowTaskIntersection:T=!0}=s,o=e.useContext(ze),[b,g]=D.useStoreWithCounter(o,"_tasks"),[X,F]=D.useStoreWithCounter(o,"_links"),v=D.useStore(o,"area"),p=D.useStore(o,"_scales"),f=D.useStore(o,"taskTypes"),U=D.useStore(o,"baselines"),[O,_]=D.useStoreWithCounter(o,"_selected"),B=D.useStore(o,"_scrollTask"),C=D.useStore(o,"criticalPath"),P=D.useStore(o,"tasks"),M=D.useStore(o,"schedule"),Q=D.useStore(o,"splitTasks"),ne=e.useMemo(()=>{if(!v||!Array.isArray(b))return[];const t=v.start??0,u=v.end??0;return i&&l?b.map(d=>({...d})):b.slice(t,u).map(d=>({...d}))},[g,v,i,l]),Z=D.useStore(o,"cellHeight"),ae=e.useMemo(()=>{if(!i||!l||!ne.length)return ne;const t=new Map,u=[];return b.forEach(d=>{const w=l.taskRows.get(d.id)??d.id;t.has(w)||(t.set(w,u.length),u.push(w))}),ne.map(d=>{const w=l.taskRows.get(d.id)??d.id,j=t.get(w)??0;return{...d,$y:j*Z,$y_base:d.$y_base!==void 0?j*Z:void 0}})},[ne,i,l,b,Z]),K=e.useMemo(()=>p.lengthUnitWidth,[p]),ce=e.useMemo(()=>p.lengthUnit||"day",[p]),E=e.useRef(!1),[x,A]=e.useState(void 0),[te,ue]=e.useState(null),re=e.useRef(null),[ie,be]=e.useState(null),[Re,$e]=e.useState(void 0),ve=e.useRef(null),[Le,ke]=e.useState(0),[ee,k]=e.useState(null),W=e.useRef(null),[V,q]=e.useState(null),[z,ge]=e.useState(null),[oe,S]=e.useState(null),J=e.useRef(null);J.current=z;const de=e.useRef(200),fe=e.useRef(null),m=e.useMemo(()=>{const t=fe.current;return!!(O.length&&t&&t.contains(document.activeElement))},[O,fe.current]),le=e.useMemo(()=>m&&O[O.length-1]?.id,[m,O]);e.useEffect(()=>{if(B&&m&&B){const{id:t}=B,u=fe.current?.querySelector(`.wx-bar[data-id='${t}']`);u&&u.focus({preventScroll:!0})}},[B]),e.useEffect(()=>{const t=fe.current;if(t&&(ke(t.offsetWidth||0),typeof ResizeObserver<"u")){const u=new ResizeObserver(d=>{d[0]&&ke(d[0].contentRect.width)});return u.observe(t),()=>u.disconnect()}},[fe.current]);const xe=e.useCallback(()=>{document.body.style.userSelect="none"},[]),G=e.useCallback(()=>{document.body.style.userSelect=""},[]),Ce=e.useCallback((t,u,d)=>{if(u.target.classList.contains("wx-line")||(d||(d=o.getTask(Ge(t))),d.type==="milestone"||d.type==="summary"))return"";const w=Ee.locate(u,"data-segment");w&&(t=w);const{left:j,width:R}=t.getBoundingClientRect(),N=(u.clientX-j)/R;let L=.2/(R>200?R/200:1);return N<L?"start":N>1-L?"end":""},[o]),se=e.useMemo(()=>{const t=new Set;if(T||!i||!l)return t;const u=new Map;return b.forEach(d=>{if(d.type==="summary"||d.type==="milestone")return;const w=l.taskRows.get(d.id)??d.id;u.has(w)||u.set(w,[]),u.get(w).push(d)}),u.forEach(d=>{if(!(d.length<2))for(let w=0;w<d.length;w++)for(let j=w+1;j<d.length;j++){const R=d[w],N=d[j],L=R.$x,Y=R.$x+R.$w,we=N.$x,je=N.$x+N.$w;zt(L,Y,we,je)&&(t.add(R.id),t.add(N.id))}}),t},[T,i,l,b,g]),Se=e.useMemo(()=>{const t=new Map;if(!i||!l)return b.forEach(w=>{t.set(w.id,w.$y)}),t;const u=new Map,d=[];return b.forEach(w=>{const j=l.taskRows.get(w.id)??w.id;u.has(j)||(u.set(j,d.length),d.push(j))}),b.forEach(w=>{const j=l.taskRows.get(w.id)??w.id,R=u.get(j)??0;t.set(w.id,R*Z)}),t},[b,i,l,Z]),ye=e.useMemo(()=>{const t=new Map;if(!i||!l)return b.forEach(w=>{t.set(w.id,w.$y),w.row!==void 0&&t.set(w.row,w.$y)}),t;const u=new Map,d=[];return b.forEach(w=>{const j=l.taskRows.get(w.id)??w.id;u.has(j)||(u.set(j,d.length),d.push(j))}),u.forEach((w,j)=>{t.set(j,w*Z)}),t},[b,i,l,Z]),Me=e.useCallback(t=>{if(!fe.current)return[];const d=Math.min(t.startX,t.currentX),w=Math.max(t.startX,t.currentX),j=Math.min(t.startY,t.currentY),R=Math.max(t.startY,t.currentY);return b.filter(N=>{const L=N.$x,Y=N.$x+N.$w,je=Se.get(N.id)??N.$y,Pe=je+N.$h;return L<w&&Y>d&&je<R&&Pe>j})},[b,Se]),Ne=e.useMemo(()=>new Set(O.map(t=>t.id)),[O,_]),We=e.useCallback(t=>Ne.has(t),[Ne]),a=e.useCallback((t,u)=>{const{clientX:d}=u,w=Ge(t),j=o.getTask(w),R=u.target.classList;if(!u.target.closest(".wx-delete-button")&&!n){if(R.contains("wx-progress-marker")){const{progress:N}=o.getTask(w);re.current={id:w,x:d,progress:N,dx:0,node:t,marker:u.target},u.target.classList.add("wx-progress-in-drag")}else{const N=Ce(t,u,j)||"move",L={id:w,mode:N,x:d,dx:0,l:j.$x,w:j.$w};if(Q&&j.segments?.length){const Y=Ee.locate(u,"data-segment");Y&&(L.segmentIndex=Y.dataset.segment*1,pe.extendDragOptions(j,L))}ue(L)}xe()}},[o,n,Ce,xe,Q]),y=e.useCallback(t=>{if(t.button!==0||oe)return;const u=Ee.locate(t);if(!u&&I&&!n){const d=fe.current;if(!d)return;const w=d.getBoundingClientRect(),j=t.clientX-w.left,R=t.clientY-w.top;if(h){const L=mt(j,p);L&&(J.current=L,ge(L))}const N={startX:j,startY:R,currentX:j,currentY:R,ctrlKey:t.ctrlKey||t.metaKey};k(N),W.current=N,xe();return}if(u){if(I&&!n&&O.length>1){const d=Ge(u);if(We(d)){const w=t.target.classList;if(!w.contains("wx-link")&&!w.contains("wx-progress-marker")&&!t.target.closest(".wx-delete-button")){const j=o.getTask(d);if(!Ce(u,t,j)){const N=new Map;O.forEach(L=>{const Y=o.getTask(L.id);if(Y){if(M?.auto&&Y.type==="summary")return;N.set(L.id,{$x:Y.$x,$w:Y.$w,start:Y.start,end:Y.end})}}),q({baseTaskId:d,startX:t.clientX,dx:0,originalPositions:N}),xe();return}}}}a(u,t)}},[a,I,h,n,O,We,o,Ce,M,xe,p,oe]),$=e.useCallback(t=>{const u=Ee.locate(t);u&&(ve.current=setTimeout(()=>{$e(!0),a(u,t.touches[0])},300))},[a]),H=e.useCallback(t=>{be(t&&{...X.find(u=>u.id===t)})},[X]),he=e.useCallback(()=>{const t=W.current;if(t){const u=Me(t);t.ctrlKey?u.forEach(d=>{o.exec("select-task",{id:d.id,toggle:!0,marquee:!0})}):(O.length>0&&o.exec("select-task",{id:null,marquee:!0}),u.forEach((d,w)=>{o.exec("select-task",{id:d.id,toggle:w>0,marquee:!0})})),k(null),W.current=null,G(),E.current=!0;return}if(V){const{dx:u,originalPositions:d}=V,w=Math.round(u/K);if(w!==0){let j=!0;d.forEach((R,N)=>{const L=o.getTask(N);L&&(o.exec("update-task",{id:N,diff:w,task:{start:L.start,end:L.end},skipUndo:!j}),j=!1)}),E.current=!0}else d.forEach((j,R)=>{o.exec("drag-task",{id:R,left:j.$x,width:j.$w,inProgress:!1})});q(null),G();return}if(re.current){const{dx:u,id:d,marker:w,value:j}=re.current;re.current=null,typeof j<"u"&&u&&o.exec("update-task",{id:d,task:{progress:j},inProgress:!1}),w.classList.remove("wx-progress-in-drag"),E.current=!0,G()}else if(te){const{id:u,mode:d,dx:w,l:j,w:R,start:N,segment:L,index:Y}=te;if(ue(null),N){const we=Math.round(w/K);if(!we)o.exec("drag-task",{id:u,width:R,left:j,inProgress:!1,...L&&{segmentIndex:Y}});else{let je={},Pe=o.getTask(u);L&&(Pe=Pe.segments[Y]);const _e=1440*60*1e3,Ie=we*(ce==="week"?7:ce==="month"?30:ce==="quarter"?91:ce==="year"?365:1)*_e;d==="move"?(je.start=new Date(Pe.start.getTime()+Ie),je.end=new Date(Pe.end.getTime()+Ie)):d==="start"?(je.start=new Date(Pe.start.getTime()+Ie),je.end=Pe.end):d==="end"&&(je.start=Pe.start,je.end=new Date(Pe.end.getTime()+Ie)),o.exec("update-task",{id:u,task:je,...L&&{segmentIndex:Y}})}E.current=!0}G()}},[o,G,te,K,ce,ee,V,Me,O]),me=e.useCallback((t,u)=>{const{clientX:d,clientY:w}=u,j=fe.current;if(j){const R=j.getBoundingClientRect();de.current=d-R.left}if(oe){if(!j)return;const R=j.getBoundingClientRect(),N=d-R.left;S(L=>({...L,currentX:N}));return}if(!n){if(ee){const R=fe.current;if(!R)return;const N=R.getBoundingClientRect(),L=d-N.left,Y=w-N.top;k(we=>({...we,currentX:L,currentY:Y})),W.current&&(W.current.currentX=L,W.current.currentY=Y);return}if(V){const R=d-V.startX;V.originalPositions.forEach((N,L)=>{const Y=N.$x+R;o.exec("drag-task",{id:L,left:Y,width:N.$w,inProgress:!0})}),q(N=>({...N,dx:R}));return}if(re.current){const{node:R,x:N,id:L}=re.current,Y=re.current.dx=d-N,we=Math.round(Y/R.offsetWidth*100);let je=re.current.progress+we;re.current.value=je=Math.min(Math.max(0,je),100),o.exec("update-task",{id:L,task:{progress:je},inProgress:!0})}else if(te){H(null);const{mode:R,l:N,w:L,x:Y,id:we,start:je,segment:Pe,index:_e}=te,He=o.getTask(we),Ie=d-Y;if(!je&&Math.abs(Ie)<20||R==="start"&&L-Ie<K||R==="end"&&L+Ie<K||R==="move"&&(Ie<0&&N+Ie<0||Ie>0&&N+L+Ie>Le)||te.segment&&!pe.isSegmentMoveAllowed(He,te))return;const Ke={...te,dx:Ie};let Ue,qe;if(R==="start"?(Ue=N+Ie,qe=L-Ie):R==="end"?(Ue=N,qe=L+Ie):R==="move"&&(Ue=N+Ie,qe=L),o.exec("drag-task",{id:we,width:qe,left:Ue,inProgress:!0,...Pe&&{segmentIndex:_e}}),!Ke.start&&(R==="move"&&He.$x==N||R!=="move"&&He.$w==L)){E.current=!0,he();return}Ke.start=!0,ue(Ke)}else{const R=Ee.locate(t);if(R){const N=o.getTask(Ge(R)),Y=Ee.locate(t,"data-segment")||R,we=Ce(Y,u,N);Y.style.cursor=we&&!n?"col-resize":"pointer"}}}},[o,n,te,K,Le,Ce,H,he,ee,V,oe]),De=e.useCallback(t=>{me(t,t)},[me]),Oe=e.useCallback(t=>{Re?(t.preventDefault(),me(t,t.touches[0])):ve.current&&(clearTimeout(ve.current),ve.current=null)},[Re,me]),Ve=e.useCallback(()=>{he()},[he]),bt=e.useCallback(()=>{$e(null),ve.current&&(clearTimeout(ve.current),ve.current=null),he()},[he]);e.useEffect(()=>(window.addEventListener("mouseup",Ve),()=>{window.removeEventListener("mouseup",Ve)}),[Ve]);const yt=e.useCallback(t=>{if(!n){const u=Ee.locateID(t.target);if(u&&!t.target.classList.contains("wx-link")){const d=Ee.locateID(t.target,"data-segment");o.exec("show-editor",{id:u,...d!==null&&{segmentIndex:d}})}}},[o,n]),Tt=["e2s","s2s","e2e","s2e"],Xe=e.useCallback((t,u)=>Tt[(t?1:0)+(u?0:2)],[]),Fe=e.useCallback((t,u)=>{const d=x.id,w=x.start;return t===d?!0:!!X.find(j=>j.target==t&&j.source==d&&j.type===Xe(w,u))},[x,F,Xe]),et=e.useCallback(()=>{x&&A(null)},[x]),tt=e.useCallback((t,u,d)=>{if(!u.length||!t||d==null)return;console.log("[paste] executePaste called:",{targetDate:t.toISOString(),taskCount:u.length,parent:d});const w=864e5,j=o.getHistory();j?.startBatch();const R=new Date(t),N=R.getUTCDay(),L=N===0?-6:1-N;R.setUTCDate(R.getUTCDate()+L),R.setUTCHours(0,0,0,0),u.forEach((Y,we)=>{const je=`task-${Date.now()}-${we}`,Pe=At(R,Y._startCellOffset||0,p),_e=new Date(Pe.getTime()+(Y._startDayOfWeek||0)*w);_e.setUTCHours(0,0,0,0);const He=new Date(_e.getTime()+(Y._durationDays||7)*w);He.setUTCHours(0,0,0,0),console.log("[paste] task:",{text:Y.text,original:{start:Y.start?.toISOString?.(),end:Y.end?.toISOString?.()},calculated:{targetWeekStart:R.toISOString(),weekOffset:Pe.toISOString(),newStart:_e.toISOString(),newEnd:He.toISOString()},clipboard:{_startCellOffset:Y._startCellOffset,_startDayOfWeek:Y._startDayOfWeek,_durationDays:Y._durationDays},row:Y.row}),o.exec("add-task",{task:{id:je,text:Y.text,start:_e,end:He,type:Y.type||"task",parent:d,row:Y.row},target:d,mode:"child",skipUndo:we>0})}),j?.endBatch()},[o,p]),Ct=e.useCallback(t=>{if(E.current){E.current=!1;return}if(oe&&oe.currentX!=null){const d=mt(oe.currentX,p);d&&tt(d,oe.tasks,oe.parent),S(null);return}const u=Ee.locateID(t.target);if(u){const d=o.getTask(u),w=b.find(R=>R.id===u);console.log("[click] task:",d?.text,"id:",u),console.log("[click] api.getTask:",{start:d?.start,end:d?.end,duration:d?.duration}),console.log("[click] rendered:",{start:w?.start,end:w?.end,$w:w?.$w,$x:w?.$x});const j=t.target.classList;if(j.contains("wx-link")){const R=j.contains("wx-left");if(!x){A({id:u,start:R});return}x.id!==u&&!Fe(u,R)&&o.exec("add-link",{link:{source:x.id,target:u,type:Xe(x.start,R)}})}else if(j.contains("wx-delete-button-icon"))o.exec("delete-link",{id:ie.id}),be(null);else{let R;const N=Ee.locate(t,"data-segment");N&&(R=N.dataset.segment*1),o.exec("select-task",{id:u,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:R})}}et()},[o,x,F,ie,Fe,Xe,et,oe,p,tt]),St=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),vt=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),Mt=e.useCallback(t=>{if(Re||ve.current)return t.preventDefault(),!1},[Re]),st=e.useMemo(()=>f.map(t=>t.id),[f]),nt=e.useCallback(t=>{let u=st.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(u=`task ${u}`),u},[st]),rt=e.useCallback(t=>{o.exec(t.action,t.data)},[o]),Qe=e.useCallback(t=>C&&P.byId(t).$critical,[C,P]),ot=e.useCallback(t=>{if(M?.auto){const u=P.getSummaryId(t,!0),d=P.getSummaryId(x.id,!0);return x?.id&&!(Array.isArray(u)?u:[u]).includes(x.id)&&!(Array.isArray(d)?d:[d]).includes(t)}return x},[M,P,x]),lt=e.useCallback(()=>{const t=o.getState()._selected;if(!t||!t.length)return;const u=864e5,d=t.map(L=>{const Y=o.getTask(L.id);if(!Y)return null;const we=b.find(Rt=>Rt.id===L.id);if(!we)return null;const{$x:je,$y:Pe,$h:_e,$w:He,$skip:Ie,$level:Ke,$index:Ue,$y_base:qe,$x_base:hs,$w_base:ms,$h_base:gs,$skip_baseline:ws,$critical:ps,$reorder:ks,...Et}=we,it=we.end&&we.start?Math.round((we.end.getTime()-we.start.getTime())/u):0,at=we.start?(we.start.getUTCDay()+6)%7:0;return console.log("[copy] task:",{id:Y.id,text:Y.text,start:we.start?.toISOString?.(),end:we.end?.toISOString?.(),durationDays:it,startDayOfWeek:at,$w:He,$h:_e,row:we.row,parent:we.parent}),{...Et,_durationDays:it,_startDayOfWeek:at,_originalWidth:He,_originalHeight:_e}}).filter(Boolean);if(!d.length)return;const j=d[0].parent,R=d.filter(L=>L.parent===j);if(R.length===0)return;const N=R.reduce((L,Y)=>Y.start&&(!L||Y.start<L)?Y.start:L,null);Ye=R.map(L=>({...L,_startCellOffset:Ht(L.start,N,p)})),ht=j,Ze=N,console.log("[copy] clipboard stored:",{taskCount:Ye.length,baseDate:N?.toISOString?.(),parent:j,tasks:Ye.map(L=>({id:L.id,text:L.text,_startCellOffset:L._startCellOffset,_startDayOfWeek:L._startDayOfWeek,_durationDays:L._durationDays}))})},[o,p]);e.useEffect(()=>h?o.intercept("hotkey",u=>{if(u.key==="ctrl+c"||u.key==="meta+c")return lt(),!1;if(u.key==="ctrl+v"||u.key==="meta+v")return!Ye.length||!Ze||S({tasks:Ye,baseDate:Ze,parent:ht,currentX:de.current}),!1}):void 0,[h,o,lt]),e.useEffect(()=>{if(!oe)return;const t=u=>{u.key==="Escape"&&(u.preventDefault(),u.stopPropagation(),S(null))};return document.addEventListener("keydown",t,!0),()=>document.removeEventListener("keydown",t,!0)},[oe]);const ct=e.useMemo(()=>{if(!ee)return null;const t=Math.min(ee.startX,ee.currentX),u=Math.min(ee.startY,ee.currentY),d=Math.abs(ee.currentX-ee.startX),w=Math.abs(ee.currentY-ee.startY);return{left:`${t}px`,top:`${u}px`,width:`${d}px`,height:`${w}px`}},[ee]);return c.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${ae.length?ae[0].$h:0}px`},ref:fe,onContextMenu:Mt,onMouseDown:y,onMouseMove:De,onTouchStart:$,onTouchMove:Oe,onTouchEnd:bt,onClick:Ct,onDoubleClick:yt,onDragStart:t=>(t.preventDefault(),!1),children:[c.jsx(Ot,{onSelectLink:H,selectedLink:ie,readonly:n}),ae.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const u=se.has(t.id),d=`wx-bar wx-${nt(t.type)}`+(Re&&te&&t.id===te.id?" wx-touch":"")+(x&&x.id===t.id?" wx-selected":"")+(Ne.has(t.id)?" wx-selected":"")+(Qe(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(Q&&t.segments?" wx-split":"")+(u?" wx-collision":""),w="wx-link wx-left"+(x?" wx-visible":"")+(!x||!Fe(t.id,!0)&&ot(t.id)?" wx-target":"")+(x&&x.id===t.id&&x.start?" wx-selected":"")+(Qe(t.id)?" wx-critical":""),j="wx-link wx-right"+(x?" wx-visible":"")+(!x||!Fe(t.id,!1)&&ot(t.id)?" wx-target":"")+(x&&x.id===t.id&&!x.start?" wx-selected":"")+(Qe(t.id)?" wx-critical":"");return c.jsxs(e.Fragment,{children:[!t.$skip&&c.jsxs("div",{className:"wx-GKbcLEGA "+d,style:St(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:le===t.id?0:-1,children:[n?null:t.id===ie?.target&&ie?.type[2]==="s"?c.jsx(Te.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+w,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?c.jsxs(c.Fragment,{children:[t.progress&&!(Q&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:c.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(Q&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?c.jsx(r,{data:t,api:o,onAction:rt}):Q&&t.segments?c.jsx(_t,{task:t,type:nt(t.type)}):c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""}),u&&c.jsx("div",{className:"wx-GKbcLEGA wx-collision-warning",title:"This task overlaps with another task in the same row",children:"!"})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?c.jsx(r,{data:t,api:o,onAction:rt}):c.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===ie?.target&&ie?.type[2]==="e"?c.jsx(Te.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+j,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),U&&!t.$skip_baseline?c.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:vt(t)}):null]},t.id)}),ee&&ct&&c.jsx("div",{className:"wx-GKbcLEGA wx-marquee-selection",style:ct}),oe&&oe.currentX!=null&&oe.tasks.map((t,u)=>{const w=(Math.floor(oe.currentX/K)+(t._startCellOffset||0))*K,j=t._originalWidth||K,R=t._originalHeight||Z,N=ye.get(t.row)??(t.$y||0);return c.jsx("div",{className:"wx-GKbcLEGA wx-bar wx-task wx-paste-preview",style:{left:w,top:N,width:j,height:R},children:c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text})},`preview-${u}`)})]})}function Ut(s){const{highlightTime:n}=s,r=e.useContext(ze),i=D.useStore(r,"_scales");return c.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:i.width},children:(i?.rows||[]).map((l,I)=>c.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${l.height}px`},children:(l.cells||[]).map((h,T)=>{const o=n?n(h.date,h.unit):"",b="wx-cell "+(h.css||"")+" "+(o||""),g=typeof h.value=="string"&&h.value.includes("<");return c.jsx("div",{className:"wx-ZkvhDKir "+b,style:{width:`${h.width}px`},...g?{dangerouslySetInnerHTML:{__html:h.value}}:{children:h.value}},T)})},I))})}const qt=new Map;function Yt(s){const n=e.useRef(null),r=e.useRef(0),i=e.useRef(null),l=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(l)return cancelAnimationFrame(i.current),i.current=requestAnimationFrame(()=>{const I={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};qt.set(s,I),window.dispatchEvent(new CustomEvent("render-metric",{detail:I}))}),()=>cancelAnimationFrame(i.current)})}function Xt(s){const{readonly:n,fullWidth:r,fullHeight:i,taskTemplate:l,cellBorders:I,highlightTime:h,multiTaskRows:T=!1,rowMapping:o=null,marqueeSelect:b=!1,copyPaste:g=!1,scrollToCurrentWeek:X=!1,currentWeekColor:F=null,allowTaskIntersection:v=!0}=s,p=e.useContext(ze),[f,U]=D.useStoreWithCounter(p,"_selected"),O=D.useStore(p,"scrollTop"),_=D.useStore(p,"cellHeight"),B=D.useStore(p,"cellWidth"),C=D.useStore(p,"_scales"),P=D.useStore(p,"_markers"),M=D.useStore(p,"_scrollTask"),Q=D.useStore(p,"zoom"),ne=D.useStore(p,"_tasks"),[Z,ae]=e.useState(),K=e.useRef(null),ce=e.useRef(0),E=e.useRef(!1),x=1+(C?.rows?.length||0),A=e.useMemo(()=>{if(!T||!o||!ne?.length)return null;const k=new Map,W=new Map,V=[];return ne.forEach(q=>{const z=o.taskRows.get(q.id)??q.id;W.has(z)||(W.set(z,V.length),V.push(z))}),ne.forEach(q=>{const z=o.taskRows.get(q.id)??q.id,ge=W.get(z)??0;k.set(q.id,ge*_)}),k},[ne,T,o,_]),te=e.useMemo(()=>{const k=[];return f&&f.length&&_&&f.forEach(W=>{const V=A?.get(W.id)??W.$y;k.push({height:`${_}px`,top:`${V-3}px`})}),k},[U,_,A]),ue=e.useMemo(()=>Math.max(Z||0,i),[Z,i]);e.useEffect(()=>{const k=K.current;k&&typeof O=="number"&&(k.scrollTop=O)},[O]);const re=()=>{ie()};function ie(k){const W=K.current;if(!W)return;const V={};V.left=W.scrollLeft,p.exec("scroll-chart",V)}function be(){const k=K.current,V=Math.ceil((Z||0)/(_||1))+1,q=Math.floor((k&&k.scrollTop||0)/(_||1)),z=Math.max(0,q-x),ge=q+V+x,oe=z*(_||0);p.exec("render-data",{start:z,end:ge,from:oe})}e.useEffect(()=>{be()},[Z,O]);const Re=e.useCallback(k=>{if(!k)return;const{id:W,mode:V}=k;if(V.toString().indexOf("x")<0)return;const q=K.current;if(!q)return;const{clientWidth:z}=q,ge=p.getTask(W);if(ge.$x+ge.$w<q.scrollLeft)p.exec("scroll-chart",{left:ge.$x-(B||0)}),q.scrollLeft=ge.$x-(B||0);else if(ge.$x>=z+q.scrollLeft){const oe=z<ge.$w?B||0:ge.$w;p.exec("scroll-chart",{left:ge.$x-z+oe}),q.scrollLeft=ge.$x-z+oe}},[p,B]);e.useEffect(()=>{Re(M)},[M]);function $e(k){if(Q&&(k.ctrlKey||k.metaKey)){k.preventDefault();const W=K.current,V=k.clientX-(W?W.getBoundingClientRect().left:0);if(ce.current+=k.deltaY,Math.abs(ce.current)>=150){const z=-Math.sign(ce.current);ce.current=0,p.exec("zoom-scale",{dir:z,offset:V})}}}const ve=e.useCallback(k=>{const W=h(k.date,k.unit);return W?{css:W,width:k.width}:null},[h]),Le=e.useMemo(()=>{if(!C||!h||!["hour","day","week"].includes(C.minUnit))return null;let W=0;return C.rows[C.rows.length-1].cells.map(V=>{const q=ve(V),z=W;return W+=V.width,q?{...q,left:z}:null})},[C,h,ve]),ke=e.useCallback(k=>{k.eventSource="chart",p.exec("hotkey",k)},[p]);e.useEffect(()=>{const k=K.current;if(!k)return;const W=()=>ae(k.clientHeight);W();const V=new ResizeObserver(()=>W());return V.observe(k),()=>{V.disconnect()}},[K.current]);const ee=e.useRef(null);return e.useEffect(()=>{const k=K.current;if(k&&!ee.current)return ee.current=gt.hotkeys(k,{keys:{arrowup:!0,arrowdown:!0},exec:W=>ke(W)}),()=>{ee.current?.destroy(),ee.current=null}},[]),e.useEffect(()=>{const k=K.current;if(!k)return;const W=$e;return k.addEventListener("wheel",W),()=>{k.removeEventListener("wheel",W)}},[$e]),e.useEffect(()=>{if(!X||E.current||!C||!K.current||!Z)return;const k=K.current,{clientWidth:W}=k,V=new Date,q=C.rows[C.rows.length-1]?.cells;if(!q)return;let z=-1,ge=0;const oe=[];for(let J=0;J<q.length;J++){const de=q[J];oe.push({left:ge,width:de.width});const fe=de.date;if(de.unit==="week"){const m=new Date(fe);m.setUTCDate(m.getUTCDate()+7),V>=fe&&V<m&&(z=J)}else de.unit==="day"&&V.getUTCFullYear()===fe.getUTCFullYear()&&V.getUTCMonth()===fe.getUTCMonth()&&V.getUTCDate()===fe.getUTCDate()&&(z=J);ge+=de.width}let S=z;if(z>0&&(S=z-1),S>=0&&oe[S]){const J=oe[S],de=Math.max(0,J.left);k.scrollLeft=de,p.exec("scroll-chart",{left:de}),E.current=!0}},[X,C,Z,p]),Yt("chart"),c.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:K,onScroll:re,children:[c.jsx(Ut,{highlightTime:h,scales:C}),P&&P.length?c.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${ue}px`},children:P.map((k,W)=>c.jsx("div",{className:`wx-mR7v2Xag wx-marker ${k.css||""}`,style:{left:`${k.left}px`},children:c.jsx("div",{className:"wx-mR7v2Xag wx-content",children:k.text})},W))}):null,c.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${ue}px`},children:[Le?c.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:Le.map((k,W)=>k?c.jsx("div",{className:"wx-mR7v2Xag "+k.css,style:{width:`${k.width}px`,left:`${k.left}px`}},W):null)}):null,c.jsx(Wt,{borders:I}),f&&f.length?f.map((k,W)=>k.$y?c.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":k.id,style:te[W]},k.id):null):null,c.jsx(Gt,{readonly:n,taskTemplate:l,multiTaskRows:T,rowMapping:o,marqueeSelect:b,copyPaste:g,allowTaskIntersection:v})]})]})}function Ft(s){const{position:n="after",size:r=4,dir:i="x",onMove:l,onDisplayChange:I,compactMode:h,containerWidth:T=0,leftThreshold:o=50,rightThreshold:b=50}=s,[g,X]=D.useWritableProp(s.value??0),[F,v]=D.useWritableProp(s.display??"all");function p(re){let ie=0;n=="center"?ie=r/2:n=="before"&&(ie=r);const be={size:[r+"px","auto"],p:[re-ie+"px","0px"],p2:["auto","0px"]};if(i!="x")for(let Re in be)be[Re]=be[Re].reverse();return be}const[f,U]=e.useState(!1),[O,_]=e.useState(null),B=e.useRef(0),C=e.useRef(),P=e.useRef(),M=e.useRef(F);e.useEffect(()=>{M.current=F},[F]),e.useEffect(()=>{O===null&&g>0&&_(g)},[O,g]);function Q(re){return i=="x"?re.clientX:re.clientY}const ne=e.useCallback(re=>{const ie=C.current+Q(re)-B.current;X(ie);let be;ie<=o?be="chart":T-ie<=b?be="grid":be="all",M.current!==be&&(v(be),M.current=be),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>l&&l(ie),100)},[T,o,b,l]),Z=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",U(!1),window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",Z)},[ne]),ae=e.useMemo(()=>F!=="all"?"auto":i=="x"?"ew-resize":"ns-resize",[F,i]),K=e.useCallback(re=>{!h&&(F==="grid"||F==="chart")||(B.current=Q(re),C.current=g,U(!0),document.body.style.cursor=ae,document.body.style.userSelect="none",window.addEventListener("mousemove",ne),window.addEventListener("mouseup",Z))},[ae,ne,Z,g,h,F]);function ce(){v("all"),O!==null&&(X(O),l&&l(O))}function E(re){if(h){const ie=F==="chart"?"grid":"chart";v(ie),I(ie)}else if(F==="grid"||F==="chart")ce(),I("all");else{const ie=re==="left"?"chart":"grid";v(ie),I(ie)}}function x(){E("left")}function A(){E("right")}const te=e.useMemo(()=>p(g),[g,n,r,i]),ue=["wx-resizer",`wx-resizer-${i}`,`wx-resizer-display-${F}`,f?"wx-resizer-active":""].filter(Boolean).join(" ");return c.jsxs("div",{className:"wx-pFykzMlT "+ue,onMouseDown:K,style:{width:te.size[0],height:te.size[1],cursor:ae},children:[c.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:x})}),c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:A})})]}),c.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const Kt=650;function pt(s){let n;function r(){n=new ResizeObserver(l=>{for(let I of l)if(I.target===document.body){let h=I.contentRect.width<=Kt;s(h)}}),n.observe(document.body)}function i(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:i}}function Bt(s){const{taskTemplate:n,readonly:r,cellBorders:i,highlightTime:l,onTableAPIChange:I,multiTaskRows:h=!1,rowMapping:T=null,marqueeSelect:o=!1,copyPaste:b=!1,scrollToCurrentWeek:g=!1,currentWeekColor:X=null,allowTaskIntersection:F=!0}=s,v=e.useContext(ze),p=D.useStore(v,"_tasks"),f=D.useStore(v,"_scales"),U=D.useStore(v,"cellHeight"),O=D.useStore(v,"columns"),_=D.useStore(v,"_scrollTask"),B=D.useStore(v,"undo"),C=e.useMemo(()=>{if(!h)return T;const S=new Map,J=new Map;return p.forEach(de=>{const fe=de.row??de.id;J.set(de.id,fe),S.has(fe)||S.set(fe,[]),S.get(fe).push(de.id)}),{rowMap:S,taskRows:J}},[p,h,T]),[P,M]=e.useState(!1);let[Q,ne]=e.useState(0);const[Z,ae]=e.useState(0),[K,ce]=e.useState(0),[E,x]=e.useState(void 0),[A,te]=e.useState("all"),ue=e.useRef(null),re=e.useCallback(S=>{M(J=>(S!==J&&(S?(ue.current=A,A==="all"&&te("grid")):(!ue.current||ue.current==="all")&&te("all")),S))},[A]);e.useEffect(()=>{const S=pt(re);return S.observe(),()=>{S.disconnect()}},[re]);const ie=e.useMemo(()=>{let S;return O.every(J=>J.width&&!J.flexgrow)?S=O.reduce((J,de)=>J+parseInt(de.width),0):P&&A==="chart"?S=parseInt(O.find(J=>J.id==="action")?.width)||50:S=440,Q=S,S},[O,P,A]);e.useEffect(()=>{ne(ie)},[ie]);const be=e.useMemo(()=>(Z??0)-(E??0),[Z,E]),Re=e.useMemo(()=>f.width,[f]),$e=e.useMemo(()=>{if(!h||!C)return p.length*U;const S=new Set;return p.forEach(J=>{const de=C.taskRows.get(J.id)??J.id;S.add(de)}),S.size*U},[p,U,h,C]),ve=e.useMemo(()=>f.height+$e+be,[f,$e,be]),Le=e.useMemo(()=>Q+Re,[Q,Re]),ke=e.useRef(null),ee=e.useCallback(()=>{Promise.resolve().then(()=>{if((Z??0)>(Le??0)){const S=(Z??0)-Q;v.exec("expand-scale",{minWidth:S})}})},[Z,Le,Q,v]);e.useEffect(()=>{let S;return ke.current&&(S=new ResizeObserver(ee),S.observe(ke.current)),()=>{S&&S.disconnect()}},[ke.current,ee]),e.useEffect(()=>{ee()},[Re]);const k=e.useRef(null),W=e.useRef(null),V=e.useCallback(()=>{const S=k.current;S&&v.exec("scroll-chart",{top:S.scrollTop})},[v]),q=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{q.current={rTasks:p,rScales:f,rCellHeight:U,scrollSize:be,ganttDiv:k.current,ganttHeight:K??0}},[p,f,U,be,K]);const z=e.useCallback(S=>{if(!S)return;const{rTasks:J,rScales:de,rCellHeight:fe,scrollSize:m,ganttDiv:le,ganttHeight:xe}=q.current;if(!le)return;const{id:G}=S,Ce=J.findIndex(se=>se.id===G);if(Ce>-1){const se=xe-de.height,Se=Ce*fe,ye=le.scrollTop;let Me=null;Se<ye?Me=Se:Se+fe>ye+se&&(Me=Se-se+fe+m),Me!==null&&(v.exec("scroll-chart",{top:Math.max(Me,0)}),k.current.scrollTop=Math.max(Me,0))}},[v]);e.useEffect(()=>{z(_)},[_]),e.useEffect(()=>{const S=k.current,J=W.current;if(!S||!J)return;const de=()=>{Dt.flushSync(()=>{ce(S.offsetHeight),ae(S.offsetWidth),x(J.offsetWidth)})},fe=new ResizeObserver(de);return fe.observe(S),()=>fe.disconnect()},[k.current]);const ge=e.useRef(null),oe=e.useRef(null);return e.useEffect(()=>{oe.current&&(oe.current.destroy(),oe.current=null);const S=ge.current;if(S)return oe.current=gt.hotkeys(S,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,"meta+c":!0,"meta+v":!0,"meta+x":!0,"meta+d":!0,backspace:!0,"ctrl+z":B,"ctrl+y":B,"meta+z":B,"meta+shift+z":B},exec:J=>{if(J.isInput)return;const de=J.key;if(de==="ctrl+z"||de==="meta+z"){v.exec("undo",{});return}if(de==="ctrl+y"||de==="meta+shift+z"){v.exec("redo",{});return}v.exec("hotkey",J)}}),()=>{oe.current?.destroy(),oe.current=null}},[B]),c.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:k,onScroll:V,children:c.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:ve,width:"100%"},ref:W,children:c.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:K,width:E},children:c.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:ge,children:[O.length?c.jsxs(c.Fragment,{children:[c.jsx(Pt,{display:A,compactMode:P,columnWidth:ie,width:Q,readonly:r,fullHeight:$e,onTableAPIChange:I,multiTaskRows:h,rowMapping:C}),c.jsx(Ft,{value:Q,display:A,compactMode:P,containerWidth:Z,onMove:S=>ne(S),onDisplayChange:S=>te(S)})]}):null,c.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:ke,children:c.jsx(Xt,{readonly:r,fullWidth:Re,fullHeight:$e,taskTemplate:n,cellBorders:i,highlightTime:l,multiTaskRows:h,rowMapping:C,marqueeSelect:o,copyPaste:b,scrollToCurrentWeek:g,currentWeekColor:X,allowTaskIntersection:F})})]})})})})}function Vt(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function Qt(s,n){return typeof s=="function"?s:Ee.dateToString(s,n)}function kt(s,n){return s.map(({format:r,...i})=>({...i,format:Qt(r,n)}))}function Zt(s,n){const r=Vt(n);for(let i in r)r[i]=Ee.dateToString(r[i],s);return r}function Jt(s,n){if(!s||!s.length)return s;const r=Ee.dateToString("%d-%m-%Y",n);return s.map(i=>i.template?i:i.id==="start"||i.id=="end"?{...i,_template:l=>r(l),template:l=>r(l)}:i.id==="duration"?{...i,_template:l=>l,template:l=>l}:i)}function es(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:kt(r.scales,n)}))}:s}const ts=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),ss=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],ns=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:i=pe.defaultTaskTypes,tasks:l=[],selected:I=[],activeTask:h=null,links:T=[],scales:o=ss,columns:b=pe.defaultColumns,start:g=null,end:X=null,lengthUnit:F="day",durationUnit:v="day",cellWidth:p=100,cellHeight:f=38,scaleHeight:U=36,readonly:O=!1,cellBorders:_="full",zoom:B=!1,baselines:C=!1,highlightTime:P=null,init:M=null,autoScale:Q=!0,unscheduledTasks:ne=!1,criticalPath:Z=null,schedule:ae={type:"forward"},projectStart:K=null,projectEnd:ce=null,calendar:E=null,undo:x=!1,splitTasks:A=!1,multiTaskRows:te=!1,marqueeSelect:ue=!1,copyPaste:re=!1,currentWeekHighlight:ie=!1,currentWeekColor:be=null,scrollToCurrentWeek:Re=!1,allowTaskIntersection:$e=!0,...ve},Le){const ke=e.useRef();ke.current=ve;const ee=e.useMemo(()=>new pe.DataStore(D.writable),[]),k=e.useMemo(()=>({...Je.en,...Be.en}),[]),W=e.useContext(Te.context.i18n),V=e.useMemo(()=>W?W.extend(k,!0):Ee.locale(k),[W,k]),q=e.useMemo(()=>V.getRaw().calendar,[V]),z=e.useMemo(()=>{let se={zoom:es(B,q),scales:kt(o,q),columns:Jt(b,q),links:pe.normalizeLinks(T),cellWidth:p};return se.zoom&&(se={...se,...pe.normalizeZoom(se.zoom,Zt(q,V.getGroup("gantt")),se.scales,p)}),se},[B,o,b,T,p,q,V]),ge=e.useRef(null);ge.current!==l&&(pe.parseTaskDates(l,{durationUnit:v,splitTasks:A,calendar:E}),ge.current=l),e.useEffect(()=>{pe.parseTaskDates(l,{durationUnit:v,splitTasks:A,calendar:E})},[l,v,E,A]);const oe=e.useMemo(()=>{if(!te)return null;const se=new Map,Se=new Map,ye=Me=>{Me.forEach(Ne=>{const We=Ne.row??Ne.id;Se.set(Ne.id,We),se.has(We)||se.set(We,[]),se.get(We).push(Ne.id),Ne.data&&Ne.data.length>0&&ye(Ne.data)})};return ye(l),{rowMap:se,taskRows:Se}},[l,te]),S=e.useMemo(()=>ee.in,[ee]),J=e.useRef(null);J.current===null&&(J.current=new jt.EventBusRouter((se,Se)=>{const ye="on"+ts(se);ke.current&&ke.current[ye]&&ke.current[ye](Se)}),S.setNext(J.current));const[de,fe]=e.useState(null),m=e.useRef(null);m.current=de;const le=e.useMemo(()=>({getState:ee.getState.bind(ee),getReactiveState:ee.getReactive.bind(ee),getStores:()=>({data:ee}),exec:S.exec,setNext:se=>(J.current=J.current.setNext(se),J.current),intercept:S.intercept.bind(S),on:S.on.bind(S),detach:S.detach.bind(S),getTask:ee.getTask.bind(ee),serialize:ee.serialize.bind(ee),getTable:se=>se?new Promise(Se=>setTimeout(()=>Se(m.current),1)):m.current,getHistory:()=>ee.getHistory()}),[ee,S]);e.useImperativeHandle(Le,()=>({...le}),[le]);const xe=e.useRef(0);e.useEffect(()=>{xe.current?ee.init({tasks:l,links:z.links,start:g,columns:z.columns,end:X,lengthUnit:F,cellWidth:z.cellWidth,cellHeight:f,scaleHeight:U,scales:z.scales,taskTypes:i,zoom:z.zoom,selected:I,activeTask:h,baselines:C,autoScale:Q,unscheduledTasks:ne,markers:r,durationUnit:v,criticalPath:Z,schedule:ae,projectStart:K,projectEnd:ce,calendar:E,undo:x,_weekStart:q.weekStart,splitTasks:A}):M&&M(le),xe.current++},[le,M,l,z,g,X,F,f,U,i,I,h,C,Q,ne,r,v,Z,ae,K,ce,E,x,q,A,ee]),xe.current===0&&ee.init({tasks:l,links:z.links,start:g,columns:z.columns,end:X,lengthUnit:F,cellWidth:z.cellWidth,cellHeight:f,scaleHeight:U,scales:z.scales,taskTypes:i,zoom:z.zoom,selected:I,activeTask:h,baselines:C,autoScale:Q,unscheduledTasks:ne,markers:r,durationUnit:v,criticalPath:Z,schedule:ae,projectStart:K,projectEnd:ce,calendar:E,undo:x,_weekStart:q.weekStart,splitTasks:A});const G=e.useMemo(()=>{const se=new Date,Se=q?.weekStart??0,ye=new Date(Date.UTC(se.getUTCFullYear(),se.getUTCMonth(),se.getUTCDate())),Ne=(ye.getUTCDay()-Se+7)%7;ye.setUTCDate(ye.getUTCDate()-Ne),ye.setUTCHours(0,0,0,0);const We=new Date(ye);return We.setUTCDate(We.getUTCDate()+7),a=>a>=ye&&a<We},[q]),Ce=e.useMemo(()=>(se,Se)=>{let ye=[];if(E)Se=="day"&&!E.getDayHours(se)&&ye.push("wx-weekend"),Se=="hour"&&!E.getDayHours(se)&&ye.push("wx-weekend");else if(P){const Me=P(se,Se);Me&&ye.push(Me)}return ie&&(Se==="week"||Se==="day")&&G(se)&&ye.push("wx-current-week"),ye.join(" ")},[E,P,ie,G]);return c.jsx(Te.context.i18n.Provider,{value:V,children:c.jsx(ze.Provider,{value:le,children:c.jsx(Bt,{taskTemplate:n,readonly:O,cellBorders:_,highlightTime:Ce,onTableAPIChange:fe,multiTaskRows:te,rowMapping:oe,marqueeSelect:ue,copyPaste:re,scrollToCurrentWeek:Re,currentWeekColor:be,allowTaskIntersection:$e})})})});function rs({api:s=null,items:n=[]}){const r=e.useContext(Te.context.i18n),i=e.useMemo(()=>r||Ee.locale(Be.en),[r]),l=e.useMemo(()=>i.getGroup("gantt"),[i]),I=D.useStoreLater(s,"_selected"),h=D.useStoreLater(s,"undo"),T=D.useStoreLater(s,"history"),o=D.useStoreLater(s,"splitTasks"),b=["undo","redo"],g=e.useMemo(()=>{const F=pe.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:pe.getToolbarButtons({undo:h,splitTasks:o})).map(p=>{let f={...p,disabled:!1};return f.handler=pe.isHandledAction(F,f.id)?U=>pe.handleAction(s,U.id,null,l):f.handler,f.text&&(f.text=l(f.text)),f.menuText&&(f.menuText=l(f.menuText)),f})},[n,s,l,h,o]),X=e.useMemo(()=>{const F=[];return g.forEach(v=>{const p=v.id;if(p==="add-task")F.push(v);else if(b.includes(p))b.includes(p)&&F.push({...v,disabled:v.isDisabled(T)});else{if(!I?.length||!s)return;F.push({...v,disabled:v.isDisabled&&I.some(f=>v.isDisabled(f,s.getState()))})}}),F.filter((v,p)=>{if(s&&v.isHidden)return!I.some(f=>v.isHidden(f,s.getState()));if(v.comp==="separator"){const f=F[p+1];if(!f||f.comp==="separator")return!1}return!0})},[s,I,T,g]);return r?c.jsx(ut.Toolbar,{items:X}):c.jsx(Te.context.i18n.Provider,{value:i,children:c.jsx(ut.Toolbar,{items:X})})}const os=e.forwardRef(function({options:n=[],api:r=null,resolver:i=null,filter:l=null,at:I="point",children:h,onClick:T,css:o},b){const g=e.useRef(null),X=e.useRef(null),F=e.useContext(Te.context.i18n),v=e.useMemo(()=>F||Ee.locale({...Be.en,...Je.en}),[F]),p=e.useMemo(()=>v.getGroup("gantt"),[v]),f=D.useStoreLater(r,"taskTypes"),U=D.useStoreLater(r,"selected"),O=D.useStoreLater(r,"_selected"),_=D.useStoreLater(r,"splitTasks"),B=e.useMemo(()=>pe.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{g.current&&g.current.show&&g.current.show()}),r.on("drag-task",()=>{g.current&&g.current.show&&g.current.show()}))},[r]);function C(E){return E.map(x=>(x={...x},x.text&&(x.text=p(x.text)),x.subtext&&(x.subtext=p(x.subtext)),x.data&&(x.data=C(x.data)),x))}function P(){const E=n.length?n:pe.getMenuOptions({splitTasks:_}),x=E.find(A=>A.id==="convert-task");return x&&(x.data=[],(f||[]).forEach(A=>{x.data.push(x.dataFactory(A))})),C(E)}const M=e.useMemo(()=>P(),[r,n,f,_,p]),Q=e.useMemo(()=>O&&O.length?O:[],[O]),ne=e.useCallback((E,x)=>{let A=E?r?.getTask(E):null;if(i){const te=i(E,x);A=te===!0?A:te}if(A){const te=Ee.locateID(x.target,"data-segment");te!==null?X.current={id:A.id,segmentIndex:te}:X.current=A.id,(!Array.isArray(U)||!U.includes(A.id))&&r&&r.exec&&r.exec("select-task",{id:A.id})}return A},[r,i,U]),Z=e.useCallback(E=>{const x=E.action;x&&(pe.isHandledAction(B,x.id)&&pe.handleAction(r,x.id,X.current,p),T&&T(E))},[r,p,T,B]),ae=e.useCallback((E,x)=>{const A=Q.length?Q:x?[x]:[];let te=l?A.every(ue=>l(E,ue)):!0;if(te&&(E.isHidden&&(te=!A.some(ue=>E.isHidden(ue,r.getState(),X.current))),E.isDisabled)){const ue=A.some(re=>E.isDisabled(re,r.getState(),X.current));E.disabled=ue}return te},[l,Q,r]);e.useImperativeHandle(b,()=>({show:(E,x)=>{g.current&&g.current.show&&g.current.show(E,x)}}));const K=e.useCallback(E=>{g.current&&g.current.show&&g.current.show(E)},[]),ce=c.jsxs(c.Fragment,{children:[c.jsx($t.ContextMenu,{filter:ae,options:M,dataKey:"id",resolver:ne,onClick:Z,at:I,ref:g,css:o}),c.jsx("span",{onContextMenu:K,"data-menu-ignore":"true",children:typeof h=="function"?h():h})]});if(!F&&Te.context.i18n?.Provider){const E=Te.context.i18n.Provider;return c.jsx(E,{value:v,children:ce})}return ce});function ls({api:s,autoSave:n,onLinksChange:r}){const l=e.useContext(Te.context.i18n).getGroup("gantt"),I=D.useStore(s,"activeTask"),h=D.useStore(s,"_activeTask"),T=D.useStore(s,"_links"),o=D.useStore(s,"schedule"),b=D.useStore(s,"unscheduledTasks"),[g,X]=e.useState();function F(){if(I){const U=T.filter(_=>_.target==I).map(_=>({link:_,task:s.getTask(_.source)})),O=T.filter(_=>_.source==I).map(_=>({link:_,task:s.getTask(_.target)}));return[{title:l("Predecessors"),data:U},{title:l("Successors"),data:O}]}}e.useEffect(()=>{X(F())},[I,T]);const v=e.useMemo(()=>[{id:"e2s",label:l("End-to-start")},{id:"s2s",label:l("Start-to-start")},{id:"e2e",label:l("End-to-end")},{id:"s2e",label:l("Start-to-end")}],[l]);function p(U){n?s.exec("delete-link",{id:U}):(X(O=>(O||[]).map(_=>({..._,data:_.data.filter(B=>B.link.id!==U)}))),r&&r({id:U,action:"delete-link",data:{id:U}}))}function f(U,O){n?s.exec("update-link",{id:U,link:O}):(X(_=>(_||[]).map(B=>({...B,data:B.data.map(C=>C.link.id===U?{...C,link:{...C.link,...O}}:C)}))),r&&r({id:U,action:"update-link",data:{id:U,link:O}}))}return c.jsx(c.Fragment,{children:(g||[]).map((U,O)=>U.data.length?c.jsx("div",{className:"wx-j93aYGQf wx-links",children:c.jsx(Te.Field,{label:U.title,position:"top",children:c.jsx("table",{children:c.jsx("tbody",{children:U.data.map(_=>c.jsxs("tr",{children:[c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:_.task.text||""})}),o?.auto&&_.link.type==="e2s"?c.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:c.jsx(Te.Text,{type:"number",placeholder:l("Lag"),value:_.link.lag,disabled:b&&h?.unscheduled,onChange:B=>{B.input||f(_.link.id,{lag:B.value})}})}):null,c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:c.jsx(Te.Combo,{value:_.link.type,placeholder:l("Select link type"),options:v,onChange:B=>f(_.link.id,{type:B.value}),children:({option:B})=>B.label})})}),c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>p(_.link.id),role:"button"})})]},_.link.id))})})})},O):null)})}function cs(s){const{value:n,time:r,format:i,onchange:l,onChange:I,...h}=s,T=I??l;function o(b){const g=new Date(b.value);g.setUTCHours(n.getUTCHours()),g.setUTCMinutes(n.getUTCMinutes()),T&&T({value:g})}return c.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[c.jsx(Te.DatePicker,{...h,value:n,onChange:o,format:i,buttons:["today"],clear:!1}),r?c.jsx(Te.TimePicker,{value:n,onChange:T,format:i}):null]})}Ae.registerEditorItem("select",Te.RichSelect);Ae.registerEditorItem("date",cs);Ae.registerEditorItem("twostate",Te.TwoState);Ae.registerEditorItem("slider",Te.Slider);Ae.registerEditorItem("counter",Te.Counter);Ae.registerEditorItem("links",ls);function is({api:s,items:n=[],css:r="",layout:i="default",readonly:l=!1,placement:I="sidebar",bottomBar:h=!0,topBar:T=!0,autoSave:o=!0,focus:b=!1,hotkeys:g={}}){const X=e.useContext(Te.context.i18n),F=e.useMemo(()=>X||Ee.locale({...Be.en,...Je.en}),[X]),v=e.useMemo(()=>F.getGroup("gantt"),[F]),p=F.getRaw(),f=e.useMemo(()=>{const m=p.gantt?.dateFormat||p.formats?.dateFormat;return Ee.dateToString(m,p.calendar)},[p]),U=e.useMemo(()=>{if(T===!0&&!l){const m=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:v("Delete"),id:"delete"}];return o?{items:m}:{items:[...m,{comp:"button",type:"primary",text:v("Save"),id:"save"}]}}return T},[T,l,o,v]),[O,_]=e.useState(!1),B=e.useMemo(()=>O?"wx-full-screen":"",[O]),C=e.useCallback(m=>{_(m)},[]);e.useEffect(()=>{const m=pt(C);return m.observe(),()=>{m.disconnect()}},[C]);const P=D.useStore(s,"_activeTask"),M=D.useStore(s,"activeTask"),Q=D.useStore(s,"unscheduledTasks"),ne=D.useStore(s,"links"),Z=D.useStore(s,"splitTasks"),ae=e.useMemo(()=>Z&&M?.segmentIndex,[Z,M]),K=e.useMemo(()=>ae||ae===0,[ae]),ce=e.useMemo(()=>pe.getEditorItems({unscheduledTasks:Q}),[Q]),E=D.useStore(s,"undo"),[x,A]=e.useState({}),[te,ue]=e.useState(null),[re,ie]=e.useState(),[be,Re]=e.useState(null),$e=D.useStore(s,"taskTypes"),ve=e.useMemo(()=>{if(!P)return null;let m;if(K&&P.segments?m={...P.segments[ae]}:m={...P},l){let le={parent:m.parent};return ce.forEach(({key:xe,comp:G})=>{if(G!=="links"){const Ce=m[xe];G==="date"&&Ce instanceof Date?le[xe]=f(Ce):G==="slider"&&xe==="progress"?le[xe]=`${Ce}%`:le[xe]=Ce}}),le}return m||null},[P,K,ae,l,ce,f]);e.useEffect(()=>{ie(ve)},[ve]),e.useEffect(()=>{A({}),Re(null),ue(null)},[M]);function Le(m,le){return m.map(xe=>{const G={...xe};if(xe.config&&(G.config={...G.config}),G.comp==="links"&&s&&(G.api=s,G.autoSave=o,G.onLinksChange=k),G.comp==="select"&&G.key==="type"){const Ce=G.options??($e||[]);G.options=Ce.map(se=>({...se,label:v(se.label)}))}return G.comp==="slider"&&G.key==="progress"&&(G.labelTemplate=Ce=>`${v(G.label)} ${Ce}%`),G.label&&(G.label=v(G.label)),G.config?.placeholder&&(G.config.placeholder=v(G.config.placeholder)),le&&(G.isDisabled&&G.isDisabled(le,s.getState())?G.disabled=!0:delete G.disabled),G})}const ke=e.useMemo(()=>{let m=n.length?n:ce;return m=Le(m,re),re?m.filter(le=>!le.isHidden||!le.isHidden(re,s.getState())):m},[n,ce,re,$e,v,s,o]),ee=e.useMemo(()=>ke.map(m=>m.key),[ke]);function k({id:m,action:le,data:xe}){A(G=>({...G,[m]:{action:le,data:xe}}))}const W=e.useCallback(()=>{for(let m in x)if(ne.byId(m)){const{action:le,data:xe}=x[m];s.exec(le,xe)}},[s,x,ne]),V=e.useCallback(()=>{const m=M?.id||M;if(K){if(P?.segments){const le=P.segments.filter((xe,G)=>G!==ae);s.exec("update-task",{id:m,task:{segments:le}})}}else s.exec("delete-task",{id:m})},[s,M,K,P,ae]),q=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),z=e.useCallback(m=>{const{item:le,changes:xe}=m;le.id==="delete"&&V(),le.id==="save"&&(xe.length?q():W()),le.comp&&q()},[s,M,o,W,V,q]),ge=e.useCallback((m,le,xe)=>(Q&&m.type==="summary"&&(m.unscheduled=!1),pe.prepareEditTask(m,s.getState(),le),xe||ue(!1),m),[Q,s]),oe=e.useCallback(m=>{m={...m,unscheduled:Q&&m.unscheduled&&m.type!=="summary"},delete m.links,delete m.data,(ee.indexOf("duration")===-1||m.segments&&!m.duration)&&delete m.duration;const le={id:M?.id||M,task:m,...K&&{segmentIndex:ae}};o&&te&&(le.inProgress=te),s.exec("update-task",le),o||W()},[s,M,Q,o,W,ee,K,ae,te]),S=e.useCallback(m=>{let{update:le,key:xe,input:G}=m;if(G&&ue(!0),m.update=ge({...le},xe,G),!o)ie(m.update);else if(!be&&!G){const Ce=ke.find(ye=>ye.key===xe),se=le[xe];(!Ce.validation||Ce.validation(se))&&(!Ce.required||se)&&oe(m.update)}},[o,ge,be,ke,oe]),J=e.useCallback(m=>{o||oe(m.values)},[o,oe]),de=e.useCallback(m=>{Re(m.errors)},[]),fe=e.useMemo(()=>E?{"ctrl+z":m=>{m.preventDefault(),s.exec("undo")},"ctrl+y":m=>{m.preventDefault(),s.exec("redo")}}:{},[E,s]);return ve?c.jsx(Te.Locale,{children:c.jsx(Ae.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${B} ${r}`,items:ke,values:ve,topBar:U,bottomBar:h,placement:I,layout:i,readonly:l,autoSave:o,focus:b,onAction:z,onSave:J,onValidation:de,onChange:S,hotkeys:g&&{...fe,...g}})}):null}const as=({children:s,columns:n=null,api:r})=>{const[i,l]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(l)},[r]),c.jsx(wt.HeaderMenu,{api:i,columns:n,children:s})};function us(s){const{api:n,content:r,children:i}=s,l=e.useRef(null),I=e.useRef(null),[h,T]=e.useState({}),[o,b]=e.useState(null),[g,X]=e.useState({});function F(C){for(;C;){if(C.getAttribute){const P=C.getAttribute("data-tooltip-id"),M=C.getAttribute("data-tooltip-at"),Q=C.getAttribute("data-tooltip");if(P||Q)return{id:P,tooltip:Q,target:C,at:M}}C=C.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const C=I.current;if(C&&g&&(g.text||r)){const P=C.getBoundingClientRect();let M=!1,Q=g.left,ne=g.top;P.right>=h.right&&(Q=h.width-P.width-5,M=!0),P.bottom>=h.bottom&&(ne=g.top-(P.bottom-h.bottom+2),M=!0),M&&X(Z=>Z&&{...Z,left:Q,top:ne})}},[g,h,r]);const v=e.useRef(null),p=300,f=C=>{clearTimeout(v.current),v.current=setTimeout(()=>{C()},p)};function U(C){let{id:P,tooltip:M,target:Q,at:ne}=F(C.target);if(X(null),b(null),!M)if(P)M=_(P);else{clearTimeout(v.current);return}const Z=C.clientX;f(()=>{P&&b(O(B(P)));const ae=Q.getBoundingClientRect(),K=l.current,ce=K?K.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let E,x;ne==="left"?(E=ae.top+5-ce.top,x=ae.right+5-ce.left):(E=ae.top+ae.height-ce.top,x=Z-ce.left),T(ce),X({top:E,left:x,text:M})})}function O(C){return n?.getTask(B(C))||null}function _(C){return O(C)?.text||""}function B(C){const P=parseInt(C);return isNaN(P)?C:P}return c.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:l,onMouseMove:U,children:[g&&(g.text||r)?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:I,style:{top:`${g.top}px`,left:`${g.left}px`},children:r?c.jsx(r,{data:o}):g.text?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:g.text}):null}):null,i]})}function ds({fonts:s=!0,children:n}){return n?c.jsx(Te.Material,{fonts:s,children:n()}):c.jsx(Te.Material,{fonts:s})}function fs({fonts:s=!0,children:n}){return n?c.jsx(Te.Willow,{fonts:s,children:n}):c.jsx(Te.Willow,{fonts:s})}function xs({fonts:s=!0,children:n}){return n?c.jsx(Te.WillowDark,{fonts:s,children:n}):c.jsx(Te.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>pe.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>pe.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>pe.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>pe.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>pe.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>pe.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>pe.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>pe.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>pe.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>Ae.registerEditorItem});exports.ContextMenu=os;exports.Editor=is;exports.Gantt=ns;exports.HeaderMenu=as;exports.Material=ds;exports.Toolbar=rs;exports.Tooltip=us;exports.Willow=fs;exports.WillowDark=xs;
//# sourceMappingURL=index.cjs.map
