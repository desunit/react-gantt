"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("react/jsx-runtime"),e=require("react"),ye=require("@svar-ui/react-core"),ve=require("@svar-ui/lib-dom"),Be=require("@svar-ui/gantt-locales"),Ze=require("@svar-ui/core-locales"),Et=require("@svar-ui/lib-state"),pe=require("@svar-ui/gantt-store"),S=require("@svar-ui/lib-react"),ht=require("@svar-ui/grid-store"),gt=require("@svar-ui/react-grid"),Rt=require("react-dom"),at=require("@svar-ui/react-toolbar"),jt=require("@svar-ui/react-menu"),_e=require("@svar-ui/react-editor"),ze=e.createContext(null);function Ge(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function $t(s,n,r){const i=s.getBoundingClientRect(),o=n.querySelector(".wx-body").getBoundingClientRect();return{top:i.top-o.top,left:i.left-o.left,dt:i.bottom-r.clientY,db:r.clientY-i.top}}function ut(s){return s&&s.getAttribute("data-context-id")}const dt=5;function Dt(s,n){let r,i,o,D,h,l,d,z,p;function Z(w){D=w.clientX,h=w.clientY,l={...$t(r,s,w),y:n.getTask(o).$y},document.body.style.userSelect="none"}function R(w){r=ve.locate(w),ut(r)&&(o=Ge(r),p=setTimeout(()=>{z=!0,n&&n.touchStart&&n.touchStart(),Z(w.touches[0])},500),s.addEventListener("touchmove",I),s.addEventListener("contextmenu",f),window.addEventListener("touchend",q))}function f(w){if(z||p)return w.preventDefault(),!1}function O(w){w.which===1&&(r=ve.locate(w),ut(r)&&(o=Ge(r),s.addEventListener("mousemove",J),window.addEventListener("mouseup",E),Z(w)))}function g(w){s.removeEventListener("mousemove",J),s.removeEventListener("touchmove",I),document.body.removeEventListener("mouseup",E),document.body.removeEventListener("touchend",q),document.body.style.userSelect="",w&&(s.removeEventListener("mousedown",O),s.removeEventListener("touchstart",R))}function j(w){const te=w.clientX-D,F=w.clientY-h;if(!i){if(Math.abs(te)<dt&&Math.abs(F)<dt||n&&n.start&&n.start({id:o,e:w})===!1)return;i=r.cloneNode(!0),i.style.pointerEvents="none",i.classList.add("wx-reorder-task"),i.style.position="absolute",i.style.left=l.left+"px",i.style.top=l.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(i,r)}if(i){const me=Math.round(Math.max(0,l.top+F));if(n&&n.move&&n.move({id:o,top:me,detail:d})===!1)return;const N=n.getTask(o),de=N.$y;if(!l.start&&l.y==de)return X();l.start=!0,l.y=N.$y-4,i.style.top=me+"px";const re=document.elementFromPoint(w.clientX,w.clientY),m=ve.locate(re);if(m&&m!==r){const M=Ge(m),P=m.getBoundingClientRect(),ae=P.top+P.height/2,se=w.clientY+l.db>ae&&m.nextElementSibling!==r,oe=w.clientY-l.dt<ae&&m.previousElementSibling!==r;d?.after==M||d?.before==M?d=null:se?d={id:o,after:M}:oe&&(d={id:o,before:M})}}}function J(w){j(w)}function I(w){z?(w.preventDefault(),j(w.touches[0])):p&&(clearTimeout(p),p=null)}function q(){z=null,p&&(clearTimeout(p),p=null),X()}function E(){X()}function X(){r&&(r.style.visibility=""),i&&(i.parentNode.removeChild(i),n&&n.end&&n.end({id:o,top:l.top})),o=r=i=l=d=null,g()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",O),s.addEventListener("touchstart",R),{destroy(){g(!0)}}}function Lt({row:s,column:n}){function r(o,D){return{justifyContent:D.align,paddingLeft:`${(o.$level-1)*20}px`}}const i=n&&n._cell;return c.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?c.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):c.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),c.jsx("div",{className:"wx-pqc08MHU wx-text",children:i?c.jsx(i,{row:s,column:n}):s.text})]})}function ft({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?c.jsx("div",{style:{textAlign:s.align},children:c.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function It(s){const{readonly:n,compactMode:r,width:i=0,display:o="all",columnWidth:D=0,onTableAPIChange:h,multiTaskRows:l=!1,rowMapping:d=null}=s,[z,p]=S.useWritableProp(D),[Z,R]=e.useState(),f=e.useContext(ye.context.i18n),O=e.useMemo(()=>f.getGroup("gantt"),[f]),g=e.useContext(ze),j=S.useStore(g,"scrollTop"),J=S.useStore(g,"cellHeight"),I=S.useStore(g,"_scrollTask"),q=S.useStore(g,"_selected"),E=S.useStore(g,"area"),X=S.useStore(g,"_tasks"),w=S.useStore(g,"_scales"),te=S.useStore(g,"columns"),F=S.useStore(g,"_sort"),me=S.useStore(g,"calendar"),N=S.useStore(g,"durationUnit"),de=S.useStore(g,"splitTasks"),[re,m]=e.useState(null),M=e.useMemo(()=>!X||!E?[]:l&&d?X:X.slice(E.start,E.end),[X,E,l,d]),P=e.useCallback((a,y)=>{if(y==="add-task")g.exec(y,{target:a,task:{text:O("New Task")},mode:"child",show:!0});else if(y==="open-task"){const v=M.find(H=>H.id===a);(v?.data||v?.lazy)&&g.exec(y,{id:a,mode:!v.open})}},[M]),ae=e.useCallback(a=>{const y=ve.locateID(a),v=a.target.dataset.action;v&&a.preventDefault(),y?v==="add-task"||v==="open-task"?P(y,v):g.exec("select-task",{id:y,toggle:a.ctrlKey||a.metaKey,range:a.shiftKey,show:!0}):v==="add-task"&&P(null,v)},[g,P]),se=e.useRef(null),oe=e.useRef(null),[fe,he]=e.useState(0),[Re,Ce]=e.useState(!1);e.useEffect(()=>{const a=oe.current;if(!a||typeof ResizeObserver>"u")return;const y=()=>he(a.clientWidth);y();const v=new ResizeObserver(y);return v.observe(a),()=>v.disconnect()},[]);const je=e.useRef(null),Ee=e.useCallback(a=>{const y=a.id,{before:v,after:H}=a,ke=a.onMove;let we=v||H,Se=v?"before":"after";if(ke){if(Se==="after"){const We=g.getTask(we);We.data?.length&&We.open&&(Se="before",we=We.data[0].id)}je.current={id:y,[Se]:we}}else je.current=null;g.exec("move-task",{id:y,mode:Se,target:we,inProgress:ke})},[g]),G=e.useMemo(()=>l&&d?0:E?.from??0,[E,l,d]),b=e.useMemo(()=>w?.height??0,[w]),W=e.useMemo(()=>!r&&o!=="grid"?(z??0)>(i??0):(z??0)>(fe??0),[r,o,z,i,fe]),K=e.useMemo(()=>{const a={};return W&&o==="all"||o==="grid"&&W?a.width=z:o==="grid"&&(a.width="100%"),a},[W,o,z]),B=e.useMemo(()=>re&&!M.find(a=>a.id===re.id)?[...M,re]:M,[M,re]),V=e.useMemo(()=>{if(!l||!d)return B;const a=new Map,y=new Set;return B.forEach(v=>{const H=d.taskRows.get(v.id)??v.id;y.has(H)||(a.set(H,{...v,$rowTasks:d.rowMap.get(H)||[v.id]}),y.add(H))}),Array.from(a.values())},[B,l,d]),ce=e.useMemo(()=>{let a=(te||[]).map(H=>{H={...H};const ke=H.header;if(typeof ke=="object"){const we=ke.text&&O(ke.text);H.header={...ke,text:we}}else H.header=O(ke);return H});const y=a.findIndex(H=>H.id==="text"),v=a.findIndex(H=>H.id==="add-task");if(y!==-1&&(a[y].cell&&(a[y]._cell=a[y].cell),a[y].cell=Lt),v!==-1){a[v].cell=a[v].cell||ft;const H=a[v].header;if(typeof H!="object"&&(a[v].header={text:H}),a[v].header.cell=H.cell||ft,n)a.splice(v,1);else if(r){const[ke]=a.splice(v,1);a.unshift(ke)}}return a.length>0&&(a[a.length-1].resize=!1),a},[te,O,n,r]),le=e.useMemo(()=>o==="all"?`${i}px`:o==="grid"?"calc(100% - 4px)":ce.find(a=>a.id==="add-task")?"50px":"0",[o,i,ce]),T=e.useMemo(()=>{if(V&&F?.length){const a={};return F.forEach(({key:y,order:v},H)=>{a[y]={order:v,...F.length>1&&{index:H}}}),a}return{}},[V,F]),U=e.useCallback(()=>ce.some(a=>a.flexgrow&&!a.hidden),[]),ue=e.useMemo(()=>U(),[U,Re]),ie=e.useMemo(()=>{let a=o==="chart"?ce.filter(v=>v.id==="add-task"):ce;const y=o==="all"?i:fe;if(!ue){let v=z,H=!1;if(ce.some(ke=>ke.$width)){let ke=0;v=ce.reduce((we,Se)=>(Se.hidden||(ke+=Se.width,we+=Se.$width||Se.width),we),0),ke>v&&v>y&&(H=!0)}if(H||v<y){let ke=1;return H||(ke=(y-50)/(v-50||1)),a.map(we=>(we.id!=="add-task"&&!we.hidden&&(we.$width||(we.$width=we.width),we.width=we.$width*ke),we))}}return a},[o,ce,ue,z,i,fe]),Le=e.useCallback(a=>{if(!U()){const y=ie.reduce((v,H)=>(a&&H.$width&&(H.$width=H.width),v+(H.hidden?0:H.width)),0);y!==z&&p(y)}Ce(!0),Ce(!1)},[U,ie,z,p]),k=e.useCallback(()=>{ce.filter(y=>y.flexgrow&&!y.hidden).length===1&&ce.forEach(y=>{y.$width&&!y.flexgrow&&!y.hidden&&(y.width=y.$width)})},[]),ne=e.useCallback(a=>{if(!n){const y=ve.locateID(a),v=ve.locateAttr(a,"data-col-id");!(v&&ce.find(ke=>ke.id==v))?.editor&&y&&g.exec("show-editor",{id:y})}},[g,n]),xe=e.useMemo(()=>Array.isArray(q)?q.map(a=>a.id):[],[q]),Y=e.useRef(G);Y.current=G,e.useEffect(()=>{const a=v=>{if(se.current){const H=se.current.querySelector(".wx-body");H&&(H.style.top=-((v??0)-(Y.current??0))+"px")}oe.current&&(oe.current.scrollTop=0)};return a(j),g.on("scroll-chart",({top:v})=>{v!==void 0&&a(v)})},[g,j]),e.useEffect(()=>{if(se.current){const a=se.current.querySelector(".wx-body");a&&(a.style.top=-((j??0)-(G??0))+"px")}},[G]),e.useEffect(()=>{const a=se.current;if(!a)return;const y=a.querySelector(".wx-table-box .wx-body");if(!y||typeof ResizeObserver>"u")return;const v=new ResizeObserver(()=>{if(se.current){const H=se.current.querySelector(".wx-body");H&&(H.style.top=-((j??0)-(Y.current??0))+"px")}});return v.observe(y),()=>{v.disconnect()}},[ie,K,o,le,V,j]),e.useEffect(()=>{if(!I||!Z)return;const{id:a}=I,y=Z.getState().focusCell;y&&y.row!==a&&se.current&&se.current.contains(document.activeElement)&&Z.exec("focus-cell",{row:a,column:y.column})},[I,Z]);const Q=e.useCallback(({id:a})=>{if(n)return!1;g.getTask(a).open&&g.exec("open-task",{id:a,mode:!1});const y=g.getState()._tasks.find(v=>v.id===a);if(m(y||null),!y)return!1},[g,n]),ge=e.useCallback(({id:a,top:y})=>{je.current?Ee({...je.current,onMove:!1}):g.exec("drag-task",{id:a,top:y+(G??0),inProgress:!1}),m(null)},[g,Ee,G]),be=e.useCallback(({id:a,top:y,detail:v})=>{v&&Ee({...v,onMove:!0}),g.exec("drag-task",{id:a,top:y+(G??0),inProgress:!0})},[g,Ee,G]);e.useEffect(()=>{const a=se.current;return a?Dt(a,{start:Q,end:ge,move:be,getTask:g.getTask}).destroy:void 0},[g,Q,ge,be]);const $e=e.useCallback(a=>{const{key:y,isInput:v}=a;if(!v&&(y==="arrowup"||y==="arrowdown"))return a.eventSource="grid",g.exec("hotkey",a),!1;if(y==="enter"){const H=Z?.getState().focusCell;if(H){const{row:ke,column:we}=H;we==="add-task"?P(ke,"add-task"):we==="text"&&P(ke,"open-task")}}},[g,P,Z]),Me=e.useRef(null),Ne=()=>{Me.current={setTableAPI:R,handleHotkey:$e,sortVal:F,api:g,adjustColumns:k,setColumnWidth:Le,tasks:M,calendarVal:me,durationUnitVal:N,splitTasksVal:de,onTableAPIChange:h}};Ne(),e.useEffect(()=>{Ne()},[R,$e,F,g,k,Le,M,me,N,de,h]);const Oe=e.useCallback(a=>{R(a),a.intercept("hotkey",y=>Me.current.handleHotkey(y)),a.intercept("scroll",()=>!1),a.intercept("select-row",()=>!1),a.intercept("sort-rows",y=>{const v=Me.current.sortVal,{key:H,add:ke}=y,we=v?v.find(We=>We.key===H):null;let Se="asc";return we&&(Se=!we||we.order==="asc"?"desc":"asc"),g.exec("sort-tasks",{key:H,order:Se,add:ke}),!1}),a.on("resize-column",()=>{Me.current.setColumnWidth(!0)}),a.on("hide-column",y=>{y.mode||Me.current.adjustColumns(),Me.current.setColumnWidth()}),a.intercept("update-cell",y=>{const{id:v,column:H,value:ke}=y,we=Me.current.tasks.find(Se=>Se.id===v);if(we){const Se={...we};let We=ke;We&&!isNaN(We)&&!(We instanceof Date)&&(We*=1),Se[H]=We,pe.prepareEditTask(Se,{calendar:Me.current.calendarVal,durationUnit:Me.current.durationUnitVal,splitTasks:Me.current.splitTasksVal},H),g.exec("update-task",{id:v,task:Se})}return!1}),h&&h(a)},[]);return c.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${le}`},ref:oe,children:c.jsx("div",{ref:se,style:K,className:"wx-rHj6070p wx-table",onClick:ae,onDoubleClick:ne,children:c.jsx(gt.Grid,{init:Oe,sizes:{rowHeight:J,headerHeight:(b??0)-1},rowStyle:a=>a.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:a=>`wx-rHj6070p wx-text-${a.align}${a.id==="add-task"?" wx-action":""}`,data:V,columns:ie,selectedRows:[...xe],sortMarks:T})})})}function Nt({borders:s=""}){const n=e.useContext(ze),r=S.useStore(n,"cellWidth"),i=S.useStore(n,"cellHeight"),o=e.useRef(null),[D,h]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&o.current){const d=getComputedStyle(o.current).getPropertyValue("--wx-gantt-border");h(d?d.substring(d.indexOf("#")):"#1d1e261a")}},[]);const l={width:"100%",height:"100%",background:r!=null&&i!=null?`url(${pe.grid(r,i,D,s)})`:void 0,position:"absolute",pointerEvents:"none"};return c.jsx("div",{ref:o,style:l})}function Pt({onSelectLink:s,selectedLink:n,readonly:r}){const i=e.useContext(ze),o=S.useStore(i,"_links"),D=S.useStore(i,"criticalPath"),h=e.useRef(null),l=e.useCallback(d=>{const z=d?.target?.classList;!z?.contains("wx-line")&&!z?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&h.current){const d=z=>{h.current&&!h.current.contains(z.target)&&l(z)};return document.addEventListener("click",d),()=>{document.removeEventListener("click",d)}}},[r,n,l]),c.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(o||[]).map(d=>{const z="wx-dkx3NwEn wx-line"+(D&&d.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return c.jsx("polyline",{className:z,points:d.$p,onClick:()=>!r&&s(d.id),"data-link-id":d.id},d.id)}),!r&&n&&c.jsx("polyline",{ref:h,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function Wt(s){const{task:n,type:r}=s;function i(D){const h=n.segments[D];return{left:`${h.$x}px`,top:"0px",width:`${h.$w}px`,height:"100%"}}function o(D){if(!n.progress)return 0;const h=n.duration*n.progress/100,l=n.segments;let d=0,z=0,p=null;do{const Z=l[z];z===D&&(d>h?p=0:p=Math.min((h-d)/Z.duration,1)*100),d+=Z.duration,z++}while(p===null&&z<l.length);return p||0}return c.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map((D,h)=>c.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":h,style:i(h),children:[n.progress?c.jsx("div",{className:"wx-progress-wrapper",children:c.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${o(h)}%`}})}):null,c.jsx("div",{className:"wx-content",children:D.text||""})]},h))})}let Ue=[],Qe=null,xt=null;const mt=(s,n)=>{if(!n||!n.start)return null;const{start:r,lengthUnitWidth:i,lengthUnit:o}=n,D=864e5,h=o==="week"?7:o==="month"?30:o==="quarter"?91:o==="year"?365:1,l=Math.floor(s/i),d=new Date(r.getTime()+l*h*D);return d.setHours(0,0,0,0),d},Ht=(s,n,r)=>{if(!r||!s||!n)return 0;const{lengthUnit:i}=r,h=(i==="week"?7:i==="month"?30:i==="quarter"?91:i==="year"?365:1)*864e5;return Math.round((s.getTime()-n.getTime())/h)},At=(s,n,r)=>{if(!r||!s)return s;const{lengthUnit:i}=r,h=(i==="week"?7:i==="month"?30:i==="quarter"?91:i==="year"?365:1)*864e5,l=new Date(s.getTime()+n*h);return l.setHours(0,0,0,0),l};function _t(s){const{readonly:n,taskTemplate:r,multiTaskRows:i=!1,rowMapping:o=null,marqueeSelect:D=!1,copyPaste:h=!1}=s,l=e.useContext(ze),[d,z]=S.useStoreWithCounter(l,"_tasks"),[p,Z]=S.useStoreWithCounter(l,"_links"),R=S.useStore(l,"area"),f=S.useStore(l,"_scales"),O=S.useStore(l,"taskTypes"),g=S.useStore(l,"baselines"),[j,J]=S.useStoreWithCounter(l,"_selected"),I=S.useStore(l,"_scrollTask"),q=S.useStore(l,"criticalPath"),E=S.useStore(l,"tasks"),X=S.useStore(l,"schedule"),w=S.useStore(l,"splitTasks"),te=e.useMemo(()=>{if(!R||!Array.isArray(d))return[];const t=R.start??0,u=R.end??0;return i&&o?d.map(x=>({...x})):d.slice(t,u).map(x=>({...x}))},[z,R,i,o]),F=S.useStore(l,"cellHeight"),me=e.useMemo(()=>{if(!i||!o||!te.length)return te;const t=new Map,u=[];return d.forEach(x=>{const C=o.taskRows.get(x.id)??x.id;t.has(C)||(t.set(C,u.length),u.push(C))}),te.map(x=>{const C=o.taskRows.get(x.id)??x.id,L=t.get(C)??0;return{...x,$y:L*F,$y_base:x.$y_base!==void 0?L*F:void 0}})},[te,i,o,d,F]),N=e.useMemo(()=>f.lengthUnitWidth,[f]),de=e.useMemo(()=>f.lengthUnit||"day",[f]),re=e.useRef(!1),[m,M]=e.useState(void 0),[P,ae]=e.useState(null),se=e.useRef(null),[oe,fe]=e.useState(null),[he,Re]=e.useState(void 0),Ce=e.useRef(null),[je,Ee]=e.useState(0),[G,b]=e.useState(null),W=e.useRef(null),[K,B]=e.useState(null),[V,ce]=e.useState(null),[le,T]=e.useState(null),U=e.useRef(null);U.current=V;const ue=e.useRef(200),ie=e.useRef(null),Le=e.useMemo(()=>{const t=ie.current;return!!(j.length&&t&&t.contains(document.activeElement))},[j,ie.current]),k=e.useMemo(()=>Le&&j[j.length-1]?.id,[Le,j]);e.useEffect(()=>{if(I&&Le&&I){const{id:t}=I,u=ie.current?.querySelector(`.wx-bar[data-id='${t}']`);u&&u.focus({preventScroll:!0})}},[I]),e.useEffect(()=>{const t=ie.current;if(t&&(Ee(t.offsetWidth||0),typeof ResizeObserver<"u")){const u=new ResizeObserver(x=>{x[0]&&Ee(x[0].contentRect.width)});return u.observe(t),()=>u.disconnect()}},[ie.current]);const ne=e.useCallback(()=>{document.body.style.userSelect="none"},[]),xe=e.useCallback(()=>{document.body.style.userSelect=""},[]),Y=e.useCallback((t,u,x)=>{if(u.target.classList.contains("wx-line")||(x||(x=l.getTask(Ge(t))),x.type==="milestone"||x.type==="summary"))return"";const C=ve.locate(u,"data-segment");C&&(t=C);const{left:L,width:$}=t.getBoundingClientRect(),A=(u.clientX-L)/$;let _=.2/($>200?$/200:1);return A<_?"start":A>1-_?"end":""},[l]),Q=e.useMemo(()=>{const t=new Map;if(!i||!o)return d.forEach(C=>{t.set(C.id,C.$y)}),t;const u=new Map,x=[];return d.forEach(C=>{const L=o.taskRows.get(C.id)??C.id;u.has(L)||(u.set(L,x.length),x.push(L))}),d.forEach(C=>{const L=o.taskRows.get(C.id)??C.id,$=u.get(L)??0;t.set(C.id,$*F)}),t},[d,i,o,F]),ge=e.useMemo(()=>{const t=new Map;if(!i||!o)return d.forEach(C=>{t.set(C.id,C.$y),C.row!==void 0&&t.set(C.row,C.$y)}),t;const u=new Map,x=[];return d.forEach(C=>{const L=o.taskRows.get(C.id)??C.id;u.has(L)||(u.set(L,x.length),x.push(L))}),u.forEach((C,L)=>{t.set(L,C*F)}),t},[d,i,o,F]),be=e.useCallback(t=>{if(!ie.current)return[];const x=Math.min(t.startX,t.currentX),C=Math.max(t.startX,t.currentX),L=Math.min(t.startY,t.currentY),$=Math.max(t.startY,t.currentY);return d.filter(A=>{const _=A.$x,ee=A.$x+A.$w,De=Q.get(A.id)??A.$y,Pe=De+A.$h;return _<C&&ee>x&&De<$&&Pe>L})},[d,Q]),$e=e.useMemo(()=>new Set(j.map(t=>t.id)),[j,J]),Me=e.useCallback(t=>$e.has(t),[$e]),Ne=e.useCallback((t,u)=>{const{clientX:x}=u,C=Ge(t),L=l.getTask(C),$=u.target.classList;if(!u.target.closest(".wx-delete-button")&&!n){if($.contains("wx-progress-marker")){const{progress:A}=l.getTask(C);se.current={id:C,x,progress:A,dx:0,node:t,marker:u.target},u.target.classList.add("wx-progress-in-drag")}else{const A=Y(t,u,L)||"move",_={id:C,mode:A,x,dx:0,l:L.$x,w:L.$w};if(w&&L.segments?.length){const ee=ve.locate(u,"data-segment");ee&&(_.segmentIndex=ee.dataset.segment*1,pe.extendDragOptions(L,_))}ae(_)}ne()}},[l,n,Y,ne,w]),Oe=e.useCallback(t=>{if(t.button!==0||le)return;const u=ve.locate(t);if(!u&&D&&!n){const x=ie.current;if(!x)return;const C=x.getBoundingClientRect(),L=t.clientX-C.left,$=t.clientY-C.top;if(h){const _=mt(L,f);_&&(U.current=_,ce(_))}const A={startX:L,startY:$,currentX:L,currentY:$,ctrlKey:t.ctrlKey||t.metaKey};b(A),W.current=A,ne();return}if(u){if(D&&!n&&j.length>1){const x=Ge(u);if(Me(x)){const C=t.target.classList;if(!C.contains("wx-link")&&!C.contains("wx-progress-marker")&&!t.target.closest(".wx-delete-button")){const L=l.getTask(x);if(!Y(u,t,L)){const A=new Map;j.forEach(_=>{const ee=l.getTask(_.id);if(ee){if(X?.auto&&ee.type==="summary")return;A.set(_.id,{$x:ee.$x,$w:ee.$w,start:ee.start,end:ee.end})}}),B({baseTaskId:x,startX:t.clientX,dx:0,originalPositions:A}),ne();return}}}}Ne(u,t)}},[Ne,D,h,n,j,Me,l,Y,X,ne,f,le]),a=e.useCallback(t=>{const u=ve.locate(t);u&&(Ce.current=setTimeout(()=>{Re(!0),Ne(u,t.touches[0])},300))},[Ne]),y=e.useCallback(t=>{fe(t&&{...p.find(u=>u.id===t)})},[p]),v=e.useCallback(()=>{const t=W.current;if(t){const u=be(t);t.ctrlKey?u.forEach(x=>{l.exec("select-task",{id:x.id,toggle:!0,marquee:!0})}):(j.length>0&&l.exec("select-task",{id:null,marquee:!0}),u.forEach((x,C)=>{l.exec("select-task",{id:x.id,toggle:C>0,marquee:!0})})),b(null),W.current=null,xe(),re.current=!0;return}if(K){const{dx:u,originalPositions:x}=K,C=Math.round(u/N);if(C!==0){let L=!0;x.forEach(($,A)=>{const _=l.getTask(A);_&&(l.exec("update-task",{id:A,diff:C,task:{start:_.start,end:_.end},skipUndo:!L}),L=!1)}),re.current=!0}else x.forEach((L,$)=>{l.exec("drag-task",{id:$,left:L.$x,width:L.$w,inProgress:!1})});B(null),xe();return}if(se.current){const{dx:u,id:x,marker:C,value:L}=se.current;se.current=null,typeof L<"u"&&u&&l.exec("update-task",{id:x,task:{progress:L},inProgress:!1}),C.classList.remove("wx-progress-in-drag"),re.current=!0,xe()}else if(P){const{id:u,mode:x,dx:C,l:L,w:$,start:A,segment:_,index:ee}=P;if(ae(null),A){const Te=Math.round(C/N);if(!Te)l.exec("drag-task",{id:u,width:$,left:L,inProgress:!1,..._&&{segmentIndex:ee}});else{let De={},Pe=l.getTask(u);_&&(Pe=Pe.segments[ee]);const Ae=1440*60*1e3,Ie=Te*(de==="week"?7:de==="month"?30:de==="quarter"?91:de==="year"?365:1)*Ae;x==="move"?(De.start=new Date(Pe.start.getTime()+Ie),De.end=new Date(Pe.end.getTime()+Ie)):x==="start"?(De.start=new Date(Pe.start.getTime()+Ie),De.end=Pe.end):x==="end"&&(De.start=Pe.start,De.end=new Date(Pe.end.getTime()+Ie)),l.exec("update-task",{id:u,task:De,..._&&{segmentIndex:ee}})}re.current=!0}xe()}},[l,xe,P,N,de,G,K,be,j]),H=e.useCallback((t,u)=>{const{clientX:x,clientY:C}=u,L=ie.current;if(L){const $=L.getBoundingClientRect();ue.current=x-$.left}if(le){if(!L)return;const $=L.getBoundingClientRect(),A=x-$.left;T(_=>({..._,currentX:A}));return}if(!n){if(G){const $=ie.current;if(!$)return;const A=$.getBoundingClientRect(),_=x-A.left,ee=C-A.top;b(Te=>({...Te,currentX:_,currentY:ee})),W.current&&(W.current.currentX=_,W.current.currentY=ee);return}if(K){const $=x-K.startX;K.originalPositions.forEach((A,_)=>{const ee=A.$x+$;l.exec("drag-task",{id:_,left:ee,width:A.$w,inProgress:!0})}),B(A=>({...A,dx:$}));return}if(se.current){const{node:$,x:A,id:_}=se.current,ee=se.current.dx=x-A,Te=Math.round(ee/$.offsetWidth*100);let De=se.current.progress+Te;se.current.value=De=Math.min(Math.max(0,De),100),l.exec("update-task",{id:_,task:{progress:De},inProgress:!0})}else if(P){y(null);const{mode:$,l:A,w:_,x:ee,id:Te,start:De,segment:Pe,index:Ae}=P,He=l.getTask(Te),Ie=x-ee;if(!De&&Math.abs(Ie)<20||$==="start"&&_-Ie<N||$==="end"&&_+Ie<N||$==="move"&&(Ie<0&&A+Ie<0||Ie>0&&A+_+Ie>je)||P.segment&&!pe.isSegmentMoveAllowed(He,P))return;const Ke={...P,dx:Ie};let qe,Xe;if($==="start"?(qe=A+Ie,Xe=_-Ie):$==="end"?(qe=A,Xe=_+Ie):$==="move"&&(qe=A+Ie,Xe=_),l.exec("drag-task",{id:Te,width:Xe,left:qe,inProgress:!0,...Pe&&{segmentIndex:Ae}}),!Ke.start&&($==="move"&&He.$x==A||$!=="move"&&He.$w==_)){re.current=!0,v();return}Ke.start=!0,ae(Ke)}else{const $=ve.locate(t);if($){const A=l.getTask(Ge($)),ee=ve.locate(t,"data-segment")||$,Te=Y(ee,u,A);ee.style.cursor=Te&&!n?"col-resize":"pointer"}}}},[l,n,P,N,je,Y,y,v,G,K,le]),ke=e.useCallback(t=>{H(t,t)},[H]),we=e.useCallback(t=>{he?(t.preventDefault(),H(t,t.touches[0])):Ce.current&&(clearTimeout(Ce.current),Ce.current=null)},[he,H]),Se=e.useCallback(()=>{v()},[v]),We=e.useCallback(()=>{Re(null),Ce.current&&(clearTimeout(Ce.current),Ce.current=null),v()},[v]);e.useEffect(()=>(window.addEventListener("mouseup",Se),()=>{window.removeEventListener("mouseup",Se)}),[Se]);const kt=e.useCallback(t=>{if(!n){const u=ve.locateID(t.target);if(u&&!t.target.classList.contains("wx-link")){const x=ve.locateID(t.target,"data-segment");l.exec("show-editor",{id:u,...x!==null&&{segmentIndex:x}})}}},[l,n]),bt=["e2s","s2s","e2e","s2e"],Ye=e.useCallback((t,u)=>bt[(t?1:0)+(u?0:2)],[]),Fe=e.useCallback((t,u)=>{const x=m.id,C=m.start;return t===x?!0:!!p.find(L=>L.target==t&&L.source==x&&L.type===Ye(C,u))},[m,Z,Ye]),Je=e.useCallback(()=>{m&&M(null)},[m]),et=e.useCallback((t,u,x)=>{if(!u.length||!t||x==null)return;const C=864e5,L=l.getHistory();L?.startBatch();const $=new Date(t),A=$.getDay(),_=A===0?-6:1-A;$.setDate($.getDate()+_),$.setHours(0,0,0,0),u.forEach((ee,Te)=>{const De=`task-${Date.now()}-${Te}`,Pe=At($,ee._startCellOffset||0,f),Ae=new Date(Pe.getTime()+(ee._startDayOfWeek||0)*C);Ae.setHours(0,0,0,0);const He=new Date(Ae.getTime()+(ee._durationDays||7)*C);He.setHours(0,0,0,0),console.log("[paste] task:",ee.text,"newStart:",Ae,"newEnd:",He,"_durationDays:",ee._durationDays,"_startDayOfWeek:",ee._startDayOfWeek),l.exec("add-task",{task:{id:De,text:ee.text,start:Ae,end:He,type:ee.type||"task",parent:x,row:ee.row},target:x,mode:"child",skipUndo:Te>0})}),L?.endBatch()},[l,f]),yt=e.useCallback(t=>{if(re.current){re.current=!1;return}if(le&&le.currentX!=null){const x=mt(le.currentX,f);x&&et(x,le.tasks,le.parent),T(null);return}const u=ve.locateID(t.target);if(u){const x=l.getTask(u),C=d.find($=>$.id===u);console.log("[click] task:",x?.text,"id:",u),console.log("[click] api.getTask:",{start:x?.start,end:x?.end,duration:x?.duration}),console.log("[click] rendered:",{start:C?.start,end:C?.end,$w:C?.$w,$x:C?.$x});const L=t.target.classList;if(L.contains("wx-link")){const $=L.contains("wx-left");if(!m){M({id:u,start:$});return}m.id!==u&&!Fe(u,$)&&l.exec("add-link",{link:{source:m.id,target:u,type:Ye(m.start,$)}})}else if(L.contains("wx-delete-button-icon"))l.exec("delete-link",{id:oe.id}),fe(null);else{let $;const A=ve.locate(t,"data-segment");A&&($=A.dataset.segment*1),l.exec("select-task",{id:u,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:$})}}Je()},[l,m,Z,oe,Fe,Ye,Je,le,f,et]),vt=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),Tt=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),Mt=e.useCallback(t=>{if(he||Ce.current)return t.preventDefault(),!1},[he]),tt=e.useMemo(()=>O.map(t=>t.id),[O]),st=e.useCallback(t=>{let u=tt.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(u=`task ${u}`),u},[tt]),nt=e.useCallback(t=>{l.exec(t.action,t.data)},[l]),Ve=e.useCallback(t=>q&&E.byId(t).$critical,[q,E]),rt=e.useCallback(t=>{if(X?.auto){const u=E.getSummaryId(t,!0),x=E.getSummaryId(m.id,!0);return m?.id&&!(Array.isArray(u)?u:[u]).includes(m.id)&&!(Array.isArray(x)?x:[x]).includes(t)}return m},[X,E,m]),ot=e.useCallback(()=>{const t=l.getState()._selected;if(!t||!t.length)return;const u=864e5,x=t.map(_=>{const ee=l.getTask(_.id);if(!ee)return null;const Te=d.find(St=>St.id===_.id);if(!Te)return null;const{$x:De,$y:Pe,$h:Ae,$w:He,$skip:Ie,$level:Ke,$index:qe,$y_base:Xe,$x_base:ds,$w_base:fs,$h_base:xs,$skip_baseline:ms,$critical:hs,$reorder:gs,...Ct}=Te,ct=Te.end&&Te.start?Math.round((Te.end.getTime()-Te.start.getTime())/u):0,it=Te.start?(Te.start.getDay()+6)%7:0;return console.log("[copy] task:",ee.text,"durationDays:",ct,"startDayOfWeek:",it,"$w:",He),{...Ct,_durationDays:ct,_startDayOfWeek:it,_originalWidth:He,_originalHeight:Ae}}).filter(Boolean);if(!x.length)return;const L=x[0].parent,$=x.filter(_=>_.parent===L);if($.length===0)return;const A=$.reduce((_,ee)=>ee.start&&(!_||ee.start<_)?ee.start:_,null);Ue=$.map(_=>({..._,_startCellOffset:Ht(_.start,A,f)})),xt=L,Qe=A},[l,f]);e.useEffect(()=>h?l.intercept("hotkey",u=>{if(u.key==="ctrl+c"||u.key==="meta+c")return ot(),!1;if(u.key==="ctrl+v"||u.key==="meta+v")return!Ue.length||!Qe||T({tasks:Ue,baseDate:Qe,parent:xt,currentX:ue.current}),!1}):void 0,[h,l,ot]),e.useEffect(()=>{if(!le)return;const t=u=>{u.key==="Escape"&&(u.preventDefault(),u.stopPropagation(),T(null))};return document.addEventListener("keydown",t,!0),()=>document.removeEventListener("keydown",t,!0)},[le]);const lt=e.useMemo(()=>{if(!G)return null;const t=Math.min(G.startX,G.currentX),u=Math.min(G.startY,G.currentY),x=Math.abs(G.currentX-G.startX),C=Math.abs(G.currentY-G.startY);return{left:`${t}px`,top:`${u}px`,width:`${x}px`,height:`${C}px`}},[G]);return c.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${me.length?me[0].$h:0}px`},ref:ie,onContextMenu:Mt,onMouseDown:Oe,onMouseMove:ke,onTouchStart:a,onTouchMove:we,onTouchEnd:We,onClick:yt,onDoubleClick:kt,onDragStart:t=>(t.preventDefault(),!1),children:[c.jsx(Pt,{onSelectLink:y,selectedLink:oe,readonly:n}),me.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const u=`wx-bar wx-${st(t.type)}`+(he&&P&&t.id===P.id?" wx-touch":"")+(m&&m.id===t.id?" wx-selected":"")+($e.has(t.id)?" wx-selected":"")+(Ve(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(w&&t.segments?" wx-split":""),x="wx-link wx-left"+(m?" wx-visible":"")+(!m||!Fe(t.id,!0)&&rt(t.id)?" wx-target":"")+(m&&m.id===t.id&&m.start?" wx-selected":"")+(Ve(t.id)?" wx-critical":""),C="wx-link wx-right"+(m?" wx-visible":"")+(!m||!Fe(t.id,!1)&&rt(t.id)?" wx-target":"")+(m&&m.id===t.id&&!m.start?" wx-selected":"")+(Ve(t.id)?" wx-critical":"");return c.jsxs(e.Fragment,{children:[!t.$skip&&c.jsxs("div",{className:"wx-GKbcLEGA "+u,style:vt(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:k===t.id?0:-1,children:[n?null:t.id===oe?.target&&oe?.type[2]==="s"?c.jsx(ye.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+x,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?c.jsxs(c.Fragment,{children:[t.progress&&!(w&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:c.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(w&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?c.jsx(r,{data:t,api:l,onAction:nt}):w&&t.segments?c.jsx(Wt,{task:t,type:st(t.type)}):c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?c.jsx(r,{data:t,api:l,onAction:nt}):c.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===oe?.target&&oe?.type[2]==="e"?c.jsx(ye.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+C,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),g&&!t.$skip_baseline?c.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:Tt(t)}):null]},t.id)}),G&&lt&&c.jsx("div",{className:"wx-GKbcLEGA wx-marquee-selection",style:lt}),le&&le.currentX!=null&&le.tasks.map((t,u)=>{const C=(Math.floor(le.currentX/N)+(t._startCellOffset||0))*N,L=t._originalWidth||N,$=t._originalHeight||F,A=ge.get(t.row)??(t.$y||0);return c.jsx("div",{className:"wx-GKbcLEGA wx-bar wx-task wx-paste-preview",style:{left:C,top:A,width:L,height:$},children:c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text})},`preview-${u}`)})]})}function zt(s){const{highlightTime:n}=s,r=e.useContext(ze),i=S.useStore(r,"_scales");return c.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:i.width},children:(i?.rows||[]).map((o,D)=>c.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${o.height}px`},children:(o.cells||[]).map((h,l)=>{const d=n?n(h.date,h.unit):"",z="wx-cell "+(h.css||"")+" "+(d||""),p=typeof h.value=="string"&&h.value.includes("<");return c.jsx("div",{className:"wx-ZkvhDKir "+z,style:{width:`${h.width}px`},...p?{dangerouslySetInnerHTML:{__html:h.value}}:{children:h.value}},l)})},D))})}const Gt=new Map;function Ot(s){const n=e.useRef(null),r=e.useRef(0),i=e.useRef(null),o=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(o)return cancelAnimationFrame(i.current),i.current=requestAnimationFrame(()=>{const D={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};Gt.set(s,D),window.dispatchEvent(new CustomEvent("render-metric",{detail:D}))}),()=>cancelAnimationFrame(i.current)})}function qt(s){const{readonly:n,fullWidth:r,fullHeight:i,taskTemplate:o,cellBorders:D,highlightTime:h,multiTaskRows:l=!1,rowMapping:d=null,marqueeSelect:z=!1,copyPaste:p=!1,scrollToCurrentWeek:Z=!1,currentWeekColor:R=null}=s,f=e.useContext(ze),[O,g]=S.useStoreWithCounter(f,"_selected"),j=S.useStore(f,"scrollTop"),J=S.useStore(f,"cellHeight"),I=S.useStore(f,"cellWidth"),q=S.useStore(f,"_scales"),E=S.useStore(f,"_markers"),X=S.useStore(f,"_scrollTask"),w=S.useStore(f,"zoom"),te=S.useStore(f,"_tasks"),[F,me]=e.useState(),N=e.useRef(null),de=e.useRef(0),re=e.useRef(!1),m=1+(q?.rows?.length||0),M=e.useMemo(()=>{if(!l||!d||!te?.length)return null;const b=new Map,W=new Map,K=[];return te.forEach(B=>{const V=d.taskRows.get(B.id)??B.id;W.has(V)||(W.set(V,K.length),K.push(V))}),te.forEach(B=>{const V=d.taskRows.get(B.id)??B.id,ce=W.get(V)??0;b.set(B.id,ce*J)}),b},[te,l,d,J]),P=e.useMemo(()=>{const b=[];return O&&O.length&&J&&O.forEach(W=>{const K=M?.get(W.id)??W.$y;b.push({height:`${J}px`,top:`${K-3}px`})}),b},[g,J,M]),ae=e.useMemo(()=>Math.max(F||0,i),[F,i]);e.useEffect(()=>{const b=N.current;b&&typeof j=="number"&&(b.scrollTop=j)},[j]);const se=()=>{oe()};function oe(b){const W=N.current;if(!W)return;const K={};K.left=W.scrollLeft,f.exec("scroll-chart",K)}function fe(){const b=N.current,K=Math.ceil((F||0)/(J||1))+1,B=Math.floor((b&&b.scrollTop||0)/(J||1)),V=Math.max(0,B-m),ce=B+K+m,le=V*(J||0);f.exec("render-data",{start:V,end:ce,from:le})}e.useEffect(()=>{fe()},[F,j]);const he=e.useCallback(b=>{if(!b)return;const{id:W,mode:K}=b;if(K.toString().indexOf("x")<0)return;const B=N.current;if(!B)return;const{clientWidth:V}=B,ce=f.getTask(W);if(ce.$x+ce.$w<B.scrollLeft)f.exec("scroll-chart",{left:ce.$x-(I||0)}),B.scrollLeft=ce.$x-(I||0);else if(ce.$x>=V+B.scrollLeft){const le=V<ce.$w?I||0:ce.$w;f.exec("scroll-chart",{left:ce.$x-V+le}),B.scrollLeft=ce.$x-V+le}},[f,I]);e.useEffect(()=>{he(X)},[X]);function Re(b){if(w&&(b.ctrlKey||b.metaKey)){b.preventDefault();const W=N.current,K=b.clientX-(W?W.getBoundingClientRect().left:0);if(de.current+=b.deltaY,Math.abs(de.current)>=150){const V=-Math.sign(de.current);de.current=0,f.exec("zoom-scale",{dir:V,offset:K})}}}const Ce=e.useCallback(b=>{const W=h(b.date,b.unit);return W?{css:W,width:b.width}:null},[h]),je=e.useMemo(()=>{if(!q||!h||!["hour","day","week"].includes(q.minUnit))return null;let W=0;return q.rows[q.rows.length-1].cells.map(K=>{const B=Ce(K),V=W;return W+=K.width,B?{...B,left:V}:null})},[q,h,Ce]),Ee=e.useCallback(b=>{b.eventSource="chart",f.exec("hotkey",b)},[f]);e.useEffect(()=>{const b=N.current;if(!b)return;const W=()=>me(b.clientHeight);W();const K=new ResizeObserver(()=>W());return K.observe(b),()=>{K.disconnect()}},[N.current]);const G=e.useRef(null);return e.useEffect(()=>{const b=N.current;if(b&&!G.current)return G.current=ht.hotkeys(b,{keys:{arrowup:!0,arrowdown:!0},exec:W=>Ee(W)}),()=>{G.current?.destroy(),G.current=null}},[]),e.useEffect(()=>{const b=N.current;if(!b)return;const W=Re;return b.addEventListener("wheel",W),()=>{b.removeEventListener("wheel",W)}},[Re]),e.useEffect(()=>{if(!Z||re.current||!q||!N.current||!F)return;const b=N.current,{clientWidth:W}=b,K=new Date,B=q.rows[q.rows.length-1]?.cells;if(!B)return;let V=-1,ce=0;const le=[];for(let U=0;U<B.length;U++){const ue=B[U];le.push({left:ce,width:ue.width});const ie=ue.date;if(ue.unit==="week"){const Le=new Date(ie);Le.setDate(Le.getDate()+7),K>=ie&&K<Le&&(V=U)}else ue.unit==="day"&&K.getFullYear()===ie.getFullYear()&&K.getMonth()===ie.getMonth()&&K.getDate()===ie.getDate()&&(V=U);ce+=ue.width}let T=V;if(V>0&&(T=V-1),T>=0&&le[T]){const U=le[T],ue=Math.max(0,U.left);b.scrollLeft=ue,f.exec("scroll-chart",{left:ue}),re.current=!0}},[Z,q,F,f]),Ot("chart"),c.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:N,onScroll:se,children:[c.jsx(zt,{highlightTime:h,scales:q}),E&&E.length?c.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${ae}px`},children:E.map((b,W)=>c.jsx("div",{className:`wx-mR7v2Xag wx-marker ${b.css||""}`,style:{left:`${b.left}px`},children:c.jsx("div",{className:"wx-mR7v2Xag wx-content",children:b.text})},W))}):null,c.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${ae}px`},children:[je?c.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:je.map((b,W)=>b?c.jsx("div",{className:"wx-mR7v2Xag "+b.css,style:{width:`${b.width}px`,left:`${b.left}px`}},W):null)}):null,c.jsx(Nt,{borders:D}),O&&O.length?O.map((b,W)=>b.$y?c.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":b.id,style:P[W]},b.id):null):null,c.jsx(_t,{readonly:n,taskTemplate:o,multiTaskRows:l,rowMapping:d,marqueeSelect:z,copyPaste:p})]})]})}function Xt(s){const{position:n="after",size:r=4,dir:i="x",onMove:o,onDisplayChange:D,compactMode:h,containerWidth:l=0,leftThreshold:d=50,rightThreshold:z=50}=s,[p,Z]=S.useWritableProp(s.value??0),[R,f]=S.useWritableProp(s.display??"all");function O(oe){let fe=0;n=="center"?fe=r/2:n=="before"&&(fe=r);const he={size:[r+"px","auto"],p:[oe-fe+"px","0px"],p2:["auto","0px"]};if(i!="x")for(let Re in he)he[Re]=he[Re].reverse();return he}const[g,j]=e.useState(!1),[J,I]=e.useState(null),q=e.useRef(0),E=e.useRef(),X=e.useRef(),w=e.useRef(R);e.useEffect(()=>{w.current=R},[R]),e.useEffect(()=>{J===null&&p>0&&I(p)},[J,p]);function te(oe){return i=="x"?oe.clientX:oe.clientY}const F=e.useCallback(oe=>{const fe=E.current+te(oe)-q.current;Z(fe);let he;fe<=d?he="chart":l-fe<=z?he="grid":he="all",w.current!==he&&(f(he),w.current=he),X.current&&clearTimeout(X.current),X.current=setTimeout(()=>o&&o(fe),100)},[l,d,z,o]),me=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",j(!1),window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",me)},[F]),N=e.useMemo(()=>R!=="all"?"auto":i=="x"?"ew-resize":"ns-resize",[R,i]),de=e.useCallback(oe=>{!h&&(R==="grid"||R==="chart")||(q.current=te(oe),E.current=p,j(!0),document.body.style.cursor=N,document.body.style.userSelect="none",window.addEventListener("mousemove",F),window.addEventListener("mouseup",me))},[N,F,me,p,h,R]);function re(){f("all"),J!==null&&(Z(J),o&&o(J))}function m(oe){if(h){const fe=R==="chart"?"grid":"chart";f(fe),D(fe)}else if(R==="grid"||R==="chart")re(),D("all");else{const fe=oe==="left"?"chart":"grid";f(fe),D(fe)}}function M(){m("left")}function P(){m("right")}const ae=e.useMemo(()=>O(p),[p,n,r,i]),se=["wx-resizer",`wx-resizer-${i}`,`wx-resizer-display-${R}`,g?"wx-resizer-active":""].filter(Boolean).join(" ");return c.jsxs("div",{className:"wx-pFykzMlT "+se,onMouseDown:de,style:{width:ae.size[0],height:ae.size[1],cursor:N},children:[c.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:M})}),c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:P})})]}),c.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const Yt=650;function wt(s){let n;function r(){n=new ResizeObserver(o=>{for(let D of o)if(D.target===document.body){let h=D.contentRect.width<=Yt;s(h)}}),n.observe(document.body)}function i(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:i}}function Ft(s){const{taskTemplate:n,readonly:r,cellBorders:i,highlightTime:o,onTableAPIChange:D,multiTaskRows:h=!1,rowMapping:l=null,marqueeSelect:d=!1,copyPaste:z=!1,scrollToCurrentWeek:p=!1,currentWeekColor:Z=null}=s,R=e.useContext(ze),f=S.useStore(R,"_tasks"),O=S.useStore(R,"_scales"),g=S.useStore(R,"cellHeight"),j=S.useStore(R,"columns"),J=S.useStore(R,"_scrollTask"),I=S.useStore(R,"undo"),q=e.useMemo(()=>{if(!h)return l;const T=new Map,U=new Map;return f.forEach(ue=>{const ie=ue.row??ue.id;U.set(ue.id,ie),T.has(ie)||T.set(ie,[]),T.get(ie).push(ue.id)}),{rowMap:T,taskRows:U}},[f,h,l]),[E,X]=e.useState(!1);let[w,te]=e.useState(0);const[F,me]=e.useState(0),[N,de]=e.useState(0),[re,m]=e.useState(void 0),[M,P]=e.useState("all"),ae=e.useRef(null),se=e.useCallback(T=>{X(U=>(T!==U&&(T?(ae.current=M,M==="all"&&P("grid")):(!ae.current||ae.current==="all")&&P("all")),T))},[M]);e.useEffect(()=>{const T=wt(se);return T.observe(),()=>{T.disconnect()}},[se]);const oe=e.useMemo(()=>{let T;return j.every(U=>U.width&&!U.flexgrow)?T=j.reduce((U,ue)=>U+parseInt(ue.width),0):E&&M==="chart"?T=parseInt(j.find(U=>U.id==="action")?.width)||50:T=440,w=T,T},[j,E,M]);e.useEffect(()=>{te(oe)},[oe]);const fe=e.useMemo(()=>(F??0)-(re??0),[F,re]),he=e.useMemo(()=>O.width,[O]),Re=e.useMemo(()=>{if(!h||!q)return f.length*g;const T=new Set;return f.forEach(U=>{const ue=q.taskRows.get(U.id)??U.id;T.add(ue)}),T.size*g},[f,g,h,q]),Ce=e.useMemo(()=>O.height+Re+fe,[O,Re,fe]),je=e.useMemo(()=>w+he,[w,he]),Ee=e.useRef(null),G=e.useCallback(()=>{Promise.resolve().then(()=>{if((F??0)>(je??0)){const T=(F??0)-w;R.exec("expand-scale",{minWidth:T})}})},[F,je,w,R]);e.useEffect(()=>{let T;return Ee.current&&(T=new ResizeObserver(G),T.observe(Ee.current)),()=>{T&&T.disconnect()}},[Ee.current,G]),e.useEffect(()=>{G()},[he]);const b=e.useRef(null),W=e.useRef(null),K=e.useCallback(()=>{const T=b.current;T&&R.exec("scroll-chart",{top:T.scrollTop})},[R]),B=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{B.current={rTasks:f,rScales:O,rCellHeight:g,scrollSize:fe,ganttDiv:b.current,ganttHeight:N??0}},[f,O,g,fe,N]);const V=e.useCallback(T=>{if(!T)return;const{rTasks:U,rScales:ue,rCellHeight:ie,scrollSize:Le,ganttDiv:k,ganttHeight:ne}=B.current;if(!k)return;const{id:xe}=T,Y=U.findIndex(Q=>Q.id===xe);if(Y>-1){const Q=ne-ue.height,ge=Y*ie,be=k.scrollTop;let $e=null;ge<be?$e=ge:ge+ie>be+Q&&($e=ge-Q+ie+Le),$e!==null&&(R.exec("scroll-chart",{top:Math.max($e,0)}),b.current.scrollTop=Math.max($e,0))}},[R]);e.useEffect(()=>{V(J)},[J]),e.useEffect(()=>{const T=b.current,U=W.current;if(!T||!U)return;const ue=()=>{Rt.flushSync(()=>{de(T.offsetHeight),me(T.offsetWidth),m(U.offsetWidth)})},ie=new ResizeObserver(ue);return ie.observe(T),()=>ie.disconnect()},[b.current]);const ce=e.useRef(null),le=e.useRef(null);return e.useEffect(()=>{le.current&&(le.current.destroy(),le.current=null);const T=ce.current;if(T)return le.current=ht.hotkeys(T,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,"meta+c":!0,"meta+v":!0,"meta+x":!0,"meta+d":!0,backspace:!0,"ctrl+z":I,"ctrl+y":I,"meta+z":I,"meta+shift+z":I},exec:U=>{if(U.isInput)return;const ue=U.key;if(ue==="ctrl+z"||ue==="meta+z"){R.exec("undo",{});return}if(ue==="ctrl+y"||ue==="meta+shift+z"){R.exec("redo",{});return}R.exec("hotkey",U)}}),()=>{le.current?.destroy(),le.current=null}},[I]),c.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:b,onScroll:K,children:c.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:Ce,width:"100%"},ref:W,children:c.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:N,width:re},children:c.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:ce,children:[j.length?c.jsxs(c.Fragment,{children:[c.jsx(It,{display:M,compactMode:E,columnWidth:oe,width:w,readonly:r,fullHeight:Re,onTableAPIChange:D,multiTaskRows:h,rowMapping:q}),c.jsx(Xt,{value:w,display:M,compactMode:E,containerWidth:F,onMove:T=>te(T),onDisplayChange:T=>P(T)})]}):null,c.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:Ee,children:c.jsx(qt,{readonly:r,fullWidth:he,fullHeight:Re,taskTemplate:n,cellBorders:i,highlightTime:o,multiTaskRows:h,rowMapping:q,marqueeSelect:d,copyPaste:z,scrollToCurrentWeek:p,currentWeekColor:Z})})]})})})})}function Kt(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function Bt(s,n){return typeof s=="function"?s:ve.dateToString(s,n)}function pt(s,n){return s.map(({format:r,...i})=>({...i,format:Bt(r,n)}))}function Vt(s,n){const r=Kt(n);for(let i in r)r[i]=ve.dateToString(r[i],s);return r}function Ut(s,n){if(!s||!s.length)return s;const r=ve.dateToString("%d-%m-%Y",n);return s.map(i=>i.template?i:i.id==="start"||i.id=="end"?{...i,_template:o=>r(o),template:o=>r(o)}:i.id==="duration"?{...i,_template:o=>o,template:o=>o}:i)}function Qt(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:pt(r.scales,n)}))}:s}const Zt=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),Jt=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],es=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:i=pe.defaultTaskTypes,tasks:o=[],selected:D=[],activeTask:h=null,links:l=[],scales:d=Jt,columns:z=pe.defaultColumns,start:p=null,end:Z=null,lengthUnit:R="day",durationUnit:f="day",cellWidth:O=100,cellHeight:g=38,scaleHeight:j=36,readonly:J=!1,cellBorders:I="full",zoom:q=!1,baselines:E=!1,highlightTime:X=null,init:w=null,autoScale:te=!0,unscheduledTasks:F=!1,criticalPath:me=null,schedule:N={type:"forward"},projectStart:de=null,projectEnd:re=null,calendar:m=null,undo:M=!1,splitTasks:P=!1,multiTaskRows:ae=!1,marqueeSelect:se=!1,copyPaste:oe=!1,currentWeekHighlight:fe=!1,currentWeekColor:he=null,scrollToCurrentWeek:Re=!1,...Ce},je){const Ee=e.useRef();Ee.current=Ce;const G=e.useMemo(()=>new pe.DataStore(S.writable),[]),b=e.useMemo(()=>({...Ze.en,...Be.en}),[]),W=e.useContext(ye.context.i18n),K=e.useMemo(()=>W?W.extend(b,!0):ve.locale(b),[W,b]),B=e.useMemo(()=>K.getRaw().calendar,[K]),V=e.useMemo(()=>{let Q={zoom:Qt(q,B),scales:pt(d,B),columns:Ut(z,B),links:pe.normalizeLinks(l),cellWidth:O};return Q.zoom&&(Q={...Q,...pe.normalizeZoom(Q.zoom,Vt(B,K.getGroup("gantt")),Q.scales,O)}),Q},[q,d,z,l,O,B,K]),ce=e.useRef(null);ce.current!==o&&(pe.parseTaskDates(o,{durationUnit:f,splitTasks:P,calendar:m}),ce.current=o),e.useEffect(()=>{pe.parseTaskDates(o,{durationUnit:f,splitTasks:P,calendar:m})},[o,f,m,P]);const le=e.useMemo(()=>{if(!ae)return null;const Q=new Map,ge=new Map,be=$e=>{$e.forEach(Me=>{const Ne=Me.row??Me.id;ge.set(Me.id,Ne),Q.has(Ne)||Q.set(Ne,[]),Q.get(Ne).push(Me.id),Me.data&&Me.data.length>0&&be(Me.data)})};return be(o),{rowMap:Q,taskRows:ge}},[o,ae]),T=e.useMemo(()=>G.in,[G]),U=e.useRef(null);U.current===null&&(U.current=new Et.EventBusRouter((Q,ge)=>{const be="on"+Zt(Q);Ee.current&&Ee.current[be]&&Ee.current[be](ge)}),T.setNext(U.current));const[ue,ie]=e.useState(null),Le=e.useRef(null);Le.current=ue;const k=e.useMemo(()=>({getState:G.getState.bind(G),getReactiveState:G.getReactive.bind(G),getStores:()=>({data:G}),exec:T.exec,setNext:Q=>(U.current=U.current.setNext(Q),U.current),intercept:T.intercept.bind(T),on:T.on.bind(T),detach:T.detach.bind(T),getTask:G.getTask.bind(G),serialize:G.serialize.bind(G),getTable:Q=>Q?new Promise(ge=>setTimeout(()=>ge(Le.current),1)):Le.current,getHistory:()=>G.getHistory()}),[G,T]);e.useImperativeHandle(je,()=>({...k}),[k]);const ne=e.useRef(0);e.useEffect(()=>{ne.current?G.init({tasks:o,links:V.links,start:p,columns:V.columns,end:Z,lengthUnit:R,cellWidth:V.cellWidth,cellHeight:g,scaleHeight:j,scales:V.scales,taskTypes:i,zoom:V.zoom,selected:D,activeTask:h,baselines:E,autoScale:te,unscheduledTasks:F,markers:r,durationUnit:f,criticalPath:me,schedule:N,projectStart:de,projectEnd:re,calendar:m,undo:M,_weekStart:B.weekStart,splitTasks:P}):w&&w(k),ne.current++},[k,w,o,V,p,Z,R,g,j,i,D,h,E,te,F,r,f,me,N,de,re,m,M,B,P,G]),ne.current===0&&G.init({tasks:o,links:V.links,start:p,columns:V.columns,end:Z,lengthUnit:R,cellWidth:V.cellWidth,cellHeight:g,scaleHeight:j,scales:V.scales,taskTypes:i,zoom:V.zoom,selected:D,activeTask:h,baselines:E,autoScale:te,unscheduledTasks:F,markers:r,durationUnit:f,criticalPath:me,schedule:N,projectStart:de,projectEnd:re,calendar:m,undo:M,_weekStart:B.weekStart,splitTasks:P});const xe=e.useMemo(()=>{const Q=new Date,ge=B?.weekStart??0,be=new Date(Q),Me=(be.getDay()-ge+7)%7;be.setDate(be.getDate()-Me),be.setHours(0,0,0,0);const Ne=new Date(be);return Ne.setDate(Ne.getDate()+7),Oe=>Oe>=be&&Oe<Ne},[B]),Y=e.useMemo(()=>(Q,ge)=>{let be=[];if(m)ge=="day"&&!m.getDayHours(Q)&&be.push("wx-weekend"),ge=="hour"&&!m.getDayHours(Q)&&be.push("wx-weekend");else if(X){const $e=X(Q,ge);$e&&be.push($e)}return fe&&(ge==="week"||ge==="day")&&xe(Q)&&be.push("wx-current-week"),be.join(" ")},[m,X,fe,xe]);return c.jsx(ye.context.i18n.Provider,{value:K,children:c.jsx(ze.Provider,{value:k,children:c.jsx(Ft,{taskTemplate:n,readonly:J,cellBorders:I,highlightTime:Y,onTableAPIChange:ie,multiTaskRows:ae,rowMapping:le,marqueeSelect:se,copyPaste:oe,scrollToCurrentWeek:Re,currentWeekColor:he})})})});function ts({api:s=null,items:n=[]}){const r=e.useContext(ye.context.i18n),i=e.useMemo(()=>r||ve.locale(Be.en),[r]),o=e.useMemo(()=>i.getGroup("gantt"),[i]),D=S.useStoreLater(s,"_selected"),h=S.useStoreLater(s,"undo"),l=S.useStoreLater(s,"history"),d=S.useStoreLater(s,"splitTasks"),z=["undo","redo"],p=e.useMemo(()=>{const R=pe.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:pe.getToolbarButtons({undo:h,splitTasks:d})).map(O=>{let g={...O,disabled:!1};return g.handler=pe.isHandledAction(R,g.id)?j=>pe.handleAction(s,j.id,null,o):g.handler,g.text&&(g.text=o(g.text)),g.menuText&&(g.menuText=o(g.menuText)),g})},[n,s,o,h,d]),Z=e.useMemo(()=>{const R=[];return p.forEach(f=>{const O=f.id;if(O==="add-task")R.push(f);else if(z.includes(O))z.includes(O)&&R.push({...f,disabled:f.isDisabled(l)});else{if(!D?.length||!s)return;R.push({...f,disabled:f.isDisabled&&D.some(g=>f.isDisabled(g,s.getState()))})}}),R.filter((f,O)=>{if(s&&f.isHidden)return!D.some(g=>f.isHidden(g,s.getState()));if(f.comp==="separator"){const g=R[O+1];if(!g||g.comp==="separator")return!1}return!0})},[s,D,l,p]);return r?c.jsx(at.Toolbar,{items:Z}):c.jsx(ye.context.i18n.Provider,{value:i,children:c.jsx(at.Toolbar,{items:Z})})}const ss=e.forwardRef(function({options:n=[],api:r=null,resolver:i=null,filter:o=null,at:D="point",children:h,onClick:l,css:d},z){const p=e.useRef(null),Z=e.useRef(null),R=e.useContext(ye.context.i18n),f=e.useMemo(()=>R||ve.locale({...Be.en,...Ze.en}),[R]),O=e.useMemo(()=>f.getGroup("gantt"),[f]),g=S.useStoreLater(r,"taskTypes"),j=S.useStoreLater(r,"selected"),J=S.useStoreLater(r,"_selected"),I=S.useStoreLater(r,"splitTasks"),q=e.useMemo(()=>pe.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{p.current&&p.current.show&&p.current.show()}),r.on("drag-task",()=>{p.current&&p.current.show&&p.current.show()}))},[r]);function E(m){return m.map(M=>(M={...M},M.text&&(M.text=O(M.text)),M.subtext&&(M.subtext=O(M.subtext)),M.data&&(M.data=E(M.data)),M))}function X(){const m=n.length?n:pe.getMenuOptions({splitTasks:I}),M=m.find(P=>P.id==="convert-task");return M&&(M.data=[],(g||[]).forEach(P=>{M.data.push(M.dataFactory(P))})),E(m)}const w=e.useMemo(()=>X(),[r,n,g,I,O]),te=e.useMemo(()=>J&&J.length?J:[],[J]),F=e.useCallback((m,M)=>{let P=m?r?.getTask(m):null;if(i){const ae=i(m,M);P=ae===!0?P:ae}if(P){const ae=ve.locateID(M.target,"data-segment");ae!==null?Z.current={id:P.id,segmentIndex:ae}:Z.current=P.id,(!Array.isArray(j)||!j.includes(P.id))&&r&&r.exec&&r.exec("select-task",{id:P.id})}return P},[r,i,j]),me=e.useCallback(m=>{const M=m.action;M&&(pe.isHandledAction(q,M.id)&&pe.handleAction(r,M.id,Z.current,O),l&&l(m))},[r,O,l,q]),N=e.useCallback((m,M)=>{const P=te.length?te:M?[M]:[];let ae=o?P.every(se=>o(m,se)):!0;if(ae&&(m.isHidden&&(ae=!P.some(se=>m.isHidden(se,r.getState(),Z.current))),m.isDisabled)){const se=P.some(oe=>m.isDisabled(oe,r.getState(),Z.current));m.disabled=se}return ae},[o,te,r]);e.useImperativeHandle(z,()=>({show:(m,M)=>{p.current&&p.current.show&&p.current.show(m,M)}}));const de=e.useCallback(m=>{p.current&&p.current.show&&p.current.show(m)},[]),re=c.jsxs(c.Fragment,{children:[c.jsx(jt.ContextMenu,{filter:N,options:w,dataKey:"id",resolver:F,onClick:me,at:D,ref:p,css:d}),c.jsx("span",{onContextMenu:de,"data-menu-ignore":"true",children:typeof h=="function"?h():h})]});if(!R&&ye.context.i18n?.Provider){const m=ye.context.i18n.Provider;return c.jsx(m,{value:f,children:re})}return re});function ns({api:s,autoSave:n,onLinksChange:r}){const o=e.useContext(ye.context.i18n).getGroup("gantt"),D=S.useStore(s,"activeTask"),h=S.useStore(s,"_activeTask"),l=S.useStore(s,"_links"),d=S.useStore(s,"schedule"),z=S.useStore(s,"unscheduledTasks"),[p,Z]=e.useState();function R(){if(D){const j=l.filter(I=>I.target==D).map(I=>({link:I,task:s.getTask(I.source)})),J=l.filter(I=>I.source==D).map(I=>({link:I,task:s.getTask(I.target)}));return[{title:o("Predecessors"),data:j},{title:o("Successors"),data:J}]}}e.useEffect(()=>{Z(R())},[D,l]);const f=e.useMemo(()=>[{id:"e2s",label:o("End-to-start")},{id:"s2s",label:o("Start-to-start")},{id:"e2e",label:o("End-to-end")},{id:"s2e",label:o("Start-to-end")}],[o]);function O(j){n?s.exec("delete-link",{id:j}):(Z(J=>(J||[]).map(I=>({...I,data:I.data.filter(q=>q.link.id!==j)}))),r&&r({id:j,action:"delete-link",data:{id:j}}))}function g(j,J){n?s.exec("update-link",{id:j,link:J}):(Z(I=>(I||[]).map(q=>({...q,data:q.data.map(E=>E.link.id===j?{...E,link:{...E.link,...J}}:E)}))),r&&r({id:j,action:"update-link",data:{id:j,link:J}}))}return c.jsx(c.Fragment,{children:(p||[]).map((j,J)=>j.data.length?c.jsx("div",{className:"wx-j93aYGQf wx-links",children:c.jsx(ye.Field,{label:j.title,position:"top",children:c.jsx("table",{children:c.jsx("tbody",{children:j.data.map(I=>c.jsxs("tr",{children:[c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:I.task.text||""})}),d?.auto&&I.link.type==="e2s"?c.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:c.jsx(ye.Text,{type:"number",placeholder:o("Lag"),value:I.link.lag,disabled:z&&h?.unscheduled,onChange:q=>{q.input||g(I.link.id,{lag:q.value})}})}):null,c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:c.jsx(ye.Combo,{value:I.link.type,placeholder:o("Select link type"),options:f,onChange:q=>g(I.link.id,{type:q.value}),children:({option:q})=>q.label})})}),c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>O(I.link.id),role:"button"})})]},I.link.id))})})})},J):null)})}function rs(s){const{value:n,time:r,format:i,onchange:o,onChange:D,...h}=s,l=D??o;function d(z){const p=new Date(z.value);p.setHours(n.getHours()),p.setMinutes(n.getMinutes()),l&&l({value:p})}return c.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[c.jsx(ye.DatePicker,{...h,value:n,onChange:d,format:i,buttons:["today"],clear:!1}),r?c.jsx(ye.TimePicker,{value:n,onChange:l,format:i}):null]})}_e.registerEditorItem("select",ye.RichSelect);_e.registerEditorItem("date",rs);_e.registerEditorItem("twostate",ye.TwoState);_e.registerEditorItem("slider",ye.Slider);_e.registerEditorItem("counter",ye.Counter);_e.registerEditorItem("links",ns);function os({api:s,items:n=[],css:r="",layout:i="default",readonly:o=!1,placement:D="sidebar",bottomBar:h=!0,topBar:l=!0,autoSave:d=!0,focus:z=!1,hotkeys:p={}}){const Z=e.useContext(ye.context.i18n),R=e.useMemo(()=>Z||ve.locale({...Be.en,...Ze.en}),[Z]),f=e.useMemo(()=>R.getGroup("gantt"),[R]),O=R.getRaw(),g=e.useMemo(()=>{const k=O.gantt?.dateFormat||O.formats?.dateFormat;return ve.dateToString(k,O.calendar)},[O]),j=e.useMemo(()=>{if(l===!0&&!o){const k=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:f("Delete"),id:"delete"}];return d?{items:k}:{items:[...k,{comp:"button",type:"primary",text:f("Save"),id:"save"}]}}return l},[l,o,d,f]),[J,I]=e.useState(!1),q=e.useMemo(()=>J?"wx-full-screen":"",[J]),E=e.useCallback(k=>{I(k)},[]);e.useEffect(()=>{const k=wt(E);return k.observe(),()=>{k.disconnect()}},[E]);const X=S.useStore(s,"_activeTask"),w=S.useStore(s,"activeTask"),te=S.useStore(s,"unscheduledTasks"),F=S.useStore(s,"links"),me=S.useStore(s,"splitTasks"),N=e.useMemo(()=>me&&w?.segmentIndex,[me,w]),de=e.useMemo(()=>N||N===0,[N]),re=e.useMemo(()=>pe.getEditorItems({unscheduledTasks:te}),[te]),m=S.useStore(s,"undo"),[M,P]=e.useState({}),[ae,se]=e.useState(null),[oe,fe]=e.useState(),[he,Re]=e.useState(null),Ce=S.useStore(s,"taskTypes"),je=e.useMemo(()=>{if(!X)return null;let k;if(de&&X.segments?k={...X.segments[N]}:k={...X},o){let ne={parent:k.parent};return re.forEach(({key:xe,comp:Y})=>{if(Y!=="links"){const Q=k[xe];Y==="date"&&Q instanceof Date?ne[xe]=g(Q):Y==="slider"&&xe==="progress"?ne[xe]=`${Q}%`:ne[xe]=Q}}),ne}return k||null},[X,de,N,o,re,g]);e.useEffect(()=>{fe(je)},[je]),e.useEffect(()=>{P({}),Re(null),se(null)},[w]);function Ee(k,ne){return k.map(xe=>{const Y={...xe};if(xe.config&&(Y.config={...Y.config}),Y.comp==="links"&&s&&(Y.api=s,Y.autoSave=d,Y.onLinksChange=W),Y.comp==="select"&&Y.key==="type"){const Q=Y.options??(Ce||[]);Y.options=Q.map(ge=>({...ge,label:f(ge.label)}))}return Y.comp==="slider"&&Y.key==="progress"&&(Y.labelTemplate=Q=>`${f(Y.label)} ${Q}%`),Y.label&&(Y.label=f(Y.label)),Y.config?.placeholder&&(Y.config.placeholder=f(Y.config.placeholder)),ne&&(Y.isDisabled&&Y.isDisabled(ne,s.getState())?Y.disabled=!0:delete Y.disabled),Y})}const G=e.useMemo(()=>{let k=n.length?n:re;return k=Ee(k,oe),oe?k.filter(ne=>!ne.isHidden||!ne.isHidden(oe,s.getState())):k},[n,re,oe,Ce,f,s,d]),b=e.useMemo(()=>G.map(k=>k.key),[G]);function W({id:k,action:ne,data:xe}){P(Y=>({...Y,[k]:{action:ne,data:xe}}))}const K=e.useCallback(()=>{for(let k in M)if(F.byId(k)){const{action:ne,data:xe}=M[k];s.exec(ne,xe)}},[s,M,F]),B=e.useCallback(()=>{const k=w?.id||w;if(de){if(X?.segments){const ne=X.segments.filter((xe,Y)=>Y!==N);s.exec("update-task",{id:k,task:{segments:ne}})}}else s.exec("delete-task",{id:k})},[s,w,de,X,N]),V=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),ce=e.useCallback(k=>{const{item:ne,changes:xe}=k;ne.id==="delete"&&B(),ne.id==="save"&&(xe.length?V():K()),ne.comp&&V()},[s,w,d,K,B,V]),le=e.useCallback((k,ne,xe)=>(te&&k.type==="summary"&&(k.unscheduled=!1),pe.prepareEditTask(k,s.getState(),ne),xe||se(!1),k),[te,s]),T=e.useCallback(k=>{k={...k,unscheduled:te&&k.unscheduled&&k.type!=="summary"},delete k.links,delete k.data,(b.indexOf("duration")===-1||k.segments&&!k.duration)&&delete k.duration;const ne={id:w?.id||w,task:k,...de&&{segmentIndex:N}};d&&ae&&(ne.inProgress=ae),s.exec("update-task",ne),d||K()},[s,w,te,d,K,b,de,N,ae]),U=e.useCallback(k=>{let{update:ne,key:xe,input:Y}=k;if(Y&&se(!0),k.update=le({...ne},xe,Y),!d)fe(k.update);else if(!he&&!Y){const Q=G.find($e=>$e.key===xe),ge=ne[xe];(!Q.validation||Q.validation(ge))&&(!Q.required||ge)&&T(k.update)}},[d,le,he,G,T]),ue=e.useCallback(k=>{d||T(k.values)},[d,T]),ie=e.useCallback(k=>{Re(k.errors)},[]),Le=e.useMemo(()=>m?{"ctrl+z":k=>{k.preventDefault(),s.exec("undo")},"ctrl+y":k=>{k.preventDefault(),s.exec("redo")}}:{},[m,s]);return je?c.jsx(ye.Locale,{children:c.jsx(_e.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${q} ${r}`,items:G,values:je,topBar:j,bottomBar:h,placement:D,layout:i,readonly:o,autoSave:d,focus:z,onAction:ce,onSave:ue,onValidation:ie,onChange:U,hotkeys:p&&{...Le,...p}})}):null}const ls=({children:s,columns:n=null,api:r})=>{const[i,o]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(o)},[r]),c.jsx(gt.HeaderMenu,{api:i,columns:n,children:s})};function cs(s){const{api:n,content:r,children:i}=s,o=e.useRef(null),D=e.useRef(null),[h,l]=e.useState({}),[d,z]=e.useState(null),[p,Z]=e.useState({});function R(E){for(;E;){if(E.getAttribute){const X=E.getAttribute("data-tooltip-id"),w=E.getAttribute("data-tooltip-at"),te=E.getAttribute("data-tooltip");if(X||te)return{id:X,tooltip:te,target:E,at:w}}E=E.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const E=D.current;if(E&&p&&(p.text||r)){const X=E.getBoundingClientRect();let w=!1,te=p.left,F=p.top;X.right>=h.right&&(te=h.width-X.width-5,w=!0),X.bottom>=h.bottom&&(F=p.top-(X.bottom-h.bottom+2),w=!0),w&&Z(me=>me&&{...me,left:te,top:F})}},[p,h,r]);const f=e.useRef(null),O=300,g=E=>{clearTimeout(f.current),f.current=setTimeout(()=>{E()},O)};function j(E){let{id:X,tooltip:w,target:te,at:F}=R(E.target);if(Z(null),z(null),!w)if(X)w=I(X);else{clearTimeout(f.current);return}const me=E.clientX;g(()=>{X&&z(J(q(X)));const N=te.getBoundingClientRect(),de=o.current,re=de?de.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let m,M;F==="left"?(m=N.top+5-re.top,M=N.right+5-re.left):(m=N.top+N.height-re.top,M=me-re.left),l(re),Z({top:m,left:M,text:w})})}function J(E){return n?.getTask(q(E))||null}function I(E){return J(E)?.text||""}function q(E){const X=parseInt(E);return isNaN(X)?E:X}return c.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:o,onMouseMove:j,children:[p&&(p.text||r)?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:D,style:{top:`${p.top}px`,left:`${p.left}px`},children:r?c.jsx(r,{data:d}):p.text?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:p.text}):null}):null,i]})}function is({fonts:s=!0,children:n}){return n?c.jsx(ye.Material,{fonts:s,children:n()}):c.jsx(ye.Material,{fonts:s})}function as({fonts:s=!0,children:n}){return n?c.jsx(ye.Willow,{fonts:s,children:n}):c.jsx(ye.Willow,{fonts:s})}function us({fonts:s=!0,children:n}){return n?c.jsx(ye.WillowDark,{fonts:s,children:n}):c.jsx(ye.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>pe.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>pe.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>pe.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>pe.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>pe.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>pe.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>pe.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>pe.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>pe.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>_e.registerEditorItem});exports.ContextMenu=ss;exports.Editor=os;exports.Gantt=es;exports.HeaderMenu=ls;exports.Material=is;exports.Toolbar=ts;exports.Tooltip=cs;exports.Willow=as;exports.WillowDark=us;
//# sourceMappingURL=index.cjs.map
