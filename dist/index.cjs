"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("react/jsx-runtime"),e=require("react"),ye=require("@svar-ui/react-core"),Ee=require("@svar-ui/lib-dom"),Ke=require("@svar-ui/gantt-locales"),Je=require("@svar-ui/core-locales"),jt=require("@svar-ui/lib-state"),we=require("@svar-ui/gantt-store"),j=require("@svar-ui/lib-react"),gt=require("@svar-ui/grid-store"),wt=require("@svar-ui/react-grid"),$t=require("react-dom"),ut=require("@svar-ui/react-toolbar"),Dt=require("@svar-ui/react-menu"),ze=require("@svar-ui/react-editor"),Ge=e.createContext(null);function Oe(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function It(s,n,r){const i=s.getBoundingClientRect(),l=n.querySelector(".wx-body").getBoundingClientRect();return{top:i.top-l.top,left:i.left-l.left,dt:i.bottom-r.clientY,db:r.clientY-i.top}}function dt(s){return s&&s.getAttribute("data-context-id")}const ft=5;function Lt(s,n){let r,i,l,I,h,v,o,y,k;function F(S){I=S.clientX,h=S.clientY,v={...It(r,s,S),y:n.getTask(l).$y},document.body.style.userSelect="none"}function Y(S){r=Ee.locate(S),dt(r)&&(l=Oe(r),k=setTimeout(()=>{y=!0,n&&n.touchStart&&n.touchStart(),F(S.touches[0])},500),s.addEventListener("touchmove",A),s.addEventListener("contextmenu",M),window.addEventListener("touchend",K))}function M(S){if(y||k)return S.preventDefault(),!1}function w(S){S.which===1&&(r=Ee.locate(S),dt(r)&&(l=Oe(r),s.addEventListener("mousemove",H),window.addEventListener("mouseup",T),F(S)))}function f(S){s.removeEventListener("mousemove",H),s.removeEventListener("touchmove",A),document.body.removeEventListener("mouseup",T),document.body.removeEventListener("touchend",K),document.body.style.userSelect="",S&&(s.removeEventListener("mousedown",w),s.removeEventListener("touchstart",Y))}function U(S){const V=S.clientX-I,ne=S.clientY-h;if(!i){if(Math.abs(V)<ft&&Math.abs(ne)<ft||n&&n.start&&n.start({id:l,e:S})===!1)return;i=r.cloneNode(!0),i.style.pointerEvents="none",i.classList.add("wx-reorder-task"),i.style.position="absolute",i.style.left=v.left+"px",i.style.top=v.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(i,r)}if(i){const Q=Math.round(Math.max(0,v.top+ne));if(n&&n.move&&n.move({id:l,top:Q,detail:o})===!1)return;const ae=n.getTask(l),X=ae.$y;if(!v.start&&v.y==X)return N();v.start=!0,v.y=ae.$y-4,i.style.top=Q+"px";const ce=document.elementFromPoint(S.clientX,S.clientY),E=Ee.locate(ce);if(E&&E!==r){const x=Oe(E),z=E.getBoundingClientRect(),te=z.top+z.height/2,ue=S.clientY+v.db>te&&E.nextElementSibling!==r,re=S.clientY-v.dt<te&&E.previousElementSibling!==r;o?.after==x||o?.before==x?o=null:ue?o={id:l,after:x}:re&&(o={id:l,before:x})}}}function H(S){U(S)}function A(S){y?(S.preventDefault(),U(S.touches[0])):k&&(clearTimeout(k),k=null)}function K(){y=null,k&&(clearTimeout(k),k=null),N()}function T(){N()}function N(){r&&(r.style.visibility=""),i&&(i.parentNode.removeChild(i),n&&n.end&&n.end({id:l,top:v.top})),l=r=i=v=o=null,f()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",w),s.addEventListener("touchstart",Y),{destroy(){f(!0)}}}function Nt({row:s,column:n}){function r(l,I){return{justifyContent:I.align,paddingLeft:`${(l.$level-1)*20}px`}}const i=n&&n._cell;return c.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?c.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):c.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),c.jsx("div",{className:"wx-pqc08MHU wx-text",children:i?c.jsx(i,{row:s,column:n}):s.text})]})}function xt({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?c.jsx("div",{style:{textAlign:s.align},children:c.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function Pt(s){const{readonly:n,compactMode:r,width:i=0,display:l="all",columnWidth:I=0,onTableAPIChange:h,multiTaskRows:v=!1,rowMapping:o=null}=s,[y,k]=j.useWritableProp(I),[F,Y]=e.useState(),M=e.useContext(ye.context.i18n),w=e.useMemo(()=>M.getGroup("gantt"),[M]),f=e.useContext(Ge),U=j.useStore(f,"scrollTop"),H=j.useStore(f,"cellHeight"),A=j.useStore(f,"_scrollTask"),K=j.useStore(f,"_selected"),T=j.useStore(f,"area"),N=j.useStore(f,"_tasks"),S=j.useStore(f,"_scales"),V=j.useStore(f,"columns"),ne=j.useStore(f,"_sort"),Q=j.useStore(f,"calendar"),ae=j.useStore(f,"durationUnit"),X=j.useStore(f,"splitTasks"),[ce,E]=e.useState(null),x=e.useMemo(()=>!N||!T?[]:v&&o?N:N.slice(T.start,T.end),[N,T,v,o]),z=e.useCallback((a,b)=>{if(b==="add-task")f.exec(b,{target:a,task:{text:w("New Task")},mode:"child",show:!0});else if(b==="open-task"){const $=x.find(_=>_.id===a);($?.data||$?.lazy)&&f.exec(b,{id:a,mode:!$.open})}},[x]),te=e.useCallback(a=>{const b=Ee.locateID(a),$=a.target.dataset.action;$&&a.preventDefault(),b?$==="add-task"||$==="open-task"?z(b,$):f.exec("select-task",{id:b,toggle:a.ctrlKey||a.metaKey,range:a.shiftKey,show:!0}):$==="add-task"&&z(null,$)},[f,z]),ue=e.useRef(null),re=e.useRef(null),[ie,ke]=e.useState(0),[Re,De]=e.useState(!1);e.useEffect(()=>{const a=re.current;if(!a||typeof ResizeObserver>"u")return;const b=()=>ke(a.clientWidth);b();const $=new ResizeObserver(b);return $.observe(a),()=>$.disconnect()},[]);const Me=e.useRef(null),Le=e.useCallback(a=>{const b=a.id,{before:$,after:_}=a,he=a.onMove;let me=$||_,$e=$?"before":"after";if(he){if($e==="after"){const He=f.getTask(me);He.data?.length&&He.open&&($e="before",me=He.data[0].id)}Me.current={id:b,[$e]:me}}else Me.current=null;f.exec("move-task",{id:b,mode:$e,target:me,inProgress:he})},[f]),pe=e.useMemo(()=>v&&o?0:T?.from??0,[T,v,o]),ee=e.useMemo(()=>S?.height??0,[S]),p=e.useMemo(()=>!r&&l!=="grid"?(y??0)>(i??0):(y??0)>(ie??0),[r,l,y,i,ie]),P=e.useMemo(()=>{const a={};return p&&l==="all"||l==="grid"&&p?a.width=y:l==="grid"&&(a.width="100%"),a},[p,l,y]),B=e.useMemo(()=>ce&&!x.find(a=>a.id===ce.id)?[...x,ce]:x,[x,ce]),q=e.useMemo(()=>{if(!v||!o)return B;const a=new Map,b=new Set;return B.forEach($=>{const _=o.taskRows.get($.id)??$.id;b.has(_)||(a.set(_,{...$,$rowTasks:o.rowMap.get(_)||[$.id]}),b.add(_))}),Array.from(a.values())},[B,v,o]),G=e.useMemo(()=>{let a=(V||[]).map(_=>{_={..._};const he=_.header;if(typeof he=="object"){const me=he.text&&w(he.text);_.header={...he,text:me}}else _.header=w(he);return _});const b=a.findIndex(_=>_.id==="text"),$=a.findIndex(_=>_.id==="add-task");if(b!==-1&&(a[b].cell&&(a[b]._cell=a[b].cell),a[b].cell=Nt),$!==-1){a[$].cell=a[$].cell||xt;const _=a[$].header;if(typeof _!="object"&&(a[$].header={text:_}),a[$].header.cell=_.cell||xt,n)a.splice($,1);else if(r){const[he]=a.splice($,1);a.unshift(he)}}return a.length>0&&(a[a.length-1].resize=!1),a},[V,w,n,r]),ge=e.useMemo(()=>l==="all"?`${i}px`:l==="grid"?"calc(100% - 4px)":G.find(a=>a.id==="add-task")?"50px":"0",[l,i,G]),oe=e.useMemo(()=>{if(q&&ne?.length){const a={};return ne.forEach(({key:b,order:$},_)=>{a[b]={order:$,...ne.length>1&&{index:_}}}),a}return{}},[q,ne]),C=e.useCallback(()=>G.some(a=>a.flexgrow&&!a.hidden),[]),Z=e.useMemo(()=>C(),[C,Re]),de=e.useMemo(()=>{let a=l==="chart"?G.filter($=>$.id==="add-task"):G;const b=l==="all"?i:ie;if(!Z){let $=y,_=!1;if(G.some(he=>he.$width)){let he=0;$=G.reduce((me,$e)=>($e.hidden||(he+=$e.width,me+=$e.$width||$e.width),me),0),he>$&&$>b&&(_=!0)}if(_||$<b){let he=1;return _||(he=(b-50)/($-50||1)),a.map(me=>(me.id!=="add-task"&&!me.hidden&&(me.$width||(me.$width=me.width),me.width=me.$width*he),me))}}return a},[l,G,Z,y,i,ie]),fe=e.useCallback(a=>{if(!C()){const b=de.reduce(($,_)=>(a&&_.$width&&(_.$width=_.width),$+(_.hidden?0:_.width)),0);b!==y&&k(b)}De(!0),De(!1)},[C,de,y,k]),m=e.useCallback(()=>{G.filter(b=>b.flexgrow&&!b.hidden).length===1&&G.forEach(b=>{b.$width&&!b.flexgrow&&!b.hidden&&(b.width=b.$width)})},[]),le=e.useCallback(a=>{if(!n){const b=Ee.locateID(a),$=Ee.locateAttr(a,"data-col-id");!($&&G.find(he=>he.id==$))?.editor&&b&&f.exec("show-editor",{id:b})}},[f,n]),xe=e.useMemo(()=>Array.isArray(K)?K.map(a=>a.id):[],[K]),O=e.useRef(pe);O.current=pe,e.useEffect(()=>{const a=$=>{if(ue.current){const _=ue.current.querySelector(".wx-body");_&&(_.style.top=-(($??0)-(O.current??0))+"px")}re.current&&(re.current.scrollTop=0)};return a(U),f.on("scroll-chart",({top:$})=>{$!==void 0&&a($)})},[f,U]),e.useEffect(()=>{if(ue.current){const a=ue.current.querySelector(".wx-body");a&&(a.style.top=-((U??0)-(pe??0))+"px")}},[pe]),e.useEffect(()=>{const a=ue.current;if(!a)return;const b=a.querySelector(".wx-table-box .wx-body");if(!b||typeof ResizeObserver>"u")return;const $=new ResizeObserver(()=>{if(ue.current){const _=ue.current.querySelector(".wx-body");_&&(_.style.top=-((U??0)-(O.current??0))+"px")}});return $.observe(b),()=>{$.disconnect()}},[de,P,l,ge,q,U]),e.useEffect(()=>{if(!A||!F)return;const{id:a}=A,b=F.getState().focusCell;b&&b.row!==a&&ue.current&&ue.current.contains(document.activeElement)&&F.exec("focus-cell",{row:a,column:b.column})},[A,F]);const Te=e.useCallback(({id:a})=>{if(n)return!1;f.getTask(a).open&&f.exec("open-task",{id:a,mode:!1});const b=f.getState()._tasks.find($=>$.id===a);if(E(b||null),!b)return!1},[f,n]),se=e.useCallback(({id:a,top:b})=>{Me.current?Le({...Me.current,onMove:!1}):f.exec("drag-task",{id:a,top:b+(pe??0),inProgress:!1}),E(null)},[f,Le,pe]),Ce=e.useCallback(({id:a,top:b,detail:$})=>{$&&Le({...$,onMove:!0}),f.exec("drag-task",{id:a,top:b+(pe??0),inProgress:!0})},[f,Le,pe]);e.useEffect(()=>{const a=ue.current;return a?Lt(a,{start:Te,end:se,move:Ce,getTask:f.getTask}).destroy:void 0},[f,Te,se,Ce]);const be=e.useCallback(a=>{const{key:b,isInput:$}=a;if(!$&&(b==="arrowup"||b==="arrowdown"))return a.eventSource="grid",f.exec("hotkey",a),!1;if(b==="enter"){const _=F?.getState().focusCell;if(_){const{row:he,column:me}=_;me==="add-task"?z(he,"add-task"):me==="text"&&z(he,"open-task")}}},[f,z,F]),Se=e.useRef(null),Ne=()=>{Se.current={setTableAPI:Y,handleHotkey:be,sortVal:ne,api:f,adjustColumns:m,setColumnWidth:fe,tasks:x,calendarVal:Q,durationUnitVal:ae,splitTasksVal:X,onTableAPIChange:h}};Ne(),e.useEffect(()=>{Ne()},[Y,be,ne,f,m,fe,x,Q,ae,X,h]);const We=e.useCallback(a=>{Y(a),a.intercept("hotkey",b=>Se.current.handleHotkey(b)),a.intercept("scroll",()=>!1),a.intercept("select-row",()=>!1),a.intercept("sort-rows",b=>{const $=Se.current.sortVal,{key:_,add:he}=b,me=$?$.find(He=>He.key===_):null;let $e="asc";return me&&($e=!me||me.order==="asc"?"desc":"asc"),f.exec("sort-tasks",{key:_,order:$e,add:he}),!1}),a.on("resize-column",()=>{Se.current.setColumnWidth(!0)}),a.on("hide-column",b=>{b.mode||Se.current.adjustColumns(),Se.current.setColumnWidth()}),a.intercept("update-cell",b=>{const{id:$,column:_,value:he}=b,me=Se.current.tasks.find($e=>$e.id===$);if(me){const $e={...me};let He=he;He&&!isNaN(He)&&!(He instanceof Date)&&(He*=1),$e[_]=He,we.prepareEditTask($e,{calendar:Se.current.calendarVal,durationUnit:Se.current.durationUnitVal,splitTasks:Se.current.splitTasksVal},_),f.exec("update-task",{id:$,task:$e})}return!1}),h&&h(a)},[]);return c.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ge}`},ref:re,children:c.jsx("div",{ref:ue,style:P,className:"wx-rHj6070p wx-table",onClick:te,onDoubleClick:le,children:c.jsx(wt.Grid,{init:We,sizes:{rowHeight:H,headerHeight:(ee??0)-1},rowStyle:a=>a.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:a=>`wx-rHj6070p wx-text-${a.align}${a.id==="add-task"?" wx-action":""}`,data:q,columns:de,selectedRows:[...xe],sortMarks:oe})})})}function Wt({borders:s=""}){const n=e.useContext(Ge),r=j.useStore(n,"cellWidth"),i=j.useStore(n,"cellHeight"),l=e.useRef(null),[I,h]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&l.current){const o=getComputedStyle(l.current).getPropertyValue("--wx-gantt-border");h(o?o.substring(o.indexOf("#")):"#1d1e261a")}},[]);const v={width:"100%",height:"100%",background:r!=null&&i!=null?`url(${we.grid(r,i,I,s)})`:void 0,position:"absolute",pointerEvents:"none"};return c.jsx("div",{ref:l,style:v})}function Ht({onSelectLink:s,selectedLink:n,readonly:r}){const i=e.useContext(Ge),l=j.useStore(i,"_links"),I=j.useStore(i,"criticalPath"),h=e.useRef(null),v=e.useCallback(o=>{const y=o?.target?.classList;!y?.contains("wx-line")&&!y?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&h.current){const o=y=>{h.current&&!h.current.contains(y.target)&&v(y)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}}},[r,n,v]),c.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(l||[]).map(o=>{const y="wx-dkx3NwEn wx-line"+(I&&o.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return c.jsx("polyline",{className:y,points:o.$p,onClick:()=>!r&&s(o.id),"data-link-id":o.id},o.id)}),!r&&n&&c.jsx("polyline",{ref:h,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function At(s){const{task:n,type:r}=s;function i(I){const h=n.segments[I];return{left:`${h.$x}px`,top:"0px",width:`${h.$w}px`,height:"100%"}}function l(I){if(!n.progress)return 0;const h=n.duration*n.progress/100,v=n.segments;let o=0,y=0,k=null;do{const F=v[y];y===I&&(o>h?k=0:k=Math.min((h-o)/F.duration,1)*100),o+=F.duration,y++}while(k===null&&y<v.length);return k||0}return c.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map((I,h)=>c.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":h,style:i(h),children:[n.progress?c.jsx("div",{className:"wx-progress-wrapper",children:c.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${l(h)}%`}})}):null,c.jsx("div",{className:"wx-content",children:I.text||""})]},h))})}let Qe=[],Ze=null,ht=null;const mt=(s,n)=>{if(!n||!n.start)return null;const{start:r,lengthUnitWidth:i,lengthUnit:l}=n,I=864e5,h=l==="week"?7:l==="month"?30:l==="quarter"?91:l==="year"?365:1,v=Math.floor(s/i),o=new Date(r.getTime()+v*h*I);return o.setUTCHours(0,0,0,0),o},_t=(s,n,r)=>{if(!r||!s||!n)return 0;const{lengthUnit:i}=r,h=(i==="week"?7:i==="month"?30:i==="quarter"?91:i==="year"?365:1)*864e5;return Math.round((s.getTime()-n.getTime())/h)},zt=(s,n,r)=>{if(!r||!s)return s;const{lengthUnit:i}=r,h=(i==="week"?7:i==="month"?30:i==="quarter"?91:i==="year"?365:1)*864e5,v=new Date(s.getTime()+n*h);return v.setUTCHours(0,0,0,0),v},Gt=(s,n,r,i)=>s<i&&n>r;function Ot(s){const{readonly:n,taskTemplate:r,multiTaskRows:i=!1,rowMapping:l=null,marqueeSelect:I=!1,copyPaste:h=!1,allowTaskIntersection:v=!0}=s,o=e.useContext(Ge),[y,k]=j.useStoreWithCounter(o,"_tasks"),[F,Y]=j.useStoreWithCounter(o,"_links"),M=j.useStore(o,"area"),w=j.useStore(o,"_scales"),f=j.useStore(o,"taskTypes"),U=j.useStore(o,"baselines"),[H,A]=j.useStoreWithCounter(o,"_selected"),K=j.useStore(o,"_scrollTask"),T=j.useStore(o,"criticalPath"),N=j.useStore(o,"tasks"),S=j.useStore(o,"schedule"),V=j.useStore(o,"splitTasks"),ne=e.useMemo(()=>{if(!M||!Array.isArray(y))return[];const t=M.start??0,u=M.end??0;return i&&l?y.map(d=>({...d})):y.slice(t,u).map(d=>({...d}))},[k,M,i,l]),Q=j.useStore(o,"cellHeight"),ae=e.useMemo(()=>{if(!i||!l||!ne.length)return ne;const t=new Map,u=[];return y.forEach(d=>{const g=l.taskRows.get(d.id)??d.id;t.has(g)||(t.set(g,u.length),u.push(g))}),ne.map(d=>{const g=l.taskRows.get(d.id)??d.id,D=t.get(g)??0;return{...d,$y:D*Q,$y_base:d.$y_base!==void 0?D*Q:void 0}})},[ne,i,l,y,Q]),X=e.useMemo(()=>w.lengthUnitWidth,[w]),ce=e.useMemo(()=>w.lengthUnit||"day",[w]),E=e.useRef(!1),[x,z]=e.useState(void 0),[te,ue]=e.useState(null),re=e.useRef(null),[ie,ke]=e.useState(null),[Re,De]=e.useState(void 0),Me=e.useRef(null),[Le,pe]=e.useState(0),[ee,p]=e.useState(null),P=e.useRef(null),[B,q]=e.useState(null),[G,ge]=e.useState(null),[oe,C]=e.useState(null),Z=e.useRef(null);Z.current=G;const de=e.useRef(200),fe=e.useRef(null),m=e.useMemo(()=>{const t=fe.current;return!!(H.length&&t&&t.contains(document.activeElement))},[H,fe.current]),le=e.useMemo(()=>m&&H[H.length-1]?.id,[m,H]);e.useEffect(()=>{if(K&&m&&K){const{id:t}=K,u=fe.current?.querySelector(`.wx-bar[data-id='${t}']`);u&&u.focus({preventScroll:!0})}},[K]),e.useEffect(()=>{const t=fe.current;if(t&&(pe(t.offsetWidth||0),typeof ResizeObserver<"u")){const u=new ResizeObserver(d=>{d[0]&&pe(d[0].contentRect.width)});return u.observe(t),()=>u.disconnect()}},[fe.current]);const xe=e.useCallback(()=>{document.body.style.userSelect="none"},[]),O=e.useCallback(()=>{document.body.style.userSelect=""},[]),Te=e.useCallback((t,u,d)=>{if(u.target.classList.contains("wx-line")||(d||(d=o.getTask(Oe(t))),d.type==="milestone"||d.type==="summary"))return"";const g=Ee.locate(u,"data-segment");g&&(t=g);const{left:D,width:R}=t.getBoundingClientRect(),L=(u.clientX-D)/R;let W=.2/(R>200?R/200:1);return L<W?"start":L>1-W?"end":""},[o]),se=e.useMemo(()=>{const t=new Set;if(v||!i||!l)return t;const u=new Map;return y.forEach(d=>{if(d.type==="summary"||d.type==="milestone")return;const g=l.taskRows.get(d.id)??d.id;u.has(g)||u.set(g,[]),u.get(g).push(d)}),u.forEach(d=>{if(!(d.length<2))for(let g=0;g<d.length;g++)for(let D=g+1;D<d.length;D++){const R=d[g],L=d[D],W=R.$x,J=R.$x+R.$w,ve=L.$x,je=L.$x+L.$w;Gt(W,J,ve,je)&&(t.add(R.id),t.add(L.id))}}),t},[v,i,l,y,k]),Ce=e.useMemo(()=>{const t=new Map;if(!i||!l)return y.forEach(g=>{t.set(g.id,g.$y)}),t;const u=new Map,d=[];return y.forEach(g=>{const D=l.taskRows.get(g.id)??g.id;u.has(D)||(u.set(D,d.length),d.push(D))}),y.forEach(g=>{const D=l.taskRows.get(g.id)??g.id,R=u.get(D)??0;t.set(g.id,R*Q)}),t},[y,i,l,Q]),be=e.useMemo(()=>{const t=new Map;if(!i||!l)return y.forEach(g=>{t.set(g.id,g.$y),g.row!==void 0&&t.set(g.row,g.$y)}),t;const u=new Map,d=[];return y.forEach(g=>{const D=l.taskRows.get(g.id)??g.id;u.has(D)||(u.set(D,d.length),d.push(D))}),u.forEach((g,D)=>{t.set(D,g*Q)}),t},[y,i,l,Q]),Se=e.useCallback(t=>{if(!fe.current)return[];const d=Math.min(t.startX,t.currentX),g=Math.max(t.startX,t.currentX),D=Math.min(t.startY,t.currentY),R=Math.max(t.startY,t.currentY);return y.filter(L=>{const W=L.$x,J=L.$x+L.$w,je=Ce.get(L.id)??L.$y,Pe=je+L.$h;return W<g&&J>d&&je<R&&Pe>D})},[y,Ce]),Ne=e.useMemo(()=>new Set(H.map(t=>t.id)),[H,A]),We=e.useCallback(t=>Ne.has(t),[Ne]),a=e.useCallback((t,u)=>{const{clientX:d}=u,g=Oe(t),D=o.getTask(g),R=u.target.classList;if(!u.target.closest(".wx-delete-button")&&!n){if(R.contains("wx-progress-marker")){const{progress:L}=o.getTask(g);re.current={id:g,x:d,progress:L,dx:0,node:t,marker:u.target},u.target.classList.add("wx-progress-in-drag")}else{const L=Te(t,u,D)||"move",W={id:g,mode:L,x:d,dx:0,l:D.$x,w:D.$w};if(V&&D.segments?.length){const J=Ee.locate(u,"data-segment");J&&(W.segmentIndex=J.dataset.segment*1,we.extendDragOptions(D,W))}ue(W)}xe()}},[o,n,Te,xe,V]),b=e.useCallback(t=>{if(t.button!==0||oe)return;const u=Ee.locate(t);if(!u&&I&&!n){const d=fe.current;if(!d)return;const g=d.getBoundingClientRect(),D=t.clientX-g.left,R=t.clientY-g.top;if(h){const W=mt(D,w);W&&(Z.current=W,ge(W))}const L={startX:D,startY:R,currentX:D,currentY:R,ctrlKey:t.ctrlKey||t.metaKey};p(L),P.current=L,xe();return}if(u){if(I&&!n&&H.length>1){const d=Oe(u);if(We(d)){const g=t.target.classList;if(!g.contains("wx-link")&&!g.contains("wx-progress-marker")&&!t.target.closest(".wx-delete-button")){const D=o.getTask(d);if(!Te(u,t,D)){const L=new Map;H.forEach(W=>{const J=o.getTask(W.id);if(J){if(S?.auto&&J.type==="summary")return;L.set(W.id,{$x:J.$x,$w:J.$w,start:J.start,end:J.end})}}),q({baseTaskId:d,startX:t.clientX,dx:0,originalPositions:L}),xe();return}}}}a(u,t)}},[a,I,h,n,H,We,o,Te,S,xe,w,oe]),$=e.useCallback(t=>{const u=Ee.locate(t);u&&(Me.current=setTimeout(()=>{De(!0),a(u,t.touches[0])},300))},[a]),_=e.useCallback(t=>{ke(t&&{...F.find(u=>u.id===t)})},[F]),he=e.useCallback(()=>{const t=P.current;if(t){const u=Se(t);t.ctrlKey?u.forEach(d=>{o.exec("select-task",{id:d.id,toggle:!0,marquee:!0})}):(H.length>0&&o.exec("select-task",{id:null,marquee:!0}),u.forEach((d,g)=>{o.exec("select-task",{id:d.id,toggle:g>0,marquee:!0})})),p(null),P.current=null,O(),E.current=!0;return}if(B){const{dx:u,originalPositions:d}=B,g=Math.round(u/X);if(g!==0){let D=!0;d.forEach((R,L)=>{const W=o.getTask(L);W&&(o.exec("update-task",{id:L,diff:g,task:{start:W.start,end:W.end},skipUndo:!D}),D=!1)}),E.current=!0}else d.forEach((D,R)=>{o.exec("drag-task",{id:R,left:D.$x,width:D.$w,inProgress:!1})});q(null),O();return}if(re.current){const{dx:u,id:d,marker:g,value:D}=re.current;re.current=null,typeof D<"u"&&u&&o.exec("update-task",{id:d,task:{progress:D},inProgress:!1}),g.classList.remove("wx-progress-in-drag"),E.current=!0,O()}else if(te){const{id:u,mode:d,dx:g,l:D,w:R,start:L,segment:W,index:J}=te;if(ue(null),L){const ve=Math.round(g/X);if(!ve)o.exec("drag-task",{id:u,width:R,left:D,inProgress:!1,...W&&{segmentIndex:J}});else{let je={},Pe=o.getTask(u);W&&(Pe=Pe.segments[J]);const _e=1440*60*1e3,Ie=ve*(ce==="week"?7:ce==="month"?30:ce==="quarter"?91:ce==="year"?365:1)*_e;d==="move"?(je.start=new Date(Pe.start.getTime()+Ie),je.end=new Date(Pe.end.getTime()+Ie)):d==="start"?(je.start=new Date(Pe.start.getTime()+Ie),je.end=Pe.end):d==="end"&&(je.start=Pe.start,je.end=new Date(Pe.end.getTime()+Ie)),o.exec("update-task",{id:u,task:je,...W&&{segmentIndex:J}})}E.current=!0}O()}},[o,O,te,X,ce,ee,B,Se,H]),me=e.useCallback((t,u)=>{const{clientX:d,clientY:g}=u,D=fe.current;if(D){const R=D.getBoundingClientRect();de.current=d-R.left}if(oe){if(!D)return;const R=D.getBoundingClientRect(),L=d-R.left;C(W=>({...W,currentX:L}));return}if(!n){if(ee){const R=fe.current;if(!R)return;const L=R.getBoundingClientRect(),W=d-L.left,J=g-L.top;p(ve=>({...ve,currentX:W,currentY:J})),P.current&&(P.current.currentX=W,P.current.currentY=J);return}if(B){const R=d-B.startX;B.originalPositions.forEach((L,W)=>{const J=L.$x+R;o.exec("drag-task",{id:W,left:J,width:L.$w,inProgress:!0})}),q(L=>({...L,dx:R}));return}if(re.current){const{node:R,x:L,id:W}=re.current,J=re.current.dx=d-L,ve=Math.round(J/R.offsetWidth*100);let je=re.current.progress+ve;re.current.value=je=Math.min(Math.max(0,je),100),o.exec("update-task",{id:W,task:{progress:je},inProgress:!0})}else if(te){_(null);const{mode:R,l:L,w:W,x:J,id:ve,start:je,segment:Pe,index:_e}=te,Ae=o.getTask(ve),Ie=d-J;if(!je&&Math.abs(Ie)<20||R==="start"&&W-Ie<X||R==="end"&&W+Ie<X||R==="move"&&(Ie<0&&L+Ie<0||Ie>0&&L+W+Ie>Le)||te.segment&&!we.isSegmentMoveAllowed(Ae,te))return;const Fe={...te,dx:Ie};let Ue,qe;if(R==="start"?(Ue=L+Ie,qe=W-Ie):R==="end"?(Ue=L,qe=W+Ie):R==="move"&&(Ue=L+Ie,qe=W),o.exec("drag-task",{id:ve,width:qe,left:Ue,inProgress:!0,...Pe&&{segmentIndex:_e}}),!Fe.start&&(R==="move"&&Ae.$x==L||R!=="move"&&Ae.$w==W)){E.current=!0,he();return}Fe.start=!0,ue(Fe)}else{const R=Ee.locate(t);if(R){const L=o.getTask(Oe(R)),J=Ee.locate(t,"data-segment")||R,ve=Te(J,u,L);J.style.cursor=ve&&!n?"col-resize":"pointer"}}}},[o,n,te,X,Le,Te,_,he,ee,B,oe]),$e=e.useCallback(t=>{me(t,t)},[me]),He=e.useCallback(t=>{Re?(t.preventDefault(),me(t,t.touches[0])):Me.current&&(clearTimeout(Me.current),Me.current=null)},[Re,me]),Be=e.useCallback(()=>{he()},[he]),bt=e.useCallback(()=>{De(null),Me.current&&(clearTimeout(Me.current),Me.current=null),he()},[he]);e.useEffect(()=>(window.addEventListener("mouseup",Be),()=>{window.removeEventListener("mouseup",Be)}),[Be]);const yt=e.useCallback(t=>{if(!n){const u=Ee.locateID(t.target);if(u&&!t.target.classList.contains("wx-link")){const d=Ee.locateID(t.target,"data-segment");o.exec("show-editor",{id:u,...d!==null&&{segmentIndex:d}})}}},[o,n]),Tt=["e2s","s2s","e2e","s2e"],Ye=e.useCallback((t,u)=>Tt[(t?1:0)+(u?0:2)],[]),Xe=e.useCallback((t,u)=>{const d=x.id,g=x.start;return t===d?!0:!!F.find(D=>D.target==t&&D.source==d&&D.type===Ye(g,u))},[x,Y,Ye]),et=e.useCallback(()=>{x&&z(null)},[x]),tt=e.useCallback((t,u,d)=>{if(!u.length||!t||d==null)return;const g=864e5,D=o.getHistory();D?.startBatch();const R=new Date(t),L=R.getUTCDay(),W=L===0?-6:1-L;R.setUTCDate(R.getUTCDate()+W),R.setUTCHours(0,0,0,0),u.forEach((J,ve)=>{const je=`task-${Date.now()}-${ve}`,Pe=zt(R,J._startCellOffset||0,w),_e=new Date(Pe.getTime()+(J._startDayOfWeek||0)*g);_e.setUTCHours(0,0,0,0);const Ae=new Date(_e.getTime()+(J._durationDays||7)*g);Ae.setUTCHours(0,0,0,0),console.log("[paste] task:",J.text,"newStart:",_e,"newEnd:",Ae,"_durationDays:",J._durationDays,"_startDayOfWeek:",J._startDayOfWeek),o.exec("add-task",{task:{id:je,text:J.text,start:_e,end:Ae,type:J.type||"task",parent:d,row:J.row},target:d,mode:"child",skipUndo:ve>0})}),D?.endBatch()},[o,w]),Ct=e.useCallback(t=>{if(E.current){E.current=!1;return}if(oe&&oe.currentX!=null){const d=mt(oe.currentX,w);d&&tt(d,oe.tasks,oe.parent),C(null);return}const u=Ee.locateID(t.target);if(u){const d=o.getTask(u),g=y.find(R=>R.id===u);console.log("[click] task:",d?.text,"id:",u),console.log("[click] api.getTask:",{start:d?.start,end:d?.end,duration:d?.duration}),console.log("[click] rendered:",{start:g?.start,end:g?.end,$w:g?.$w,$x:g?.$x});const D=t.target.classList;if(D.contains("wx-link")){const R=D.contains("wx-left");if(!x){z({id:u,start:R});return}x.id!==u&&!Xe(u,R)&&o.exec("add-link",{link:{source:x.id,target:u,type:Ye(x.start,R)}})}else if(D.contains("wx-delete-button-icon"))o.exec("delete-link",{id:ie.id}),ke(null);else{let R;const L=Ee.locate(t,"data-segment");L&&(R=L.dataset.segment*1),o.exec("select-task",{id:u,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:R})}}et()},[o,x,Y,ie,Xe,Ye,et,oe,w,tt]),vt=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),Mt=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),St=e.useCallback(t=>{if(Re||Me.current)return t.preventDefault(),!1},[Re]),st=e.useMemo(()=>f.map(t=>t.id),[f]),nt=e.useCallback(t=>{let u=st.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(u=`task ${u}`),u},[st]),rt=e.useCallback(t=>{o.exec(t.action,t.data)},[o]),Ve=e.useCallback(t=>T&&N.byId(t).$critical,[T,N]),ot=e.useCallback(t=>{if(S?.auto){const u=N.getSummaryId(t,!0),d=N.getSummaryId(x.id,!0);return x?.id&&!(Array.isArray(u)?u:[u]).includes(x.id)&&!(Array.isArray(d)?d:[d]).includes(t)}return x},[S,N,x]),lt=e.useCallback(()=>{const t=o.getState()._selected;if(!t||!t.length)return;const u=864e5,d=t.map(W=>{const J=o.getTask(W.id);if(!J)return null;const ve=y.find(Rt=>Rt.id===W.id);if(!ve)return null;const{$x:je,$y:Pe,$h:_e,$w:Ae,$skip:Ie,$level:Fe,$index:Ue,$y_base:qe,$x_base:hs,$w_base:ms,$h_base:gs,$skip_baseline:ws,$critical:ps,$reorder:ks,...Et}=ve,it=ve.end&&ve.start?Math.round((ve.end.getTime()-ve.start.getTime())/u):0,at=ve.start?(ve.start.getUTCDay()+6)%7:0;return console.log("[copy] task:",J.text,"durationDays:",it,"startDayOfWeek:",at,"$w:",Ae),{...Et,_durationDays:it,_startDayOfWeek:at,_originalWidth:Ae,_originalHeight:_e}}).filter(Boolean);if(!d.length)return;const D=d[0].parent,R=d.filter(W=>W.parent===D);if(R.length===0)return;const L=R.reduce((W,J)=>J.start&&(!W||J.start<W)?J.start:W,null);Qe=R.map(W=>({...W,_startCellOffset:_t(W.start,L,w)})),ht=D,Ze=L},[o,w]);e.useEffect(()=>h?o.intercept("hotkey",u=>{if(u.key==="ctrl+c"||u.key==="meta+c")return lt(),!1;if(u.key==="ctrl+v"||u.key==="meta+v")return!Qe.length||!Ze||C({tasks:Qe,baseDate:Ze,parent:ht,currentX:de.current}),!1}):void 0,[h,o,lt]),e.useEffect(()=>{if(!oe)return;const t=u=>{u.key==="Escape"&&(u.preventDefault(),u.stopPropagation(),C(null))};return document.addEventListener("keydown",t,!0),()=>document.removeEventListener("keydown",t,!0)},[oe]);const ct=e.useMemo(()=>{if(!ee)return null;const t=Math.min(ee.startX,ee.currentX),u=Math.min(ee.startY,ee.currentY),d=Math.abs(ee.currentX-ee.startX),g=Math.abs(ee.currentY-ee.startY);return{left:`${t}px`,top:`${u}px`,width:`${d}px`,height:`${g}px`}},[ee]);return c.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${ae.length?ae[0].$h:0}px`},ref:fe,onContextMenu:St,onMouseDown:b,onMouseMove:$e,onTouchStart:$,onTouchMove:He,onTouchEnd:bt,onClick:Ct,onDoubleClick:yt,onDragStart:t=>(t.preventDefault(),!1),children:[c.jsx(Ht,{onSelectLink:_,selectedLink:ie,readonly:n}),ae.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const u=se.has(t.id),d=`wx-bar wx-${nt(t.type)}`+(Re&&te&&t.id===te.id?" wx-touch":"")+(x&&x.id===t.id?" wx-selected":"")+(Ne.has(t.id)?" wx-selected":"")+(Ve(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(V&&t.segments?" wx-split":"")+(u?" wx-collision":""),g="wx-link wx-left"+(x?" wx-visible":"")+(!x||!Xe(t.id,!0)&&ot(t.id)?" wx-target":"")+(x&&x.id===t.id&&x.start?" wx-selected":"")+(Ve(t.id)?" wx-critical":""),D="wx-link wx-right"+(x?" wx-visible":"")+(!x||!Xe(t.id,!1)&&ot(t.id)?" wx-target":"")+(x&&x.id===t.id&&!x.start?" wx-selected":"")+(Ve(t.id)?" wx-critical":"");return c.jsxs(e.Fragment,{children:[!t.$skip&&c.jsxs("div",{className:"wx-GKbcLEGA "+d,style:vt(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:le===t.id?0:-1,children:[n?null:t.id===ie?.target&&ie?.type[2]==="s"?c.jsx(ye.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+g,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?c.jsxs(c.Fragment,{children:[t.progress&&!(V&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:c.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(V&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?c.jsx(r,{data:t,api:o,onAction:rt}):V&&t.segments?c.jsx(At,{task:t,type:nt(t.type)}):c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""}),u&&c.jsx("div",{className:"wx-GKbcLEGA wx-collision-warning",title:"This task overlaps with another task in the same row",children:"!"})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?c.jsx(r,{data:t,api:o,onAction:rt}):c.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===ie?.target&&ie?.type[2]==="e"?c.jsx(ye.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+D,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),U&&!t.$skip_baseline?c.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:Mt(t)}):null]},t.id)}),ee&&ct&&c.jsx("div",{className:"wx-GKbcLEGA wx-marquee-selection",style:ct}),oe&&oe.currentX!=null&&oe.tasks.map((t,u)=>{const g=(Math.floor(oe.currentX/X)+(t._startCellOffset||0))*X,D=t._originalWidth||X,R=t._originalHeight||Q,L=be.get(t.row)??(t.$y||0);return c.jsx("div",{className:"wx-GKbcLEGA wx-bar wx-task wx-paste-preview",style:{left:g,top:L,width:D,height:R},children:c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text})},`preview-${u}`)})]})}function Ut(s){const{highlightTime:n}=s,r=e.useContext(Ge),i=j.useStore(r,"_scales");return c.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:i.width},children:(i?.rows||[]).map((l,I)=>c.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${l.height}px`},children:(l.cells||[]).map((h,v)=>{const o=n?n(h.date,h.unit):"",y="wx-cell "+(h.css||"")+" "+(o||""),k=typeof h.value=="string"&&h.value.includes("<");return c.jsx("div",{className:"wx-ZkvhDKir "+y,style:{width:`${h.width}px`},...k?{dangerouslySetInnerHTML:{__html:h.value}}:{children:h.value}},v)})},I))})}const qt=new Map;function Yt(s){const n=e.useRef(null),r=e.useRef(0),i=e.useRef(null),l=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(l)return cancelAnimationFrame(i.current),i.current=requestAnimationFrame(()=>{const I={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};qt.set(s,I),window.dispatchEvent(new CustomEvent("render-metric",{detail:I}))}),()=>cancelAnimationFrame(i.current)})}function Xt(s){const{readonly:n,fullWidth:r,fullHeight:i,taskTemplate:l,cellBorders:I,highlightTime:h,multiTaskRows:v=!1,rowMapping:o=null,marqueeSelect:y=!1,copyPaste:k=!1,scrollToCurrentWeek:F=!1,currentWeekColor:Y=null,allowTaskIntersection:M=!0}=s,w=e.useContext(Ge),[f,U]=j.useStoreWithCounter(w,"_selected"),H=j.useStore(w,"scrollTop"),A=j.useStore(w,"cellHeight"),K=j.useStore(w,"cellWidth"),T=j.useStore(w,"_scales"),N=j.useStore(w,"_markers"),S=j.useStore(w,"_scrollTask"),V=j.useStore(w,"zoom"),ne=j.useStore(w,"_tasks"),[Q,ae]=e.useState(),X=e.useRef(null),ce=e.useRef(0),E=e.useRef(!1),x=1+(T?.rows?.length||0),z=e.useMemo(()=>{if(!v||!o||!ne?.length)return null;const p=new Map,P=new Map,B=[];return ne.forEach(q=>{const G=o.taskRows.get(q.id)??q.id;P.has(G)||(P.set(G,B.length),B.push(G))}),ne.forEach(q=>{const G=o.taskRows.get(q.id)??q.id,ge=P.get(G)??0;p.set(q.id,ge*A)}),p},[ne,v,o,A]),te=e.useMemo(()=>{const p=[];return f&&f.length&&A&&f.forEach(P=>{const B=z?.get(P.id)??P.$y;p.push({height:`${A}px`,top:`${B-3}px`})}),p},[U,A,z]),ue=e.useMemo(()=>Math.max(Q||0,i),[Q,i]);e.useEffect(()=>{const p=X.current;p&&typeof H=="number"&&(p.scrollTop=H)},[H]);const re=()=>{ie()};function ie(p){const P=X.current;if(!P)return;const B={};B.left=P.scrollLeft,w.exec("scroll-chart",B)}function ke(){const p=X.current,B=Math.ceil((Q||0)/(A||1))+1,q=Math.floor((p&&p.scrollTop||0)/(A||1)),G=Math.max(0,q-x),ge=q+B+x,oe=G*(A||0);w.exec("render-data",{start:G,end:ge,from:oe})}e.useEffect(()=>{ke()},[Q,H]);const Re=e.useCallback(p=>{if(!p)return;const{id:P,mode:B}=p;if(B.toString().indexOf("x")<0)return;const q=X.current;if(!q)return;const{clientWidth:G}=q,ge=w.getTask(P);if(ge.$x+ge.$w<q.scrollLeft)w.exec("scroll-chart",{left:ge.$x-(K||0)}),q.scrollLeft=ge.$x-(K||0);else if(ge.$x>=G+q.scrollLeft){const oe=G<ge.$w?K||0:ge.$w;w.exec("scroll-chart",{left:ge.$x-G+oe}),q.scrollLeft=ge.$x-G+oe}},[w,K]);e.useEffect(()=>{Re(S)},[S]);function De(p){if(V&&(p.ctrlKey||p.metaKey)){p.preventDefault();const P=X.current,B=p.clientX-(P?P.getBoundingClientRect().left:0);if(ce.current+=p.deltaY,Math.abs(ce.current)>=150){const G=-Math.sign(ce.current);ce.current=0,w.exec("zoom-scale",{dir:G,offset:B})}}}const Me=e.useCallback(p=>{const P=h(p.date,p.unit);return P?{css:P,width:p.width}:null},[h]),Le=e.useMemo(()=>{if(!T||!h||!["hour","day","week"].includes(T.minUnit))return null;let P=0;return T.rows[T.rows.length-1].cells.map(B=>{const q=Me(B),G=P;return P+=B.width,q?{...q,left:G}:null})},[T,h,Me]),pe=e.useCallback(p=>{p.eventSource="chart",w.exec("hotkey",p)},[w]);e.useEffect(()=>{const p=X.current;if(!p)return;const P=()=>ae(p.clientHeight);P();const B=new ResizeObserver(()=>P());return B.observe(p),()=>{B.disconnect()}},[X.current]);const ee=e.useRef(null);return e.useEffect(()=>{const p=X.current;if(p&&!ee.current)return ee.current=gt.hotkeys(p,{keys:{arrowup:!0,arrowdown:!0},exec:P=>pe(P)}),()=>{ee.current?.destroy(),ee.current=null}},[]),e.useEffect(()=>{const p=X.current;if(!p)return;const P=De;return p.addEventListener("wheel",P),()=>{p.removeEventListener("wheel",P)}},[De]),e.useEffect(()=>{if(!F||E.current||!T||!X.current||!Q)return;const p=X.current,{clientWidth:P}=p,B=new Date,q=T.rows[T.rows.length-1]?.cells;if(!q)return;let G=-1,ge=0;const oe=[];for(let Z=0;Z<q.length;Z++){const de=q[Z];oe.push({left:ge,width:de.width});const fe=de.date;if(de.unit==="week"){const m=new Date(fe);m.setUTCDate(m.getUTCDate()+7),B>=fe&&B<m&&(G=Z)}else de.unit==="day"&&B.getUTCFullYear()===fe.getUTCFullYear()&&B.getUTCMonth()===fe.getUTCMonth()&&B.getUTCDate()===fe.getUTCDate()&&(G=Z);ge+=de.width}let C=G;if(G>0&&(C=G-1),C>=0&&oe[C]){const Z=oe[C],de=Math.max(0,Z.left);p.scrollLeft=de,w.exec("scroll-chart",{left:de}),E.current=!0}},[F,T,Q,w]),Yt("chart"),c.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:X,onScroll:re,children:[c.jsx(Ut,{highlightTime:h,scales:T}),N&&N.length?c.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${ue}px`},children:N.map((p,P)=>c.jsx("div",{className:`wx-mR7v2Xag wx-marker ${p.css||""}`,style:{left:`${p.left}px`},children:c.jsx("div",{className:"wx-mR7v2Xag wx-content",children:p.text})},P))}):null,c.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${ue}px`},children:[Le?c.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:Le.map((p,P)=>p?c.jsx("div",{className:"wx-mR7v2Xag "+p.css,style:{width:`${p.width}px`,left:`${p.left}px`}},P):null)}):null,c.jsx(Wt,{borders:I}),f&&f.length?f.map((p,P)=>p.$y?c.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":p.id,style:te[P]},p.id):null):null,c.jsx(Ot,{readonly:n,taskTemplate:l,multiTaskRows:v,rowMapping:o,marqueeSelect:y,copyPaste:k,allowTaskIntersection:M})]})]})}function Ft(s){const{position:n="after",size:r=4,dir:i="x",onMove:l,onDisplayChange:I,compactMode:h,containerWidth:v=0,leftThreshold:o=50,rightThreshold:y=50}=s,[k,F]=j.useWritableProp(s.value??0),[Y,M]=j.useWritableProp(s.display??"all");function w(re){let ie=0;n=="center"?ie=r/2:n=="before"&&(ie=r);const ke={size:[r+"px","auto"],p:[re-ie+"px","0px"],p2:["auto","0px"]};if(i!="x")for(let Re in ke)ke[Re]=ke[Re].reverse();return ke}const[f,U]=e.useState(!1),[H,A]=e.useState(null),K=e.useRef(0),T=e.useRef(),N=e.useRef(),S=e.useRef(Y);e.useEffect(()=>{S.current=Y},[Y]),e.useEffect(()=>{H===null&&k>0&&A(k)},[H,k]);function V(re){return i=="x"?re.clientX:re.clientY}const ne=e.useCallback(re=>{const ie=T.current+V(re)-K.current;F(ie);let ke;ie<=o?ke="chart":v-ie<=y?ke="grid":ke="all",S.current!==ke&&(M(ke),S.current=ke),N.current&&clearTimeout(N.current),N.current=setTimeout(()=>l&&l(ie),100)},[v,o,y,l]),Q=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",U(!1),window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",Q)},[ne]),ae=e.useMemo(()=>Y!=="all"?"auto":i=="x"?"ew-resize":"ns-resize",[Y,i]),X=e.useCallback(re=>{!h&&(Y==="grid"||Y==="chart")||(K.current=V(re),T.current=k,U(!0),document.body.style.cursor=ae,document.body.style.userSelect="none",window.addEventListener("mousemove",ne),window.addEventListener("mouseup",Q))},[ae,ne,Q,k,h,Y]);function ce(){M("all"),H!==null&&(F(H),l&&l(H))}function E(re){if(h){const ie=Y==="chart"?"grid":"chart";M(ie),I(ie)}else if(Y==="grid"||Y==="chart")ce(),I("all");else{const ie=re==="left"?"chart":"grid";M(ie),I(ie)}}function x(){E("left")}function z(){E("right")}const te=e.useMemo(()=>w(k),[k,n,r,i]),ue=["wx-resizer",`wx-resizer-${i}`,`wx-resizer-display-${Y}`,f?"wx-resizer-active":""].filter(Boolean).join(" ");return c.jsxs("div",{className:"wx-pFykzMlT "+ue,onMouseDown:X,style:{width:te.size[0],height:te.size[1],cursor:ae},children:[c.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:x})}),c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:z})})]}),c.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const Kt=650;function pt(s){let n;function r(){n=new ResizeObserver(l=>{for(let I of l)if(I.target===document.body){let h=I.contentRect.width<=Kt;s(h)}}),n.observe(document.body)}function i(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:i}}function Bt(s){const{taskTemplate:n,readonly:r,cellBorders:i,highlightTime:l,onTableAPIChange:I,multiTaskRows:h=!1,rowMapping:v=null,marqueeSelect:o=!1,copyPaste:y=!1,scrollToCurrentWeek:k=!1,currentWeekColor:F=null,allowTaskIntersection:Y=!0}=s,M=e.useContext(Ge),w=j.useStore(M,"_tasks"),f=j.useStore(M,"_scales"),U=j.useStore(M,"cellHeight"),H=j.useStore(M,"columns"),A=j.useStore(M,"_scrollTask"),K=j.useStore(M,"undo"),T=e.useMemo(()=>{if(!h)return v;const C=new Map,Z=new Map;return w.forEach(de=>{const fe=de.row??de.id;Z.set(de.id,fe),C.has(fe)||C.set(fe,[]),C.get(fe).push(de.id)}),{rowMap:C,taskRows:Z}},[w,h,v]),[N,S]=e.useState(!1);let[V,ne]=e.useState(0);const[Q,ae]=e.useState(0),[X,ce]=e.useState(0),[E,x]=e.useState(void 0),[z,te]=e.useState("all"),ue=e.useRef(null),re=e.useCallback(C=>{S(Z=>(C!==Z&&(C?(ue.current=z,z==="all"&&te("grid")):(!ue.current||ue.current==="all")&&te("all")),C))},[z]);e.useEffect(()=>{const C=pt(re);return C.observe(),()=>{C.disconnect()}},[re]);const ie=e.useMemo(()=>{let C;return H.every(Z=>Z.width&&!Z.flexgrow)?C=H.reduce((Z,de)=>Z+parseInt(de.width),0):N&&z==="chart"?C=parseInt(H.find(Z=>Z.id==="action")?.width)||50:C=440,V=C,C},[H,N,z]);e.useEffect(()=>{ne(ie)},[ie]);const ke=e.useMemo(()=>(Q??0)-(E??0),[Q,E]),Re=e.useMemo(()=>f.width,[f]),De=e.useMemo(()=>{if(!h||!T)return w.length*U;const C=new Set;return w.forEach(Z=>{const de=T.taskRows.get(Z.id)??Z.id;C.add(de)}),C.size*U},[w,U,h,T]),Me=e.useMemo(()=>f.height+De+ke,[f,De,ke]),Le=e.useMemo(()=>V+Re,[V,Re]),pe=e.useRef(null),ee=e.useCallback(()=>{Promise.resolve().then(()=>{if((Q??0)>(Le??0)){const C=(Q??0)-V;M.exec("expand-scale",{minWidth:C})}})},[Q,Le,V,M]);e.useEffect(()=>{let C;return pe.current&&(C=new ResizeObserver(ee),C.observe(pe.current)),()=>{C&&C.disconnect()}},[pe.current,ee]),e.useEffect(()=>{ee()},[Re]);const p=e.useRef(null),P=e.useRef(null),B=e.useCallback(()=>{const C=p.current;C&&M.exec("scroll-chart",{top:C.scrollTop})},[M]),q=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{q.current={rTasks:w,rScales:f,rCellHeight:U,scrollSize:ke,ganttDiv:p.current,ganttHeight:X??0}},[w,f,U,ke,X]);const G=e.useCallback(C=>{if(!C)return;const{rTasks:Z,rScales:de,rCellHeight:fe,scrollSize:m,ganttDiv:le,ganttHeight:xe}=q.current;if(!le)return;const{id:O}=C,Te=Z.findIndex(se=>se.id===O);if(Te>-1){const se=xe-de.height,Ce=Te*fe,be=le.scrollTop;let Se=null;Ce<be?Se=Ce:Ce+fe>be+se&&(Se=Ce-se+fe+m),Se!==null&&(M.exec("scroll-chart",{top:Math.max(Se,0)}),p.current.scrollTop=Math.max(Se,0))}},[M]);e.useEffect(()=>{G(A)},[A]),e.useEffect(()=>{const C=p.current,Z=P.current;if(!C||!Z)return;const de=()=>{$t.flushSync(()=>{ce(C.offsetHeight),ae(C.offsetWidth),x(Z.offsetWidth)})},fe=new ResizeObserver(de);return fe.observe(C),()=>fe.disconnect()},[p.current]);const ge=e.useRef(null),oe=e.useRef(null);return e.useEffect(()=>{oe.current&&(oe.current.destroy(),oe.current=null);const C=ge.current;if(C)return oe.current=gt.hotkeys(C,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,"meta+c":!0,"meta+v":!0,"meta+x":!0,"meta+d":!0,backspace:!0,"ctrl+z":K,"ctrl+y":K,"meta+z":K,"meta+shift+z":K},exec:Z=>{if(Z.isInput)return;const de=Z.key;if(de==="ctrl+z"||de==="meta+z"){M.exec("undo",{});return}if(de==="ctrl+y"||de==="meta+shift+z"){M.exec("redo",{});return}M.exec("hotkey",Z)}}),()=>{oe.current?.destroy(),oe.current=null}},[K]),c.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:p,onScroll:B,children:c.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:Me,width:"100%"},ref:P,children:c.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:X,width:E},children:c.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:ge,children:[H.length?c.jsxs(c.Fragment,{children:[c.jsx(Pt,{display:z,compactMode:N,columnWidth:ie,width:V,readonly:r,fullHeight:De,onTableAPIChange:I,multiTaskRows:h,rowMapping:T}),c.jsx(Ft,{value:V,display:z,compactMode:N,containerWidth:Q,onMove:C=>ne(C),onDisplayChange:C=>te(C)})]}):null,c.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:pe,children:c.jsx(Xt,{readonly:r,fullWidth:Re,fullHeight:De,taskTemplate:n,cellBorders:i,highlightTime:l,multiTaskRows:h,rowMapping:T,marqueeSelect:o,copyPaste:y,scrollToCurrentWeek:k,currentWeekColor:F,allowTaskIntersection:Y})})]})})})})}function Vt(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function Qt(s,n){return typeof s=="function"?s:Ee.dateToString(s,n)}function kt(s,n){return s.map(({format:r,...i})=>({...i,format:Qt(r,n)}))}function Zt(s,n){const r=Vt(n);for(let i in r)r[i]=Ee.dateToString(r[i],s);return r}function Jt(s,n){if(!s||!s.length)return s;const r=Ee.dateToString("%d-%m-%Y",n);return s.map(i=>i.template?i:i.id==="start"||i.id=="end"?{...i,_template:l=>r(l),template:l=>r(l)}:i.id==="duration"?{...i,_template:l=>l,template:l=>l}:i)}function es(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:kt(r.scales,n)}))}:s}const ts=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),ss=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],ns=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:i=we.defaultTaskTypes,tasks:l=[],selected:I=[],activeTask:h=null,links:v=[],scales:o=ss,columns:y=we.defaultColumns,start:k=null,end:F=null,lengthUnit:Y="day",durationUnit:M="day",cellWidth:w=100,cellHeight:f=38,scaleHeight:U=36,readonly:H=!1,cellBorders:A="full",zoom:K=!1,baselines:T=!1,highlightTime:N=null,init:S=null,autoScale:V=!0,unscheduledTasks:ne=!1,criticalPath:Q=null,schedule:ae={type:"forward"},projectStart:X=null,projectEnd:ce=null,calendar:E=null,undo:x=!1,splitTasks:z=!1,multiTaskRows:te=!1,marqueeSelect:ue=!1,copyPaste:re=!1,currentWeekHighlight:ie=!1,currentWeekColor:ke=null,scrollToCurrentWeek:Re=!1,allowTaskIntersection:De=!0,...Me},Le){const pe=e.useRef();pe.current=Me;const ee=e.useMemo(()=>new we.DataStore(j.writable),[]),p=e.useMemo(()=>({...Je.en,...Ke.en}),[]),P=e.useContext(ye.context.i18n),B=e.useMemo(()=>P?P.extend(p,!0):Ee.locale(p),[P,p]),q=e.useMemo(()=>B.getRaw().calendar,[B]),G=e.useMemo(()=>{let se={zoom:es(K,q),scales:kt(o,q),columns:Jt(y,q),links:we.normalizeLinks(v),cellWidth:w};return se.zoom&&(se={...se,...we.normalizeZoom(se.zoom,Zt(q,B.getGroup("gantt")),se.scales,w)}),se},[K,o,y,v,w,q,B]),ge=e.useRef(null);ge.current!==l&&(we.parseTaskDates(l,{durationUnit:M,splitTasks:z,calendar:E}),ge.current=l),e.useEffect(()=>{we.parseTaskDates(l,{durationUnit:M,splitTasks:z,calendar:E})},[l,M,E,z]);const oe=e.useMemo(()=>{if(!te)return null;const se=new Map,Ce=new Map,be=Se=>{Se.forEach(Ne=>{const We=Ne.row??Ne.id;Ce.set(Ne.id,We),se.has(We)||se.set(We,[]),se.get(We).push(Ne.id),Ne.data&&Ne.data.length>0&&be(Ne.data)})};return be(l),{rowMap:se,taskRows:Ce}},[l,te]),C=e.useMemo(()=>ee.in,[ee]),Z=e.useRef(null);Z.current===null&&(Z.current=new jt.EventBusRouter((se,Ce)=>{const be="on"+ts(se);pe.current&&pe.current[be]&&pe.current[be](Ce)}),C.setNext(Z.current));const[de,fe]=e.useState(null),m=e.useRef(null);m.current=de;const le=e.useMemo(()=>({getState:ee.getState.bind(ee),getReactiveState:ee.getReactive.bind(ee),getStores:()=>({data:ee}),exec:C.exec,setNext:se=>(Z.current=Z.current.setNext(se),Z.current),intercept:C.intercept.bind(C),on:C.on.bind(C),detach:C.detach.bind(C),getTask:ee.getTask.bind(ee),serialize:ee.serialize.bind(ee),getTable:se=>se?new Promise(Ce=>setTimeout(()=>Ce(m.current),1)):m.current,getHistory:()=>ee.getHistory()}),[ee,C]);e.useImperativeHandle(Le,()=>({...le}),[le]);const xe=e.useRef(0);e.useEffect(()=>{xe.current?ee.init({tasks:l,links:G.links,start:k,columns:G.columns,end:F,lengthUnit:Y,cellWidth:G.cellWidth,cellHeight:f,scaleHeight:U,scales:G.scales,taskTypes:i,zoom:G.zoom,selected:I,activeTask:h,baselines:T,autoScale:V,unscheduledTasks:ne,markers:r,durationUnit:M,criticalPath:Q,schedule:ae,projectStart:X,projectEnd:ce,calendar:E,undo:x,_weekStart:q.weekStart,splitTasks:z}):S&&S(le),xe.current++},[le,S,l,G,k,F,Y,f,U,i,I,h,T,V,ne,r,M,Q,ae,X,ce,E,x,q,z,ee]),xe.current===0&&ee.init({tasks:l,links:G.links,start:k,columns:G.columns,end:F,lengthUnit:Y,cellWidth:G.cellWidth,cellHeight:f,scaleHeight:U,scales:G.scales,taskTypes:i,zoom:G.zoom,selected:I,activeTask:h,baselines:T,autoScale:V,unscheduledTasks:ne,markers:r,durationUnit:M,criticalPath:Q,schedule:ae,projectStart:X,projectEnd:ce,calendar:E,undo:x,_weekStart:q.weekStart,splitTasks:z});const O=e.useMemo(()=>{const se=new Date,Ce=q?.weekStart??0,be=new Date(Date.UTC(se.getUTCFullYear(),se.getUTCMonth(),se.getUTCDate())),Ne=(be.getUTCDay()-Ce+7)%7;be.setUTCDate(be.getUTCDate()-Ne),be.setUTCHours(0,0,0,0);const We=new Date(be);return We.setUTCDate(We.getUTCDate()+7),a=>a>=be&&a<We},[q]),Te=e.useMemo(()=>(se,Ce)=>{let be=[];if(E)Ce=="day"&&!E.getDayHours(se)&&be.push("wx-weekend"),Ce=="hour"&&!E.getDayHours(se)&&be.push("wx-weekend");else if(N){const Se=N(se,Ce);Se&&be.push(Se)}return ie&&(Ce==="week"||Ce==="day")&&O(se)&&be.push("wx-current-week"),be.join(" ")},[E,N,ie,O]);return c.jsx(ye.context.i18n.Provider,{value:B,children:c.jsx(Ge.Provider,{value:le,children:c.jsx(Bt,{taskTemplate:n,readonly:H,cellBorders:A,highlightTime:Te,onTableAPIChange:fe,multiTaskRows:te,rowMapping:oe,marqueeSelect:ue,copyPaste:re,scrollToCurrentWeek:Re,currentWeekColor:ke,allowTaskIntersection:De})})})});function rs({api:s=null,items:n=[]}){const r=e.useContext(ye.context.i18n),i=e.useMemo(()=>r||Ee.locale(Ke.en),[r]),l=e.useMemo(()=>i.getGroup("gantt"),[i]),I=j.useStoreLater(s,"_selected"),h=j.useStoreLater(s,"undo"),v=j.useStoreLater(s,"history"),o=j.useStoreLater(s,"splitTasks"),y=["undo","redo"],k=e.useMemo(()=>{const Y=we.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:we.getToolbarButtons({undo:h,splitTasks:o})).map(w=>{let f={...w,disabled:!1};return f.handler=we.isHandledAction(Y,f.id)?U=>we.handleAction(s,U.id,null,l):f.handler,f.text&&(f.text=l(f.text)),f.menuText&&(f.menuText=l(f.menuText)),f})},[n,s,l,h,o]),F=e.useMemo(()=>{const Y=[];return k.forEach(M=>{const w=M.id;if(w==="add-task")Y.push(M);else if(y.includes(w))y.includes(w)&&Y.push({...M,disabled:M.isDisabled(v)});else{if(!I?.length||!s)return;Y.push({...M,disabled:M.isDisabled&&I.some(f=>M.isDisabled(f,s.getState()))})}}),Y.filter((M,w)=>{if(s&&M.isHidden)return!I.some(f=>M.isHidden(f,s.getState()));if(M.comp==="separator"){const f=Y[w+1];if(!f||f.comp==="separator")return!1}return!0})},[s,I,v,k]);return r?c.jsx(ut.Toolbar,{items:F}):c.jsx(ye.context.i18n.Provider,{value:i,children:c.jsx(ut.Toolbar,{items:F})})}const os=e.forwardRef(function({options:n=[],api:r=null,resolver:i=null,filter:l=null,at:I="point",children:h,onClick:v,css:o},y){const k=e.useRef(null),F=e.useRef(null),Y=e.useContext(ye.context.i18n),M=e.useMemo(()=>Y||Ee.locale({...Ke.en,...Je.en}),[Y]),w=e.useMemo(()=>M.getGroup("gantt"),[M]),f=j.useStoreLater(r,"taskTypes"),U=j.useStoreLater(r,"selected"),H=j.useStoreLater(r,"_selected"),A=j.useStoreLater(r,"splitTasks"),K=e.useMemo(()=>we.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{k.current&&k.current.show&&k.current.show()}),r.on("drag-task",()=>{k.current&&k.current.show&&k.current.show()}))},[r]);function T(E){return E.map(x=>(x={...x},x.text&&(x.text=w(x.text)),x.subtext&&(x.subtext=w(x.subtext)),x.data&&(x.data=T(x.data)),x))}function N(){const E=n.length?n:we.getMenuOptions({splitTasks:A}),x=E.find(z=>z.id==="convert-task");return x&&(x.data=[],(f||[]).forEach(z=>{x.data.push(x.dataFactory(z))})),T(E)}const S=e.useMemo(()=>N(),[r,n,f,A,w]),V=e.useMemo(()=>H&&H.length?H:[],[H]),ne=e.useCallback((E,x)=>{let z=E?r?.getTask(E):null;if(i){const te=i(E,x);z=te===!0?z:te}if(z){const te=Ee.locateID(x.target,"data-segment");te!==null?F.current={id:z.id,segmentIndex:te}:F.current=z.id,(!Array.isArray(U)||!U.includes(z.id))&&r&&r.exec&&r.exec("select-task",{id:z.id})}return z},[r,i,U]),Q=e.useCallback(E=>{const x=E.action;x&&(we.isHandledAction(K,x.id)&&we.handleAction(r,x.id,F.current,w),v&&v(E))},[r,w,v,K]),ae=e.useCallback((E,x)=>{const z=V.length?V:x?[x]:[];let te=l?z.every(ue=>l(E,ue)):!0;if(te&&(E.isHidden&&(te=!z.some(ue=>E.isHidden(ue,r.getState(),F.current))),E.isDisabled)){const ue=z.some(re=>E.isDisabled(re,r.getState(),F.current));E.disabled=ue}return te},[l,V,r]);e.useImperativeHandle(y,()=>({show:(E,x)=>{k.current&&k.current.show&&k.current.show(E,x)}}));const X=e.useCallback(E=>{k.current&&k.current.show&&k.current.show(E)},[]),ce=c.jsxs(c.Fragment,{children:[c.jsx(Dt.ContextMenu,{filter:ae,options:S,dataKey:"id",resolver:ne,onClick:Q,at:I,ref:k,css:o}),c.jsx("span",{onContextMenu:X,"data-menu-ignore":"true",children:typeof h=="function"?h():h})]});if(!Y&&ye.context.i18n?.Provider){const E=ye.context.i18n.Provider;return c.jsx(E,{value:M,children:ce})}return ce});function ls({api:s,autoSave:n,onLinksChange:r}){const l=e.useContext(ye.context.i18n).getGroup("gantt"),I=j.useStore(s,"activeTask"),h=j.useStore(s,"_activeTask"),v=j.useStore(s,"_links"),o=j.useStore(s,"schedule"),y=j.useStore(s,"unscheduledTasks"),[k,F]=e.useState();function Y(){if(I){const U=v.filter(A=>A.target==I).map(A=>({link:A,task:s.getTask(A.source)})),H=v.filter(A=>A.source==I).map(A=>({link:A,task:s.getTask(A.target)}));return[{title:l("Predecessors"),data:U},{title:l("Successors"),data:H}]}}e.useEffect(()=>{F(Y())},[I,v]);const M=e.useMemo(()=>[{id:"e2s",label:l("End-to-start")},{id:"s2s",label:l("Start-to-start")},{id:"e2e",label:l("End-to-end")},{id:"s2e",label:l("Start-to-end")}],[l]);function w(U){n?s.exec("delete-link",{id:U}):(F(H=>(H||[]).map(A=>({...A,data:A.data.filter(K=>K.link.id!==U)}))),r&&r({id:U,action:"delete-link",data:{id:U}}))}function f(U,H){n?s.exec("update-link",{id:U,link:H}):(F(A=>(A||[]).map(K=>({...K,data:K.data.map(T=>T.link.id===U?{...T,link:{...T.link,...H}}:T)}))),r&&r({id:U,action:"update-link",data:{id:U,link:H}}))}return c.jsx(c.Fragment,{children:(k||[]).map((U,H)=>U.data.length?c.jsx("div",{className:"wx-j93aYGQf wx-links",children:c.jsx(ye.Field,{label:U.title,position:"top",children:c.jsx("table",{children:c.jsx("tbody",{children:U.data.map(A=>c.jsxs("tr",{children:[c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:A.task.text||""})}),o?.auto&&A.link.type==="e2s"?c.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:c.jsx(ye.Text,{type:"number",placeholder:l("Lag"),value:A.link.lag,disabled:y&&h?.unscheduled,onChange:K=>{K.input||f(A.link.id,{lag:K.value})}})}):null,c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:c.jsx(ye.Combo,{value:A.link.type,placeholder:l("Select link type"),options:M,onChange:K=>f(A.link.id,{type:K.value}),children:({option:K})=>K.label})})}),c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>w(A.link.id),role:"button"})})]},A.link.id))})})})},H):null)})}function cs(s){const{value:n,time:r,format:i,onchange:l,onChange:I,...h}=s,v=I??l;function o(y){const k=new Date(y.value);k.setUTCHours(n.getUTCHours()),k.setUTCMinutes(n.getUTCMinutes()),v&&v({value:k})}return c.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[c.jsx(ye.DatePicker,{...h,value:n,onChange:o,format:i,buttons:["today"],clear:!1}),r?c.jsx(ye.TimePicker,{value:n,onChange:v,format:i}):null]})}ze.registerEditorItem("select",ye.RichSelect);ze.registerEditorItem("date",cs);ze.registerEditorItem("twostate",ye.TwoState);ze.registerEditorItem("slider",ye.Slider);ze.registerEditorItem("counter",ye.Counter);ze.registerEditorItem("links",ls);function is({api:s,items:n=[],css:r="",layout:i="default",readonly:l=!1,placement:I="sidebar",bottomBar:h=!0,topBar:v=!0,autoSave:o=!0,focus:y=!1,hotkeys:k={}}){const F=e.useContext(ye.context.i18n),Y=e.useMemo(()=>F||Ee.locale({...Ke.en,...Je.en}),[F]),M=e.useMemo(()=>Y.getGroup("gantt"),[Y]),w=Y.getRaw(),f=e.useMemo(()=>{const m=w.gantt?.dateFormat||w.formats?.dateFormat;return Ee.dateToString(m,w.calendar)},[w]),U=e.useMemo(()=>{if(v===!0&&!l){const m=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:M("Delete"),id:"delete"}];return o?{items:m}:{items:[...m,{comp:"button",type:"primary",text:M("Save"),id:"save"}]}}return v},[v,l,o,M]),[H,A]=e.useState(!1),K=e.useMemo(()=>H?"wx-full-screen":"",[H]),T=e.useCallback(m=>{A(m)},[]);e.useEffect(()=>{const m=pt(T);return m.observe(),()=>{m.disconnect()}},[T]);const N=j.useStore(s,"_activeTask"),S=j.useStore(s,"activeTask"),V=j.useStore(s,"unscheduledTasks"),ne=j.useStore(s,"links"),Q=j.useStore(s,"splitTasks"),ae=e.useMemo(()=>Q&&S?.segmentIndex,[Q,S]),X=e.useMemo(()=>ae||ae===0,[ae]),ce=e.useMemo(()=>we.getEditorItems({unscheduledTasks:V}),[V]),E=j.useStore(s,"undo"),[x,z]=e.useState({}),[te,ue]=e.useState(null),[re,ie]=e.useState(),[ke,Re]=e.useState(null),De=j.useStore(s,"taskTypes"),Me=e.useMemo(()=>{if(!N)return null;let m;if(X&&N.segments?m={...N.segments[ae]}:m={...N},l){let le={parent:m.parent};return ce.forEach(({key:xe,comp:O})=>{if(O!=="links"){const Te=m[xe];O==="date"&&Te instanceof Date?le[xe]=f(Te):O==="slider"&&xe==="progress"?le[xe]=`${Te}%`:le[xe]=Te}}),le}return m||null},[N,X,ae,l,ce,f]);e.useEffect(()=>{ie(Me)},[Me]),e.useEffect(()=>{z({}),Re(null),ue(null)},[S]);function Le(m,le){return m.map(xe=>{const O={...xe};if(xe.config&&(O.config={...O.config}),O.comp==="links"&&s&&(O.api=s,O.autoSave=o,O.onLinksChange=p),O.comp==="select"&&O.key==="type"){const Te=O.options??(De||[]);O.options=Te.map(se=>({...se,label:M(se.label)}))}return O.comp==="slider"&&O.key==="progress"&&(O.labelTemplate=Te=>`${M(O.label)} ${Te}%`),O.label&&(O.label=M(O.label)),O.config?.placeholder&&(O.config.placeholder=M(O.config.placeholder)),le&&(O.isDisabled&&O.isDisabled(le,s.getState())?O.disabled=!0:delete O.disabled),O})}const pe=e.useMemo(()=>{let m=n.length?n:ce;return m=Le(m,re),re?m.filter(le=>!le.isHidden||!le.isHidden(re,s.getState())):m},[n,ce,re,De,M,s,o]),ee=e.useMemo(()=>pe.map(m=>m.key),[pe]);function p({id:m,action:le,data:xe}){z(O=>({...O,[m]:{action:le,data:xe}}))}const P=e.useCallback(()=>{for(let m in x)if(ne.byId(m)){const{action:le,data:xe}=x[m];s.exec(le,xe)}},[s,x,ne]),B=e.useCallback(()=>{const m=S?.id||S;if(X){if(N?.segments){const le=N.segments.filter((xe,O)=>O!==ae);s.exec("update-task",{id:m,task:{segments:le}})}}else s.exec("delete-task",{id:m})},[s,S,X,N,ae]),q=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),G=e.useCallback(m=>{const{item:le,changes:xe}=m;le.id==="delete"&&B(),le.id==="save"&&(xe.length?q():P()),le.comp&&q()},[s,S,o,P,B,q]),ge=e.useCallback((m,le,xe)=>(V&&m.type==="summary"&&(m.unscheduled=!1),we.prepareEditTask(m,s.getState(),le),xe||ue(!1),m),[V,s]),oe=e.useCallback(m=>{m={...m,unscheduled:V&&m.unscheduled&&m.type!=="summary"},delete m.links,delete m.data,(ee.indexOf("duration")===-1||m.segments&&!m.duration)&&delete m.duration;const le={id:S?.id||S,task:m,...X&&{segmentIndex:ae}};o&&te&&(le.inProgress=te),s.exec("update-task",le),o||P()},[s,S,V,o,P,ee,X,ae,te]),C=e.useCallback(m=>{let{update:le,key:xe,input:O}=m;if(O&&ue(!0),m.update=ge({...le},xe,O),!o)ie(m.update);else if(!ke&&!O){const Te=pe.find(be=>be.key===xe),se=le[xe];(!Te.validation||Te.validation(se))&&(!Te.required||se)&&oe(m.update)}},[o,ge,ke,pe,oe]),Z=e.useCallback(m=>{o||oe(m.values)},[o,oe]),de=e.useCallback(m=>{Re(m.errors)},[]),fe=e.useMemo(()=>E?{"ctrl+z":m=>{m.preventDefault(),s.exec("undo")},"ctrl+y":m=>{m.preventDefault(),s.exec("redo")}}:{},[E,s]);return Me?c.jsx(ye.Locale,{children:c.jsx(ze.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${K} ${r}`,items:pe,values:Me,topBar:U,bottomBar:h,placement:I,layout:i,readonly:l,autoSave:o,focus:y,onAction:G,onSave:Z,onValidation:de,onChange:C,hotkeys:k&&{...fe,...k}})}):null}const as=({children:s,columns:n=null,api:r})=>{const[i,l]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(l)},[r]),c.jsx(wt.HeaderMenu,{api:i,columns:n,children:s})};function us(s){const{api:n,content:r,children:i}=s,l=e.useRef(null),I=e.useRef(null),[h,v]=e.useState({}),[o,y]=e.useState(null),[k,F]=e.useState({});function Y(T){for(;T;){if(T.getAttribute){const N=T.getAttribute("data-tooltip-id"),S=T.getAttribute("data-tooltip-at"),V=T.getAttribute("data-tooltip");if(N||V)return{id:N,tooltip:V,target:T,at:S}}T=T.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const T=I.current;if(T&&k&&(k.text||r)){const N=T.getBoundingClientRect();let S=!1,V=k.left,ne=k.top;N.right>=h.right&&(V=h.width-N.width-5,S=!0),N.bottom>=h.bottom&&(ne=k.top-(N.bottom-h.bottom+2),S=!0),S&&F(Q=>Q&&{...Q,left:V,top:ne})}},[k,h,r]);const M=e.useRef(null),w=300,f=T=>{clearTimeout(M.current),M.current=setTimeout(()=>{T()},w)};function U(T){let{id:N,tooltip:S,target:V,at:ne}=Y(T.target);if(F(null),y(null),!S)if(N)S=A(N);else{clearTimeout(M.current);return}const Q=T.clientX;f(()=>{N&&y(H(K(N)));const ae=V.getBoundingClientRect(),X=l.current,ce=X?X.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let E,x;ne==="left"?(E=ae.top+5-ce.top,x=ae.right+5-ce.left):(E=ae.top+ae.height-ce.top,x=Q-ce.left),v(ce),F({top:E,left:x,text:S})})}function H(T){return n?.getTask(K(T))||null}function A(T){return H(T)?.text||""}function K(T){const N=parseInt(T);return isNaN(N)?T:N}return c.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:l,onMouseMove:U,children:[k&&(k.text||r)?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:I,style:{top:`${k.top}px`,left:`${k.left}px`},children:r?c.jsx(r,{data:o}):k.text?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:k.text}):null}):null,i]})}function ds({fonts:s=!0,children:n}){return n?c.jsx(ye.Material,{fonts:s,children:n()}):c.jsx(ye.Material,{fonts:s})}function fs({fonts:s=!0,children:n}){return n?c.jsx(ye.Willow,{fonts:s,children:n}):c.jsx(ye.Willow,{fonts:s})}function xs({fonts:s=!0,children:n}){return n?c.jsx(ye.WillowDark,{fonts:s,children:n}):c.jsx(ye.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>we.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>we.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>we.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>we.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>we.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>we.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>we.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>we.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>we.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>ze.registerEditorItem});exports.ContextMenu=os;exports.Editor=is;exports.Gantt=ns;exports.HeaderMenu=as;exports.Material=ds;exports.Toolbar=rs;exports.Tooltip=us;exports.Willow=fs;exports.WillowDark=xs;
//# sourceMappingURL=index.cjs.map
