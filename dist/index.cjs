"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("react/jsx-runtime"),e=require("react"),ke=require("@svar-ui/react-core"),Te=require("@svar-ui/lib-dom"),Ke=require("@svar-ui/gantt-locales"),Ue=require("@svar-ui/core-locales"),wt=require("@svar-ui/lib-state"),pe=require("@svar-ui/gantt-store"),M=require("@svar-ui/lib-react"),at=require("@svar-ui/grid-store"),ut=require("@svar-ui/react-grid"),pt=require("react-dom"),ot=require("@svar-ui/react-toolbar"),bt=require("@svar-ui/react-menu"),We=require("@svar-ui/react-editor"),He=e.createContext(null);function ze(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function kt(s,n,r){const a=s.getBoundingClientRect(),o=n.querySelector(".wx-body").getBoundingClientRect();return{top:a.top-o.top,left:a.left-o.left,dt:a.bottom-r.clientY,db:r.clientY-a.top}}function lt(s){return s&&s.getAttribute("data-context-id")}const ct=5;function yt(s,n){let r,a,o,D,h,l,x,A,p;function K(g){D=g.clientX,h=g.clientY,l={...kt(r,s,g),y:n.getTask(o).$y},document.body.style.userSelect="none"}function j(g){r=Te.locate(g),lt(r)&&(o=ze(r),p=setTimeout(()=>{A=!0,n&&n.touchStart&&n.touchStart(),K(g.touches[0])},500),s.addEventListener("touchmove",I),s.addEventListener("contextmenu",m),window.addEventListener("touchend",z))}function m(g){if(A||p)return g.preventDefault(),!1}function H(g){g.which===1&&(r=Te.locate(g),lt(r)&&(o=ze(r),s.addEventListener("mousemove",B),window.addEventListener("mouseup",E),K(g)))}function f(g){s.removeEventListener("mousemove",B),s.removeEventListener("touchmove",I),document.body.removeEventListener("mouseup",E),document.body.removeEventListener("touchend",z),document.body.style.userSelect="",g&&(s.removeEventListener("mousedown",H),s.removeEventListener("touchstart",j))}function R(g){const ee=g.clientX-D,Y=g.clientY-h;if(!a){if(Math.abs(ee)<ct&&Math.abs(Y)<ct||n&&n.start&&n.start({id:o,e:g})===!1)return;a=r.cloneNode(!0),a.style.pointerEvents="none",a.classList.add("wx-reorder-task"),a.style.position="absolute",a.style.left=l.left+"px",a.style.top=l.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(a,r)}if(a){const de=Math.round(Math.max(0,l.top+Y));if(n&&n.move&&n.move({id:o,top:de,detail:x})===!1)return;const W=n.getTask(o),le=W.$y;if(!l.start&&l.y==le)return G();l.start=!0,l.y=W.$y-4,a.style.top=de+"px";const se=document.elementFromPoint(g.clientX,g.clientY),d=Te.locate(se);if(d&&d!==r){const v=ze(d),N=d.getBoundingClientRect(),oe=N.top+N.height/2,te=g.clientY+l.db>oe&&d.nextElementSibling!==r,ne=g.clientY-l.dt<oe&&d.previousElementSibling!==r;x?.after==v||x?.before==v?x=null:te?x={id:o,after:v}:ne&&(x={id:o,before:v})}}}function B(g){R(g)}function I(g){A?(g.preventDefault(),R(g.touches[0])):p&&(clearTimeout(p),p=null)}function z(){A=null,p&&(clearTimeout(p),p=null),G()}function E(){G()}function G(){r&&(r.style.visibility=""),a&&(a.parentNode.removeChild(a),n&&n.end&&n.end({id:o,top:l.top})),o=r=a=l=x=null,f()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",H),s.addEventListener("touchstart",j),{destroy(){f(!0)}}}function vt({row:s,column:n}){function r(o,D){return{justifyContent:D.align,paddingLeft:`${(o.$level-1)*20}px`}}const a=n&&n._cell;return c.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?c.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):c.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),c.jsx("div",{className:"wx-pqc08MHU wx-text",children:a?c.jsx(a,{row:s,column:n}):s.text})]})}function it({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?c.jsx("div",{style:{textAlign:s.align},children:c.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function Tt(s){const{readonly:n,compactMode:r,width:a=0,display:o="all",columnWidth:D=0,onTableAPIChange:h,multiTaskRows:l=!1,rowMapping:x=null}=s,[A,p]=M.useWritableProp(D),[K,j]=e.useState(),m=e.useContext(ke.context.i18n),H=e.useMemo(()=>m.getGroup("gantt"),[m]),f=e.useContext(He),R=M.useStore(f,"scrollTop"),B=M.useStore(f,"cellHeight"),I=M.useStore(f,"_scrollTask"),z=M.useStore(f,"_selected"),E=M.useStore(f,"area"),G=M.useStore(f,"_tasks"),g=M.useStore(f,"_scales"),ee=M.useStore(f,"columns"),Y=M.useStore(f,"_sort"),de=M.useStore(f,"calendar"),W=M.useStore(f,"durationUnit"),le=M.useStore(f,"splitTasks"),[se,d]=e.useState(null),v=e.useMemo(()=>!G||!E?[]:l&&x?G:G.slice(E.start,E.end),[G,E,l,x]),N=e.useCallback((i,k)=>{if(k==="add-task")f.exec(k,{target:i,task:{text:H("New Task")},mode:"child",show:!0});else if(k==="open-task"){const C=v.find(_=>_.id===i);(C?.data||C?.lazy)&&f.exec(k,{id:i,mode:!C.open})}},[v]),oe=e.useCallback(i=>{const k=Te.locateID(i),C=i.target.dataset.action;C&&i.preventDefault(),k?C==="add-task"||C==="open-task"?N(k,C):f.exec("select-task",{id:k,toggle:i.ctrlKey||i.metaKey,range:i.shiftKey,show:!0}):C==="add-task"&&N(null,C)},[f,N]),te=e.useRef(null),ne=e.useRef(null),[ce,me]=e.useState(0),[Re,Ce]=e.useState(!1);e.useEffect(()=>{const i=ne.current;if(!i||typeof ResizeObserver>"u")return;const k=()=>me(i.clientWidth);k();const C=new ResizeObserver(k);return C.observe(i),()=>C.disconnect()},[]);const je=e.useRef(null),Se=e.useCallback(i=>{const k=i.id,{before:C,after:_}=i,fe=i.onMove;let ue=C||_,Ee=C?"before":"after";if(fe){if(Ee==="after"){const Ne=f.getTask(ue);Ne.data?.length&&Ne.open&&(Ee="before",ue=Ne.data[0].id)}je.current={id:k,[Ee]:ue}}else je.current=null;f.exec("move-task",{id:k,mode:Ee,target:ue,inProgress:fe})},[f]),L=e.useMemo(()=>E?.from??0,[E]),b=e.useMemo(()=>g?.height??0,[g]),P=e.useMemo(()=>!r&&o!=="grid"?(A??0)>(a??0):(A??0)>(ce??0),[r,o,A,a,ce]),Z=e.useMemo(()=>{const i={};return P&&o==="all"||o==="grid"&&P?i.width=A:o==="grid"&&(i.width="100%"),i},[P,o,A]),V=e.useMemo(()=>se&&!v.find(i=>i.id===se.id)?[...v,se]:v,[v,se]),F=e.useMemo(()=>{if(!l||!x)return V;const i=new Map,k=new Set;return V.forEach(C=>{const _=x.taskRows.get(C.id)??C.id;k.has(_)||(i.set(_,{...C,$rowTasks:x.rowMap.get(_)||[C.id]}),k.add(_))}),Array.from(i.values())},[V,l,x]),Q=e.useMemo(()=>{let i=(ee||[]).map(_=>{_={..._};const fe=_.header;if(typeof fe=="object"){const ue=fe.text&&H(fe.text);_.header={...fe,text:ue}}else _.header=H(fe);return _});const k=i.findIndex(_=>_.id==="text"),C=i.findIndex(_=>_.id==="add-task");if(k!==-1&&(i[k].cell&&(i[k]._cell=i[k].cell),i[k].cell=vt),C!==-1){i[C].cell=i[C].cell||it;const _=i[C].header;if(typeof _!="object"&&(i[C].header={text:_}),i[C].header.cell=_.cell||it,n)i.splice(C,1);else if(r){const[fe]=i.splice(C,1);i.unshift(fe)}}return i.length>0&&(i[i.length-1].resize=!1),i},[ee,H,n,r]),ye=e.useMemo(()=>o==="all"?`${a}px`:o==="grid"?"calc(100% - 4px)":Q.find(i=>i.id==="add-task")?"50px":"0",[o,a,Q]),T=e.useMemo(()=>{if(F&&Y?.length){const i={};return Y.forEach(({key:k,order:C},_)=>{i[k]={order:C,...Y.length>1&&{index:_}}}),i}return{}},[F,Y]),q=e.useCallback(()=>Q.some(i=>i.flexgrow&&!i.hidden),[]),ie=e.useMemo(()=>q(),[q,Re]),ae=e.useMemo(()=>{let i=o==="chart"?Q.filter(C=>C.id==="add-task"):Q;const k=o==="all"?a:ce;if(!ie){let C=A,_=!1;if(Q.some(fe=>fe.$width)){let fe=0;C=Q.reduce((ue,Ee)=>(Ee.hidden||(fe+=Ee.width,ue+=Ee.$width||Ee.width),ue),0),fe>C&&C>k&&(_=!0)}if(_||C<k){let fe=1;return _||(fe=(k-50)/(C-50||1)),i.map(ue=>(ue.id!=="add-task"&&!ue.hidden&&(ue.$width||(ue.$width=ue.width),ue.width=ue.$width*fe),ue))}}return i},[o,Q,ie,A,a,ce]),De=e.useCallback(i=>{if(!q()){const k=ae.reduce((C,_)=>(i&&_.$width&&(_.$width=_.width),C+(_.hidden?0:_.width)),0);k!==A&&p(k)}Ce(!0),Ce(!1)},[q,ae,A,p]),w=e.useCallback(()=>{Q.filter(k=>k.flexgrow&&!k.hidden).length===1&&Q.forEach(k=>{k.$width&&!k.flexgrow&&!k.hidden&&(k.width=k.$width)})},[]),re=e.useCallback(i=>{if(!n){const k=Te.locateID(i),C=Te.locateAttr(i,"data-col-id");!(C&&Q.find(fe=>fe.id==C))?.editor&&k&&f.exec("show-editor",{id:k})}},[f,n]),he=e.useMemo(()=>Array.isArray(z)?z.map(i=>i.id):[],[z]),O=e.useRef(L);O.current=L,e.useEffect(()=>{const i=C=>{if(te.current){const _=te.current.querySelector(".wx-body");_&&(_.style.top=-((C??0)-(O.current??0))+"px")}ne.current&&(ne.current.scrollTop=0)};return i(R),f.on("scroll-chart",({top:C})=>{C!==void 0&&i(C)})},[f,R]),e.useEffect(()=>{if(te.current){const i=te.current.querySelector(".wx-body");i&&(i.style.top=-((R??0)-(L??0))+"px")}},[L]),e.useEffect(()=>{const i=te.current;if(!i)return;const k=i.querySelector(".wx-table-box .wx-body");if(!k||typeof ResizeObserver>"u")return;const C=new ResizeObserver(()=>{if(te.current){const _=te.current.querySelector(".wx-body");_&&(_.style.top=-((R??0)-(O.current??0))+"px")}});return C.observe(k),()=>{C.disconnect()}},[ae,Z,o,ye,F,R]),e.useEffect(()=>{if(!I||!K)return;const{id:i}=I,k=K.getState().focusCell;k&&k.row!==i&&te.current&&te.current.contains(document.activeElement)&&K.exec("focus-cell",{row:i,column:k.column})},[I,K]);const U=e.useCallback(({id:i})=>{if(n)return!1;f.getTask(i).open&&f.exec("open-task",{id:i,mode:!1});const k=f.getState()._tasks.find(C=>C.id===i);if(d(k||null),!k)return!1},[f,n]),we=e.useCallback(({id:i,top:k})=>{je.current?Se({...je.current,onMove:!1}):f.exec("drag-task",{id:i,top:k+(L??0),inProgress:!1}),d(null)},[f,Se,L]),be=e.useCallback(({id:i,top:k,detail:C})=>{C&&Se({...C,onMove:!0}),f.exec("drag-task",{id:i,top:k+(L??0),inProgress:!0})},[f,Se,L]);e.useEffect(()=>{const i=te.current;return i?yt(i,{start:U,end:we,move:be,getTask:f.getTask}).destroy:void 0},[f,U,we,be]);const Me=e.useCallback(i=>{const{key:k,isInput:C}=i;if(!C&&(k==="arrowup"||k==="arrowdown"))return i.eventSource="grid",f.exec("hotkey",i),!1;if(k==="enter"){const _=K?.getState().focusCell;if(_){const{row:fe,column:ue}=_;ue==="add-task"?N(fe,"add-task"):ue==="text"&&N(fe,"open-task")}}},[f,N,K]),ve=e.useRef(null),Ie=()=>{ve.current={setTableAPI:j,handleHotkey:Me,sortVal:Y,api:f,adjustColumns:w,setColumnWidth:De,tasks:v,calendarVal:de,durationUnitVal:W,splitTasksVal:le,onTableAPIChange:h}};Ie(),e.useEffect(()=>{Ie()},[j,Me,Y,f,w,De,v,de,W,le,h]);const Ge=e.useCallback(i=>{j(i),i.intercept("hotkey",k=>ve.current.handleHotkey(k)),i.intercept("scroll",()=>!1),i.intercept("select-row",()=>!1),i.intercept("sort-rows",k=>{const C=ve.current.sortVal,{key:_,add:fe}=k,ue=C?C.find(Ne=>Ne.key===_):null;let Ee="asc";return ue&&(Ee=!ue||ue.order==="asc"?"desc":"asc"),f.exec("sort-tasks",{key:_,order:Ee,add:fe}),!1}),i.on("resize-column",()=>{ve.current.setColumnWidth(!0)}),i.on("hide-column",k=>{k.mode||ve.current.adjustColumns(),ve.current.setColumnWidth()}),i.intercept("update-cell",k=>{const{id:C,column:_,value:fe}=k,ue=ve.current.tasks.find(Ee=>Ee.id===C);if(ue){const Ee={...ue};let Ne=fe;Ne&&!isNaN(Ne)&&!(Ne instanceof Date)&&(Ne*=1),Ee[_]=Ne,pe.prepareEditTask(Ee,{calendar:ve.current.calendarVal,durationUnit:ve.current.durationUnitVal,splitTasks:ve.current.splitTasksVal},_),f.exec("update-task",{id:C,task:Ee})}return!1}),h&&h(i)},[]);return c.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ye}`},ref:ne,children:c.jsx("div",{ref:te,style:Z,className:"wx-rHj6070p wx-table",onClick:oe,onDoubleClick:re,children:c.jsx(ut.Grid,{init:Ge,sizes:{rowHeight:B,headerHeight:(b??0)-1},rowStyle:i=>i.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:i=>`wx-rHj6070p wx-text-${i.align}${i.id==="add-task"?" wx-action":""}`,data:F,columns:ae,selectedRows:[...he],sortMarks:T})})})}function Mt({borders:s=""}){const n=e.useContext(He),r=M.useStore(n,"cellWidth"),a=M.useStore(n,"cellHeight"),o=e.useRef(null),[D,h]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&o.current){const x=getComputedStyle(o.current).getPropertyValue("--wx-gantt-border");h(x?x.substring(x.indexOf("#")):"#1d1e261a")}},[]);const l={width:"100%",height:"100%",background:r!=null&&a!=null?`url(${pe.grid(r,a,D,s)})`:void 0,position:"absolute"};return c.jsx("div",{ref:o,style:l})}function Ct({onSelectLink:s,selectedLink:n,readonly:r}){const a=e.useContext(He),o=M.useStore(a,"_links"),D=M.useStore(a,"criticalPath"),h=e.useRef(null),l=e.useCallback(x=>{const A=x?.target?.classList;!A?.contains("wx-line")&&!A?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&h.current){const x=A=>{h.current&&!h.current.contains(A.target)&&l(A)};return document.addEventListener("click",x),()=>{document.removeEventListener("click",x)}}},[r,n,l]),c.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(o||[]).map(x=>{const A="wx-dkx3NwEn wx-line"+(D&&x.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return c.jsx("polyline",{className:A,points:x.$p,onClick:()=>!r&&s(x.id),"data-link-id":x.id},x.id)}),!r&&n&&c.jsx("polyline",{ref:h,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function St(s){const{task:n,type:r}=s;function a(D){const h=n.segments[D];return{left:`${h.$x}px`,top:"0px",width:`${h.$w}px`,height:"100%"}}function o(D){if(!n.progress)return 0;const h=n.duration*n.progress/100,l=n.segments;let x=0,A=0,p=null;do{const K=l[A];A===D&&(x>h?p=0:p=Math.min((h-x)/K.duration,1)*100),x+=K.duration,A++}while(p===null&&A<l.length);return p||0}return c.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map((D,h)=>c.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":h,style:a(h),children:[n.progress?c.jsx("div",{className:"wx-progress-wrapper",children:c.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${o(h)}%`}})}):null,c.jsx("div",{className:"wx-content",children:D.text||""})]},h))})}let Xe=[],Ve=null,Ye=null;const Et=(s,n)=>{if(!n||!n.start)return null;const{start:r,lengthUnitWidth:a,lengthUnit:o}=n,D=864e5,h=o==="week"?7:o==="month"?30:o==="quarter"?91:o==="year"?365:1,l=Math.floor(s/a);return new Date(r.getTime()+l*h*D)};function Rt(s){const{readonly:n,taskTemplate:r,multiTaskRows:a=!1,rowMapping:o=null,marqueeSelect:D=!1,copyPaste:h=!1}=s,l=e.useContext(He),[x,A]=M.useStoreWithCounter(l,"_tasks"),[p,K]=M.useStoreWithCounter(l,"_links"),j=M.useStore(l,"area"),m=M.useStore(l,"_scales"),H=M.useStore(l,"taskTypes"),f=M.useStore(l,"baselines"),[R,B]=M.useStoreWithCounter(l,"_selected"),I=M.useStore(l,"_scrollTask"),z=M.useStore(l,"criticalPath"),E=M.useStore(l,"tasks"),G=M.useStore(l,"schedule"),g=M.useStore(l,"splitTasks"),ee=e.useMemo(()=>{if(!j||!Array.isArray(x))return[];const t=j.start??0,u=j.end??0;return a&&o?x.map(y=>({...y})):x.slice(t,u).map(y=>({...y}))},[A,j,a,o]),Y=M.useStore(l,"cellHeight"),de=e.useMemo(()=>{if(!a||!o||!ee.length)return ee;const t=new Map,u=[];return x.forEach(y=>{const S=o.taskRows.get(y.id)??y.id;t.has(S)||(t.set(S,u.length),u.push(S))}),ee.map(y=>{const S=o.taskRows.get(y.id)??y.id,$=t.get(S)??0;return{...y,$y:$*Y,$y_base:y.$y_base!==void 0?$*Y:void 0}})},[ee,a,o,x,Y]),W=e.useMemo(()=>m.lengthUnitWidth,[m]),le=e.useMemo(()=>m.lengthUnit||"day",[m]),se=e.useRef(!1),[d,v]=e.useState(void 0),[N,oe]=e.useState(null),te=e.useRef(null),[ne,ce]=e.useState(null),[me,Re]=e.useState(void 0),Ce=e.useRef(null),[je,Se]=e.useState(0),[L,b]=e.useState(null),[P,Z]=e.useState(null),[V,F]=e.useState(null),Q=e.useRef(null),ye=e.useMemo(()=>{const t=Q.current;return!!(R.length&&t&&t.contains(document.activeElement))},[R,Q.current]),T=e.useMemo(()=>ye&&R[R.length-1]?.id,[ye,R]);e.useEffect(()=>{if(I&&ye&&I){const{id:t}=I,u=Q.current?.querySelector(`.wx-bar[data-id='${t}']`);u&&u.focus({preventScroll:!0})}},[I]),e.useEffect(()=>{const t=Q.current;if(t&&(Se(t.offsetWidth||0),typeof ResizeObserver<"u")){const u=new ResizeObserver(y=>{y[0]&&Se(y[0].contentRect.width)});return u.observe(t),()=>u.disconnect()}},[Q.current]);const q=e.useCallback(()=>{document.body.style.userSelect="none"},[]),ie=e.useCallback(()=>{document.body.style.userSelect=""},[]),ae=e.useCallback((t,u,y)=>{if(u.target.classList.contains("wx-line")||(y||(y=l.getTask(ze(t))),y.type==="milestone"||y.type==="summary"))return"";const S=Te.locate(u,"data-segment");S&&(t=S);const{left:$,width:X}=t.getBoundingClientRect(),J=(u.clientX-$)/X;let ge=.2/(X>200?X/200:1);return J<ge?"start":J>1-ge?"end":""},[l]),De=e.useMemo(()=>{const t=new Map;if(!a||!o)return x.forEach(S=>{t.set(S.id,S.$y)}),t;const u=new Map,y=[];return x.forEach(S=>{const $=o.taskRows.get(S.id)??S.id;u.has($)||(u.set($,y.length),y.push($))}),x.forEach(S=>{const $=o.taskRows.get(S.id)??S.id,X=u.get($)??0;t.set(S.id,X*Y)}),t},[x,a,o,Y]),w=e.useCallback(t=>{const u=Q.current;if(!u)return[];const y=u.parentElement?.scrollLeft||0,S=u.parentElement?.parentElement?.scrollTop||0,$=Math.min(t.startX,t.currentX),X=Math.max(t.startX,t.currentX),J=Math.min(t.startY,t.currentY),ge=Math.max(t.startY,t.currentY);return x.filter(xe=>{const Le=xe.$x-y,Pe=xe.$x+xe.$w-y,Ae=(De.get(xe.id)??xe.$y)-S,$e=Ae+xe.$h;return Le<X&&Pe>$&&Ae<ge&&$e>J})},[x,De]),re=e.useMemo(()=>new Set(R.map(t=>t.id)),[R,B]),he=e.useCallback(t=>re.has(t),[re]),O=e.useCallback((t,u)=>{const{clientX:y}=u,S=ze(t),$=l.getTask(S),X=u.target.classList;if(!u.target.closest(".wx-delete-button")&&!n){if(X.contains("wx-progress-marker")){const{progress:J}=l.getTask(S);te.current={id:S,x:y,progress:J,dx:0,node:t,marker:u.target},u.target.classList.add("wx-progress-in-drag")}else{const J=ae(t,u,$)||"move",ge={id:S,mode:J,x:y,dx:0,l:$.$x,w:$.$w};if(g&&$.segments?.length){const xe=Te.locate(u,"data-segment");xe&&(ge.segmentIndex=xe.dataset.segment*1,pe.extendDragOptions($,ge))}oe(ge)}q()}},[l,n,ae,q,g]),U=e.useCallback(t=>{if(t.button!==0)return;const u=Te.locate(t);if(!u&&D&&!n){const y=Q.current;if(!y)return;const S=y.getBoundingClientRect(),$=t.clientX-S.left,X=t.clientY-S.top;if(h){const J=y.parentElement?.scrollLeft||0,ge=$+J,xe=Et(ge,m);xe&&F(xe)}b({startX:$,startY:X,currentX:$,currentY:X,ctrlKey:t.ctrlKey||t.metaKey}),q();return}if(u){if(D&&!n&&R.length>1){const y=ze(u);if(he(y)){const S=t.target.classList;if(!S.contains("wx-link")&&!S.contains("wx-progress-marker")&&!t.target.closest(".wx-delete-button")){const $=l.getTask(y);if(!ae(u,t,$)){const J=new Map;R.forEach(ge=>{const xe=l.getTask(ge.id);if(xe){if(G?.auto&&xe.type==="summary")return;J.set(ge.id,{$x:xe.$x,$w:xe.$w,start:xe.start,end:xe.end})}}),Z({baseTaskId:y,startX:t.clientX,dx:0,originalPositions:J}),q();return}}}}O(u,t)}},[O,D,h,n,R,he,l,ae,G,q,m]),we=e.useCallback(t=>{const u=Te.locate(t);u&&(Ce.current=setTimeout(()=>{Re(!0),O(u,t.touches[0])},300))},[O]),be=e.useCallback(t=>{ce(t&&{...p.find(u=>u.id===t)})},[p]),Me=e.useCallback(()=>{if(L){const t=w(L);L.ctrlKey?t.forEach(u=>{l.exec("select-task",{id:u.id,toggle:!0,marquee:!0})}):(R.length>0&&l.exec("select-task",{id:null,marquee:!0}),t.forEach((u,y)=>{l.exec("select-task",{id:u.id,toggle:y>0,marquee:!0})})),b(null),ie(),se.current=!0;return}if(P){const{dx:t,originalPositions:u}=P,y=Math.round(t/W);if(y!==0){let S=!0;u.forEach(($,X)=>{const J=l.getTask(X);J&&(l.exec("update-task",{id:X,diff:y,task:{start:J.start,end:J.end},skipUndo:!S}),S=!1)}),se.current=!0}else u.forEach((S,$)=>{l.exec("drag-task",{id:$,left:S.$x,width:S.$w,inProgress:!1})});Z(null),ie();return}if(te.current){const{dx:t,id:u,marker:y,value:S}=te.current;te.current=null,typeof S<"u"&&t&&l.exec("update-task",{id:u,task:{progress:S},inProgress:!1}),y.classList.remove("wx-progress-in-drag"),se.current=!0,ie()}else if(N){const{id:t,mode:u,dx:y,l:S,w:$,start:X,segment:J,index:ge}=N;if(oe(null),X){const xe=Math.round(y/W);if(!xe)l.exec("drag-task",{id:t,width:$,left:S,inProgress:!1,...J&&{segmentIndex:ge}});else{let Le={},Pe=l.getTask(t);J&&(Pe=Pe.segments[ge]);const _e=1440*60*1e3,$e=xe*(le==="week"?7:le==="month"?30:le==="quarter"?91:le==="year"?365:1)*_e;u==="move"?(Le.start=new Date(Pe.start.getTime()+$e),Le.end=new Date(Pe.end.getTime()+$e)):u==="start"?(Le.start=new Date(Pe.start.getTime()+$e),Le.end=Pe.end):u==="end"&&(Le.start=Pe.start,Le.end=new Date(Pe.end.getTime()+$e)),l.exec("update-task",{id:t,task:Le,...J&&{segmentIndex:ge}})}se.current=!0}ie()}},[l,ie,N,W,le,L,P,w,R]),ve=e.useCallback((t,u)=>{const{clientX:y,clientY:S}=u;if(!n){if(L){const $=Q.current;if(!$)return;const X=$.getBoundingClientRect(),J=y-X.left,ge=S-X.top;b(xe=>({...xe,currentX:J,currentY:ge}));return}if(P){const $=y-P.startX;P.originalPositions.forEach((X,J)=>{const ge=X.$x+$;l.exec("drag-task",{id:J,left:ge,width:X.$w,inProgress:!0})}),Z(X=>({...X,dx:$}));return}if(te.current){const{node:$,x:X,id:J}=te.current,ge=te.current.dx=y-X,xe=Math.round(ge/$.offsetWidth*100);let Le=te.current.progress+xe;te.current.value=Le=Math.min(Math.max(0,Le),100),l.exec("update-task",{id:J,task:{progress:Le},inProgress:!0})}else if(N){be(null);const{mode:$,l:X,w:J,x:ge,id:xe,start:Le,segment:Pe,index:_e}=N,Ae=l.getTask(xe),$e=y-ge;if(!Le&&Math.abs($e)<20||$==="start"&&J-$e<W||$==="end"&&J+$e<W||$==="move"&&($e<0&&X+$e<0||$e>0&&X+J+$e>je)||N.segment&&!pe.isSegmentMoveAllowed(Ae,N))return;const Fe={...N,dx:$e};let Oe,qe;if($==="start"?(Oe=X+$e,qe=J-$e):$==="end"?(Oe=X,qe=J+$e):$==="move"&&(Oe=X+$e,qe=J),l.exec("drag-task",{id:xe,width:qe,left:Oe,inProgress:!0,...Pe&&{segmentIndex:_e}}),!Fe.start&&($==="move"&&Ae.$x==X||$!=="move"&&Ae.$w==J)){se.current=!0,Me();return}Fe.start=!0,oe(Fe)}else{const $=Te.locate(t);if($){const X=l.getTask(ze($)),ge=Te.locate(t,"data-segment")||$,xe=ae(ge,u,X);ge.style.cursor=xe&&!n?"col-resize":"pointer"}}}},[l,n,N,W,je,ae,be,Me,L,P]),Ie=e.useCallback(t=>{ve(t,t)},[ve]),Ge=e.useCallback(t=>{me?(t.preventDefault(),ve(t,t.touches[0])):Ce.current&&(clearTimeout(Ce.current),Ce.current=null)},[me,ve]),i=e.useCallback(()=>{Me()},[Me]),k=e.useCallback(()=>{Re(null),Ce.current&&(clearTimeout(Ce.current),Ce.current=null),Me()},[Me]);e.useEffect(()=>(window.addEventListener("mouseup",i),()=>{window.removeEventListener("mouseup",i)}),[i]);const C=e.useCallback(t=>{if(!n){const u=Te.locateID(t.target);if(u&&!t.target.classList.contains("wx-link")){const y=Te.locateID(t.target,"data-segment");l.exec("show-editor",{id:u,...y!==null&&{segmentIndex:y}})}}},[l,n]),_=["e2s","s2s","e2e","s2e"],fe=e.useCallback((t,u)=>_[(t?1:0)+(u?0:2)],[]),ue=e.useCallback((t,u)=>{const y=d.id,S=d.start;return t===y?!0:!!p.find($=>$.target==t&&$.source==y&&$.type===fe(S,u))},[d,K,fe]),Ee=e.useCallback(()=>{d&&v(null)},[d]),Ne=e.useCallback(t=>{if(se.current){se.current=!1;return}const u=Te.locateID(t.target);if(u){const y=t.target.classList;if(y.contains("wx-link")){const S=y.contains("wx-left");if(!d){v({id:u,start:S});return}d.id!==u&&!ue(u,S)&&l.exec("add-link",{link:{source:d.id,target:u,type:fe(d.start,S)}})}else if(y.contains("wx-delete-button-icon"))l.exec("delete-link",{id:ne.id}),ce(null);else{let S;const $=Te.locate(t,"data-segment");$&&(S=$.dataset.segment*1),l.exec("select-task",{id:u,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:S})}}Ee()},[l,d,K,ne,ue,fe,Ee]),xt=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),mt=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),ht=e.useCallback(t=>{if(me||Ce.current)return t.preventDefault(),!1},[me]),Qe=e.useMemo(()=>H.map(t=>t.id),[H]),Ze=e.useCallback(t=>{let u=Qe.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(u=`task ${u}`),u},[Qe]),Je=e.useCallback(t=>{l.exec(t.action,t.data)},[l]),Be=e.useCallback(t=>z&&E.byId(t).$critical,[z,E]),et=e.useCallback(t=>{if(G?.auto){const u=E.getSummaryId(t,!0),y=E.getSummaryId(d.id,!0);return d?.id&&!(Array.isArray(u)?u:[u]).includes(d.id)&&!(Array.isArray(y)?y:[y]).includes(t)}return d},[G,E,d]),tt=e.useRef(null);tt.current=V;const st=e.useCallback(()=>{const t=l.getState()._selected;if(!t||!t.length)return;const u=t.map(X=>{const J=l.getTask(X.id);if(!J)return null;const{$x:ge,$y:xe,$w:Le,$h:Pe,$skip:_e,$level:Ae,$index:$e,$y_base:Fe,$x_base:Oe,$w_base:qe,$h_base:es,$skip_baseline:ts,$critical:ss,$reorder:ns,...gt}=J;return gt}).filter(Boolean);if(!u.length)return;const S=u[0].parent,$=u.filter(X=>X.parent===S);$.length!==0&&(Xe=$,Ye=S,Ve=Xe.reduce((X,J)=>J.start&&(!X||J.start<X)?J.start:X,null))},[l]),nt=e.useCallback(()=>{const t=tt.current;if(!Xe.length||!t||!Ve||Ye==null)return;const u=t.getTime()-Ve.getTime(),y=l.getHistory();y?.startBatch(),Xe.forEach((S,$)=>{const X=`task-${Date.now()}-${$}`,J=S.start?new Date(S.start.getTime()+u):null,ge=S.end?new Date(S.end.getTime()+u):null;l.exec("add-task",{task:{...S,id:X,start:J,end:ge,parent:Ye,row:S.row},target:Ye,mode:"child",skipUndo:$>0})}),y?.endBatch()},[l]);e.useEffect(()=>h?l.intercept("hotkey",u=>{if(u.key==="ctrl+c"||u.key==="meta+c")return st(),!1;if(u.key==="ctrl+v"||u.key==="meta+v")return nt(),!1}):void 0,[h,l,st,nt]);const rt=e.useMemo(()=>{if(!L)return null;const t=Math.min(L.startX,L.currentX),u=Math.min(L.startY,L.currentY),y=Math.abs(L.currentX-L.startX),S=Math.abs(L.currentY-L.startY);return{left:`${t}px`,top:`${u}px`,width:`${y}px`,height:`${S}px`}},[L]);return c.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${de.length?de[0].$h:0}px`},ref:Q,onContextMenu:ht,onMouseDown:U,onMouseMove:Ie,onTouchStart:we,onTouchMove:Ge,onTouchEnd:k,onClick:Ne,onDoubleClick:C,onDragStart:t=>(t.preventDefault(),!1),children:[c.jsx(Ct,{onSelectLink:be,selectedLink:ne,readonly:n}),de.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const u=`wx-bar wx-${Ze(t.type)}`+(me&&N&&t.id===N.id?" wx-touch":"")+(d&&d.id===t.id?" wx-selected":"")+(re.has(t.id)?" wx-selected":"")+(Be(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(g&&t.segments?" wx-split":""),y="wx-link wx-left"+(d?" wx-visible":"")+(!d||!ue(t.id,!0)&&et(t.id)?" wx-target":"")+(d&&d.id===t.id&&d.start?" wx-selected":"")+(Be(t.id)?" wx-critical":""),S="wx-link wx-right"+(d?" wx-visible":"")+(!d||!ue(t.id,!1)&&et(t.id)?" wx-target":"")+(d&&d.id===t.id&&!d.start?" wx-selected":"")+(Be(t.id)?" wx-critical":"");return c.jsxs(e.Fragment,{children:[!t.$skip&&c.jsxs("div",{className:"wx-GKbcLEGA "+u,style:xt(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:T===t.id?0:-1,children:[n?null:t.id===ne?.target&&ne?.type[2]==="s"?c.jsx(ke.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+y,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?c.jsxs(c.Fragment,{children:[t.progress&&!(g&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:c.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(g&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?c.jsx(r,{data:t,api:l,onAction:Je}):g&&t.segments?c.jsx(St,{task:t,type:Ze(t.type)}):c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?c.jsx(r,{data:t,api:l,onAction:Je}):c.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===ne?.target&&ne?.type[2]==="e"?c.jsx(ke.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+S,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),f&&!t.$skip_baseline?c.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:mt(t)}):null]},t.id)}),L&&rt&&c.jsx("div",{className:"wx-GKbcLEGA wx-marquee-selection",style:rt})]})}function jt(s){const{highlightTime:n}=s,r=e.useContext(He),a=M.useStore(r,"_scales");return c.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:a.width},children:(a?.rows||[]).map((o,D)=>c.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${o.height}px`},children:(o.cells||[]).map((h,l)=>{const x=n?n(h.date,h.unit):"",A="wx-cell "+(h.css||"")+" "+(x||""),p=typeof h.value=="string"&&h.value.includes("<");return c.jsx("div",{className:"wx-ZkvhDKir "+A,style:{width:`${h.width}px`},...p?{dangerouslySetInnerHTML:{__html:h.value}}:{children:h.value}},l)})},D))})}const $t=new Map;function Dt(s){const n=e.useRef(null),r=e.useRef(0),a=e.useRef(null),o=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(o)return cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{const D={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};$t.set(s,D),window.dispatchEvent(new CustomEvent("render-metric",{detail:D}))}),()=>cancelAnimationFrame(a.current)})}function Lt(s){const{readonly:n,fullWidth:r,fullHeight:a,taskTemplate:o,cellBorders:D,highlightTime:h,multiTaskRows:l=!1,rowMapping:x=null,marqueeSelect:A=!1,copyPaste:p=!1,scrollToCurrentWeek:K=!1,currentWeekColor:j=null}=s,m=e.useContext(He),[H,f]=M.useStoreWithCounter(m,"_selected"),R=M.useStore(m,"scrollTop"),B=M.useStore(m,"cellHeight"),I=M.useStore(m,"cellWidth"),z=M.useStore(m,"_scales"),E=M.useStore(m,"_markers"),G=M.useStore(m,"_scrollTask"),g=M.useStore(m,"zoom"),ee=M.useStore(m,"_tasks"),[Y,de]=e.useState(),W=e.useRef(null),le=e.useRef(0),se=e.useRef(!1),d=1+(z?.rows?.length||0),v=e.useMemo(()=>{if(!l||!x||!ee?.length)return null;const b=new Map,P=new Map,Z=[];return ee.forEach(V=>{const F=x.taskRows.get(V.id)??V.id;P.has(F)||(P.set(F,Z.length),Z.push(F))}),ee.forEach(V=>{const F=x.taskRows.get(V.id)??V.id,Q=P.get(F)??0;b.set(V.id,Q*B)}),b},[ee,l,x,B]),N=e.useMemo(()=>{const b=[];return H&&H.length&&B&&H.forEach(P=>{const Z=v?.get(P.id)??P.$y;b.push({height:`${B}px`,top:`${Z-3}px`})}),b},[f,B,v]),oe=e.useMemo(()=>Math.max(Y||0,a),[Y,a]);e.useEffect(()=>{const b=W.current;b&&typeof R=="number"&&(b.scrollTop=R)},[R]);const te=()=>{ne()};function ne(b){const P=W.current;if(!P)return;const Z={};Z.left=P.scrollLeft,m.exec("scroll-chart",Z)}function ce(){const b=W.current,Z=Math.ceil((Y||0)/(B||1))+1,V=Math.floor((b&&b.scrollTop||0)/(B||1)),F=Math.max(0,V-d),Q=V+Z+d,ye=F*(B||0);m.exec("render-data",{start:F,end:Q,from:ye})}e.useEffect(()=>{ce()},[Y,R]);const me=e.useCallback(b=>{if(!b)return;const{id:P,mode:Z}=b;if(Z.toString().indexOf("x")<0)return;const V=W.current;if(!V)return;const{clientWidth:F}=V,Q=m.getTask(P);if(Q.$x+Q.$w<V.scrollLeft)m.exec("scroll-chart",{left:Q.$x-(I||0)}),V.scrollLeft=Q.$x-(I||0);else if(Q.$x>=F+V.scrollLeft){const ye=F<Q.$w?I||0:Q.$w;m.exec("scroll-chart",{left:Q.$x-F+ye}),V.scrollLeft=Q.$x-F+ye}},[m,I]);e.useEffect(()=>{me(G)},[G]);function Re(b){if(g&&(b.ctrlKey||b.metaKey)){b.preventDefault();const P=W.current,Z=b.clientX-(P?P.getBoundingClientRect().left:0);if(le.current+=b.deltaY,Math.abs(le.current)>=150){const F=-Math.sign(le.current);le.current=0,m.exec("zoom-scale",{dir:F,offset:Z})}}}const Ce=e.useCallback(b=>{const P=h(b.date,b.unit);return P?{css:P,width:b.width}:null},[h]),je=e.useMemo(()=>{if(!z||!h||!["hour","day","week"].includes(z.minUnit))return null;let P=0;return z.rows[z.rows.length-1].cells.map(Z=>{const V=Ce(Z),F=P;return P+=Z.width,V?{...V,left:F}:null})},[z,h,Ce]),Se=e.useCallback(b=>{b.eventSource="chart",m.exec("hotkey",b)},[m]);e.useEffect(()=>{const b=W.current;if(!b)return;const P=()=>de(b.clientHeight);P();const Z=new ResizeObserver(()=>P());return Z.observe(b),()=>{Z.disconnect()}},[W.current]);const L=e.useRef(null);return e.useEffect(()=>{const b=W.current;if(b&&!L.current)return L.current=at.hotkeys(b,{keys:{arrowup:!0,arrowdown:!0},exec:P=>Se(P)}),()=>{L.current?.destroy(),L.current=null}},[]),e.useEffect(()=>{const b=W.current;if(!b)return;const P=Re;return b.addEventListener("wheel",P),()=>{b.removeEventListener("wheel",P)}},[Re]),e.useEffect(()=>{if(!K||se.current||!z||!W.current||!Y)return;const b=W.current,{clientWidth:P}=b,Z=new Date,V=z.rows[z.rows.length-1]?.cells;if(!V)return;let F=-1,Q=0;const ye=[];for(let q=0;q<V.length;q++){const ie=V[q];ye.push({left:Q,width:ie.width});const ae=ie.date;if(ie.unit==="week"){const De=new Date(ae);De.setDate(De.getDate()+7),Z>=ae&&Z<De&&(F=q)}else ie.unit==="day"&&Z.getFullYear()===ae.getFullYear()&&Z.getMonth()===ae.getMonth()&&Z.getDate()===ae.getDate()&&(F=q);Q+=ie.width}let T=F;if(F>0&&(T=F-1),T>=0&&ye[T]){const q=ye[T],ie=Math.max(0,q.left);b.scrollLeft=ie,m.exec("scroll-chart",{left:ie}),se.current=!0}},[K,z,Y,m]),Dt("chart"),c.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:W,onScroll:te,children:[c.jsx(jt,{highlightTime:h,scales:z}),E&&E.length?c.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${oe}px`},children:E.map((b,P)=>c.jsx("div",{className:`wx-mR7v2Xag wx-marker ${b.css||""}`,style:{left:`${b.left}px`},children:c.jsx("div",{className:"wx-mR7v2Xag wx-content",children:b.text})},P))}):null,c.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${oe}px`},children:[je?c.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:je.map((b,P)=>b?c.jsx("div",{className:"wx-mR7v2Xag "+b.css,style:{width:`${b.width}px`,left:`${b.left}px`}},P):null)}):null,c.jsx(Mt,{borders:D}),H&&H.length?H.map((b,P)=>b.$y?c.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":b.id,style:N[P]},b.id):null):null,c.jsx(Rt,{readonly:n,taskTemplate:o,multiTaskRows:l,rowMapping:x,marqueeSelect:A,copyPaste:p})]})]})}function It(s){const{position:n="after",size:r=4,dir:a="x",onMove:o,onDisplayChange:D,compactMode:h,containerWidth:l=0,leftThreshold:x=50,rightThreshold:A=50}=s,[p,K]=M.useWritableProp(s.value??0),[j,m]=M.useWritableProp(s.display??"all");function H(ne){let ce=0;n=="center"?ce=r/2:n=="before"&&(ce=r);const me={size:[r+"px","auto"],p:[ne-ce+"px","0px"],p2:["auto","0px"]};if(a!="x")for(let Re in me)me[Re]=me[Re].reverse();return me}const[f,R]=e.useState(!1),[B,I]=e.useState(null),z=e.useRef(0),E=e.useRef(),G=e.useRef(),g=e.useRef(j);e.useEffect(()=>{g.current=j},[j]),e.useEffect(()=>{B===null&&p>0&&I(p)},[B,p]);function ee(ne){return a=="x"?ne.clientX:ne.clientY}const Y=e.useCallback(ne=>{const ce=E.current+ee(ne)-z.current;K(ce);let me;ce<=x?me="chart":l-ce<=A?me="grid":me="all",g.current!==me&&(m(me),g.current=me),G.current&&clearTimeout(G.current),G.current=setTimeout(()=>o&&o(ce),100)},[l,x,A,o]),de=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",R(!1),window.removeEventListener("mousemove",Y),window.removeEventListener("mouseup",de)},[Y]),W=e.useMemo(()=>j!=="all"?"auto":a=="x"?"ew-resize":"ns-resize",[j,a]),le=e.useCallback(ne=>{!h&&(j==="grid"||j==="chart")||(z.current=ee(ne),E.current=p,R(!0),document.body.style.cursor=W,document.body.style.userSelect="none",window.addEventListener("mousemove",Y),window.addEventListener("mouseup",de))},[W,Y,de,p,h,j]);function se(){m("all"),B!==null&&(K(B),o&&o(B))}function d(ne){if(h){const ce=j==="chart"?"grid":"chart";m(ce),D(ce)}else if(j==="grid"||j==="chart")se(),D("all");else{const ce=ne==="left"?"chart":"grid";m(ce),D(ce)}}function v(){d("left")}function N(){d("right")}const oe=e.useMemo(()=>H(p),[p,n,r,a]),te=["wx-resizer",`wx-resizer-${a}`,`wx-resizer-display-${j}`,f?"wx-resizer-active":""].filter(Boolean).join(" ");return c.jsxs("div",{className:"wx-pFykzMlT "+te,onMouseDown:le,style:{width:oe.size[0],height:oe.size[1],cursor:W},children:[c.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:v})}),c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:N})})]}),c.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const Nt=650;function dt(s){let n;function r(){n=new ResizeObserver(o=>{for(let D of o)if(D.target===document.body){let h=D.contentRect.width<=Nt;s(h)}}),n.observe(document.body)}function a(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:a}}function Pt(s){const{taskTemplate:n,readonly:r,cellBorders:a,highlightTime:o,onTableAPIChange:D,multiTaskRows:h=!1,rowMapping:l=null,marqueeSelect:x=!1,copyPaste:A=!1,scrollToCurrentWeek:p=!1,currentWeekColor:K=null}=s,j=e.useContext(He),m=M.useStore(j,"_tasks"),H=M.useStore(j,"_scales"),f=M.useStore(j,"cellHeight"),R=M.useStore(j,"columns"),B=M.useStore(j,"_scrollTask"),I=M.useStore(j,"undo"),z=e.useMemo(()=>{if(!h)return l;const T=new Map,q=new Map;return m.forEach(ie=>{const ae=ie.row??ie.id;q.set(ie.id,ae),T.has(ae)||T.set(ae,[]),T.get(ae).push(ie.id)}),{rowMap:T,taskRows:q}},[m,h,l]),[E,G]=e.useState(!1);let[g,ee]=e.useState(0);const[Y,de]=e.useState(0),[W,le]=e.useState(0),[se,d]=e.useState(void 0),[v,N]=e.useState("all"),oe=e.useRef(null),te=e.useCallback(T=>{G(q=>(T!==q&&(T?(oe.current=v,v==="all"&&N("grid")):(!oe.current||oe.current==="all")&&N("all")),T))},[v]);e.useEffect(()=>{const T=dt(te);return T.observe(),()=>{T.disconnect()}},[te]);const ne=e.useMemo(()=>{let T;return R.every(q=>q.width&&!q.flexgrow)?T=R.reduce((q,ie)=>q+parseInt(ie.width),0):E&&v==="chart"?T=parseInt(R.find(q=>q.id==="action")?.width)||50:T=440,g=T,T},[R,E,v]);e.useEffect(()=>{ee(ne)},[ne]);const ce=e.useMemo(()=>(Y??0)-(se??0),[Y,se]),me=e.useMemo(()=>H.width,[H]),Re=e.useMemo(()=>{if(!h||!z)return m.length*f;const T=new Set;return m.forEach(q=>{const ie=z.taskRows.get(q.id)??q.id;T.add(ie)}),T.size*f},[m,f,h,z]),Ce=e.useMemo(()=>H.height+Re+ce,[H,Re,ce]),je=e.useMemo(()=>g+me,[g,me]),Se=e.useRef(null),L=e.useCallback(()=>{Promise.resolve().then(()=>{if((Y??0)>(je??0)){const T=(Y??0)-g;j.exec("expand-scale",{minWidth:T})}})},[Y,je,g,j]);e.useEffect(()=>{let T;return Se.current&&(T=new ResizeObserver(L),T.observe(Se.current)),()=>{T&&T.disconnect()}},[Se.current,L]),e.useEffect(()=>{L()},[me]);const b=e.useRef(null),P=e.useRef(null),Z=e.useCallback(()=>{const T=b.current;T&&j.exec("scroll-chart",{top:T.scrollTop})},[j]),V=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{V.current={rTasks:m,rScales:H,rCellHeight:f,scrollSize:ce,ganttDiv:b.current,ganttHeight:W??0}},[m,H,f,ce,W]);const F=e.useCallback(T=>{if(!T)return;const{rTasks:q,rScales:ie,rCellHeight:ae,scrollSize:De,ganttDiv:w,ganttHeight:re}=V.current;if(!w)return;const{id:he}=T,O=q.findIndex(U=>U.id===he);if(O>-1){const U=re-ie.height,we=O*ae,be=w.scrollTop;let Me=null;we<be?Me=we:we+ae>be+U&&(Me=we-U+ae+De),Me!==null&&(j.exec("scroll-chart",{top:Math.max(Me,0)}),b.current.scrollTop=Math.max(Me,0))}},[j]);e.useEffect(()=>{F(B)},[B]),e.useEffect(()=>{const T=b.current,q=P.current;if(!T||!q)return;const ie=()=>{pt.flushSync(()=>{le(T.offsetHeight),de(T.offsetWidth),d(q.offsetWidth)})},ae=new ResizeObserver(ie);return ae.observe(T),()=>ae.disconnect()},[b.current]);const Q=e.useRef(null),ye=e.useRef(null);return e.useEffect(()=>{ye.current&&(ye.current.destroy(),ye.current=null);const T=Q.current;if(T)return ye.current=at.hotkeys(T,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,"meta+c":!0,"meta+v":!0,"meta+x":!0,"meta+d":!0,backspace:!0,"ctrl+z":I,"ctrl+y":I,"meta+z":I,"meta+shift+z":I},exec:q=>{q.isInput||j.exec("hotkey",q)}}),()=>{ye.current?.destroy(),ye.current=null}},[I]),c.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:b,onScroll:Z,children:c.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:Ce,width:"100%"},ref:P,children:c.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:W,width:se},children:c.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:Q,children:[R.length?c.jsxs(c.Fragment,{children:[c.jsx(Tt,{display:v,compactMode:E,columnWidth:ne,width:g,readonly:r,fullHeight:Re,onTableAPIChange:D,multiTaskRows:h,rowMapping:z}),c.jsx(It,{value:g,display:v,compactMode:E,containerWidth:Y,onMove:T=>ee(T),onDisplayChange:T=>N(T)})]}):null,c.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:Se,children:c.jsx(Lt,{readonly:r,fullWidth:me,fullHeight:Re,taskTemplate:n,cellBorders:a,highlightTime:o,multiTaskRows:h,rowMapping:z,marqueeSelect:x,copyPaste:A,scrollToCurrentWeek:p,currentWeekColor:K})})]})})})})}function At(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function Wt(s,n){return typeof s=="function"?s:Te.dateToString(s,n)}function ft(s,n){return s.map(({format:r,...a})=>({...a,format:Wt(r,n)}))}function Ht(s,n){const r=At(n);for(let a in r)r[a]=Te.dateToString(r[a],s);return r}function zt(s,n){if(!s||!s.length)return s;const r=Te.dateToString("%d-%m-%Y",n);return s.map(a=>a.template?a:a.id==="start"||a.id=="end"?{...a,_template:o=>r(o),template:o=>r(o)}:a.id==="duration"?{...a,_template:o=>o,template:o=>o}:a)}function Gt(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:ft(r.scales,n)}))}:s}const _t=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),Ot=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],qt=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:a=pe.defaultTaskTypes,tasks:o=[],selected:D=[],activeTask:h=null,links:l=[],scales:x=Ot,columns:A=pe.defaultColumns,start:p=null,end:K=null,lengthUnit:j="day",durationUnit:m="day",cellWidth:H=100,cellHeight:f=38,scaleHeight:R=36,readonly:B=!1,cellBorders:I="full",zoom:z=!1,baselines:E=!1,highlightTime:G=null,init:g=null,autoScale:ee=!0,unscheduledTasks:Y=!1,criticalPath:de=null,schedule:W={type:"forward"},projectStart:le=null,projectEnd:se=null,calendar:d=null,undo:v=!1,splitTasks:N=!1,multiTaskRows:oe=!1,marqueeSelect:te=!1,copyPaste:ne=!1,currentWeekHighlight:ce=!1,currentWeekColor:me=null,scrollToCurrentWeek:Re=!1,...Ce},je){const Se=e.useRef();Se.current=Ce;const L=e.useMemo(()=>new pe.DataStore(M.writable),[]),b=e.useMemo(()=>({...Ue.en,...Ke.en}),[]),P=e.useContext(ke.context.i18n),Z=e.useMemo(()=>P?P.extend(b,!0):Te.locale(b),[P,b]),V=e.useMemo(()=>Z.getRaw().calendar,[Z]),F=e.useMemo(()=>{let U={zoom:Gt(z,V),scales:ft(x,V),columns:zt(A,V),links:pe.normalizeLinks(l),cellWidth:H};return U.zoom&&(U={...U,...pe.normalizeZoom(U.zoom,Ht(V,Z.getGroup("gantt")),U.scales,H)}),U},[z,x,A,l,H,V,Z]),Q=e.useRef(null);Q.current!==o&&(pe.parseTaskDates(o,{durationUnit:m,splitTasks:N,calendar:d}),Q.current=o),e.useEffect(()=>{pe.parseTaskDates(o,{durationUnit:m,splitTasks:N,calendar:d})},[o,m,d,N]);const ye=e.useMemo(()=>{if(!oe)return null;const U=new Map,we=new Map,be=Me=>{Me.forEach(ve=>{const Ie=ve.row??ve.id;we.set(ve.id,Ie),U.has(Ie)||U.set(Ie,[]),U.get(Ie).push(ve.id),ve.data&&ve.data.length>0&&be(ve.data)})};return be(o),{rowMap:U,taskRows:we}},[o,oe]),T=e.useMemo(()=>L.in,[L]),q=e.useRef(null);q.current===null&&(q.current=new wt.EventBusRouter((U,we)=>{const be="on"+_t(U);Se.current&&Se.current[be]&&Se.current[be](we)}),T.setNext(q.current));const[ie,ae]=e.useState(null),De=e.useRef(null);De.current=ie;const w=e.useMemo(()=>({getState:L.getState.bind(L),getReactiveState:L.getReactive.bind(L),getStores:()=>({data:L}),exec:T.exec,setNext:U=>(q.current=q.current.setNext(U),q.current),intercept:T.intercept.bind(T),on:T.on.bind(T),detach:T.detach.bind(T),getTask:L.getTask.bind(L),serialize:L.serialize.bind(L),getTable:U=>U?new Promise(we=>setTimeout(()=>we(De.current),1)):De.current,getHistory:()=>L.getHistory()}),[L,T]);e.useImperativeHandle(je,()=>({...w}),[w]);const re=e.useRef(0);e.useEffect(()=>{re.current?L.init({tasks:o,links:F.links,start:p,columns:F.columns,end:K,lengthUnit:j,cellWidth:F.cellWidth,cellHeight:f,scaleHeight:R,scales:F.scales,taskTypes:a,zoom:F.zoom,selected:D,activeTask:h,baselines:E,autoScale:ee,unscheduledTasks:Y,markers:r,durationUnit:m,criticalPath:de,schedule:W,projectStart:le,projectEnd:se,calendar:d,undo:v,_weekStart:V.weekStart,splitTasks:N}):g&&g(w),re.current++},[w,g,o,F,p,K,j,f,R,a,D,h,E,ee,Y,r,m,de,W,le,se,d,v,V,N,L]),re.current===0&&L.init({tasks:o,links:F.links,start:p,columns:F.columns,end:K,lengthUnit:j,cellWidth:F.cellWidth,cellHeight:f,scaleHeight:R,scales:F.scales,taskTypes:a,zoom:F.zoom,selected:D,activeTask:h,baselines:E,autoScale:ee,unscheduledTasks:Y,markers:r,durationUnit:m,criticalPath:de,schedule:W,projectStart:le,projectEnd:se,calendar:d,undo:v,_weekStart:V.weekStart,splitTasks:N});const he=e.useMemo(()=>{const U=new Date,we=V?.weekStart??0,be=new Date(U),ve=(be.getDay()-we+7)%7;be.setDate(be.getDate()-ve),be.setHours(0,0,0,0);const Ie=new Date(be);return Ie.setDate(Ie.getDate()+7),Ge=>Ge>=be&&Ge<Ie},[V]),O=e.useMemo(()=>(U,we)=>{let be=[];if(d)we=="day"&&!d.getDayHours(U)&&be.push("wx-weekend"),we=="hour"&&!d.getDayHours(U)&&be.push("wx-weekend");else if(G){const Me=G(U,we);Me&&be.push(Me)}return ce&&(we==="week"||we==="day")&&he(U)&&be.push("wx-current-week"),be.join(" ")},[d,G,ce,he]);return c.jsx(ke.context.i18n.Provider,{value:Z,children:c.jsx(He.Provider,{value:w,children:c.jsx(Pt,{taskTemplate:n,readonly:B,cellBorders:I,highlightTime:O,onTableAPIChange:ae,multiTaskRows:oe,rowMapping:ye,marqueeSelect:te,copyPaste:ne,scrollToCurrentWeek:Re,currentWeekColor:me})})})});function Yt({api:s=null,items:n=[]}){const r=e.useContext(ke.context.i18n),a=e.useMemo(()=>r||Te.locale(Ke.en),[r]),o=e.useMemo(()=>a.getGroup("gantt"),[a]),D=M.useStoreLater(s,"_selected"),h=M.useStoreLater(s,"undo"),l=M.useStoreLater(s,"history"),x=M.useStoreLater(s,"splitTasks"),A=["undo","redo"],p=e.useMemo(()=>{const j=pe.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:pe.getToolbarButtons({undo:h,splitTasks:x})).map(H=>{let f={...H,disabled:!1};return f.handler=pe.isHandledAction(j,f.id)?R=>pe.handleAction(s,R.id,null,o):f.handler,f.text&&(f.text=o(f.text)),f.menuText&&(f.menuText=o(f.menuText)),f})},[n,s,o,h,x]),K=e.useMemo(()=>{const j=[];return p.forEach(m=>{const H=m.id;if(H==="add-task")j.push(m);else if(A.includes(H))A.includes(H)&&j.push({...m,disabled:m.isDisabled(l)});else{if(!D?.length||!s)return;j.push({...m,disabled:m.isDisabled&&D.some(f=>m.isDisabled(f,s.getState()))})}}),j.filter((m,H)=>{if(s&&m.isHidden)return!D.some(f=>m.isHidden(f,s.getState()));if(m.comp==="separator"){const f=j[H+1];if(!f||f.comp==="separator")return!1}return!0})},[s,D,l,p]);return r?c.jsx(ot.Toolbar,{items:K}):c.jsx(ke.context.i18n.Provider,{value:a,children:c.jsx(ot.Toolbar,{items:K})})}const Ft=e.forwardRef(function({options:n=[],api:r=null,resolver:a=null,filter:o=null,at:D="point",children:h,onClick:l,css:x},A){const p=e.useRef(null),K=e.useRef(null),j=e.useContext(ke.context.i18n),m=e.useMemo(()=>j||Te.locale({...Ke.en,...Ue.en}),[j]),H=e.useMemo(()=>m.getGroup("gantt"),[m]),f=M.useStoreLater(r,"taskTypes"),R=M.useStoreLater(r,"selected"),B=M.useStoreLater(r,"_selected"),I=M.useStoreLater(r,"splitTasks"),z=e.useMemo(()=>pe.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{p.current&&p.current.show&&p.current.show()}),r.on("drag-task",()=>{p.current&&p.current.show&&p.current.show()}))},[r]);function E(d){return d.map(v=>(v={...v},v.text&&(v.text=H(v.text)),v.subtext&&(v.subtext=H(v.subtext)),v.data&&(v.data=E(v.data)),v))}function G(){const d=n.length?n:pe.getMenuOptions({splitTasks:I}),v=d.find(N=>N.id==="convert-task");return v&&(v.data=[],(f||[]).forEach(N=>{v.data.push(v.dataFactory(N))})),E(d)}const g=e.useMemo(()=>G(),[r,n,f,I,H]),ee=e.useMemo(()=>B&&B.length?B:[],[B]),Y=e.useCallback((d,v)=>{let N=d?r?.getTask(d):null;if(a){const oe=a(d,v);N=oe===!0?N:oe}if(N){const oe=Te.locateID(v.target,"data-segment");oe!==null?K.current={id:N.id,segmentIndex:oe}:K.current=N.id,(!Array.isArray(R)||!R.includes(N.id))&&r&&r.exec&&r.exec("select-task",{id:N.id})}return N},[r,a,R]),de=e.useCallback(d=>{const v=d.action;v&&(pe.isHandledAction(z,v.id)&&pe.handleAction(r,v.id,K.current,H),l&&l(d))},[r,H,l,z]),W=e.useCallback((d,v)=>{const N=ee.length?ee:v?[v]:[];let oe=o?N.every(te=>o(d,te)):!0;if(oe&&(d.isHidden&&(oe=!N.some(te=>d.isHidden(te,r.getState(),K.current))),d.isDisabled)){const te=N.some(ne=>d.isDisabled(ne,r.getState(),K.current));d.disabled=te}return oe},[o,ee,r]);e.useImperativeHandle(A,()=>({show:(d,v)=>{p.current&&p.current.show&&p.current.show(d,v)}}));const le=e.useCallback(d=>{p.current&&p.current.show&&p.current.show(d)},[]),se=c.jsxs(c.Fragment,{children:[c.jsx(bt.ContextMenu,{filter:W,options:g,dataKey:"id",resolver:Y,onClick:de,at:D,ref:p,css:x}),c.jsx("span",{onContextMenu:le,"data-menu-ignore":"true",children:typeof h=="function"?h():h})]});if(!j&&ke.context.i18n?.Provider){const d=ke.context.i18n.Provider;return c.jsx(d,{value:m,children:se})}return se});function Xt({api:s,autoSave:n,onLinksChange:r}){const o=e.useContext(ke.context.i18n).getGroup("gantt"),D=M.useStore(s,"activeTask"),h=M.useStore(s,"_activeTask"),l=M.useStore(s,"_links"),x=M.useStore(s,"schedule"),A=M.useStore(s,"unscheduledTasks"),[p,K]=e.useState();function j(){if(D){const R=l.filter(I=>I.target==D).map(I=>({link:I,task:s.getTask(I.source)})),B=l.filter(I=>I.source==D).map(I=>({link:I,task:s.getTask(I.target)}));return[{title:o("Predecessors"),data:R},{title:o("Successors"),data:B}]}}e.useEffect(()=>{K(j())},[D,l]);const m=e.useMemo(()=>[{id:"e2s",label:o("End-to-start")},{id:"s2s",label:o("Start-to-start")},{id:"e2e",label:o("End-to-end")},{id:"s2e",label:o("Start-to-end")}],[o]);function H(R){n?s.exec("delete-link",{id:R}):(K(B=>(B||[]).map(I=>({...I,data:I.data.filter(z=>z.link.id!==R)}))),r&&r({id:R,action:"delete-link",data:{id:R}}))}function f(R,B){n?s.exec("update-link",{id:R,link:B}):(K(I=>(I||[]).map(z=>({...z,data:z.data.map(E=>E.link.id===R?{...E,link:{...E.link,...B}}:E)}))),r&&r({id:R,action:"update-link",data:{id:R,link:B}}))}return c.jsx(c.Fragment,{children:(p||[]).map((R,B)=>R.data.length?c.jsx("div",{className:"wx-j93aYGQf wx-links",children:c.jsx(ke.Field,{label:R.title,position:"top",children:c.jsx("table",{children:c.jsx("tbody",{children:R.data.map(I=>c.jsxs("tr",{children:[c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:I.task.text||""})}),x?.auto&&I.link.type==="e2s"?c.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:c.jsx(ke.Text,{type:"number",placeholder:o("Lag"),value:I.link.lag,disabled:A&&h?.unscheduled,onChange:z=>{z.input||f(I.link.id,{lag:z.value})}})}):null,c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:c.jsx(ke.Combo,{value:I.link.type,placeholder:o("Select link type"),options:m,onChange:z=>f(I.link.id,{type:z.value}),children:({option:z})=>z.label})})}),c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>H(I.link.id),role:"button"})})]},I.link.id))})})})},B):null)})}function Kt(s){const{value:n,time:r,format:a,onchange:o,onChange:D,...h}=s,l=D??o;function x(A){const p=new Date(A.value);p.setHours(n.getHours()),p.setMinutes(n.getMinutes()),l&&l({value:p})}return c.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[c.jsx(ke.DatePicker,{...h,value:n,onChange:x,format:a,buttons:["today"],clear:!1}),r?c.jsx(ke.TimePicker,{value:n,onChange:l,format:a}):null]})}We.registerEditorItem("select",ke.RichSelect);We.registerEditorItem("date",Kt);We.registerEditorItem("twostate",ke.TwoState);We.registerEditorItem("slider",ke.Slider);We.registerEditorItem("counter",ke.Counter);We.registerEditorItem("links",Xt);function Bt({api:s,items:n=[],css:r="",layout:a="default",readonly:o=!1,placement:D="sidebar",bottomBar:h=!0,topBar:l=!0,autoSave:x=!0,focus:A=!1,hotkeys:p={}}){const K=e.useContext(ke.context.i18n),j=e.useMemo(()=>K||Te.locale({...Ke.en,...Ue.en}),[K]),m=e.useMemo(()=>j.getGroup("gantt"),[j]),H=j.getRaw(),f=e.useMemo(()=>{const w=H.gantt?.dateFormat||H.formats?.dateFormat;return Te.dateToString(w,H.calendar)},[H]),R=e.useMemo(()=>{if(l===!0&&!o){const w=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:m("Delete"),id:"delete"}];return x?{items:w}:{items:[...w,{comp:"button",type:"primary",text:m("Save"),id:"save"}]}}return l},[l,o,x,m]),[B,I]=e.useState(!1),z=e.useMemo(()=>B?"wx-full-screen":"",[B]),E=e.useCallback(w=>{I(w)},[]);e.useEffect(()=>{const w=dt(E);return w.observe(),()=>{w.disconnect()}},[E]);const G=M.useStore(s,"_activeTask"),g=M.useStore(s,"activeTask"),ee=M.useStore(s,"unscheduledTasks"),Y=M.useStore(s,"links"),de=M.useStore(s,"splitTasks"),W=e.useMemo(()=>de&&g?.segmentIndex,[de,g]),le=e.useMemo(()=>W||W===0,[W]),se=e.useMemo(()=>pe.getEditorItems({unscheduledTasks:ee}),[ee]),d=M.useStore(s,"undo"),[v,N]=e.useState({}),[oe,te]=e.useState(null),[ne,ce]=e.useState(),[me,Re]=e.useState(null),Ce=M.useStore(s,"taskTypes"),je=e.useMemo(()=>{if(!G)return null;let w;if(le&&G.segments?w={...G.segments[W]}:w={...G},o){let re={parent:w.parent};return se.forEach(({key:he,comp:O})=>{if(O!=="links"){const U=w[he];O==="date"&&U instanceof Date?re[he]=f(U):O==="slider"&&he==="progress"?re[he]=`${U}%`:re[he]=U}}),re}return w||null},[G,le,W,o,se,f]);e.useEffect(()=>{ce(je)},[je]),e.useEffect(()=>{N({}),Re(null),te(null)},[g]);function Se(w,re){return w.map(he=>{const O={...he};if(he.config&&(O.config={...O.config}),O.comp==="links"&&s&&(O.api=s,O.autoSave=x,O.onLinksChange=P),O.comp==="select"&&O.key==="type"){const U=O.options??(Ce||[]);O.options=U.map(we=>({...we,label:m(we.label)}))}return O.comp==="slider"&&O.key==="progress"&&(O.labelTemplate=U=>`${m(O.label)} ${U}%`),O.label&&(O.label=m(O.label)),O.config?.placeholder&&(O.config.placeholder=m(O.config.placeholder)),re&&(O.isDisabled&&O.isDisabled(re,s.getState())?O.disabled=!0:delete O.disabled),O})}const L=e.useMemo(()=>{let w=n.length?n:se;return w=Se(w,ne),ne?w.filter(re=>!re.isHidden||!re.isHidden(ne,s.getState())):w},[n,se,ne,Ce,m,s,x]),b=e.useMemo(()=>L.map(w=>w.key),[L]);function P({id:w,action:re,data:he}){N(O=>({...O,[w]:{action:re,data:he}}))}const Z=e.useCallback(()=>{for(let w in v)if(Y.byId(w)){const{action:re,data:he}=v[w];s.exec(re,he)}},[s,v,Y]),V=e.useCallback(()=>{const w=g?.id||g;if(le){if(G?.segments){const re=G.segments.filter((he,O)=>O!==W);s.exec("update-task",{id:w,task:{segments:re}})}}else s.exec("delete-task",{id:w})},[s,g,le,G,W]),F=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),Q=e.useCallback(w=>{const{item:re,changes:he}=w;re.id==="delete"&&V(),re.id==="save"&&(he.length?F():Z()),re.comp&&F()},[s,g,x,Z,V,F]),ye=e.useCallback((w,re,he)=>(ee&&w.type==="summary"&&(w.unscheduled=!1),pe.prepareEditTask(w,s.getState(),re),he||te(!1),w),[ee,s]),T=e.useCallback(w=>{w={...w,unscheduled:ee&&w.unscheduled&&w.type!=="summary"},delete w.links,delete w.data,(b.indexOf("duration")===-1||w.segments&&!w.duration)&&delete w.duration;const re={id:g?.id||g,task:w,...le&&{segmentIndex:W}};x&&oe&&(re.inProgress=oe),s.exec("update-task",re),x||Z()},[s,g,ee,x,Z,b,le,W,oe]),q=e.useCallback(w=>{let{update:re,key:he,input:O}=w;if(O&&te(!0),w.update=ye({...re},he,O),!x)ce(w.update);else if(!me&&!O){const U=L.find(Me=>Me.key===he),we=re[he];(!U.validation||U.validation(we))&&(!U.required||we)&&T(w.update)}},[x,ye,me,L,T]),ie=e.useCallback(w=>{x||T(w.values)},[x,T]),ae=e.useCallback(w=>{Re(w.errors)},[]),De=e.useMemo(()=>d?{"ctrl+z":w=>{w.preventDefault(),s.exec("undo")},"ctrl+y":w=>{w.preventDefault(),s.exec("redo")}}:{},[d,s]);return je?c.jsx(ke.Locale,{children:c.jsx(We.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${z} ${r}`,items:L,values:je,topBar:R,bottomBar:h,placement:D,layout:a,readonly:o,autoSave:x,focus:A,onAction:Q,onSave:ie,onValidation:ae,onChange:q,hotkeys:p&&{...De,...p}})}):null}const Vt=({children:s,columns:n=null,api:r})=>{const[a,o]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(o)},[r]),c.jsx(ut.HeaderMenu,{api:a,columns:n,children:s})};function Ut(s){const{api:n,content:r,children:a}=s,o=e.useRef(null),D=e.useRef(null),[h,l]=e.useState({}),[x,A]=e.useState(null),[p,K]=e.useState({});function j(E){for(;E;){if(E.getAttribute){const G=E.getAttribute("data-tooltip-id"),g=E.getAttribute("data-tooltip-at"),ee=E.getAttribute("data-tooltip");if(G||ee)return{id:G,tooltip:ee,target:E,at:g}}E=E.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const E=D.current;if(E&&p&&(p.text||r)){const G=E.getBoundingClientRect();let g=!1,ee=p.left,Y=p.top;G.right>=h.right&&(ee=h.width-G.width-5,g=!0),G.bottom>=h.bottom&&(Y=p.top-(G.bottom-h.bottom+2),g=!0),g&&K(de=>de&&{...de,left:ee,top:Y})}},[p,h,r]);const m=e.useRef(null),H=300,f=E=>{clearTimeout(m.current),m.current=setTimeout(()=>{E()},H)};function R(E){let{id:G,tooltip:g,target:ee,at:Y}=j(E.target);if(K(null),A(null),!g)if(G)g=I(G);else{clearTimeout(m.current);return}const de=E.clientX;f(()=>{G&&A(B(z(G)));const W=ee.getBoundingClientRect(),le=o.current,se=le?le.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let d,v;Y==="left"?(d=W.top+5-se.top,v=W.right+5-se.left):(d=W.top+W.height-se.top,v=de-se.left),l(se),K({top:d,left:v,text:g})})}function B(E){return n?.getTask(z(E))||null}function I(E){return B(E)?.text||""}function z(E){const G=parseInt(E);return isNaN(G)?E:G}return c.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:o,onMouseMove:R,children:[p&&(p.text||r)?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:D,style:{top:`${p.top}px`,left:`${p.left}px`},children:r?c.jsx(r,{data:x}):p.text?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:p.text}):null}):null,a]})}function Qt({fonts:s=!0,children:n}){return n?c.jsx(ke.Material,{fonts:s,children:n()}):c.jsx(ke.Material,{fonts:s})}function Zt({fonts:s=!0,children:n}){return n?c.jsx(ke.Willow,{fonts:s,children:n}):c.jsx(ke.Willow,{fonts:s})}function Jt({fonts:s=!0,children:n}){return n?c.jsx(ke.WillowDark,{fonts:s,children:n}):c.jsx(ke.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>pe.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>pe.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>pe.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>pe.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>pe.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>pe.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>pe.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>pe.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>pe.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>We.registerEditorItem});exports.ContextMenu=Ft;exports.Editor=Bt;exports.Gantt=qt;exports.HeaderMenu=Vt;exports.Material=Qt;exports.Toolbar=Yt;exports.Tooltip=Ut;exports.Willow=Zt;exports.WillowDark=Jt;
//# sourceMappingURL=index.cjs.map
