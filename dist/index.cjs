"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const l=require("react/jsx-runtime"),e=require("react"),ge=require("@svar-ui/react-core"),be=require("@svar-ui/lib-dom"),qe=require("@svar-ui/gantt-locales"),Ke=require("@svar-ui/core-locales"),ct=require("@svar-ui/lib-state"),xe=require("@svar-ui/gantt-store"),T=require("@svar-ui/lib-react"),nt=require("@svar-ui/grid-store"),rt=require("@svar-ui/react-grid"),it=require("react-dom"),Je=require("@svar-ui/react-toolbar"),at=require("@svar-ui/react-menu"),Ae=require("@svar-ui/react-editor"),We=e.createContext(null);function ze(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function ut(s,n,r){const a=s.getBoundingClientRect(),c=n.querySelector(".wx-body").getBoundingClientRect();return{top:a.top-c.top,left:a.left-c.left,dt:a.bottom-r.clientY,db:r.clientY-a.top}}function et(s){return s&&s.getAttribute("data-context-id")}const tt=5;function dt(s,n){let r,a,c,L,o,y,b,I,m;function D(x){L=x.clientX,o=x.clientY,y={...ut(r,s,x),y:n.getTask(c).$y},document.body.style.userSelect="none"}function p(x){r=be.locate(x),et(r)&&(c=ze(r),m=setTimeout(()=>{I=!0,n&&n.touchStart&&n.touchStart(),D(x.touches[0])},500),s.addEventListener("touchmove",$),s.addEventListener("contextmenu",S),window.addEventListener("touchend",U))}function S(x){if(I||m)return x.preventDefault(),!1}function F(x){x.which===1&&(r=be.locate(x),et(r)&&(c=ze(r),s.addEventListener("mousemove",_),window.addEventListener("mouseup",C),D(x)))}function u(x){s.removeEventListener("mousemove",_),s.removeEventListener("touchmove",$),document.body.removeEventListener("mouseup",C),document.body.removeEventListener("touchend",U),document.body.style.userSelect="",x&&(s.removeEventListener("mousedown",F),s.removeEventListener("touchstart",p))}function z(x){const V=x.clientX-L,se=x.clientY-o;if(!a){if(Math.abs(V)<tt&&Math.abs(se)<tt||n&&n.start&&n.start({id:c,e:x})===!1)return;a=r.cloneNode(!0),a.style.pointerEvents="none",a.classList.add("wx-reorder-task"),a.style.position="absolute",a.style.left=y.left+"px",a.style.top=y.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(a,r)}if(a){const X=Math.round(Math.max(0,y.top+se));if(n&&n.move&&n.move({id:c,top:X,detail:b})===!1)return;const B=n.getTask(c),ae=B.$y;if(!y.start&&y.y==ae)return P();y.start=!0,y.y=B.$y-4,a.style.top=X+"px";const E=document.elementFromPoint(x.clientX,x.clientY),R=be.locate(E);if(R&&R!==r){const k=ze(R),O=R.getBoundingClientRect(),Z=O.top+O.height/2,ee=x.clientY+y.db>Z&&R.nextElementSibling!==r,oe=x.clientY-y.dt<Z&&R.previousElementSibling!==r;b?.after==k||b?.before==k?b=null:ee?b={id:c,after:k}:oe&&(b={id:c,before:k})}}}function _(x){z(x)}function $(x){I?(x.preventDefault(),z(x.touches[0])):m&&(clearTimeout(m),m=null)}function U(){I=null,m&&(clearTimeout(m),m=null),P()}function C(){P()}function P(){r&&(r.style.visibility=""),a&&(a.parentNode.removeChild(a),n&&n.end&&n.end({id:c,top:y.top})),c=r=a=y=b=null,u()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",F),s.addEventListener("touchstart",p),{destroy(){u(!0)}}}function ft({row:s,column:n}){function r(c,L){return{justifyContent:L.align,paddingLeft:`${(c.$level-1)*20}px`}}const a=n&&n._cell;return l.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?l.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):l.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),l.jsx("div",{className:"wx-pqc08MHU wx-text",children:a?l.jsx(a,{row:s,column:n}):s.text})]})}function st({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?l.jsx("div",{style:{textAlign:s.align},children:l.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function xt(s){const{readonly:n,compactMode:r,width:a=0,display:c="all",columnWidth:L=0,onTableAPIChange:o,multiTaskRows:y=!1,rowMapping:b=null}=s,[I,m]=T.useWritableProp(L),[D,p]=e.useState(),S=e.useContext(ge.context.i18n),F=e.useMemo(()=>S.getGroup("gantt"),[S]),u=e.useContext(We),z=T.useStore(u,"scrollTop"),_=T.useStore(u,"cellHeight"),$=T.useStore(u,"_scrollTask"),U=T.useStore(u,"_selected"),C=T.useStore(u,"area"),P=T.useStore(u,"_tasks"),x=T.useStore(u,"_scales"),V=T.useStore(u,"columns"),se=T.useStore(u,"_sort"),X=T.useStore(u,"calendar"),B=T.useStore(u,"durationUnit"),ae=T.useStore(u,"splitTasks"),[E,R]=e.useState(null),k=e.useMemo(()=>!P||!C?[]:P.slice(C.start,C.end),[P,C]),O=e.useCallback((i,w)=>{if(w==="add-task")u.exec(w,{target:i,task:{text:F("New Task")},mode:"child",show:!0});else if(w==="open-task"){const M=k.find(Y=>Y.id===i);(M?.data||M?.lazy)&&u.exec(w,{id:i,mode:!M.open})}},[k]),Z=e.useCallback(i=>{const w=be.locateID(i),M=i.target.dataset.action;M&&i.preventDefault(),w?M==="add-task"||M==="open-task"?O(w,M):u.exec("select-task",{id:w,toggle:i.ctrlKey||i.metaKey,range:i.shiftKey,show:!0}):M==="add-task"&&O(null,M)},[u,O]),ee=e.useRef(null),oe=e.useRef(null),[le,pe]=e.useState(0),[ye,Se]=e.useState(!1);e.useEffect(()=>{const i=oe.current;if(!i||typeof ResizeObserver>"u")return;const w=()=>pe(i.clientWidth);w();const M=new ResizeObserver(w);return M.observe(i),()=>M.disconnect()},[]);const ve=e.useRef(null),G=e.useCallback(i=>{const w=i.id,{before:M,after:Y}=i,me=i.onMove;let fe=M||Y,Me=M?"before":"after";if(me){if(Me==="after"){const De=u.getTask(fe);De.data?.length&&De.open&&(Me="before",fe=De.data[0].id)}ve.current={id:w,[Me]:fe}}else ve.current=null;u.exec("move-task",{id:w,mode:Me,target:fe,inProgress:me})},[u]),f=e.useMemo(()=>C?.from??0,[C]),W=e.useMemo(()=>x?.height??0,[x]),Q=e.useMemo(()=>!r&&c!=="grid"?(I??0)>(a??0):(I??0)>(le??0),[r,c,I,a,le]),H=e.useMemo(()=>{const i={};return Q&&c==="all"||c==="grid"&&Q?i.width=I:c==="grid"&&(i.width="100%"),i},[Q,c,I]),q=e.useMemo(()=>E&&!k.find(i=>i.id===E.id)?[...k,E]:k,[k,E]),te=e.useMemo(()=>{if(!y||!b)return q;const i=new Map,w=new Set;return q.forEach(M=>{const Y=b.taskRows.get(M.id)??M.id;w.has(Y)||(i.set(Y,{...M,$rowTasks:b.rowMap.get(Y)||[M.id]}),w.add(Y))}),Array.from(i.values())},[q,y,b]),v=e.useMemo(()=>{let i=(V||[]).map(Y=>{Y={...Y};const me=Y.header;if(typeof me=="object"){const fe=me.text&&F(me.text);Y.header={...me,text:fe}}else Y.header=F(me);return Y});const w=i.findIndex(Y=>Y.id==="text"),M=i.findIndex(Y=>Y.id==="add-task");if(w!==-1&&(i[w].cell&&(i[w]._cell=i[w].cell),i[w].cell=ft),M!==-1){i[M].cell=i[M].cell||st;const Y=i[M].header;if(typeof Y!="object"&&(i[M].header={text:Y}),i[M].header.cell=Y.cell||st,n)i.splice(M,1);else if(r){const[me]=i.splice(M,1);i.unshift(me)}}return i.length>0&&(i[i.length-1].resize=!1),i},[V,F,n,r]),K=e.useMemo(()=>c==="all"?`${a}px`:c==="grid"?"calc(100% - 4px)":v.find(i=>i.id==="add-task")?"50px":"0",[c,a,v]),ie=e.useMemo(()=>{if(te&&se?.length){const i={};return se.forEach(({key:w,order:M},Y)=>{i[w]={order:M,...se.length>1&&{index:Y}}}),i}return{}},[te,se]),we=e.useCallback(()=>v.some(i=>i.flexgrow&&!i.hidden),[]),Re=e.useMemo(()=>we(),[we,ye]),Ce=e.useMemo(()=>{let i=c==="chart"?v.filter(M=>M.id==="add-task"):v;const w=c==="all"?a:le;if(!Re){let M=I,Y=!1;if(v.some(me=>me.$width)){let me=0;M=v.reduce((fe,Me)=>(Me.hidden||(me+=Me.width,fe+=Me.$width||Me.width),fe),0),me>M&&M>w&&(Y=!0)}if(Y||M<w){let me=1;return Y||(me=(w-50)/(M-50||1)),i.map(fe=>(fe.id!=="add-task"&&!fe.hidden&&(fe.$width||(fe.$width=fe.width),fe.width=fe.$width*me),fe))}}return i},[c,v,Re,I,a,le]),$e=e.useCallback(i=>{if(!we()){const w=Ce.reduce((M,Y)=>(i&&Y.$width&&(Y.$width=Y.width),M+(Y.hidden?0:Y.width)),0);w!==I&&m(w)}Se(!0),Se(!1)},[we,Ce,I,m]),h=e.useCallback(()=>{v.filter(w=>w.flexgrow&&!w.hidden).length===1&&v.forEach(w=>{w.$width&&!w.flexgrow&&!w.hidden&&(w.width=w.$width)})},[]),ne=e.useCallback(i=>{if(!n){const w=be.locateID(i),M=be.locateAttr(i,"data-col-id");!(M&&v.find(me=>me.id==M))?.editor&&w&&u.exec("show-editor",{id:w})}},[u,n]),de=e.useMemo(()=>Array.isArray(U)?U.map(i=>i.id):[],[U]),g=e.useCallback(()=>{if(ee.current&&te!==null){const i=ee.current.querySelector(".wx-body");i&&(i.style.top=-((z??0)-(f??0))+"px")}oe.current&&(oe.current.scrollTop=0)},[te,z,f]);e.useEffect(()=>{ee.current&&g()},[z,f,g]),e.useEffect(()=>{const i=ee.current;if(!i)return;const w=i.querySelector(".wx-table-box .wx-body");if(!w||typeof ResizeObserver>"u")return;const M=new ResizeObserver(()=>{g()});return M.observe(w),()=>{M.disconnect()}},[Ce,H,c,K,te,g]),e.useEffect(()=>{if(!$||!D)return;const{id:i}=$,w=D.getState().focusCell;w&&w.row!==i&&ee.current&&ee.current.contains(document.activeElement)&&D.exec("focus-cell",{row:i,column:w.column})},[$,D]);const J=e.useCallback(({id:i})=>{if(n)return!1;u.getTask(i).open&&u.exec("open-task",{id:i,mode:!1});const w=u.getState()._tasks.find(M=>M.id===i);if(R(w||null),!w)return!1},[u,n]),re=e.useCallback(({id:i,top:w})=>{ve.current?G({...ve.current,onMove:!1}):u.exec("drag-task",{id:i,top:w+(f??0),inProgress:!1}),R(null)},[u,G,f]),Ne=e.useCallback(({id:i,top:w,detail:M})=>{M&&G({...M,onMove:!0}),u.exec("drag-task",{id:i,top:w+(f??0),inProgress:!0})},[u,G,f]);e.useEffect(()=>{const i=ee.current;return i?dt(i,{start:J,end:re,move:Ne,getTask:u.getTask}).destroy:void 0},[u,J,re,Ne]);const je=e.useCallback(i=>{const{key:w,isInput:M}=i;if(!M&&(w==="arrowup"||w==="arrowdown"))return i.eventSource="grid",u.exec("hotkey",i),!1;if(w==="enter"){const Y=D?.getState().focusCell;if(Y){const{row:me,column:fe}=Y;fe==="add-task"?O(me,"add-task"):fe==="text"&&O(me,"open-task")}}},[u,O,D]),Te=e.useRef(null),He=()=>{Te.current={setTableAPI:p,handleHotkey:je,sortVal:se,api:u,adjustColumns:h,setColumnWidth:$e,tasks:k,calendarVal:X,durationUnitVal:B,splitTasksVal:ae,onTableAPIChange:o}};He(),e.useEffect(()=>{He()},[p,je,se,u,h,$e,k,X,B,ae,o]);const Ye=e.useCallback(i=>{p(i),i.intercept("hotkey",w=>Te.current.handleHotkey(w)),i.intercept("scroll",()=>!1),i.intercept("select-row",()=>!1),i.intercept("sort-rows",w=>{const M=Te.current.sortVal,{key:Y,add:me}=w,fe=M?M.find(De=>De.key===Y):null;let Me="asc";return fe&&(Me=!fe||fe.order==="asc"?"desc":"asc"),u.exec("sort-tasks",{key:Y,order:Me,add:me}),!1}),i.on("resize-column",()=>{Te.current.setColumnWidth(!0)}),i.on("hide-column",w=>{w.mode||Te.current.adjustColumns(),Te.current.setColumnWidth()}),i.intercept("update-cell",w=>{const{id:M,column:Y,value:me}=w,fe=Te.current.tasks.find(Me=>Me.id===M);if(fe){const Me={...fe};let De=me;De&&!isNaN(De)&&!(De instanceof Date)&&(De*=1),Me[Y]=De,xe.prepareEditTask(Me,{calendar:Te.current.calendarVal,durationUnit:Te.current.durationUnitVal,splitTasks:Te.current.splitTasksVal},Y),u.exec("update-task",{id:M,task:Me})}return!1}),o&&o(i)},[]);return l.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${K}`},ref:oe,children:l.jsx("div",{ref:ee,style:H,className:"wx-rHj6070p wx-table",onClick:Z,onDoubleClick:ne,children:l.jsx(rt.Grid,{init:Ye,sizes:{rowHeight:_,headerHeight:(W??0)-1},rowStyle:i=>i.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:i=>`wx-rHj6070p wx-text-${i.align}${i.id==="add-task"?" wx-action":""}`,data:te,columns:Ce,selectedRows:[...de],sortMarks:ie})})})}function mt({borders:s=""}){const n=e.useContext(We),r=T.useStore(n,"cellWidth"),a=T.useStore(n,"cellHeight"),c=e.useRef(null),[L,o]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&c.current){const b=getComputedStyle(c.current).getPropertyValue("--wx-gantt-border");o(b?b.substring(b.indexOf("#")):"#1d1e261a")}},[]);const y={width:"100%",height:"100%",background:r!=null&&a!=null?`url(${xe.grid(r,a,L,s)})`:void 0,position:"absolute"};return l.jsx("div",{ref:c,style:y})}function ht({onSelectLink:s,selectedLink:n,readonly:r}){const a=e.useContext(We),c=T.useStore(a,"_links"),L=T.useStore(a,"criticalPath"),o=e.useRef(null),y=e.useCallback(b=>{const I=b?.target?.classList;!I?.contains("wx-line")&&!I?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&o.current){const b=I=>{o.current&&!o.current.contains(I.target)&&y(I)};return document.addEventListener("click",b),()=>{document.removeEventListener("click",b)}}},[r,n,y]),l.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(c||[]).map(b=>{const I="wx-dkx3NwEn wx-line"+(L&&b.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return l.jsx("polyline",{className:I,points:b.$p,onClick:()=>!r&&s(b.id),"data-link-id":b.id},b.id)}),!r&&n&&l.jsx("polyline",{ref:o,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function gt(s){const{task:n,type:r}=s;function a(L){const o=n.segments[L];return{left:`${o.$x}px`,top:"0px",width:`${o.$w}px`,height:"100%"}}function c(L){if(!n.progress)return 0;const o=n.duration*n.progress/100,y=n.segments;let b=0,I=0,m=null;do{const D=y[I];I===L&&(b>o?m=0:m=Math.min((o-b)/D.duration,1)*100),b+=D.duration,I++}while(m===null&&I<y.length);return m||0}return l.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map((L,o)=>l.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":o,style:a(o),children:[n.progress?l.jsx("div",{className:"wx-progress-wrapper",children:l.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${c(o)}%`}})}):null,l.jsx("div",{className:"wx-content",children:L.text||""})]},o))})}function wt(s){const{readonly:n,taskTemplate:r,multiTaskRows:a=!1,rowMapping:c=null,marqueeSelect:L=!1}=s,o=e.useContext(We),[y,b]=T.useStoreWithCounter(o,"_tasks"),[I,m]=T.useStoreWithCounter(o,"_links"),D=T.useStore(o,"area"),p=T.useStore(o,"_scales"),S=T.useStore(o,"taskTypes"),F=T.useStore(o,"baselines"),[u,z]=T.useStoreWithCounter(o,"_selected"),_=T.useStore(o,"_scrollTask"),$=T.useStore(o,"criticalPath"),U=T.useStore(o,"tasks"),C=T.useStore(o,"schedule"),P=T.useStore(o,"splitTasks"),x=e.useMemo(()=>{if(!D||!Array.isArray(y))return[];const t=D.start??0,d=D.end??0;return y.slice(t,d).map(j=>({...j}))},[b,D]),V=T.useStore(o,"cellHeight"),se=e.useMemo(()=>{if(!a||!c||!x.length)return x;const t=new Map,d=[];return y.forEach(j=>{const N=c.taskRows.get(j.id)??j.id;t.has(N)||(t.set(N,d.length),d.push(N))}),x.map(j=>{const N=c.taskRows.get(j.id)??j.id,A=t.get(N)??0;return{...j,$y:A*V,$y_base:j.$y_base!==void 0?A*V:void 0}})},[x,a,c,y,V]),X=e.useMemo(()=>p.lengthUnitWidth,[p]),B=e.useMemo(()=>p.lengthUnit||"day",[p]),ae=e.useRef(!1),[E,R]=e.useState(void 0),[k,O]=e.useState(null),Z=e.useRef(null),[ee,oe]=e.useState(null),[le,pe]=e.useState(void 0),ye=e.useRef(null),[Se,ve]=e.useState(0),[G,f]=e.useState(null),[W,Q]=e.useState(null),H=e.useRef(null),q=e.useMemo(()=>{const t=H.current;return!!(u.length&&t&&t.contains(document.activeElement))},[u,H.current]),te=e.useMemo(()=>q&&u[u.length-1]?.id,[q,u]);e.useEffect(()=>{if(_&&q&&_){const{id:t}=_,d=H.current?.querySelector(`.wx-bar[data-id='${t}']`);d&&d.focus({preventScroll:!0})}},[_]),e.useEffect(()=>{const t=H.current;if(t&&(ve(t.offsetWidth||0),typeof ResizeObserver<"u")){const d=new ResizeObserver(j=>{j[0]&&ve(j[0].contentRect.width)});return d.observe(t),()=>d.disconnect()}},[H.current]);const v=e.useCallback(()=>{document.body.style.userSelect="none"},[]),K=e.useCallback(()=>{document.body.style.userSelect=""},[]),ie=e.useCallback((t,d,j)=>{if(d.target.classList.contains("wx-line")||(j||(j=o.getTask(ze(t))),j.type==="milestone"||j.type==="summary"))return"";const N=be.locate(d,"data-segment");N&&(t=N);const{left:A,width:ce}=t.getBoundingClientRect(),ue=(d.clientX-A)/ce;let ke=.2/(ce>200?ce/200:1);return ue<ke?"start":ue>1-ke?"end":""},[o]),we=e.useMemo(()=>{const t=new Map;if(!a||!c)return y.forEach(N=>{t.set(N.id,N.$y)}),t;const d=new Map,j=[];return y.forEach(N=>{const A=c.taskRows.get(N.id)??N.id;d.has(A)||(d.set(A,j.length),j.push(A))}),y.forEach(N=>{const A=c.taskRows.get(N.id)??N.id,ce=d.get(A)??0;t.set(N.id,ce*V)}),t},[y,a,c,V]),Re=e.useCallback(t=>{const d=H.current;if(!d)return[];const j=d.parentElement?.scrollLeft||0,N=d.parentElement?.parentElement?.scrollTop||0,A=Math.min(t.startX,t.currentX),ce=Math.max(t.startX,t.currentX),ue=Math.min(t.startY,t.currentY),ke=Math.max(t.startY,t.currentY);return y.filter(he=>{const Le=he.$x-j,Ie=he.$x+he.$w-j,Pe=(we.get(he.id)??he.$y)-N,Ee=Pe+he.$h;return Le<ce&&Ie>A&&Pe<ke&&Ee>ue})},[y,we]),Ce=e.useMemo(()=>new Set(u.map(t=>t.id)),[u,z]),$e=e.useCallback(t=>Ce.has(t),[Ce]),h=e.useCallback((t,d)=>{const{clientX:j}=d,N=ze(t),A=o.getTask(N),ce=d.target.classList;if(!d.target.closest(".wx-delete-button")&&!n){if(ce.contains("wx-progress-marker")){const{progress:ue}=o.getTask(N);Z.current={id:N,x:j,progress:ue,dx:0,node:t,marker:d.target},d.target.classList.add("wx-progress-in-drag")}else{const ue=ie(t,d,A)||"move",ke={id:N,mode:ue,x:j,dx:0,l:A.$x,w:A.$w};if(P&&A.segments?.length){const he=be.locate(d,"data-segment");he&&(ke.segmentIndex=he.dataset.segment*1,xe.extendDragOptions(A,ke))}O(ke)}v()}},[o,n,ie,v,P]),ne=e.useCallback(t=>{if(t.button!==0)return;const d=be.locate(t);if(!d&&L&&!n){const j=H.current;if(!j)return;const N=j.getBoundingClientRect(),A=t.clientX-N.left,ce=t.clientY-N.top;f({startX:A,startY:ce,currentX:A,currentY:ce,ctrlKey:t.ctrlKey||t.metaKey}),v();return}if(d){if(L&&!n&&u.length>1){const j=ze(d);if($e(j)){const N=t.target.classList;if(!N.contains("wx-link")&&!N.contains("wx-progress-marker")&&!t.target.closest(".wx-delete-button")){const A=o.getTask(j);if(!ie(d,t,A)){const ue=new Map;u.forEach(ke=>{const he=o.getTask(ke.id);if(he){if(C?.auto&&he.type==="summary")return;ue.set(ke.id,{$x:he.$x,$w:he.$w,start:he.start,end:he.end})}}),Q({baseTaskId:j,startX:t.clientX,dx:0,originalPositions:ue}),v();return}}}}h(d,t)}},[h,L,n,u,$e,o,ie,C,v]),de=e.useCallback(t=>{const d=be.locate(t);d&&(ye.current=setTimeout(()=>{pe(!0),h(d,t.touches[0])},300))},[h]),g=e.useCallback(t=>{oe(t&&{...I.find(d=>d.id===t)})},[I]),J=e.useCallback(()=>{if(G){const t=Re(G);G.ctrlKey?t.forEach(d=>{o.exec("select-task",{id:d.id,toggle:!0,marquee:!0})}):(u.length>0&&o.exec("select-task",{id:null,marquee:!0}),t.forEach((d,j)=>{o.exec("select-task",{id:d.id,toggle:j>0,marquee:!0})})),f(null),K(),ae.current=!0;return}if(W){const{dx:t,originalPositions:d}=W,j=Math.round(t/X);if(j!==0){let N=!0;d.forEach((A,ce)=>{const ue=o.getTask(ce);ue&&(o.exec("update-task",{id:ce,diff:j,task:{start:ue.start,end:ue.end},skipUndo:!N}),N=!1)}),ae.current=!0}else d.forEach((N,A)=>{o.exec("drag-task",{id:A,left:N.$x,width:N.$w,inProgress:!1})});Q(null),K();return}if(Z.current){const{dx:t,id:d,marker:j,value:N}=Z.current;Z.current=null,typeof N<"u"&&t&&o.exec("update-task",{id:d,task:{progress:N},inProgress:!1}),j.classList.remove("wx-progress-in-drag"),ae.current=!0,K()}else if(k){const{id:t,mode:d,dx:j,l:N,w:A,start:ce,segment:ue,index:ke}=k;if(O(null),ce){const he=Math.round(j/X);if(!he)o.exec("drag-task",{id:t,width:A,left:N,inProgress:!1,...ue&&{segmentIndex:ke}});else{let Le={},Ie=o.getTask(t);ue&&(Ie=Ie.segments[ke]);const Ge=1440*60*1e3,Ee=he*(B==="week"?7:B==="month"?30:B==="quarter"?91:B==="year"?365:1)*Ge;d==="move"?(Le.start=new Date(Ie.start.getTime()+Ee),Le.end=new Date(Ie.end.getTime()+Ee)):d==="start"?(Le.start=new Date(Ie.start.getTime()+Ee),Le.end=Ie.end):d==="end"&&(Le.start=Ie.start,Le.end=new Date(Ie.end.getTime()+Ee)),o.exec("update-task",{id:t,task:Le,...ue&&{segmentIndex:ke}})}ae.current=!0}K()}},[o,K,k,X,B,G,W,Re,u]),re=e.useCallback((t,d)=>{const{clientX:j,clientY:N}=d;if(!n){if(G){const A=H.current;if(!A)return;const ce=A.getBoundingClientRect(),ue=j-ce.left,ke=N-ce.top;f(he=>({...he,currentX:ue,currentY:ke}));return}if(W){const A=j-W.startX;W.originalPositions.forEach((ce,ue)=>{const ke=ce.$x+A;o.exec("drag-task",{id:ue,left:ke,width:ce.$w,inProgress:!0})}),Q(ce=>({...ce,dx:A}));return}if(Z.current){const{node:A,x:ce,id:ue}=Z.current,ke=Z.current.dx=j-ce,he=Math.round(ke/A.offsetWidth*100);let Le=Z.current.progress+he;Z.current.value=Le=Math.min(Math.max(0,Le),100),o.exec("update-task",{id:ue,task:{progress:Le},inProgress:!0})}else if(k){g(null);const{mode:A,l:ce,w:ue,x:ke,id:he,start:Le,segment:Ie,index:Ge}=k,Pe=o.getTask(he),Ee=j-ke;if(!Le&&Math.abs(Ee)<20||A==="start"&&ue-Ee<X||A==="end"&&ue+Ee<X||A==="move"&&(Ee<0&&ce+Ee<0||Ee>0&&ce+ue+Ee>Se)||k.segment&&!xe.isSegmentMoveAllowed(Pe,k))return;const Xe={...k,dx:Ee};let _e,Oe;if(A==="start"?(_e=ce+Ee,Oe=ue-Ee):A==="end"?(_e=ce,Oe=ue+Ee):A==="move"&&(_e=ce+Ee,Oe=ue),o.exec("drag-task",{id:he,width:Oe,left:_e,inProgress:!0,...Ie&&{segmentIndex:Ge}}),!Xe.start&&(A==="move"&&Pe.$x==ce||A!=="move"&&Pe.$w==ue)){ae.current=!0,J();return}Xe.start=!0,O(Xe)}else{const A=be.locate(t);if(A){const ce=o.getTask(ze(A)),ke=be.locate(t,"data-segment")||A,he=ie(ke,d,ce);ke.style.cursor=he&&!n?"col-resize":"pointer"}}}},[o,n,k,X,Se,ie,g,J,G,W]),Ne=e.useCallback(t=>{re(t,t)},[re]),je=e.useCallback(t=>{le?(t.preventDefault(),re(t,t.touches[0])):ye.current&&(clearTimeout(ye.current),ye.current=null)},[le,re]),Te=e.useCallback(()=>{J()},[J]),He=e.useCallback(()=>{pe(null),ye.current&&(clearTimeout(ye.current),ye.current=null),J()},[J]);e.useEffect(()=>(window.addEventListener("mouseup",Te),()=>{window.removeEventListener("mouseup",Te)}),[Te]);const Ye=e.useCallback(t=>{if(!n){const d=be.locateID(t.target);if(d&&!t.target.classList.contains("wx-link")){const j=be.locateID(t.target,"data-segment");o.exec("show-editor",{id:d,...j!==null&&{segmentIndex:j}})}}},[o,n]),i=["e2s","s2s","e2e","s2e"],w=e.useCallback((t,d)=>i[(t?1:0)+(d?0:2)],[]),M=e.useCallback((t,d)=>{const j=E.id,N=E.start;return t===j?!0:!!I.find(A=>A.target==t&&A.source==j&&A.type===w(N,d))},[E,m,w]),Y=e.useCallback(()=>{E&&R(null)},[E]),me=e.useCallback(t=>{if(ae.current){ae.current=!1;return}const d=be.locateID(t.target);if(d){const j=t.target.classList;if(j.contains("wx-link")){const N=j.contains("wx-left");if(!E){R({id:d,start:N});return}E.id!==d&&!M(d,N)&&o.exec("add-link",{link:{source:E.id,target:d,type:w(E.start,N)}})}else if(j.contains("wx-delete-button-icon"))o.exec("delete-link",{id:ee.id}),oe(null);else{let N;const A=be.locate(t,"data-segment");A&&(N=A.dataset.segment*1),o.exec("select-task",{id:d,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:N})}}Y()},[o,E,m,ee,M,w,Y]),fe=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),Me=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),De=e.useCallback(t=>{if(le||ye.current)return t.preventDefault(),!1},[le]),Ve=e.useMemo(()=>S.map(t=>t.id),[S]),Be=e.useCallback(t=>{let d=Ve.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(d=`task ${d}`),d},[Ve]),Ue=e.useCallback(t=>{o.exec(t.action,t.data)},[o]),Fe=e.useCallback(t=>$&&U.byId(t).$critical,[$,U]),Qe=e.useCallback(t=>{if(C?.auto){const d=U.getSummaryId(t,!0),j=U.getSummaryId(E.id,!0);return E?.id&&!(Array.isArray(d)?d:[d]).includes(E.id)&&!(Array.isArray(j)?j:[j]).includes(t)}return E},[C,U,E]),Ze=e.useMemo(()=>{if(!G)return null;const t=Math.min(G.startX,G.currentX),d=Math.min(G.startY,G.currentY),j=Math.abs(G.currentX-G.startX),N=Math.abs(G.currentY-G.startY);return{left:`${t}px`,top:`${d}px`,width:`${j}px`,height:`${N}px`}},[G]);return l.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${se.length?se[0].$h:0}px`},ref:H,onContextMenu:De,onMouseDown:ne,onMouseMove:Ne,onTouchStart:de,onTouchMove:je,onTouchEnd:He,onClick:me,onDoubleClick:Ye,onDragStart:t=>(t.preventDefault(),!1),children:[l.jsx(ht,{onSelectLink:g,selectedLink:ee,readonly:n}),se.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const d=`wx-bar wx-${Be(t.type)}`+(le&&k&&t.id===k.id?" wx-touch":"")+(E&&E.id===t.id?" wx-selected":"")+(Ce.has(t.id)?" wx-selected":"")+(Fe(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(P&&t.segments?" wx-split":""),j="wx-link wx-left"+(E?" wx-visible":"")+(!E||!M(t.id,!0)&&Qe(t.id)?" wx-target":"")+(E&&E.id===t.id&&E.start?" wx-selected":"")+(Fe(t.id)?" wx-critical":""),N="wx-link wx-right"+(E?" wx-visible":"")+(!E||!M(t.id,!1)&&Qe(t.id)?" wx-target":"")+(E&&E.id===t.id&&!E.start?" wx-selected":"")+(Fe(t.id)?" wx-critical":"");return l.jsxs(e.Fragment,{children:[!t.$skip&&l.jsxs("div",{className:"wx-GKbcLEGA "+d,style:fe(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:te===t.id?0:-1,children:[n?null:t.id===ee?.target&&ee?.type[2]==="s"?l.jsx(ge.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:l.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):l.jsx("div",{className:"wx-GKbcLEGA "+j,children:l.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?l.jsxs(l.Fragment,{children:[t.progress&&!(P&&t.segments)?l.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:l.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(P&&t.segments)?l.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?l.jsx(r,{data:t,api:o,onAction:Ue}):P&&t.segments?l.jsx(gt,{task:t,type:Be(t.type)}):l.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""})]}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?l.jsx(r,{data:t,api:o,onAction:Ue}):l.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===ee?.target&&ee?.type[2]==="e"?l.jsx(ge.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:l.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):l.jsx("div",{className:"wx-GKbcLEGA "+N,children:l.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),F&&!t.$skip_baseline?l.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:Me(t)}):null]},t.id)}),G&&Ze&&l.jsx("div",{className:"wx-GKbcLEGA wx-marquee-selection",style:Ze})]})}function pt(s){const{highlightTime:n}=s,r=e.useContext(We),a=T.useStore(r,"_scales");return l.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:a.width},children:(a?.rows||[]).map((c,L)=>l.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${c.height}px`},children:(c.cells||[]).map((o,y)=>{const b=n?n(o.date,o.unit):"",I="wx-cell "+(o.css||"")+" "+(b||""),m=typeof o.value=="string"&&o.value.includes("<");return l.jsx("div",{className:"wx-ZkvhDKir "+I,style:{width:`${o.width}px`},...m?{dangerouslySetInnerHTML:{__html:o.value}}:{children:o.value}},y)})},L))})}const kt=new Map;function bt(s){const n=e.useRef(null),r=e.useRef(0),a=e.useRef(null),c=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(c)return cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{const L={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};kt.set(s,L),window.dispatchEvent(new CustomEvent("render-metric",{detail:L}))}),()=>cancelAnimationFrame(a.current)})}function yt(s){const{readonly:n,fullWidth:r,fullHeight:a,taskTemplate:c,cellBorders:L,highlightTime:o,multiTaskRows:y=!1,rowMapping:b=null,marqueeSelect:I=!1,scrollToCurrentWeek:m=!1,currentWeekColor:D=null}=s,p=e.useContext(We),[S,F]=T.useStoreWithCounter(p,"_selected"),u=T.useStore(p,"scrollTop"),z=T.useStore(p,"cellHeight"),_=T.useStore(p,"cellWidth"),$=T.useStore(p,"_scales"),U=T.useStore(p,"_markers"),C=T.useStore(p,"_scrollTask"),P=T.useStore(p,"zoom"),x=T.useStore(p,"_tasks"),[V,se]=e.useState(),X=e.useRef(null),B=e.useRef(0),ae=e.useRef(!1),E=1+($?.rows?.length||0),R=e.useMemo(()=>{if(!y||!b||!x?.length)return null;const f=new Map,W=new Map,Q=[];return x.forEach(H=>{const q=b.taskRows.get(H.id)??H.id;W.has(q)||(W.set(q,Q.length),Q.push(q))}),x.forEach(H=>{const q=b.taskRows.get(H.id)??H.id,te=W.get(q)??0;f.set(H.id,te*z)}),f},[x,y,b,z]),k=e.useMemo(()=>{const f=[];return S&&S.length&&z&&S.forEach(W=>{const Q=R?.get(W.id)??W.$y;f.push({height:`${z}px`,top:`${Q-3}px`})}),f},[F,z,R]),O=e.useMemo(()=>Math.max(V||0,a),[V,a]);e.useEffect(()=>{const f=X.current;f&&typeof u=="number"&&(f.scrollTop=u)},[u]);const Z=()=>{ee()};function ee(f){const W=X.current;if(!W)return;const Q={};Q.left=W.scrollLeft,p.exec("scroll-chart",Q)}function oe(){const f=X.current,Q=Math.ceil((V||0)/(z||1))+1,H=Math.floor((f&&f.scrollTop||0)/(z||1)),q=Math.max(0,H-E),te=H+Q+E,v=q*(z||0);p.exec("render-data",{start:q,end:te,from:v})}e.useEffect(()=>{oe()},[V,u]);const le=e.useCallback(f=>{if(!f)return;const{id:W,mode:Q}=f;if(Q.toString().indexOf("x")<0)return;const H=X.current;if(!H)return;const{clientWidth:q}=H,te=p.getTask(W);if(te.$x+te.$w<H.scrollLeft)p.exec("scroll-chart",{left:te.$x-(_||0)}),H.scrollLeft=te.$x-(_||0);else if(te.$x>=q+H.scrollLeft){const v=q<te.$w?_||0:te.$w;p.exec("scroll-chart",{left:te.$x-q+v}),H.scrollLeft=te.$x-q+v}},[p,_]);e.useEffect(()=>{le(C)},[C]);function pe(f){if(P&&(f.ctrlKey||f.metaKey)){f.preventDefault();const W=X.current,Q=f.clientX-(W?W.getBoundingClientRect().left:0);if(B.current+=f.deltaY,Math.abs(B.current)>=150){const q=-Math.sign(B.current);B.current=0,p.exec("zoom-scale",{dir:q,offset:Q})}}}const ye=e.useCallback(f=>{const W=o(f.date,f.unit);return W?{css:W,width:f.width}:null},[o]),Se=e.useMemo(()=>{if(!$||!o||!["hour","day","week"].includes($.minUnit))return null;let W=0;return $.rows[$.rows.length-1].cells.map(Q=>{const H=ye(Q),q=W;return W+=Q.width,H?{...H,left:q}:null})},[$,o,ye]),ve=e.useCallback(f=>{f.eventSource="chart",p.exec("hotkey",f)},[p]);e.useEffect(()=>{const f=X.current;if(!f)return;const W=()=>se(f.clientHeight);W();const Q=new ResizeObserver(()=>W());return Q.observe(f),()=>{Q.disconnect()}},[X.current]);const G=e.useRef(null);return e.useEffect(()=>{const f=X.current;if(f&&!G.current)return G.current=nt.hotkeys(f,{keys:{arrowup:!0,arrowdown:!0},exec:W=>ve(W)}),()=>{G.current?.destroy(),G.current=null}},[]),e.useEffect(()=>{const f=X.current;if(!f)return;const W=pe;return f.addEventListener("wheel",W),()=>{f.removeEventListener("wheel",W)}},[pe]),e.useEffect(()=>{if(!m||ae.current||!$||!X.current||!V)return;const f=X.current,{clientWidth:W}=f,Q=new Date,H=$.rows[$.rows.length-1]?.cells;if(!H)return;let q=-1,te=0;const v=[];for(let ie=0;ie<H.length;ie++){const we=H[ie];v.push({left:te,width:we.width});const Re=we.date;if(we.unit==="week"){const Ce=new Date(Re);Ce.setDate(Ce.getDate()+7),Q>=Re&&Q<Ce&&(q=ie)}else we.unit==="day"&&Q.getFullYear()===Re.getFullYear()&&Q.getMonth()===Re.getMonth()&&Q.getDate()===Re.getDate()&&(q=ie);te+=we.width}let K=q;if(q>0&&(K=q-1),K>=0&&v[K]){const ie=v[K],we=Math.max(0,ie.left);f.scrollLeft=we,p.exec("scroll-chart",{left:we}),ae.current=!0}},[m,$,V,p]),bt("chart"),l.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:X,onScroll:Z,children:[l.jsx(pt,{highlightTime:o,scales:$}),U&&U.length?l.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${O}px`},children:U.map((f,W)=>l.jsx("div",{className:`wx-mR7v2Xag wx-marker ${f.css||""}`,style:{left:`${f.left}px`},children:l.jsx("div",{className:"wx-mR7v2Xag wx-content",children:f.text})},W))}):null,l.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${O}px`},children:[Se?l.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:Se.map((f,W)=>f?l.jsx("div",{className:"wx-mR7v2Xag "+f.css,style:{width:`${f.width}px`,left:`${f.left}px`}},W):null)}):null,l.jsx(mt,{borders:L}),S&&S.length?S.map((f,W)=>f.$y?l.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":f.id,style:k[W]},f.id):null):null,l.jsx(wt,{readonly:n,taskTemplate:c,multiTaskRows:y,rowMapping:b,marqueeSelect:I})]})]})}function vt(s){const{position:n="after",size:r=4,dir:a="x",onMove:c,onDisplayChange:L,compactMode:o,containerWidth:y=0,leftThreshold:b=50,rightThreshold:I=50}=s,[m,D]=T.useWritableProp(s.value??0),[p,S]=T.useWritableProp(s.display??"all");function F(oe){let le=0;n=="center"?le=r/2:n=="before"&&(le=r);const pe={size:[r+"px","auto"],p:[oe-le+"px","0px"],p2:["auto","0px"]};if(a!="x")for(let ye in pe)pe[ye]=pe[ye].reverse();return pe}const[u,z]=e.useState(!1),[_,$]=e.useState(null),U=e.useRef(0),C=e.useRef(),P=e.useRef(),x=e.useRef(p);e.useEffect(()=>{x.current=p},[p]),e.useEffect(()=>{_===null&&m>0&&$(m)},[_,m]);function V(oe){return a=="x"?oe.clientX:oe.clientY}const se=e.useCallback(oe=>{const le=C.current+V(oe)-U.current;D(le);let pe;le<=b?pe="chart":y-le<=I?pe="grid":pe="all",x.current!==pe&&(S(pe),x.current=pe),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>c&&c(le),100)},[y,b,I,c]),X=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",z(!1),window.removeEventListener("mousemove",se),window.removeEventListener("mouseup",X)},[se]),B=e.useMemo(()=>p!=="all"?"auto":a=="x"?"ew-resize":"ns-resize",[p,a]),ae=e.useCallback(oe=>{!o&&(p==="grid"||p==="chart")||(U.current=V(oe),C.current=m,z(!0),document.body.style.cursor=B,document.body.style.userSelect="none",window.addEventListener("mousemove",se),window.addEventListener("mouseup",X))},[B,se,X,m,o,p]);function E(){S("all"),_!==null&&(D(_),c&&c(_))}function R(oe){if(o){const le=p==="chart"?"grid":"chart";S(le),L(le)}else if(p==="grid"||p==="chart")E(),L("all");else{const le=oe==="left"?"chart":"grid";S(le),L(le)}}function k(){R("left")}function O(){R("right")}const Z=e.useMemo(()=>F(m),[m,n,r,a]),ee=["wx-resizer",`wx-resizer-${a}`,`wx-resizer-display-${p}`,u?"wx-resizer-active":""].filter(Boolean).join(" ");return l.jsxs("div",{className:"wx-pFykzMlT "+ee,onMouseDown:ae,style:{width:Z.size[0],height:Z.size[1],cursor:B},children:[l.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[l.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:l.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:k})}),l.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:l.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:O})})]}),l.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const Tt=650;function ot(s){let n;function r(){n=new ResizeObserver(c=>{for(let L of c)if(L.target===document.body){let o=L.contentRect.width<=Tt;s(o)}}),n.observe(document.body)}function a(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:a}}function Ct(s){const{taskTemplate:n,readonly:r,cellBorders:a,highlightTime:c,onTableAPIChange:L,multiTaskRows:o=!1,rowMapping:y=null,marqueeSelect:b=!1,scrollToCurrentWeek:I=!1,currentWeekColor:m=null}=s,D=e.useContext(We),p=T.useStore(D,"_tasks"),S=T.useStore(D,"_scales"),F=T.useStore(D,"cellHeight"),u=T.useStore(D,"columns"),z=T.useStore(D,"_scrollTask"),_=T.useStore(D,"undo"),[$,U]=e.useState(!1);let[C,P]=e.useState(0);const[x,V]=e.useState(0),[se,X]=e.useState(0),[B,ae]=e.useState(void 0),[E,R]=e.useState("all"),k=e.useRef(null),O=e.useCallback(v=>{U(K=>(v!==K&&(v?(k.current=E,E==="all"&&R("grid")):(!k.current||k.current==="all")&&R("all")),v))},[E]);e.useEffect(()=>{const v=ot(O);return v.observe(),()=>{v.disconnect()}},[O]);const Z=e.useMemo(()=>{let v;return u.every(K=>K.width&&!K.flexgrow)?v=u.reduce((K,ie)=>K+parseInt(ie.width),0):$&&E==="chart"?v=parseInt(u.find(K=>K.id==="action")?.width)||50:v=440,C=v,v},[u,$,E]);e.useEffect(()=>{P(Z)},[Z]);const ee=e.useMemo(()=>(x??0)-(B??0),[x,B]),oe=e.useMemo(()=>S.width,[S]),le=e.useMemo(()=>{if(!o||!y)return p.length*F;const v=new Set;return p.forEach(K=>{const ie=y.taskRows.get(K.id)??K.id;v.add(ie)}),v.size*F},[p,F,o,y]),pe=e.useMemo(()=>S.height+le+ee,[S,le,ee]),ye=e.useMemo(()=>C+oe,[C,oe]),Se=e.useRef(null),ve=e.useCallback(()=>{Promise.resolve().then(()=>{if((x??0)>(ye??0)){const v=(x??0)-C;D.exec("expand-scale",{minWidth:v})}})},[x,ye,C,D]);e.useEffect(()=>{let v;return Se.current&&(v=new ResizeObserver(ve),v.observe(Se.current)),()=>{v&&v.disconnect()}},[Se.current,ve]),e.useEffect(()=>{ve()},[oe]);const G=e.useRef(null),f=e.useRef(null),W=e.useCallback(()=>{const v=G.current;v&&D.exec("scroll-chart",{top:v.scrollTop})},[D]),Q=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{Q.current={rTasks:p,rScales:S,rCellHeight:F,scrollSize:ee,ganttDiv:G.current,ganttHeight:se??0}},[p,S,F,ee,se]);const H=e.useCallback(v=>{if(!v)return;const{rTasks:K,rScales:ie,rCellHeight:we,scrollSize:Re,ganttDiv:Ce,ganttHeight:$e}=Q.current;if(!Ce)return;const{id:h}=v,ne=K.findIndex(de=>de.id===h);if(ne>-1){const de=$e-ie.height,g=ne*we,J=Ce.scrollTop;let re=null;g<J?re=g:g+we>J+de&&(re=g-de+we+Re),re!==null&&(D.exec("scroll-chart",{top:Math.max(re,0)}),G.current.scrollTop=Math.max(re,0))}},[D]);e.useEffect(()=>{H(z)},[z]),e.useEffect(()=>{const v=G.current,K=f.current;if(!v||!K)return;const ie=()=>{it.flushSync(()=>{X(v.offsetHeight),V(v.offsetWidth),ae(K.offsetWidth)})},we=new ResizeObserver(ie);return we.observe(v),()=>we.disconnect()},[G.current]);const q=e.useRef(null),te=e.useRef(null);return e.useEffect(()=>{te.current&&(te.current.destroy(),te.current=null);const v=q.current;if(v)return te.current=nt.hotkeys(v,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,"meta+c":!0,"meta+v":!0,"meta+x":!0,"meta+d":!0,backspace:!0,"ctrl+z":_,"ctrl+y":_,"meta+z":_,"meta+shift+z":_},exec:K=>{K.isInput||D.exec("hotkey",K)}}),()=>{te.current?.destroy(),te.current=null}},[_]),l.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:G,onScroll:W,children:l.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:pe,width:"100%"},ref:f,children:l.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:se,width:B},children:l.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:q,children:[u.length?l.jsxs(l.Fragment,{children:[l.jsx(xt,{display:E,compactMode:$,columnWidth:Z,width:C,readonly:r,fullHeight:le,onTableAPIChange:L,multiTaskRows:o,rowMapping:y}),l.jsx(vt,{value:C,display:E,compactMode:$,containerWidth:x,onMove:v=>P(v),onDisplayChange:v=>R(v)})]}):null,l.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:Se,children:l.jsx(yt,{readonly:r,fullWidth:oe,fullHeight:le,taskTemplate:n,cellBorders:a,highlightTime:c,multiTaskRows:o,rowMapping:y,marqueeSelect:b,scrollToCurrentWeek:I,currentWeekColor:m})})]})})})})}function Mt(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function St(s,n){return typeof s=="function"?s:be.dateToString(s,n)}function lt(s,n){return s.map(({format:r,...a})=>({...a,format:St(r,n)}))}function Et(s,n){const r=Mt(n);for(let a in r)r[a]=be.dateToString(r[a],s);return r}function Rt(s,n){if(!s||!s.length)return s;const r=be.dateToString("%d-%m-%Y",n);return s.map(a=>a.template?a:a.id==="start"||a.id=="end"?{...a,_template:c=>r(c),template:c=>r(c)}:a.id==="duration"?{...a,_template:c=>c,template:c=>c}:a)}function jt(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:lt(r.scales,n)}))}:s}const $t=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),Lt=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],Dt=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:a=xe.defaultTaskTypes,tasks:c=[],selected:L=[],activeTask:o=null,links:y=[],scales:b=Lt,columns:I=xe.defaultColumns,start:m=null,end:D=null,lengthUnit:p="day",durationUnit:S="day",cellWidth:F=100,cellHeight:u=38,scaleHeight:z=36,readonly:_=!1,cellBorders:$="full",zoom:U=!1,baselines:C=!1,highlightTime:P=null,init:x=null,autoScale:V=!0,unscheduledTasks:se=!1,criticalPath:X=null,schedule:B={type:"forward"},projectStart:ae=null,projectEnd:E=null,calendar:R=null,undo:k=!1,splitTasks:O=!1,multiTaskRows:Z=!1,marqueeSelect:ee=!1,currentWeekHighlight:oe=!1,currentWeekColor:le=null,scrollToCurrentWeek:pe=!1,...ye},Se){const ve=e.useRef();ve.current=ye;const G=e.useMemo(()=>new xe.DataStore(T.writable),[]),f=e.useMemo(()=>({...Ke.en,...qe.en}),[]),W=e.useContext(ge.context.i18n),Q=e.useMemo(()=>W?W.extend(f,!0):be.locale(f),[W,f]),H=e.useMemo(()=>Q.getRaw().calendar,[Q]),q=e.useMemo(()=>{let g={zoom:jt(U,H),scales:lt(b,H),columns:Rt(I,H),links:xe.normalizeLinks(y),cellWidth:F};return g.zoom&&(g={...g,...xe.normalizeZoom(g.zoom,Et(H,Q.getGroup("gantt")),g.scales,F)}),g},[U,b,I,y,F,H,Q]),te=e.useRef(null);te.current!==c&&(xe.parseTaskDates(c,{durationUnit:S,splitTasks:O,calendar:R}),te.current=c),e.useEffect(()=>{xe.parseTaskDates(c,{durationUnit:S,splitTasks:O,calendar:R})},[c,S,R,O]);const v=e.useMemo(()=>{if(!Z)return null;const g=new Map,J=new Map,re=Ne=>{Ne.forEach(je=>{const Te=je.row??je.id;J.set(je.id,Te),g.has(Te)||g.set(Te,[]),g.get(Te).push(je.id),je.data&&je.data.length>0&&re(je.data)})};return re(c),{rowMap:g,taskRows:J}},[c,Z]),K=e.useMemo(()=>G.in,[G]),ie=e.useRef(null);ie.current===null&&(ie.current=new ct.EventBusRouter((g,J)=>{const re="on"+$t(g);ve.current&&ve.current[re]&&ve.current[re](J)}),K.setNext(ie.current));const[we,Re]=e.useState(null),Ce=e.useRef(null);Ce.current=we;const $e=e.useMemo(()=>({getState:G.getState.bind(G),getReactiveState:G.getReactive.bind(G),getStores:()=>({data:G}),exec:K.exec,setNext:g=>(ie.current=ie.current.setNext(g),ie.current),intercept:K.intercept.bind(K),on:K.on.bind(K),detach:K.detach.bind(K),getTask:G.getTask.bind(G),serialize:G.serialize.bind(G),getTable:g=>g?new Promise(J=>setTimeout(()=>J(Ce.current),1)):Ce.current,getHistory:()=>G.getHistory()}),[G,K]);e.useImperativeHandle(Se,()=>({...$e}),[$e]);const h=e.useRef(0);e.useEffect(()=>{h.current?G.init({tasks:c,links:q.links,start:m,columns:q.columns,end:D,lengthUnit:p,cellWidth:q.cellWidth,cellHeight:u,scaleHeight:z,scales:q.scales,taskTypes:a,zoom:q.zoom,selected:L,activeTask:o,baselines:C,autoScale:V,unscheduledTasks:se,markers:r,durationUnit:S,criticalPath:X,schedule:B,projectStart:ae,projectEnd:E,calendar:R,undo:k,_weekStart:H.weekStart,splitTasks:O}):x&&x($e),h.current++},[$e,x,c,q,m,D,p,u,z,a,L,o,C,V,se,r,S,X,B,ae,E,R,k,H,O,G]),h.current===0&&G.init({tasks:c,links:q.links,start:m,columns:q.columns,end:D,lengthUnit:p,cellWidth:q.cellWidth,cellHeight:u,scaleHeight:z,scales:q.scales,taskTypes:a,zoom:q.zoom,selected:L,activeTask:o,baselines:C,autoScale:V,unscheduledTasks:se,markers:r,durationUnit:S,criticalPath:X,schedule:B,projectStart:ae,projectEnd:E,calendar:R,undo:k,_weekStart:H.weekStart,splitTasks:O});const ne=e.useMemo(()=>{const g=new Date,J=H?.weekStart??0,re=new Date(g),je=(re.getDay()-J+7)%7;re.setDate(re.getDate()-je),re.setHours(0,0,0,0);const Te=new Date(re);return Te.setDate(Te.getDate()+7),He=>He>=re&&He<Te},[H]),de=e.useMemo(()=>(g,J)=>{let re=[];if(R)J=="day"&&!R.getDayHours(g)&&re.push("wx-weekend"),J=="hour"&&!R.getDayHours(g)&&re.push("wx-weekend");else if(P){const Ne=P(g,J);Ne&&re.push(Ne)}return oe&&(J==="week"||J==="day")&&ne(g)&&re.push("wx-current-week"),re.join(" ")},[R,P,oe,ne]);return l.jsx(ge.context.i18n.Provider,{value:Q,children:l.jsx(We.Provider,{value:$e,children:l.jsx(Ct,{taskTemplate:n,readonly:_,cellBorders:$,highlightTime:de,onTableAPIChange:Re,multiTaskRows:Z,rowMapping:v,marqueeSelect:ee,scrollToCurrentWeek:pe,currentWeekColor:le})})})});function It({api:s=null,items:n=[]}){const r=e.useContext(ge.context.i18n),a=e.useMemo(()=>r||be.locale(qe.en),[r]),c=e.useMemo(()=>a.getGroup("gantt"),[a]),L=T.useStoreLater(s,"_selected"),o=T.useStoreLater(s,"undo"),y=T.useStoreLater(s,"history"),b=T.useStoreLater(s,"splitTasks"),I=["undo","redo"],m=e.useMemo(()=>{const p=xe.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:xe.getToolbarButtons({undo:o,splitTasks:b})).map(F=>{let u={...F,disabled:!1};return u.handler=xe.isHandledAction(p,u.id)?z=>xe.handleAction(s,z.id,null,c):u.handler,u.text&&(u.text=c(u.text)),u.menuText&&(u.menuText=c(u.menuText)),u})},[n,s,c,o,b]),D=e.useMemo(()=>{const p=[];return m.forEach(S=>{const F=S.id;if(F==="add-task")p.push(S);else if(I.includes(F))I.includes(F)&&p.push({...S,disabled:S.isDisabled(y)});else{if(!L?.length||!s)return;p.push({...S,disabled:S.isDisabled&&L.some(u=>S.isDisabled(u,s.getState()))})}}),p.filter((S,F)=>{if(s&&S.isHidden)return!L.some(u=>S.isHidden(u,s.getState()));if(S.comp==="separator"){const u=p[F+1];if(!u||u.comp==="separator")return!1}return!0})},[s,L,y,m]);return r?l.jsx(Je.Toolbar,{items:D}):l.jsx(ge.context.i18n.Provider,{value:a,children:l.jsx(Je.Toolbar,{items:D})})}const Nt=e.forwardRef(function({options:n=[],api:r=null,resolver:a=null,filter:c=null,at:L="point",children:o,onClick:y,css:b},I){const m=e.useRef(null),D=e.useRef(null),p=e.useContext(ge.context.i18n),S=e.useMemo(()=>p||be.locale({...qe.en,...Ke.en}),[p]),F=e.useMemo(()=>S.getGroup("gantt"),[S]),u=T.useStoreLater(r,"taskTypes"),z=T.useStoreLater(r,"selected"),_=T.useStoreLater(r,"_selected"),$=T.useStoreLater(r,"splitTasks"),U=e.useMemo(()=>xe.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{m.current&&m.current.show&&m.current.show()}),r.on("drag-task",()=>{m.current&&m.current.show&&m.current.show()}))},[r]);function C(R){return R.map(k=>(k={...k},k.text&&(k.text=F(k.text)),k.subtext&&(k.subtext=F(k.subtext)),k.data&&(k.data=C(k.data)),k))}function P(){const R=n.length?n:xe.getMenuOptions({splitTasks:$}),k=R.find(O=>O.id==="convert-task");return k&&(k.data=[],(u||[]).forEach(O=>{k.data.push(k.dataFactory(O))})),C(R)}const x=e.useMemo(()=>P(),[r,n,u,$,F]),V=e.useMemo(()=>_&&_.length?_:[],[_]),se=e.useCallback((R,k)=>{let O=R?r?.getTask(R):null;if(a){const Z=a(R,k);O=Z===!0?O:Z}if(O){const Z=be.locateID(k.target,"data-segment");Z!==null?D.current={id:O.id,segmentIndex:Z}:D.current=O.id,(!Array.isArray(z)||!z.includes(O.id))&&r&&r.exec&&r.exec("select-task",{id:O.id})}return O},[r,a,z]),X=e.useCallback(R=>{const k=R.action;k&&(xe.isHandledAction(U,k.id)&&xe.handleAction(r,k.id,D.current,F),y&&y(R))},[r,F,y,U]),B=e.useCallback((R,k)=>{const O=V.length?V:k?[k]:[];let Z=c?O.every(ee=>c(R,ee)):!0;if(Z&&(R.isHidden&&(Z=!O.some(ee=>R.isHidden(ee,r.getState(),D.current))),R.isDisabled)){const ee=O.some(oe=>R.isDisabled(oe,r.getState(),D.current));R.disabled=ee}return Z},[c,V,r]);e.useImperativeHandle(I,()=>({show:(R,k)=>{m.current&&m.current.show&&m.current.show(R,k)}}));const ae=e.useCallback(R=>{m.current&&m.current.show&&m.current.show(R)},[]),E=l.jsxs(l.Fragment,{children:[l.jsx(at.ContextMenu,{filter:B,options:x,dataKey:"id",resolver:se,onClick:X,at:L,ref:m,css:b}),l.jsx("span",{onContextMenu:ae,"data-menu-ignore":"true",children:typeof o=="function"?o():o})]});if(!p&&ge.context.i18n?.Provider){const R=ge.context.i18n.Provider;return l.jsx(R,{value:S,children:E})}return E});function At({api:s,autoSave:n,onLinksChange:r}){const c=e.useContext(ge.context.i18n).getGroup("gantt"),L=T.useStore(s,"activeTask"),o=T.useStore(s,"_activeTask"),y=T.useStore(s,"_links"),b=T.useStore(s,"schedule"),I=T.useStore(s,"unscheduledTasks"),[m,D]=e.useState();function p(){if(L){const z=y.filter($=>$.target==L).map($=>({link:$,task:s.getTask($.source)})),_=y.filter($=>$.source==L).map($=>({link:$,task:s.getTask($.target)}));return[{title:c("Predecessors"),data:z},{title:c("Successors"),data:_}]}}e.useEffect(()=>{D(p())},[L,y]);const S=e.useMemo(()=>[{id:"e2s",label:c("End-to-start")},{id:"s2s",label:c("Start-to-start")},{id:"e2e",label:c("End-to-end")},{id:"s2e",label:c("Start-to-end")}],[c]);function F(z){n?s.exec("delete-link",{id:z}):(D(_=>(_||[]).map($=>({...$,data:$.data.filter(U=>U.link.id!==z)}))),r&&r({id:z,action:"delete-link",data:{id:z}}))}function u(z,_){n?s.exec("update-link",{id:z,link:_}):(D($=>($||[]).map(U=>({...U,data:U.data.map(C=>C.link.id===z?{...C,link:{...C.link,..._}}:C)}))),r&&r({id:z,action:"update-link",data:{id:z,link:_}}))}return l.jsx(l.Fragment,{children:(m||[]).map((z,_)=>z.data.length?l.jsx("div",{className:"wx-j93aYGQf wx-links",children:l.jsx(ge.Field,{label:z.title,position:"top",children:l.jsx("table",{children:l.jsx("tbody",{children:z.data.map($=>l.jsxs("tr",{children:[l.jsx("td",{className:"wx-j93aYGQf wx-cell",children:l.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:$.task.text||""})}),b?.auto&&$.link.type==="e2s"?l.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:l.jsx(ge.Text,{type:"number",placeholder:c("Lag"),value:$.link.lag,disabled:I&&o?.unscheduled,onChange:U=>{U.input||u($.link.id,{lag:U.value})}})}):null,l.jsx("td",{className:"wx-j93aYGQf wx-cell",children:l.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:l.jsx(ge.Combo,{value:$.link.type,placeholder:c("Select link type"),options:S,onChange:U=>u($.link.id,{type:U.value}),children:({option:U})=>U.label})})}),l.jsx("td",{className:"wx-j93aYGQf wx-cell",children:l.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>F($.link.id),role:"button"})})]},$.link.id))})})})},_):null)})}function Wt(s){const{value:n,time:r,format:a,onchange:c,onChange:L,...o}=s,y=L??c;function b(I){const m=new Date(I.value);m.setHours(n.getHours()),m.setMinutes(n.getMinutes()),y&&y({value:m})}return l.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[l.jsx(ge.DatePicker,{...o,value:n,onChange:b,format:a,buttons:["today"],clear:!1}),r?l.jsx(ge.TimePicker,{value:n,onChange:y,format:a}):null]})}Ae.registerEditorItem("select",ge.RichSelect);Ae.registerEditorItem("date",Wt);Ae.registerEditorItem("twostate",ge.TwoState);Ae.registerEditorItem("slider",ge.Slider);Ae.registerEditorItem("counter",ge.Counter);Ae.registerEditorItem("links",At);function Ht({api:s,items:n=[],css:r="",layout:a="default",readonly:c=!1,placement:L="sidebar",bottomBar:o=!0,topBar:y=!0,autoSave:b=!0,focus:I=!1,hotkeys:m={}}){const D=e.useContext(ge.context.i18n),p=e.useMemo(()=>D||be.locale({...qe.en,...Ke.en}),[D]),S=e.useMemo(()=>p.getGroup("gantt"),[p]),F=p.getRaw(),u=e.useMemo(()=>{const h=F.gantt?.dateFormat||F.formats?.dateFormat;return be.dateToString(h,F.calendar)},[F]),z=e.useMemo(()=>{if(y===!0&&!c){const h=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:S("Delete"),id:"delete"}];return b?{items:h}:{items:[...h,{comp:"button",type:"primary",text:S("Save"),id:"save"}]}}return y},[y,c,b,S]),[_,$]=e.useState(!1),U=e.useMemo(()=>_?"wx-full-screen":"",[_]),C=e.useCallback(h=>{$(h)},[]);e.useEffect(()=>{const h=ot(C);return h.observe(),()=>{h.disconnect()}},[C]);const P=T.useStore(s,"_activeTask"),x=T.useStore(s,"activeTask"),V=T.useStore(s,"unscheduledTasks"),se=T.useStore(s,"links"),X=T.useStore(s,"splitTasks"),B=e.useMemo(()=>X&&x?.segmentIndex,[X,x]),ae=e.useMemo(()=>B||B===0,[B]),E=e.useMemo(()=>xe.getEditorItems({unscheduledTasks:V}),[V]),R=T.useStore(s,"undo"),[k,O]=e.useState({}),[Z,ee]=e.useState(null),[oe,le]=e.useState(),[pe,ye]=e.useState(null),Se=T.useStore(s,"taskTypes"),ve=e.useMemo(()=>{if(!P)return null;let h;if(ae&&P.segments?h={...P.segments[B]}:h={...P},c){let ne={parent:h.parent};return E.forEach(({key:de,comp:g})=>{if(g!=="links"){const J=h[de];g==="date"&&J instanceof Date?ne[de]=u(J):g==="slider"&&de==="progress"?ne[de]=`${J}%`:ne[de]=J}}),ne}return h||null},[P,ae,B,c,E,u]);e.useEffect(()=>{le(ve)},[ve]),e.useEffect(()=>{O({}),ye(null),ee(null)},[x]);function G(h,ne){return h.map(de=>{const g={...de};if(de.config&&(g.config={...g.config}),g.comp==="links"&&s&&(g.api=s,g.autoSave=b,g.onLinksChange=Q),g.comp==="select"&&g.key==="type"){const J=g.options??(Se||[]);g.options=J.map(re=>({...re,label:S(re.label)}))}return g.comp==="slider"&&g.key==="progress"&&(g.labelTemplate=J=>`${S(g.label)} ${J}%`),g.label&&(g.label=S(g.label)),g.config?.placeholder&&(g.config.placeholder=S(g.config.placeholder)),ne&&(g.isDisabled&&g.isDisabled(ne,s.getState())?g.disabled=!0:delete g.disabled),g})}const f=e.useMemo(()=>{let h=n.length?n:E;return h=G(h,oe),oe?h.filter(ne=>!ne.isHidden||!ne.isHidden(oe,s.getState())):h},[n,E,oe,Se,S,s,b]),W=e.useMemo(()=>f.map(h=>h.key),[f]);function Q({id:h,action:ne,data:de}){O(g=>({...g,[h]:{action:ne,data:de}}))}const H=e.useCallback(()=>{for(let h in k)if(se.byId(h)){const{action:ne,data:de}=k[h];s.exec(ne,de)}},[s,k,se]),q=e.useCallback(()=>{const h=x?.id||x;if(ae){if(P?.segments){const ne=P.segments.filter((de,g)=>g!==B);s.exec("update-task",{id:h,task:{segments:ne}})}}else s.exec("delete-task",{id:h})},[s,x,ae,P,B]),te=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),v=e.useCallback(h=>{const{item:ne,changes:de}=h;ne.id==="delete"&&q(),ne.id==="save"&&(de.length?te():H()),ne.comp&&te()},[s,x,b,H,q,te]),K=e.useCallback((h,ne,de)=>(V&&h.type==="summary"&&(h.unscheduled=!1),xe.prepareEditTask(h,s.getState(),ne),de||ee(!1),h),[V,s]),ie=e.useCallback(h=>{h={...h,unscheduled:V&&h.unscheduled&&h.type!=="summary"},delete h.links,delete h.data,(W.indexOf("duration")===-1||h.segments&&!h.duration)&&delete h.duration;const ne={id:x?.id||x,task:h,...ae&&{segmentIndex:B}};b&&Z&&(ne.inProgress=Z),s.exec("update-task",ne),b||H()},[s,x,V,b,H,W,ae,B,Z]),we=e.useCallback(h=>{let{update:ne,key:de,input:g}=h;if(g&&ee(!0),h.update=K({...ne},de,g),!b)le(h.update);else if(!pe&&!g){const J=f.find(je=>je.key===de),re=ne[de];(!J.validation||J.validation(re))&&(!J.required||re)&&ie(h.update)}},[b,K,pe,f,ie]),Re=e.useCallback(h=>{b||ie(h.values)},[b,ie]),Ce=e.useCallback(h=>{ye(h.errors)},[]),$e=e.useMemo(()=>R?{"ctrl+z":h=>{h.preventDefault(),s.exec("undo")},"ctrl+y":h=>{h.preventDefault(),s.exec("redo")}}:{},[R,s]);return ve?l.jsx(ge.Locale,{children:l.jsx(Ae.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${U} ${r}`,items:f,values:ve,topBar:z,bottomBar:o,placement:L,layout:a,readonly:c,autoSave:b,focus:I,onAction:v,onSave:Re,onValidation:Ce,onChange:we,hotkeys:m&&{...$e,...m}})}):null}const Pt=({children:s,columns:n=null,api:r})=>{const[a,c]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(c)},[r]),l.jsx(rt.HeaderMenu,{api:a,columns:n,children:s})};function zt(s){const{api:n,content:r,children:a}=s,c=e.useRef(null),L=e.useRef(null),[o,y]=e.useState({}),[b,I]=e.useState(null),[m,D]=e.useState({});function p(C){for(;C;){if(C.getAttribute){const P=C.getAttribute("data-tooltip-id"),x=C.getAttribute("data-tooltip-at"),V=C.getAttribute("data-tooltip");if(P||V)return{id:P,tooltip:V,target:C,at:x}}C=C.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const C=L.current;if(C&&m&&(m.text||r)){const P=C.getBoundingClientRect();let x=!1,V=m.left,se=m.top;P.right>=o.right&&(V=o.width-P.width-5,x=!0),P.bottom>=o.bottom&&(se=m.top-(P.bottom-o.bottom+2),x=!0),x&&D(X=>X&&{...X,left:V,top:se})}},[m,o,r]);const S=e.useRef(null),F=300,u=C=>{clearTimeout(S.current),S.current=setTimeout(()=>{C()},F)};function z(C){let{id:P,tooltip:x,target:V,at:se}=p(C.target);if(D(null),I(null),!x)if(P)x=$(P);else{clearTimeout(S.current);return}const X=C.clientX;u(()=>{P&&I(_(U(P)));const B=V.getBoundingClientRect(),ae=c.current,E=ae?ae.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let R,k;se==="left"?(R=B.top+5-E.top,k=B.right+5-E.left):(R=B.top+B.height-E.top,k=X-E.left),y(E),D({top:R,left:k,text:x})})}function _(C){return n?.getTask(U(C))||null}function $(C){return _(C)?.text||""}function U(C){const P=parseInt(C);return isNaN(P)?C:P}return l.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:c,onMouseMove:z,children:[m&&(m.text||r)?l.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:L,style:{top:`${m.top}px`,left:`${m.left}px`},children:r?l.jsx(r,{data:b}):m.text?l.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:m.text}):null}):null,a]})}function Gt({fonts:s=!0,children:n}){return n?l.jsx(ge.Material,{fonts:s,children:n()}):l.jsx(ge.Material,{fonts:s})}function _t({fonts:s=!0,children:n}){return n?l.jsx(ge.Willow,{fonts:s,children:n}):l.jsx(ge.Willow,{fonts:s})}function Ot({fonts:s=!0,children:n}){return n?l.jsx(ge.WillowDark,{fonts:s,children:n}):l.jsx(ge.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>xe.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>xe.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>xe.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>xe.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>xe.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>xe.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>xe.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>xe.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>xe.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>Ae.registerEditorItem});exports.ContextMenu=Nt;exports.Editor=Ht;exports.Gantt=Dt;exports.HeaderMenu=Pt;exports.Material=Gt;exports.Toolbar=It;exports.Tooltip=zt;exports.Willow=_t;exports.WillowDark=Ot;
//# sourceMappingURL=index.cjs.map
