"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("react/jsx-runtime"),e=require("react"),Te=require("@svar-ui/react-core"),Ee=require("@svar-ui/lib-dom"),Be=require("@svar-ui/gantt-locales"),et=require("@svar-ui/core-locales"),Dt=require("@svar-ui/lib-state"),we=require("@svar-ui/gantt-store"),j=require("@svar-ui/lib-react"),pt=require("@svar-ui/grid-store"),kt=require("@svar-ui/react-grid"),It=require("react-dom"),ft=require("@svar-ui/react-toolbar"),Lt=require("@svar-ui/react-menu"),ze=require("@svar-ui/react-editor"),Ge=e.createContext(null);function Oe(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function Nt(s,n,r){const i=s.getBoundingClientRect(),l=n.querySelector(".wx-body").getBoundingClientRect();return{top:i.top-l.top,left:i.left-l.left,dt:i.bottom-r.clientY,db:r.clientY-i.top}}function xt(s){return s&&s.getAttribute("data-context-id")}const ht=5;function Pt(s,n){let r,i,l,L,h,v,o,y,k;function F(S){L=S.clientX,h=S.clientY,v={...Nt(r,s,S),y:n.getTask(l).$y},document.body.style.userSelect="none"}function Y(S){r=Ee.locate(S),xt(r)&&(l=Oe(r),k=setTimeout(()=>{y=!0,n&&n.touchStart&&n.touchStart(),F(S.touches[0])},500),s.addEventListener("touchmove",H),s.addEventListener("contextmenu",M),window.addEventListener("touchend",K))}function M(S){if(y||k)return S.preventDefault(),!1}function w(S){S.which===1&&(r=Ee.locate(S),xt(r)&&(l=Oe(r),s.addEventListener("mousemove",A),window.addEventListener("mouseup",T),F(S)))}function f(S){s.removeEventListener("mousemove",A),s.removeEventListener("touchmove",H),document.body.removeEventListener("mouseup",T),document.body.removeEventListener("touchend",K),document.body.style.userSelect="",S&&(s.removeEventListener("mousedown",w),s.removeEventListener("touchstart",Y))}function U(S){const V=S.clientX-L,ne=S.clientY-h;if(!i){if(Math.abs(V)<ht&&Math.abs(ne)<ht||n&&n.start&&n.start({id:l,e:S})===!1)return;i=r.cloneNode(!0),i.style.pointerEvents="none",i.classList.add("wx-reorder-task"),i.style.position="absolute",i.style.left=v.left+"px",i.style.top=v.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(i,r)}if(i){const Q=Math.round(Math.max(0,v.top+ne));if(n&&n.move&&n.move({id:l,top:Q,detail:o})===!1)return;const ae=n.getTask(l),X=ae.$y;if(!v.start&&v.y==X)return P();v.start=!0,v.y=ae.$y-4,i.style.top=Q+"px";const ce=document.elementFromPoint(S.clientX,S.clientY),E=Ee.locate(ce);if(E&&E!==r){const x=Oe(E),z=E.getBoundingClientRect(),te=z.top+z.height/2,ue=S.clientY+v.db>te&&E.nextElementSibling!==r,re=S.clientY-v.dt<te&&E.previousElementSibling!==r;o?.after==x||o?.before==x?o=null:ue?o={id:l,after:x}:re&&(o={id:l,before:x})}}}function A(S){U(S)}function H(S){y?(S.preventDefault(),U(S.touches[0])):k&&(clearTimeout(k),k=null)}function K(){y=null,k&&(clearTimeout(k),k=null),P()}function T(){P()}function P(){r&&(r.style.visibility=""),i&&(i.parentNode.removeChild(i),n&&n.end&&n.end({id:l,top:v.top})),l=r=i=v=o=null,f()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",w),s.addEventListener("touchstart",Y),{destroy(){f(!0)}}}function Wt({row:s,column:n}){function r(l,L){return{justifyContent:L.align,paddingLeft:`${(l.$level-1)*20}px`}}const i=n&&n._cell;return c.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?c.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):c.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),c.jsx("div",{className:"wx-pqc08MHU wx-text",children:i?c.jsx(i,{row:s,column:n}):s.text})]})}function mt({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?c.jsx("div",{style:{textAlign:s.align},children:c.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function At(s){const{readonly:n,compactMode:r,width:i=0,display:l="all",columnWidth:L=0,onTableAPIChange:h,multiTaskRows:v=!1,rowMapping:o=null}=s,[y,k]=j.useWritableProp(L),[F,Y]=e.useState(),M=e.useContext(Te.context.i18n),w=e.useMemo(()=>M.getGroup("gantt"),[M]),f=e.useContext(Ge),U=j.useStore(f,"scrollTop"),A=j.useStore(f,"cellHeight"),H=j.useStore(f,"_scrollTask"),K=j.useStore(f,"_selected"),T=j.useStore(f,"area"),P=j.useStore(f,"_tasks"),S=j.useStore(f,"_scales"),V=j.useStore(f,"columns"),ne=j.useStore(f,"_sort"),Q=j.useStore(f,"calendar"),ae=j.useStore(f,"durationUnit"),X=j.useStore(f,"splitTasks"),[ce,E]=e.useState(null),x=e.useMemo(()=>!P||!T?[]:v&&o?P:P.slice(T.start,T.end),[P,T,v,o]),z=e.useCallback((a,b)=>{if(b==="add-task")f.exec(b,{target:a,task:{text:w("New Task")},mode:"child",show:!0});else if(b==="open-task"){const $=x.find(_=>_.id===a);($?.data||$?.lazy)&&f.exec(b,{id:a,mode:!$.open})}},[x]),te=e.useCallback(a=>{const b=Ee.locateID(a),$=a.target.dataset.action;$&&a.preventDefault(),b?$==="add-task"||$==="open-task"?z(b,$):f.exec("select-task",{id:b,toggle:a.ctrlKey||a.metaKey,range:a.shiftKey,show:!0}):$==="add-task"&&z(null,$)},[f,z]),ue=e.useRef(null),re=e.useRef(null),[ie,be]=e.useState(0),[Re,De]=e.useState(!1);e.useEffect(()=>{const a=re.current;if(!a||typeof ResizeObserver>"u")return;const b=()=>be(a.clientWidth);b();const $=new ResizeObserver(b);return $.observe(a),()=>$.disconnect()},[]);const Me=e.useRef(null),Le=e.useCallback(a=>{const b=a.id,{before:$,after:_}=a,he=a.onMove;let me=$||_,$e=$?"before":"after";if(he){if($e==="after"){const Ae=f.getTask(me);Ae.data?.length&&Ae.open&&($e="before",me=Ae.data[0].id)}Me.current={id:b,[$e]:me}}else Me.current=null;f.exec("move-task",{id:b,mode:$e,target:me,inProgress:he})},[f]),pe=e.useMemo(()=>v&&o?0:T?.from??0,[T,v,o]),J=e.useMemo(()=>S?.height??0,[S]),p=e.useMemo(()=>!r&&l!=="grid"?(y??0)>(i??0):(y??0)>(ie??0),[r,l,y,i,ie]),W=e.useMemo(()=>{const a={};return p&&l==="all"||l==="grid"&&p?a.width=y:l==="grid"&&(a.width="100%"),a},[p,l,y]),B=e.useMemo(()=>ce&&!x.find(a=>a.id===ce.id)?[...x,ce]:x,[x,ce]),q=e.useMemo(()=>{if(!v||!o)return B;const a=new Map,b=new Set;return B.forEach($=>{const _=o.taskRows.get($.id)??$.id;b.has(_)||(a.set(_,{...$,$rowTasks:o.rowMap.get(_)||[$.id]}),b.add(_))}),Array.from(a.values())},[B,v,o]),G=e.useMemo(()=>{let a=(V||[]).map(_=>{_={..._};const he=_.header;if(typeof he=="object"){const me=he.text&&w(he.text);_.header={...he,text:me}}else _.header=w(he);return _});const b=a.findIndex(_=>_.id==="text"),$=a.findIndex(_=>_.id==="add-task");if(b!==-1&&(a[b].cell&&(a[b]._cell=a[b].cell),a[b].cell=Wt),$!==-1){a[$].cell=a[$].cell||mt;const _=a[$].header;if(typeof _!="object"&&(a[$].header={text:_}),a[$].header.cell=_.cell||mt,n)a.splice($,1);else if(r){const[he]=a.splice($,1);a.unshift(he)}}return a.length>0&&(a[a.length-1].resize=!1),a},[V,w,n,r]),ge=e.useMemo(()=>l==="all"?`${i}px`:l==="grid"?"calc(100% - 4px)":G.find(a=>a.id==="add-task")?"50px":"0",[l,i,G]),oe=e.useMemo(()=>{if(q&&ne?.length){const a={};return ne.forEach(({key:b,order:$},_)=>{a[b]={order:$,...ne.length>1&&{index:_}}}),a}return{}},[q,ne]),C=e.useCallback(()=>G.some(a=>a.flexgrow&&!a.hidden),[]),Z=e.useMemo(()=>C(),[C,Re]),de=e.useMemo(()=>{let a=l==="chart"?G.filter($=>$.id==="add-task"):G;const b=l==="all"?i:ie;if(!Z){let $=y,_=!1;if(G.some(he=>he.$width)){let he=0;$=G.reduce((me,$e)=>($e.hidden||(he+=$e.width,me+=$e.$width||$e.width),me),0),he>$&&$>b&&(_=!0)}if(_||$<b){let he=1;return _||(he=(b-50)/($-50||1)),a.map(me=>(me.id!=="add-task"&&!me.hidden&&(me.$width||(me.$width=me.width),me.width=me.$width*he),me))}}return a},[l,G,Z,y,i,ie]),fe=e.useCallback(a=>{if(!C()){const b=de.reduce(($,_)=>(a&&_.$width&&(_.$width=_.width),$+(_.hidden?0:_.width)),0);b!==y&&k(b)}De(!0),De(!1)},[C,de,y,k]),m=e.useCallback(()=>{G.filter(b=>b.flexgrow&&!b.hidden).length===1&&G.forEach(b=>{b.$width&&!b.flexgrow&&!b.hidden&&(b.width=b.$width)})},[]),le=e.useCallback(a=>{if(!n){const b=Ee.locateID(a),$=Ee.locateAttr(a,"data-col-id");!($&&G.find(he=>he.id==$))?.editor&&b&&f.exec("show-editor",{id:b})}},[f,n]),xe=e.useMemo(()=>Array.isArray(K)?K.map(a=>a.id):[],[K]),O=e.useRef(pe);O.current=pe,e.useEffect(()=>{const a=$=>{if(ue.current){const _=ue.current.querySelector(".wx-body");_&&(_.style.top=-(($??0)-(O.current??0))+"px")}re.current&&(re.current.scrollTop=0)};return a(U),f.on("scroll-chart",({top:$})=>{$!==void 0&&a($)})},[f,U]),e.useEffect(()=>{if(ue.current){const a=ue.current.querySelector(".wx-body");a&&(a.style.top=-((U??0)-(pe??0))+"px")}},[pe]),e.useEffect(()=>{const a=ue.current;if(!a)return;const b=a.querySelector(".wx-table-box .wx-body");if(!b||typeof ResizeObserver>"u")return;const $=new ResizeObserver(()=>{if(ue.current){const _=ue.current.querySelector(".wx-body");_&&(_.style.top=-((U??0)-(O.current??0))+"px")}});return $.observe(b),()=>{$.disconnect()}},[de,W,l,ge,q,U]),e.useEffect(()=>{if(!H||!F)return;const{id:a}=H,b=F.getState().focusCell;b&&b.row!==a&&ue.current&&ue.current.contains(document.activeElement)&&F.exec("focus-cell",{row:a,column:b.column})},[H,F]);const Ce=e.useCallback(({id:a})=>{if(n)return!1;f.getTask(a).open&&f.exec("open-task",{id:a,mode:!1});const b=f.getState()._tasks.find($=>$.id===a);if(E(b||null),!b)return!1},[f,n]),se=e.useCallback(({id:a,top:b})=>{Me.current?Le({...Me.current,onMove:!1}):f.exec("drag-task",{id:a,top:b+(pe??0),inProgress:!1}),E(null)},[f,Le,pe]),ve=e.useCallback(({id:a,top:b,detail:$})=>{$&&Le({...$,onMove:!0}),f.exec("drag-task",{id:a,top:b+(pe??0),inProgress:!0})},[f,Le,pe]);e.useEffect(()=>{const a=ue.current;return a?Pt(a,{start:Ce,end:se,move:ve,getTask:f.getTask}).destroy:void 0},[f,Ce,se,ve]);const ye=e.useCallback(a=>{const{key:b,isInput:$}=a;if(!$&&(b==="arrowup"||b==="arrowdown"))return a.eventSource="grid",f.exec("hotkey",a),!1;if(b==="enter"){const _=F?.getState().focusCell;if(_){const{row:he,column:me}=_;me==="add-task"?z(he,"add-task"):me==="text"&&z(he,"open-task")}}},[f,z,F]),Se=e.useRef(null),Ne=()=>{Se.current={setTableAPI:Y,handleHotkey:ye,sortVal:ne,api:f,adjustColumns:m,setColumnWidth:fe,tasks:x,calendarVal:Q,durationUnitVal:ae,splitTasksVal:X,onTableAPIChange:h}};Ne(),e.useEffect(()=>{Ne()},[Y,ye,ne,f,m,fe,x,Q,ae,X,h]);const We=e.useCallback(a=>{Y(a),a.intercept("hotkey",b=>Se.current.handleHotkey(b)),a.intercept("scroll",()=>!1),a.intercept("select-row",()=>!1),a.intercept("sort-rows",b=>{const $=Se.current.sortVal,{key:_,add:he}=b,me=$?$.find(Ae=>Ae.key===_):null;let $e="asc";return me&&($e=!me||me.order==="asc"?"desc":"asc"),f.exec("sort-tasks",{key:_,order:$e,add:he}),!1}),a.on("resize-column",()=>{Se.current.setColumnWidth(!0)}),a.on("hide-column",b=>{b.mode||Se.current.adjustColumns(),Se.current.setColumnWidth()}),a.intercept("update-cell",b=>{const{id:$,column:_,value:he}=b,me=Se.current.tasks.find($e=>$e.id===$);if(me){const $e={...me};let Ae=he;Ae&&!isNaN(Ae)&&!(Ae instanceof Date)&&(Ae*=1),$e[_]=Ae,we.prepareEditTask($e,{calendar:Se.current.calendarVal,durationUnit:Se.current.durationUnitVal,splitTasks:Se.current.splitTasksVal},_),f.exec("update-task",{id:$,task:$e})}return!1}),h&&h(a)},[]);return c.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ge}`},ref:re,children:c.jsx("div",{ref:ue,style:W,className:"wx-rHj6070p wx-table",onClick:te,onDoubleClick:le,children:c.jsx(kt.Grid,{init:We,sizes:{rowHeight:A,headerHeight:(J??0)-1},rowStyle:a=>a.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:a=>`wx-rHj6070p wx-text-${a.align}${a.id==="add-task"?" wx-action":""}`,data:q,columns:de,selectedRows:[...xe],sortMarks:oe})})})}function Ht({borders:s=""}){const n=e.useContext(Ge),r=j.useStore(n,"cellWidth"),i=j.useStore(n,"cellHeight"),l=e.useRef(null),[L,h]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&l.current){const o=getComputedStyle(l.current).getPropertyValue("--wx-gantt-border");h(o?o.substring(o.indexOf("#")):"#1d1e261a")}},[]);const v={width:"100%",height:"100%",background:r!=null&&i!=null?`url(${we.grid(r,i,L,s)})`:void 0,position:"absolute",pointerEvents:"none"};return c.jsx("div",{ref:l,style:v})}function _t({onSelectLink:s,selectedLink:n,readonly:r}){const i=e.useContext(Ge),l=j.useStore(i,"_links"),L=j.useStore(i,"criticalPath"),h=e.useRef(null),v=e.useCallback(o=>{const y=o?.target?.classList;!y?.contains("wx-line")&&!y?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&h.current){const o=y=>{h.current&&!h.current.contains(y.target)&&v(y)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}}},[r,n,v]),c.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(l||[]).map(o=>{const y="wx-dkx3NwEn wx-line"+(L&&o.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return c.jsx("polyline",{className:y,points:o.$p,onClick:()=>!r&&s(o.id),"data-link-id":o.id},o.id)}),!r&&n&&c.jsx("polyline",{ref:h,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function zt(s){const{task:n,type:r}=s;function i(L){const h=n.segments[L];return{left:`${h.$x}px`,top:"0px",width:`${h.$w}px`,height:"100%"}}function l(L){if(!n.progress)return 0;const h=n.duration*n.progress/100,v=n.segments;let o=0,y=0,k=null;do{const F=v[y];y===L&&(o>h?k=0:k=Math.min((h-o)/F.duration,1)*100),o+=F.duration,y++}while(k===null&&y<v.length);return k||0}return c.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map((L,h)=>c.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":h,style:i(h),children:[n.progress?c.jsx("div",{className:"wx-progress-wrapper",children:c.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${l(h)}%`}})}):null,c.jsx("div",{className:"wx-content",children:L.text||""})]},h))})}let Ze=[],Je=null,gt=null;const Ue=s=>new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())),wt=(s,n)=>{if(!n||!n.start)return null;const{start:r,lengthUnitWidth:i,lengthUnit:l}=n,L=864e5,h=l==="week"?7:l==="month"?30:l==="quarter"?91:l==="year"?365:1,v=Math.floor(s/i),o=Ue(r);return new Date(o.getTime()+v*h*L)},Gt=(s,n,r)=>{if(!r||!s||!n)return 0;const{lengthUnit:i}=r,h=(i==="week"?7:i==="month"?30:i==="quarter"?91:i==="year"?365:1)*864e5;return Math.round((s.getTime()-n.getTime())/h)},Ot=(s,n,r)=>{if(!r||!s)return s;const{lengthUnit:i}=r,h=(i==="week"?7:i==="month"?30:i==="quarter"?91:i==="year"?365:1)*864e5,v=new Date(s.getTime()+n*h);return v.setUTCHours(0,0,0,0),v},Ut=(s,n,r,i)=>s<i&&n>r;function qt(s){const{readonly:n,taskTemplate:r,multiTaskRows:i=!1,rowMapping:l=null,marqueeSelect:L=!1,copyPaste:h=!1,allowTaskIntersection:v=!0}=s,o=e.useContext(Ge),[y,k]=j.useStoreWithCounter(o,"_tasks"),[F,Y]=j.useStoreWithCounter(o,"_links"),M=j.useStore(o,"area"),w=j.useStore(o,"_scales"),f=j.useStore(o,"taskTypes"),U=j.useStore(o,"baselines"),[A,H]=j.useStoreWithCounter(o,"_selected"),K=j.useStore(o,"_scrollTask"),T=j.useStore(o,"criticalPath"),P=j.useStore(o,"tasks"),S=j.useStore(o,"schedule"),V=j.useStore(o,"splitTasks"),ne=e.useMemo(()=>{if(!M||!Array.isArray(y))return[];const t=M.start??0,u=M.end??0;return i&&l?y.map(d=>({...d})):y.slice(t,u).map(d=>({...d}))},[k,M,i,l]),Q=j.useStore(o,"cellHeight"),ae=e.useMemo(()=>{if(!i||!l||!ne.length)return ne;const t=new Map,u=[];return y.forEach(d=>{const g=l.taskRows.get(d.id)??d.id;t.has(g)||(t.set(g,u.length),u.push(g))}),ne.map(d=>{const g=l.taskRows.get(d.id)??d.id,D=t.get(g)??0;return{...d,$y:D*Q,$y_base:d.$y_base!==void 0?D*Q:void 0}})},[ne,i,l,y,Q]),X=e.useMemo(()=>w.lengthUnitWidth,[w]),ce=e.useMemo(()=>w.lengthUnit||"day",[w]),E=e.useRef(!1),[x,z]=e.useState(void 0),[te,ue]=e.useState(null),re=e.useRef(null),[ie,be]=e.useState(null),[Re,De]=e.useState(void 0),Me=e.useRef(null),[Le,pe]=e.useState(0),[J,p]=e.useState(null),W=e.useRef(null),[B,q]=e.useState(null),[G,ge]=e.useState(null),[oe,C]=e.useState(null),Z=e.useRef(null);Z.current=G;const de=e.useRef(200),fe=e.useRef(null),m=e.useMemo(()=>{const t=fe.current;return!!(A.length&&t&&t.contains(document.activeElement))},[A,fe.current]),le=e.useMemo(()=>m&&A[A.length-1]?.id,[m,A]);e.useEffect(()=>{if(K&&m&&K){const{id:t}=K,u=fe.current?.querySelector(`.wx-bar[data-id='${t}']`);u&&u.focus({preventScroll:!0})}},[K]),e.useEffect(()=>{const t=fe.current;if(t&&(pe(t.offsetWidth||0),typeof ResizeObserver<"u")){const u=new ResizeObserver(d=>{d[0]&&pe(d[0].contentRect.width)});return u.observe(t),()=>u.disconnect()}},[fe.current]);const xe=e.useCallback(()=>{document.body.style.userSelect="none"},[]),O=e.useCallback(()=>{document.body.style.userSelect=""},[]),Ce=e.useCallback((t,u,d)=>{if(u.target.classList.contains("wx-line")||(d||(d=o.getTask(Oe(t))),d.type==="milestone"||d.type==="summary"))return"";const g=Ee.locate(u,"data-segment");g&&(t=g);const{left:D,width:R}=t.getBoundingClientRect(),N=(u.clientX-D)/R;let I=.2/(R>200?R/200:1);return N<I?"start":N>1-I?"end":""},[o]),se=e.useMemo(()=>{const t=new Set;if(v||!i||!l)return t;const u=new Map;return y.forEach(d=>{if(d.type==="summary"||d.type==="milestone")return;const g=l.taskRows.get(d.id)??d.id;u.has(g)||u.set(g,[]),u.get(g).push(d)}),u.forEach(d=>{if(!(d.length<2))for(let g=0;g<d.length;g++)for(let D=g+1;D<d.length;D++){const R=d[g],N=d[D],I=R.$x,ee=R.$x+R.$w,ke=N.$x,je=N.$x+N.$w;Ut(I,ee,ke,je)&&(t.add(R.id),t.add(N.id))}}),t},[v,i,l,y,k]),ve=e.useMemo(()=>{const t=new Map;if(!i||!l)return y.forEach(g=>{t.set(g.id,g.$y)}),t;const u=new Map,d=[];return y.forEach(g=>{const D=l.taskRows.get(g.id)??g.id;u.has(D)||(u.set(D,d.length),d.push(D))}),y.forEach(g=>{const D=l.taskRows.get(g.id)??g.id,R=u.get(D)??0;t.set(g.id,R*Q)}),t},[y,i,l,Q]),ye=e.useMemo(()=>{const t=new Map;if(!i||!l)return y.forEach(g=>{t.set(g.id,g.$y),g.row!==void 0&&t.set(g.row,g.$y)}),t;const u=new Map,d=[];return y.forEach(g=>{const D=l.taskRows.get(g.id)??g.id;u.has(D)||(u.set(D,d.length),d.push(D))}),u.forEach((g,D)=>{t.set(D,g*Q)}),t},[y,i,l,Q]),Se=e.useCallback(t=>{if(!fe.current)return[];const d=Math.min(t.startX,t.currentX),g=Math.max(t.startX,t.currentX),D=Math.min(t.startY,t.currentY),R=Math.max(t.startY,t.currentY);return y.filter(N=>{const I=N.$x,ee=N.$x+N.$w,je=ve.get(N.id)??N.$y,Pe=je+N.$h;return I<g&&ee>d&&je<R&&Pe>D})},[y,ve]),Ne=e.useMemo(()=>new Set(A.map(t=>t.id)),[A,H]),We=e.useCallback(t=>Ne.has(t),[Ne]),a=e.useCallback((t,u)=>{const{clientX:d}=u,g=Oe(t),D=o.getTask(g),R=u.target.classList;if(!u.target.closest(".wx-delete-button")&&!n){if(R.contains("wx-progress-marker")){const{progress:N}=o.getTask(g);re.current={id:g,x:d,progress:N,dx:0,node:t,marker:u.target},u.target.classList.add("wx-progress-in-drag")}else{const N=Ce(t,u,D)||"move",I={id:g,mode:N,x:d,dx:0,l:D.$x,w:D.$w};if(V&&D.segments?.length){const ee=Ee.locate(u,"data-segment");ee&&(I.segmentIndex=ee.dataset.segment*1,we.extendDragOptions(D,I))}ue(I)}xe()}},[o,n,Ce,xe,V]),b=e.useCallback(t=>{if(t.button!==0||oe)return;const u=Ee.locate(t);if(!u&&L&&!n){const d=fe.current;if(!d)return;const g=d.getBoundingClientRect(),D=t.clientX-g.left,R=t.clientY-g.top;if(h){const I=wt(D,w);I&&(Z.current=I,ge(I))}const N={startX:D,startY:R,currentX:D,currentY:R,ctrlKey:t.ctrlKey||t.metaKey};p(N),W.current=N,xe();return}if(u){if(L&&!n&&A.length>1){const d=Oe(u);if(We(d)){const g=t.target.classList;if(!g.contains("wx-link")&&!g.contains("wx-progress-marker")&&!t.target.closest(".wx-delete-button")){const D=o.getTask(d);if(!Ce(u,t,D)){const N=new Map;A.forEach(I=>{const ee=o.getTask(I.id);if(ee){if(S?.auto&&ee.type==="summary")return;N.set(I.id,{$x:ee.$x,$w:ee.$w,start:ee.start,end:ee.end})}}),q({baseTaskId:d,startX:t.clientX,dx:0,originalPositions:N}),xe();return}}}}a(u,t)}},[a,L,h,n,A,We,o,Ce,S,xe,w,oe]),$=e.useCallback(t=>{const u=Ee.locate(t);u&&(Me.current=setTimeout(()=>{De(!0),a(u,t.touches[0])},300))},[a]),_=e.useCallback(t=>{be(t&&{...F.find(u=>u.id===t)})},[F]),he=e.useCallback(()=>{const t=W.current;if(t){const u=Se(t);t.ctrlKey?u.forEach(d=>{o.exec("select-task",{id:d.id,toggle:!0,marquee:!0})}):(A.length>0&&o.exec("select-task",{id:null,marquee:!0}),u.forEach((d,g)=>{o.exec("select-task",{id:d.id,toggle:g>0,marquee:!0})})),p(null),W.current=null,O(),E.current=!0;return}if(B){const{dx:u,originalPositions:d}=B,g=Math.round(u/X);if(g!==0){let D=!0;d.forEach((R,N)=>{const I=o.getTask(N);I&&(o.exec("update-task",{id:N,diff:g,task:{start:I.start,end:I.end},skipUndo:!D}),D=!1)}),E.current=!0}else d.forEach((D,R)=>{o.exec("drag-task",{id:R,left:D.$x,width:D.$w,inProgress:!1})});q(null),O();return}if(re.current){const{dx:u,id:d,marker:g,value:D}=re.current;re.current=null,typeof D<"u"&&u&&o.exec("update-task",{id:d,task:{progress:D},inProgress:!1}),g.classList.remove("wx-progress-in-drag"),E.current=!0,O()}else if(te){const{id:u,mode:d,dx:g,l:D,w:R,start:N,segment:I,index:ee}=te;if(ue(null),N){const ke=Math.round(g/X);if(!ke)o.exec("drag-task",{id:u,width:R,left:D,inProgress:!1,...I&&{segmentIndex:ee}});else{let je={},Pe=o.getTask(u);I&&(Pe=Pe.segments[ee]);const _e=1440*60*1e3,Ie=ke*(ce==="week"?7:ce==="month"?30:ce==="quarter"?91:ce==="year"?365:1)*_e;d==="move"?(je.start=new Date(Pe.start.getTime()+Ie),je.end=new Date(Pe.end.getTime()+Ie)):d==="start"?(je.start=new Date(Pe.start.getTime()+Ie),je.end=Pe.end):d==="end"&&(je.start=Pe.start,je.end=new Date(Pe.end.getTime()+Ie)),o.exec("update-task",{id:u,task:je,...I&&{segmentIndex:ee}})}E.current=!0}O()}},[o,O,te,X,ce,J,B,Se,A]),me=e.useCallback((t,u)=>{const{clientX:d,clientY:g}=u,D=fe.current;if(D){const R=D.getBoundingClientRect();de.current=d-R.left}if(oe){if(!D)return;const R=D.getBoundingClientRect(),N=d-R.left;C(I=>({...I,currentX:N}));return}if(!n){if(J){const R=fe.current;if(!R)return;const N=R.getBoundingClientRect(),I=d-N.left,ee=g-N.top;p(ke=>({...ke,currentX:I,currentY:ee})),W.current&&(W.current.currentX=I,W.current.currentY=ee);return}if(B){const R=d-B.startX;B.originalPositions.forEach((N,I)=>{const ee=N.$x+R;o.exec("drag-task",{id:I,left:ee,width:N.$w,inProgress:!0})}),q(N=>({...N,dx:R}));return}if(re.current){const{node:R,x:N,id:I}=re.current,ee=re.current.dx=d-N,ke=Math.round(ee/R.offsetWidth*100);let je=re.current.progress+ke;re.current.value=je=Math.min(Math.max(0,je),100),o.exec("update-task",{id:I,task:{progress:je},inProgress:!0})}else if(te){_(null);const{mode:R,l:N,w:I,x:ee,id:ke,start:je,segment:Pe,index:_e}=te,He=o.getTask(ke),Ie=d-ee;if(!je&&Math.abs(Ie)<20||R==="start"&&I-Ie<X||R==="end"&&I+Ie<X||R==="move"&&(Ie<0&&N+Ie<0||Ie>0&&N+I+Ie>Le)||te.segment&&!we.isSegmentMoveAllowed(He,te))return;const Ke={...te,dx:Ie};let qe,Ye;if(R==="start"?(qe=N+Ie,Ye=I-Ie):R==="end"?(qe=N,Ye=I+Ie):R==="move"&&(qe=N+Ie,Ye=I),o.exec("drag-task",{id:ke,width:Ye,left:qe,inProgress:!0,...Pe&&{segmentIndex:_e}}),!Ke.start&&(R==="move"&&He.$x==N||R!=="move"&&He.$w==I)){E.current=!0,he();return}Ke.start=!0,ue(Ke)}else{const R=Ee.locate(t);if(R){const N=o.getTask(Oe(R)),ee=Ee.locate(t,"data-segment")||R,ke=Ce(ee,u,N);ee.style.cursor=ke&&!n?"col-resize":"pointer"}}}},[o,n,te,X,Le,Ce,_,he,J,B,oe]),$e=e.useCallback(t=>{me(t,t)},[me]),Ae=e.useCallback(t=>{Re?(t.preventDefault(),me(t,t.touches[0])):Me.current&&(clearTimeout(Me.current),Me.current=null)},[Re,me]),Ve=e.useCallback(()=>{he()},[he]),Tt=e.useCallback(()=>{De(null),Me.current&&(clearTimeout(Me.current),Me.current=null),he()},[he]);e.useEffect(()=>(window.addEventListener("mouseup",Ve),()=>{window.removeEventListener("mouseup",Ve)}),[Ve]);const Ct=e.useCallback(t=>{if(!n){const u=Ee.locateID(t.target);if(u&&!t.target.classList.contains("wx-link")){const d=Ee.locateID(t.target,"data-segment");o.exec("show-editor",{id:u,...d!==null&&{segmentIndex:d}})}}},[o,n]),vt=["e2s","s2s","e2e","s2e"],Xe=e.useCallback((t,u)=>vt[(t?1:0)+(u?0:2)],[]),Fe=e.useCallback((t,u)=>{const d=x.id,g=x.start;return t===d?!0:!!F.find(D=>D.target==t&&D.source==d&&D.type===Xe(g,u))},[x,Y,Xe]),tt=e.useCallback(()=>{x&&z(null)},[x]),st=e.useCallback((t,u,d)=>{if(!u.length||!t||d==null)return;const g=864e5,D=o.getHistory();D?.startBatch();const R=new Date(t),N=R.getUTCDay(),I=N===0?-6:1-N;R.setUTCDate(R.getUTCDate()+I),R.setUTCHours(0,0,0,0),u.forEach((ee,ke)=>{const je=`task-${Date.now()}-${ke}`,Pe=Ot(R,ee._startCellOffset||0,w),_e=new Date(Pe.getTime()+(ee._startDayOfWeek||0)*g);_e.setUTCHours(0,0,0,0);const He=new Date(_e.getTime()+(ee._durationDays||7)*g);He.setUTCHours(0,0,0,0),console.log("[paste] task:",ee.text,"newStart:",_e,"newEnd:",He,"_durationDays:",ee._durationDays,"_startDayOfWeek:",ee._startDayOfWeek),o.exec("add-task",{task:{id:je,text:ee.text,start:_e,end:He,type:ee.type||"task",parent:d,row:ee.row},target:d,mode:"child",skipUndo:ke>0})}),D?.endBatch()},[o,w]),Mt=e.useCallback(t=>{if(E.current){E.current=!1;return}if(oe&&oe.currentX!=null){const d=wt(oe.currentX,w);d&&st(d,oe.tasks,oe.parent),C(null);return}const u=Ee.locateID(t.target);if(u){const d=o.getTask(u),g=y.find(R=>R.id===u);console.log("[click] task:",d?.text,"id:",u),console.log("[click] api.getTask:",{start:d?.start,end:d?.end,duration:d?.duration}),console.log("[click] rendered:",{start:g?.start,end:g?.end,$w:g?.$w,$x:g?.$x});const D=t.target.classList;if(D.contains("wx-link")){const R=D.contains("wx-left");if(!x){z({id:u,start:R});return}x.id!==u&&!Fe(u,R)&&o.exec("add-link",{link:{source:x.id,target:u,type:Xe(x.start,R)}})}else if(D.contains("wx-delete-button-icon"))o.exec("delete-link",{id:ie.id}),be(null);else{let R;const N=Ee.locate(t,"data-segment");N&&(R=N.dataset.segment*1),o.exec("select-task",{id:u,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:R})}}tt()},[o,x,Y,ie,Fe,Xe,tt,oe,w,st]),St=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),Et=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),Rt=e.useCallback(t=>{if(Re||Me.current)return t.preventDefault(),!1},[Re]),nt=e.useMemo(()=>f.map(t=>t.id),[f]),rt=e.useCallback(t=>{let u=nt.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(u=`task ${u}`),u},[nt]),ot=e.useCallback(t=>{o.exec(t.action,t.data)},[o]),Qe=e.useCallback(t=>T&&P.byId(t).$critical,[T,P]),lt=e.useCallback(t=>{if(S?.auto){const u=P.getSummaryId(t,!0),d=P.getSummaryId(x.id,!0);return x?.id&&!(Array.isArray(u)?u:[u]).includes(x.id)&&!(Array.isArray(d)?d:[d]).includes(t)}return x},[S,P,x]),ct=e.useCallback(()=>{const t=o.getState()._selected;if(!t||!t.length)return;const u=864e5,d=t.map(I=>{const ee=o.getTask(I.id);if(!ee)return null;const ke=y.find($t=>$t.id===I.id);if(!ke)return null;const{$x:je,$y:Pe,$h:_e,$w:He,$skip:Ie,$level:Ke,$index:qe,$y_base:Ye,$x_base:gs,$w_base:ws,$h_base:ps,$skip_baseline:ks,$critical:bs,$reorder:ys,...jt}=ke,at=ke.end&&ke.start?Math.round((ke.end.getTime()-ke.start.getTime())/u):0,ut=ke.start?Ue(ke.start):null,dt=ut?(ut.getUTCDay()+6)%7:0;return console.log("[copy] task:",ee.text,"durationDays:",at,"startDayOfWeek:",dt,"$w:",He),{...jt,_durationDays:at,_startDayOfWeek:dt,_originalWidth:He,_originalHeight:_e}}).filter(Boolean);if(!d.length)return;const D=d[0].parent,R=d.filter(I=>I.parent===D);if(R.length===0)return;const N=R.reduce((I,ee)=>{if(!ee.start)return I;const ke=Ue(ee.start);return!I||ke<I?ke:I},null);Ze=R.map(I=>({...I,start:I.start?Ue(I.start):I.start,end:I.end?Ue(I.end):I.end,_startCellOffset:Gt(I.start?Ue(I.start):null,N,w)})),gt=D,Je=N},[o,w]);e.useEffect(()=>h?o.intercept("hotkey",u=>{if(u.key==="ctrl+c"||u.key==="meta+c")return ct(),!1;if(u.key==="ctrl+v"||u.key==="meta+v")return!Ze.length||!Je||C({tasks:Ze,baseDate:Je,parent:gt,currentX:de.current}),!1}):void 0,[h,o,ct]),e.useEffect(()=>{if(!oe)return;const t=u=>{u.key==="Escape"&&(u.preventDefault(),u.stopPropagation(),C(null))};return document.addEventListener("keydown",t,!0),()=>document.removeEventListener("keydown",t,!0)},[oe]);const it=e.useMemo(()=>{if(!J)return null;const t=Math.min(J.startX,J.currentX),u=Math.min(J.startY,J.currentY),d=Math.abs(J.currentX-J.startX),g=Math.abs(J.currentY-J.startY);return{left:`${t}px`,top:`${u}px`,width:`${d}px`,height:`${g}px`}},[J]);return c.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${ae.length?ae[0].$h:0}px`},ref:fe,onContextMenu:Rt,onMouseDown:b,onMouseMove:$e,onTouchStart:$,onTouchMove:Ae,onTouchEnd:Tt,onClick:Mt,onDoubleClick:Ct,onDragStart:t=>(t.preventDefault(),!1),children:[c.jsx(_t,{onSelectLink:_,selectedLink:ie,readonly:n}),ae.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const u=se.has(t.id),d=`wx-bar wx-${rt(t.type)}`+(Re&&te&&t.id===te.id?" wx-touch":"")+(x&&x.id===t.id?" wx-selected":"")+(Ne.has(t.id)?" wx-selected":"")+(Qe(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(V&&t.segments?" wx-split":"")+(u?" wx-collision":""),g="wx-link wx-left"+(x?" wx-visible":"")+(!x||!Fe(t.id,!0)&&lt(t.id)?" wx-target":"")+(x&&x.id===t.id&&x.start?" wx-selected":"")+(Qe(t.id)?" wx-critical":""),D="wx-link wx-right"+(x?" wx-visible":"")+(!x||!Fe(t.id,!1)&&lt(t.id)?" wx-target":"")+(x&&x.id===t.id&&!x.start?" wx-selected":"")+(Qe(t.id)?" wx-critical":"");return c.jsxs(e.Fragment,{children:[!t.$skip&&c.jsxs("div",{className:"wx-GKbcLEGA "+d,style:St(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:le===t.id?0:-1,children:[n?null:t.id===ie?.target&&ie?.type[2]==="s"?c.jsx(Te.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+g,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?c.jsxs(c.Fragment,{children:[t.progress&&!(V&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:c.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(V&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?c.jsx(r,{data:t,api:o,onAction:ot}):V&&t.segments?c.jsx(zt,{task:t,type:rt(t.type)}):c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""}),u&&c.jsx("div",{className:"wx-GKbcLEGA wx-collision-warning",title:"This task overlaps with another task in the same row",children:"!"})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?c.jsx(r,{data:t,api:o,onAction:ot}):c.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===ie?.target&&ie?.type[2]==="e"?c.jsx(Te.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+D,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),U&&!t.$skip_baseline?c.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:Et(t)}):null]},t.id)}),J&&it&&c.jsx("div",{className:"wx-GKbcLEGA wx-marquee-selection",style:it}),oe&&oe.currentX!=null&&oe.tasks.map((t,u)=>{const g=(Math.floor(oe.currentX/X)+(t._startCellOffset||0))*X,D=t._originalWidth||X,R=t._originalHeight||Q,N=ye.get(t.row)??(t.$y||0);return c.jsx("div",{className:"wx-GKbcLEGA wx-bar wx-task wx-paste-preview",style:{left:g,top:N,width:D,height:R},children:c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text})},`preview-${u}`)})]})}function Yt(s){const{highlightTime:n}=s,r=e.useContext(Ge),i=j.useStore(r,"_scales");return c.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:i.width},children:(i?.rows||[]).map((l,L)=>c.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${l.height}px`},children:(l.cells||[]).map((h,v)=>{const o=n?n(h.date,h.unit):"",y="wx-cell "+(h.css||"")+" "+(o||""),k=typeof h.value=="string"&&h.value.includes("<");return c.jsx("div",{className:"wx-ZkvhDKir "+y,style:{width:`${h.width}px`},...k?{dangerouslySetInnerHTML:{__html:h.value}}:{children:h.value}},v)})},L))})}const Xt=new Map;function Ft(s){const n=e.useRef(null),r=e.useRef(0),i=e.useRef(null),l=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(l)return cancelAnimationFrame(i.current),i.current=requestAnimationFrame(()=>{const L={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};Xt.set(s,L),window.dispatchEvent(new CustomEvent("render-metric",{detail:L}))}),()=>cancelAnimationFrame(i.current)})}function Kt(s){const{readonly:n,fullWidth:r,fullHeight:i,taskTemplate:l,cellBorders:L,highlightTime:h,multiTaskRows:v=!1,rowMapping:o=null,marqueeSelect:y=!1,copyPaste:k=!1,scrollToCurrentWeek:F=!1,currentWeekColor:Y=null,allowTaskIntersection:M=!0}=s,w=e.useContext(Ge),[f,U]=j.useStoreWithCounter(w,"_selected"),A=j.useStore(w,"scrollTop"),H=j.useStore(w,"cellHeight"),K=j.useStore(w,"cellWidth"),T=j.useStore(w,"_scales"),P=j.useStore(w,"_markers"),S=j.useStore(w,"_scrollTask"),V=j.useStore(w,"zoom"),ne=j.useStore(w,"_tasks"),[Q,ae]=e.useState(),X=e.useRef(null),ce=e.useRef(0),E=e.useRef(!1),x=1+(T?.rows?.length||0),z=e.useMemo(()=>{if(!v||!o||!ne?.length)return null;const p=new Map,W=new Map,B=[];return ne.forEach(q=>{const G=o.taskRows.get(q.id)??q.id;W.has(G)||(W.set(G,B.length),B.push(G))}),ne.forEach(q=>{const G=o.taskRows.get(q.id)??q.id,ge=W.get(G)??0;p.set(q.id,ge*H)}),p},[ne,v,o,H]),te=e.useMemo(()=>{const p=[];return f&&f.length&&H&&f.forEach(W=>{const B=z?.get(W.id)??W.$y;p.push({height:`${H}px`,top:`${B-3}px`})}),p},[U,H,z]),ue=e.useMemo(()=>Math.max(Q||0,i),[Q,i]);e.useEffect(()=>{const p=X.current;p&&typeof A=="number"&&(p.scrollTop=A)},[A]);const re=()=>{ie()};function ie(p){const W=X.current;if(!W)return;const B={};B.left=W.scrollLeft,w.exec("scroll-chart",B)}function be(){const p=X.current,B=Math.ceil((Q||0)/(H||1))+1,q=Math.floor((p&&p.scrollTop||0)/(H||1)),G=Math.max(0,q-x),ge=q+B+x,oe=G*(H||0);w.exec("render-data",{start:G,end:ge,from:oe})}e.useEffect(()=>{be()},[Q,A]);const Re=e.useCallback(p=>{if(!p)return;const{id:W,mode:B}=p;if(B.toString().indexOf("x")<0)return;const q=X.current;if(!q)return;const{clientWidth:G}=q,ge=w.getTask(W);if(ge.$x+ge.$w<q.scrollLeft)w.exec("scroll-chart",{left:ge.$x-(K||0)}),q.scrollLeft=ge.$x-(K||0);else if(ge.$x>=G+q.scrollLeft){const oe=G<ge.$w?K||0:ge.$w;w.exec("scroll-chart",{left:ge.$x-G+oe}),q.scrollLeft=ge.$x-G+oe}},[w,K]);e.useEffect(()=>{Re(S)},[S]);function De(p){if(V&&(p.ctrlKey||p.metaKey)){p.preventDefault();const W=X.current,B=p.clientX-(W?W.getBoundingClientRect().left:0);if(ce.current+=p.deltaY,Math.abs(ce.current)>=150){const G=-Math.sign(ce.current);ce.current=0,w.exec("zoom-scale",{dir:G,offset:B})}}}const Me=e.useCallback(p=>{const W=h(p.date,p.unit);return W?{css:W,width:p.width}:null},[h]),Le=e.useMemo(()=>{if(!T||!h||!["hour","day","week"].includes(T.minUnit))return null;let W=0;return T.rows[T.rows.length-1].cells.map(B=>{const q=Me(B),G=W;return W+=B.width,q?{...q,left:G}:null})},[T,h,Me]),pe=e.useCallback(p=>{p.eventSource="chart",w.exec("hotkey",p)},[w]);e.useEffect(()=>{const p=X.current;if(!p)return;const W=()=>ae(p.clientHeight);W();const B=new ResizeObserver(()=>W());return B.observe(p),()=>{B.disconnect()}},[X.current]);const J=e.useRef(null);return e.useEffect(()=>{const p=X.current;if(p&&!J.current)return J.current=pt.hotkeys(p,{keys:{arrowup:!0,arrowdown:!0},exec:W=>pe(W)}),()=>{J.current?.destroy(),J.current=null}},[]),e.useEffect(()=>{const p=X.current;if(!p)return;const W=De;return p.addEventListener("wheel",W),()=>{p.removeEventListener("wheel",W)}},[De]),e.useEffect(()=>{if(!F||E.current||!T||!X.current||!Q)return;const p=X.current,{clientWidth:W}=p,B=new Date,q=T.rows[T.rows.length-1]?.cells;if(!q)return;let G=-1,ge=0;const oe=[];for(let Z=0;Z<q.length;Z++){const de=q[Z];oe.push({left:ge,width:de.width});const fe=de.date;if(de.unit==="week"){const m=new Date(fe);m.setUTCDate(m.getUTCDate()+7),B>=fe&&B<m&&(G=Z)}else de.unit==="day"&&B.getUTCFullYear()===fe.getUTCFullYear()&&B.getUTCMonth()===fe.getUTCMonth()&&B.getUTCDate()===fe.getUTCDate()&&(G=Z);ge+=de.width}let C=G;if(G>0&&(C=G-1),C>=0&&oe[C]){const Z=oe[C],de=Math.max(0,Z.left);p.scrollLeft=de,w.exec("scroll-chart",{left:de}),E.current=!0}},[F,T,Q,w]),Ft("chart"),c.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:X,onScroll:re,children:[c.jsx(Yt,{highlightTime:h,scales:T}),P&&P.length?c.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${ue}px`},children:P.map((p,W)=>c.jsx("div",{className:`wx-mR7v2Xag wx-marker ${p.css||""}`,style:{left:`${p.left}px`},children:c.jsx("div",{className:"wx-mR7v2Xag wx-content",children:p.text})},W))}):null,c.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${ue}px`},children:[Le?c.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:Le.map((p,W)=>p?c.jsx("div",{className:"wx-mR7v2Xag "+p.css,style:{width:`${p.width}px`,left:`${p.left}px`}},W):null)}):null,c.jsx(Ht,{borders:L}),f&&f.length?f.map((p,W)=>p.$y?c.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":p.id,style:te[W]},p.id):null):null,c.jsx(qt,{readonly:n,taskTemplate:l,multiTaskRows:v,rowMapping:o,marqueeSelect:y,copyPaste:k,allowTaskIntersection:M})]})]})}function Bt(s){const{position:n="after",size:r=4,dir:i="x",onMove:l,onDisplayChange:L,compactMode:h,containerWidth:v=0,leftThreshold:o=50,rightThreshold:y=50}=s,[k,F]=j.useWritableProp(s.value??0),[Y,M]=j.useWritableProp(s.display??"all");function w(re){let ie=0;n=="center"?ie=r/2:n=="before"&&(ie=r);const be={size:[r+"px","auto"],p:[re-ie+"px","0px"],p2:["auto","0px"]};if(i!="x")for(let Re in be)be[Re]=be[Re].reverse();return be}const[f,U]=e.useState(!1),[A,H]=e.useState(null),K=e.useRef(0),T=e.useRef(),P=e.useRef(),S=e.useRef(Y);e.useEffect(()=>{S.current=Y},[Y]),e.useEffect(()=>{A===null&&k>0&&H(k)},[A,k]);function V(re){return i=="x"?re.clientX:re.clientY}const ne=e.useCallback(re=>{const ie=T.current+V(re)-K.current;F(ie);let be;ie<=o?be="chart":v-ie<=y?be="grid":be="all",S.current!==be&&(M(be),S.current=be),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>l&&l(ie),100)},[v,o,y,l]),Q=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",U(!1),window.removeEventListener("mousemove",ne),window.removeEventListener("mouseup",Q)},[ne]),ae=e.useMemo(()=>Y!=="all"?"auto":i=="x"?"ew-resize":"ns-resize",[Y,i]),X=e.useCallback(re=>{!h&&(Y==="grid"||Y==="chart")||(K.current=V(re),T.current=k,U(!0),document.body.style.cursor=ae,document.body.style.userSelect="none",window.addEventListener("mousemove",ne),window.addEventListener("mouseup",Q))},[ae,ne,Q,k,h,Y]);function ce(){M("all"),A!==null&&(F(A),l&&l(A))}function E(re){if(h){const ie=Y==="chart"?"grid":"chart";M(ie),L(ie)}else if(Y==="grid"||Y==="chart")ce(),L("all");else{const ie=re==="left"?"chart":"grid";M(ie),L(ie)}}function x(){E("left")}function z(){E("right")}const te=e.useMemo(()=>w(k),[k,n,r,i]),ue=["wx-resizer",`wx-resizer-${i}`,`wx-resizer-display-${Y}`,f?"wx-resizer-active":""].filter(Boolean).join(" ");return c.jsxs("div",{className:"wx-pFykzMlT "+ue,onMouseDown:X,style:{width:te.size[0],height:te.size[1],cursor:ae},children:[c.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:x})}),c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:z})})]}),c.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const Vt=650;function bt(s){let n;function r(){n=new ResizeObserver(l=>{for(let L of l)if(L.target===document.body){let h=L.contentRect.width<=Vt;s(h)}}),n.observe(document.body)}function i(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:i}}function Qt(s){const{taskTemplate:n,readonly:r,cellBorders:i,highlightTime:l,onTableAPIChange:L,multiTaskRows:h=!1,rowMapping:v=null,marqueeSelect:o=!1,copyPaste:y=!1,scrollToCurrentWeek:k=!1,currentWeekColor:F=null,allowTaskIntersection:Y=!0}=s,M=e.useContext(Ge),w=j.useStore(M,"_tasks"),f=j.useStore(M,"_scales"),U=j.useStore(M,"cellHeight"),A=j.useStore(M,"columns"),H=j.useStore(M,"_scrollTask"),K=j.useStore(M,"undo"),T=e.useMemo(()=>{if(!h)return v;const C=new Map,Z=new Map;return w.forEach(de=>{const fe=de.row??de.id;Z.set(de.id,fe),C.has(fe)||C.set(fe,[]),C.get(fe).push(de.id)}),{rowMap:C,taskRows:Z}},[w,h,v]),[P,S]=e.useState(!1);let[V,ne]=e.useState(0);const[Q,ae]=e.useState(0),[X,ce]=e.useState(0),[E,x]=e.useState(void 0),[z,te]=e.useState("all"),ue=e.useRef(null),re=e.useCallback(C=>{S(Z=>(C!==Z&&(C?(ue.current=z,z==="all"&&te("grid")):(!ue.current||ue.current==="all")&&te("all")),C))},[z]);e.useEffect(()=>{const C=bt(re);return C.observe(),()=>{C.disconnect()}},[re]);const ie=e.useMemo(()=>{let C;return A.every(Z=>Z.width&&!Z.flexgrow)?C=A.reduce((Z,de)=>Z+parseInt(de.width),0):P&&z==="chart"?C=parseInt(A.find(Z=>Z.id==="action")?.width)||50:C=440,V=C,C},[A,P,z]);e.useEffect(()=>{ne(ie)},[ie]);const be=e.useMemo(()=>(Q??0)-(E??0),[Q,E]),Re=e.useMemo(()=>f.width,[f]),De=e.useMemo(()=>{if(!h||!T)return w.length*U;const C=new Set;return w.forEach(Z=>{const de=T.taskRows.get(Z.id)??Z.id;C.add(de)}),C.size*U},[w,U,h,T]),Me=e.useMemo(()=>f.height+De+be,[f,De,be]),Le=e.useMemo(()=>V+Re,[V,Re]),pe=e.useRef(null),J=e.useCallback(()=>{Promise.resolve().then(()=>{if((Q??0)>(Le??0)){const C=(Q??0)-V;M.exec("expand-scale",{minWidth:C})}})},[Q,Le,V,M]);e.useEffect(()=>{let C;return pe.current&&(C=new ResizeObserver(J),C.observe(pe.current)),()=>{C&&C.disconnect()}},[pe.current,J]),e.useEffect(()=>{J()},[Re]);const p=e.useRef(null),W=e.useRef(null),B=e.useCallback(()=>{const C=p.current;C&&M.exec("scroll-chart",{top:C.scrollTop})},[M]),q=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{q.current={rTasks:w,rScales:f,rCellHeight:U,scrollSize:be,ganttDiv:p.current,ganttHeight:X??0}},[w,f,U,be,X]);const G=e.useCallback(C=>{if(!C)return;const{rTasks:Z,rScales:de,rCellHeight:fe,scrollSize:m,ganttDiv:le,ganttHeight:xe}=q.current;if(!le)return;const{id:O}=C,Ce=Z.findIndex(se=>se.id===O);if(Ce>-1){const se=xe-de.height,ve=Ce*fe,ye=le.scrollTop;let Se=null;ve<ye?Se=ve:ve+fe>ye+se&&(Se=ve-se+fe+m),Se!==null&&(M.exec("scroll-chart",{top:Math.max(Se,0)}),p.current.scrollTop=Math.max(Se,0))}},[M]);e.useEffect(()=>{G(H)},[H]),e.useEffect(()=>{const C=p.current,Z=W.current;if(!C||!Z)return;const de=()=>{It.flushSync(()=>{ce(C.offsetHeight),ae(C.offsetWidth),x(Z.offsetWidth)})},fe=new ResizeObserver(de);return fe.observe(C),()=>fe.disconnect()},[p.current]);const ge=e.useRef(null),oe=e.useRef(null);return e.useEffect(()=>{oe.current&&(oe.current.destroy(),oe.current=null);const C=ge.current;if(C)return oe.current=pt.hotkeys(C,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,"meta+c":!0,"meta+v":!0,"meta+x":!0,"meta+d":!0,backspace:!0,"ctrl+z":K,"ctrl+y":K,"meta+z":K,"meta+shift+z":K},exec:Z=>{if(Z.isInput)return;const de=Z.key;if(de==="ctrl+z"||de==="meta+z"){M.exec("undo",{});return}if(de==="ctrl+y"||de==="meta+shift+z"){M.exec("redo",{});return}M.exec("hotkey",Z)}}),()=>{oe.current?.destroy(),oe.current=null}},[K]),c.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:p,onScroll:B,children:c.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:Me,width:"100%"},ref:W,children:c.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:X,width:E},children:c.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:ge,children:[A.length?c.jsxs(c.Fragment,{children:[c.jsx(At,{display:z,compactMode:P,columnWidth:ie,width:V,readonly:r,fullHeight:De,onTableAPIChange:L,multiTaskRows:h,rowMapping:T}),c.jsx(Bt,{value:V,display:z,compactMode:P,containerWidth:Q,onMove:C=>ne(C),onDisplayChange:C=>te(C)})]}):null,c.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:pe,children:c.jsx(Kt,{readonly:r,fullWidth:Re,fullHeight:De,taskTemplate:n,cellBorders:i,highlightTime:l,multiTaskRows:h,rowMapping:T,marqueeSelect:o,copyPaste:y,scrollToCurrentWeek:k,currentWeekColor:F,allowTaskIntersection:Y})})]})})})})}function Zt(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function Jt(s,n){return typeof s=="function"?s:Ee.dateToString(s,n)}function yt(s,n){return s.map(({format:r,...i})=>({...i,format:Jt(r,n)}))}function es(s,n){const r=Zt(n);for(let i in r)r[i]=Ee.dateToString(r[i],s);return r}function ts(s,n){if(!s||!s.length)return s;const r=Ee.dateToString("%d-%m-%Y",n);return s.map(i=>i.template?i:i.id==="start"||i.id=="end"?{...i,_template:l=>r(l),template:l=>r(l)}:i.id==="duration"?{...i,_template:l=>l,template:l=>l}:i)}function ss(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:yt(r.scales,n)}))}:s}const ns=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),rs=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],os=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:i=we.defaultTaskTypes,tasks:l=[],selected:L=[],activeTask:h=null,links:v=[],scales:o=rs,columns:y=we.defaultColumns,start:k=null,end:F=null,lengthUnit:Y="day",durationUnit:M="day",cellWidth:w=100,cellHeight:f=38,scaleHeight:U=36,readonly:A=!1,cellBorders:H="full",zoom:K=!1,baselines:T=!1,highlightTime:P=null,init:S=null,autoScale:V=!0,unscheduledTasks:ne=!1,criticalPath:Q=null,schedule:ae={type:"forward"},projectStart:X=null,projectEnd:ce=null,calendar:E=null,undo:x=!1,splitTasks:z=!1,multiTaskRows:te=!1,marqueeSelect:ue=!1,copyPaste:re=!1,currentWeekHighlight:ie=!1,currentWeekColor:be=null,scrollToCurrentWeek:Re=!1,allowTaskIntersection:De=!0,...Me},Le){const pe=e.useRef();pe.current=Me;const J=e.useMemo(()=>new we.DataStore(j.writable),[]),p=e.useMemo(()=>({...et.en,...Be.en}),[]),W=e.useContext(Te.context.i18n),B=e.useMemo(()=>W?W.extend(p,!0):Ee.locale(p),[W,p]),q=e.useMemo(()=>B.getRaw().calendar,[B]),G=e.useMemo(()=>{let se={zoom:ss(K,q),scales:yt(o,q),columns:ts(y,q),links:we.normalizeLinks(v),cellWidth:w};return se.zoom&&(se={...se,...we.normalizeZoom(se.zoom,es(q,B.getGroup("gantt")),se.scales,w)}),se},[K,o,y,v,w,q,B]),ge=e.useRef(null);ge.current!==l&&(we.parseTaskDates(l,{durationUnit:M,splitTasks:z,calendar:E}),ge.current=l),e.useEffect(()=>{we.parseTaskDates(l,{durationUnit:M,splitTasks:z,calendar:E})},[l,M,E,z]);const oe=e.useMemo(()=>{if(!te)return null;const se=new Map,ve=new Map,ye=Se=>{Se.forEach(Ne=>{const We=Ne.row??Ne.id;ve.set(Ne.id,We),se.has(We)||se.set(We,[]),se.get(We).push(Ne.id),Ne.data&&Ne.data.length>0&&ye(Ne.data)})};return ye(l),{rowMap:se,taskRows:ve}},[l,te]),C=e.useMemo(()=>J.in,[J]),Z=e.useRef(null);Z.current===null&&(Z.current=new Dt.EventBusRouter((se,ve)=>{const ye="on"+ns(se);pe.current&&pe.current[ye]&&pe.current[ye](ve)}),C.setNext(Z.current));const[de,fe]=e.useState(null),m=e.useRef(null);m.current=de;const le=e.useMemo(()=>({getState:J.getState.bind(J),getReactiveState:J.getReactive.bind(J),getStores:()=>({data:J}),exec:C.exec,setNext:se=>(Z.current=Z.current.setNext(se),Z.current),intercept:C.intercept.bind(C),on:C.on.bind(C),detach:C.detach.bind(C),getTask:J.getTask.bind(J),serialize:J.serialize.bind(J),getTable:se=>se?new Promise(ve=>setTimeout(()=>ve(m.current),1)):m.current,getHistory:()=>J.getHistory()}),[J,C]);e.useImperativeHandle(Le,()=>({...le}),[le]);const xe=e.useRef(0);e.useEffect(()=>{xe.current?J.init({tasks:l,links:G.links,start:k,columns:G.columns,end:F,lengthUnit:Y,cellWidth:G.cellWidth,cellHeight:f,scaleHeight:U,scales:G.scales,taskTypes:i,zoom:G.zoom,selected:L,activeTask:h,baselines:T,autoScale:V,unscheduledTasks:ne,markers:r,durationUnit:M,criticalPath:Q,schedule:ae,projectStart:X,projectEnd:ce,calendar:E,undo:x,_weekStart:q.weekStart,splitTasks:z}):S&&S(le),xe.current++},[le,S,l,G,k,F,Y,f,U,i,L,h,T,V,ne,r,M,Q,ae,X,ce,E,x,q,z,J]),xe.current===0&&J.init({tasks:l,links:G.links,start:k,columns:G.columns,end:F,lengthUnit:Y,cellWidth:G.cellWidth,cellHeight:f,scaleHeight:U,scales:G.scales,taskTypes:i,zoom:G.zoom,selected:L,activeTask:h,baselines:T,autoScale:V,unscheduledTasks:ne,markers:r,durationUnit:M,criticalPath:Q,schedule:ae,projectStart:X,projectEnd:ce,calendar:E,undo:x,_weekStart:q.weekStart,splitTasks:z});const O=e.useMemo(()=>{const se=new Date,ve=q?.weekStart??0,ye=new Date(Date.UTC(se.getUTCFullYear(),se.getUTCMonth(),se.getUTCDate())),Ne=(ye.getUTCDay()-ve+7)%7;ye.setUTCDate(ye.getUTCDate()-Ne),ye.setUTCHours(0,0,0,0);const We=new Date(ye);return We.setUTCDate(We.getUTCDate()+7),a=>a>=ye&&a<We},[q]),Ce=e.useMemo(()=>(se,ve)=>{let ye=[];if(E)ve=="day"&&!E.getDayHours(se)&&ye.push("wx-weekend"),ve=="hour"&&!E.getDayHours(se)&&ye.push("wx-weekend");else if(P){const Se=P(se,ve);Se&&ye.push(Se)}return ie&&(ve==="week"||ve==="day")&&O(se)&&ye.push("wx-current-week"),ye.join(" ")},[E,P,ie,O]);return c.jsx(Te.context.i18n.Provider,{value:B,children:c.jsx(Ge.Provider,{value:le,children:c.jsx(Qt,{taskTemplate:n,readonly:A,cellBorders:H,highlightTime:Ce,onTableAPIChange:fe,multiTaskRows:te,rowMapping:oe,marqueeSelect:ue,copyPaste:re,scrollToCurrentWeek:Re,currentWeekColor:be,allowTaskIntersection:De})})})});function ls({api:s=null,items:n=[]}){const r=e.useContext(Te.context.i18n),i=e.useMemo(()=>r||Ee.locale(Be.en),[r]),l=e.useMemo(()=>i.getGroup("gantt"),[i]),L=j.useStoreLater(s,"_selected"),h=j.useStoreLater(s,"undo"),v=j.useStoreLater(s,"history"),o=j.useStoreLater(s,"splitTasks"),y=["undo","redo"],k=e.useMemo(()=>{const Y=we.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:we.getToolbarButtons({undo:h,splitTasks:o})).map(w=>{let f={...w,disabled:!1};return f.handler=we.isHandledAction(Y,f.id)?U=>we.handleAction(s,U.id,null,l):f.handler,f.text&&(f.text=l(f.text)),f.menuText&&(f.menuText=l(f.menuText)),f})},[n,s,l,h,o]),F=e.useMemo(()=>{const Y=[];return k.forEach(M=>{const w=M.id;if(w==="add-task")Y.push(M);else if(y.includes(w))y.includes(w)&&Y.push({...M,disabled:M.isDisabled(v)});else{if(!L?.length||!s)return;Y.push({...M,disabled:M.isDisabled&&L.some(f=>M.isDisabled(f,s.getState()))})}}),Y.filter((M,w)=>{if(s&&M.isHidden)return!L.some(f=>M.isHidden(f,s.getState()));if(M.comp==="separator"){const f=Y[w+1];if(!f||f.comp==="separator")return!1}return!0})},[s,L,v,k]);return r?c.jsx(ft.Toolbar,{items:F}):c.jsx(Te.context.i18n.Provider,{value:i,children:c.jsx(ft.Toolbar,{items:F})})}const cs=e.forwardRef(function({options:n=[],api:r=null,resolver:i=null,filter:l=null,at:L="point",children:h,onClick:v,css:o},y){const k=e.useRef(null),F=e.useRef(null),Y=e.useContext(Te.context.i18n),M=e.useMemo(()=>Y||Ee.locale({...Be.en,...et.en}),[Y]),w=e.useMemo(()=>M.getGroup("gantt"),[M]),f=j.useStoreLater(r,"taskTypes"),U=j.useStoreLater(r,"selected"),A=j.useStoreLater(r,"_selected"),H=j.useStoreLater(r,"splitTasks"),K=e.useMemo(()=>we.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{k.current&&k.current.show&&k.current.show()}),r.on("drag-task",()=>{k.current&&k.current.show&&k.current.show()}))},[r]);function T(E){return E.map(x=>(x={...x},x.text&&(x.text=w(x.text)),x.subtext&&(x.subtext=w(x.subtext)),x.data&&(x.data=T(x.data)),x))}function P(){const E=n.length?n:we.getMenuOptions({splitTasks:H}),x=E.find(z=>z.id==="convert-task");return x&&(x.data=[],(f||[]).forEach(z=>{x.data.push(x.dataFactory(z))})),T(E)}const S=e.useMemo(()=>P(),[r,n,f,H,w]),V=e.useMemo(()=>A&&A.length?A:[],[A]),ne=e.useCallback((E,x)=>{let z=E?r?.getTask(E):null;if(i){const te=i(E,x);z=te===!0?z:te}if(z){const te=Ee.locateID(x.target,"data-segment");te!==null?F.current={id:z.id,segmentIndex:te}:F.current=z.id,(!Array.isArray(U)||!U.includes(z.id))&&r&&r.exec&&r.exec("select-task",{id:z.id})}return z},[r,i,U]),Q=e.useCallback(E=>{const x=E.action;x&&(we.isHandledAction(K,x.id)&&we.handleAction(r,x.id,F.current,w),v&&v(E))},[r,w,v,K]),ae=e.useCallback((E,x)=>{const z=V.length?V:x?[x]:[];let te=l?z.every(ue=>l(E,ue)):!0;if(te&&(E.isHidden&&(te=!z.some(ue=>E.isHidden(ue,r.getState(),F.current))),E.isDisabled)){const ue=z.some(re=>E.isDisabled(re,r.getState(),F.current));E.disabled=ue}return te},[l,V,r]);e.useImperativeHandle(y,()=>({show:(E,x)=>{k.current&&k.current.show&&k.current.show(E,x)}}));const X=e.useCallback(E=>{k.current&&k.current.show&&k.current.show(E)},[]),ce=c.jsxs(c.Fragment,{children:[c.jsx(Lt.ContextMenu,{filter:ae,options:S,dataKey:"id",resolver:ne,onClick:Q,at:L,ref:k,css:o}),c.jsx("span",{onContextMenu:X,"data-menu-ignore":"true",children:typeof h=="function"?h():h})]});if(!Y&&Te.context.i18n?.Provider){const E=Te.context.i18n.Provider;return c.jsx(E,{value:M,children:ce})}return ce});function is({api:s,autoSave:n,onLinksChange:r}){const l=e.useContext(Te.context.i18n).getGroup("gantt"),L=j.useStore(s,"activeTask"),h=j.useStore(s,"_activeTask"),v=j.useStore(s,"_links"),o=j.useStore(s,"schedule"),y=j.useStore(s,"unscheduledTasks"),[k,F]=e.useState();function Y(){if(L){const U=v.filter(H=>H.target==L).map(H=>({link:H,task:s.getTask(H.source)})),A=v.filter(H=>H.source==L).map(H=>({link:H,task:s.getTask(H.target)}));return[{title:l("Predecessors"),data:U},{title:l("Successors"),data:A}]}}e.useEffect(()=>{F(Y())},[L,v]);const M=e.useMemo(()=>[{id:"e2s",label:l("End-to-start")},{id:"s2s",label:l("Start-to-start")},{id:"e2e",label:l("End-to-end")},{id:"s2e",label:l("Start-to-end")}],[l]);function w(U){n?s.exec("delete-link",{id:U}):(F(A=>(A||[]).map(H=>({...H,data:H.data.filter(K=>K.link.id!==U)}))),r&&r({id:U,action:"delete-link",data:{id:U}}))}function f(U,A){n?s.exec("update-link",{id:U,link:A}):(F(H=>(H||[]).map(K=>({...K,data:K.data.map(T=>T.link.id===U?{...T,link:{...T.link,...A}}:T)}))),r&&r({id:U,action:"update-link",data:{id:U,link:A}}))}return c.jsx(c.Fragment,{children:(k||[]).map((U,A)=>U.data.length?c.jsx("div",{className:"wx-j93aYGQf wx-links",children:c.jsx(Te.Field,{label:U.title,position:"top",children:c.jsx("table",{children:c.jsx("tbody",{children:U.data.map(H=>c.jsxs("tr",{children:[c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:H.task.text||""})}),o?.auto&&H.link.type==="e2s"?c.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:c.jsx(Te.Text,{type:"number",placeholder:l("Lag"),value:H.link.lag,disabled:y&&h?.unscheduled,onChange:K=>{K.input||f(H.link.id,{lag:K.value})}})}):null,c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:c.jsx(Te.Combo,{value:H.link.type,placeholder:l("Select link type"),options:M,onChange:K=>f(H.link.id,{type:K.value}),children:({option:K})=>K.label})})}),c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>w(H.link.id),role:"button"})})]},H.link.id))})})})},A):null)})}function as(s){const{value:n,time:r,format:i,onchange:l,onChange:L,...h}=s,v=L??l;function o(y){const k=new Date(y.value);k.setUTCHours(n.getUTCHours()),k.setUTCMinutes(n.getUTCMinutes()),v&&v({value:k})}return c.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[c.jsx(Te.DatePicker,{...h,value:n,onChange:o,format:i,buttons:["today"],clear:!1}),r?c.jsx(Te.TimePicker,{value:n,onChange:v,format:i}):null]})}ze.registerEditorItem("select",Te.RichSelect);ze.registerEditorItem("date",as);ze.registerEditorItem("twostate",Te.TwoState);ze.registerEditorItem("slider",Te.Slider);ze.registerEditorItem("counter",Te.Counter);ze.registerEditorItem("links",is);function us({api:s,items:n=[],css:r="",layout:i="default",readonly:l=!1,placement:L="sidebar",bottomBar:h=!0,topBar:v=!0,autoSave:o=!0,focus:y=!1,hotkeys:k={}}){const F=e.useContext(Te.context.i18n),Y=e.useMemo(()=>F||Ee.locale({...Be.en,...et.en}),[F]),M=e.useMemo(()=>Y.getGroup("gantt"),[Y]),w=Y.getRaw(),f=e.useMemo(()=>{const m=w.gantt?.dateFormat||w.formats?.dateFormat;return Ee.dateToString(m,w.calendar)},[w]),U=e.useMemo(()=>{if(v===!0&&!l){const m=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:M("Delete"),id:"delete"}];return o?{items:m}:{items:[...m,{comp:"button",type:"primary",text:M("Save"),id:"save"}]}}return v},[v,l,o,M]),[A,H]=e.useState(!1),K=e.useMemo(()=>A?"wx-full-screen":"",[A]),T=e.useCallback(m=>{H(m)},[]);e.useEffect(()=>{const m=bt(T);return m.observe(),()=>{m.disconnect()}},[T]);const P=j.useStore(s,"_activeTask"),S=j.useStore(s,"activeTask"),V=j.useStore(s,"unscheduledTasks"),ne=j.useStore(s,"links"),Q=j.useStore(s,"splitTasks"),ae=e.useMemo(()=>Q&&S?.segmentIndex,[Q,S]),X=e.useMemo(()=>ae||ae===0,[ae]),ce=e.useMemo(()=>we.getEditorItems({unscheduledTasks:V}),[V]),E=j.useStore(s,"undo"),[x,z]=e.useState({}),[te,ue]=e.useState(null),[re,ie]=e.useState(),[be,Re]=e.useState(null),De=j.useStore(s,"taskTypes"),Me=e.useMemo(()=>{if(!P)return null;let m;if(X&&P.segments?m={...P.segments[ae]}:m={...P},l){let le={parent:m.parent};return ce.forEach(({key:xe,comp:O})=>{if(O!=="links"){const Ce=m[xe];O==="date"&&Ce instanceof Date?le[xe]=f(Ce):O==="slider"&&xe==="progress"?le[xe]=`${Ce}%`:le[xe]=Ce}}),le}return m||null},[P,X,ae,l,ce,f]);e.useEffect(()=>{ie(Me)},[Me]),e.useEffect(()=>{z({}),Re(null),ue(null)},[S]);function Le(m,le){return m.map(xe=>{const O={...xe};if(xe.config&&(O.config={...O.config}),O.comp==="links"&&s&&(O.api=s,O.autoSave=o,O.onLinksChange=p),O.comp==="select"&&O.key==="type"){const Ce=O.options??(De||[]);O.options=Ce.map(se=>({...se,label:M(se.label)}))}return O.comp==="slider"&&O.key==="progress"&&(O.labelTemplate=Ce=>`${M(O.label)} ${Ce}%`),O.label&&(O.label=M(O.label)),O.config?.placeholder&&(O.config.placeholder=M(O.config.placeholder)),le&&(O.isDisabled&&O.isDisabled(le,s.getState())?O.disabled=!0:delete O.disabled),O})}const pe=e.useMemo(()=>{let m=n.length?n:ce;return m=Le(m,re),re?m.filter(le=>!le.isHidden||!le.isHidden(re,s.getState())):m},[n,ce,re,De,M,s,o]),J=e.useMemo(()=>pe.map(m=>m.key),[pe]);function p({id:m,action:le,data:xe}){z(O=>({...O,[m]:{action:le,data:xe}}))}const W=e.useCallback(()=>{for(let m in x)if(ne.byId(m)){const{action:le,data:xe}=x[m];s.exec(le,xe)}},[s,x,ne]),B=e.useCallback(()=>{const m=S?.id||S;if(X){if(P?.segments){const le=P.segments.filter((xe,O)=>O!==ae);s.exec("update-task",{id:m,task:{segments:le}})}}else s.exec("delete-task",{id:m})},[s,S,X,P,ae]),q=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),G=e.useCallback(m=>{const{item:le,changes:xe}=m;le.id==="delete"&&B(),le.id==="save"&&(xe.length?q():W()),le.comp&&q()},[s,S,o,W,B,q]),ge=e.useCallback((m,le,xe)=>(V&&m.type==="summary"&&(m.unscheduled=!1),we.prepareEditTask(m,s.getState(),le),xe||ue(!1),m),[V,s]),oe=e.useCallback(m=>{m={...m,unscheduled:V&&m.unscheduled&&m.type!=="summary"},delete m.links,delete m.data,(J.indexOf("duration")===-1||m.segments&&!m.duration)&&delete m.duration;const le={id:S?.id||S,task:m,...X&&{segmentIndex:ae}};o&&te&&(le.inProgress=te),s.exec("update-task",le),o||W()},[s,S,V,o,W,J,X,ae,te]),C=e.useCallback(m=>{let{update:le,key:xe,input:O}=m;if(O&&ue(!0),m.update=ge({...le},xe,O),!o)ie(m.update);else if(!be&&!O){const Ce=pe.find(ye=>ye.key===xe),se=le[xe];(!Ce.validation||Ce.validation(se))&&(!Ce.required||se)&&oe(m.update)}},[o,ge,be,pe,oe]),Z=e.useCallback(m=>{o||oe(m.values)},[o,oe]),de=e.useCallback(m=>{Re(m.errors)},[]),fe=e.useMemo(()=>E?{"ctrl+z":m=>{m.preventDefault(),s.exec("undo")},"ctrl+y":m=>{m.preventDefault(),s.exec("redo")}}:{},[E,s]);return Me?c.jsx(Te.Locale,{children:c.jsx(ze.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${K} ${r}`,items:pe,values:Me,topBar:U,bottomBar:h,placement:L,layout:i,readonly:l,autoSave:o,focus:y,onAction:G,onSave:Z,onValidation:de,onChange:C,hotkeys:k&&{...fe,...k}})}):null}const ds=({children:s,columns:n=null,api:r})=>{const[i,l]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(l)},[r]),c.jsx(kt.HeaderMenu,{api:i,columns:n,children:s})};function fs(s){const{api:n,content:r,children:i}=s,l=e.useRef(null),L=e.useRef(null),[h,v]=e.useState({}),[o,y]=e.useState(null),[k,F]=e.useState({});function Y(T){for(;T;){if(T.getAttribute){const P=T.getAttribute("data-tooltip-id"),S=T.getAttribute("data-tooltip-at"),V=T.getAttribute("data-tooltip");if(P||V)return{id:P,tooltip:V,target:T,at:S}}T=T.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const T=L.current;if(T&&k&&(k.text||r)){const P=T.getBoundingClientRect();let S=!1,V=k.left,ne=k.top;P.right>=h.right&&(V=h.width-P.width-5,S=!0),P.bottom>=h.bottom&&(ne=k.top-(P.bottom-h.bottom+2),S=!0),S&&F(Q=>Q&&{...Q,left:V,top:ne})}},[k,h,r]);const M=e.useRef(null),w=300,f=T=>{clearTimeout(M.current),M.current=setTimeout(()=>{T()},w)};function U(T){let{id:P,tooltip:S,target:V,at:ne}=Y(T.target);if(F(null),y(null),!S)if(P)S=H(P);else{clearTimeout(M.current);return}const Q=T.clientX;f(()=>{P&&y(A(K(P)));const ae=V.getBoundingClientRect(),X=l.current,ce=X?X.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let E,x;ne==="left"?(E=ae.top+5-ce.top,x=ae.right+5-ce.left):(E=ae.top+ae.height-ce.top,x=Q-ce.left),v(ce),F({top:E,left:x,text:S})})}function A(T){return n?.getTask(K(T))||null}function H(T){return A(T)?.text||""}function K(T){const P=parseInt(T);return isNaN(P)?T:P}return c.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:l,onMouseMove:U,children:[k&&(k.text||r)?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:L,style:{top:`${k.top}px`,left:`${k.left}px`},children:r?c.jsx(r,{data:o}):k.text?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:k.text}):null}):null,i]})}function xs({fonts:s=!0,children:n}){return n?c.jsx(Te.Material,{fonts:s,children:n()}):c.jsx(Te.Material,{fonts:s})}function hs({fonts:s=!0,children:n}){return n?c.jsx(Te.Willow,{fonts:s,children:n}):c.jsx(Te.Willow,{fonts:s})}function ms({fonts:s=!0,children:n}){return n?c.jsx(Te.WillowDark,{fonts:s,children:n}):c.jsx(Te.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>we.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>we.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>we.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>we.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>we.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>we.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>we.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>we.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>we.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>ze.registerEditorItem});exports.ContextMenu=cs;exports.Editor=us;exports.Gantt=os;exports.HeaderMenu=ds;exports.Material=xs;exports.Toolbar=ls;exports.Tooltip=fs;exports.Willow=hs;exports.WillowDark=ms;
//# sourceMappingURL=index.cjs.map
