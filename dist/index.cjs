"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const c=require("react/jsx-runtime"),e=require("react"),ye=require("@svar-ui/react-core"),Ee=require("@svar-ui/lib-dom"),Be=require("@svar-ui/gantt-locales"),Je=require("@svar-ui/core-locales"),jt=require("@svar-ui/lib-state"),we=require("@svar-ui/gantt-store"),j=require("@svar-ui/lib-react"),gt=require("@svar-ui/grid-store"),wt=require("@svar-ui/react-grid"),$t=require("react-dom"),ut=require("@svar-ui/react-toolbar"),Dt=require("@svar-ui/react-menu"),ze=require("@svar-ui/react-editor"),Ge=e.createContext(null);function Oe(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function It(s,n,r){const i=s.getBoundingClientRect(),l=n.querySelector(".wx-body").getBoundingClientRect();return{top:i.top-l.top,left:i.left-l.left,dt:i.bottom-r.clientY,db:r.clientY-i.top}}function dt(s){return s&&s.getAttribute("data-context-id")}const ft=5;function Lt(s,n){let r,i,l,I,h,y,o,v,k;function K(S){I=S.clientX,h=S.clientY,y={...It(r,s,S),y:n.getTask(l).$y},document.body.style.userSelect="none"}function Y(S){r=Ee.locate(S),dt(r)&&(l=Oe(r),k=setTimeout(()=>{v=!0,n&&n.touchStart&&n.touchStart(),K(S.touches[0])},500),s.addEventListener("touchmove",A),s.addEventListener("contextmenu",C),window.addEventListener("touchend",B))}function C(S){if(v||k)return S.preventDefault(),!1}function w(S){S.which===1&&(r=Ee.locate(S),dt(r)&&(l=Oe(r),s.addEventListener("mousemove",H),window.addEventListener("mouseup",T),K(S)))}function f(S){s.removeEventListener("mousemove",H),s.removeEventListener("touchmove",A),document.body.removeEventListener("mouseup",T),document.body.removeEventListener("touchend",B),document.body.style.userSelect="",S&&(s.removeEventListener("mousedown",w),s.removeEventListener("touchstart",Y))}function q(S){const U=S.clientX-I,se=S.clientY-h;if(!i){if(Math.abs(U)<ft&&Math.abs(se)<ft||n&&n.start&&n.start({id:l,e:S})===!1)return;i=r.cloneNode(!0),i.style.pointerEvents="none",i.classList.add("wx-reorder-task"),i.style.position="absolute",i.style.left=y.left+"px",i.style.top=y.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(i,r)}if(i){const Q=Math.round(Math.max(0,y.top+se));if(n&&n.move&&n.move({id:l,top:Q,detail:o})===!1)return;const ae=n.getTask(l),F=ae.$y;if(!y.start&&y.y==F)return P();y.start=!0,y.y=ae.$y-4,i.style.top=Q+"px";const ce=document.elementFromPoint(S.clientX,S.clientY),E=Ee.locate(ce);if(E&&E!==r){const x=Oe(E),z=E.getBoundingClientRect(),te=z.top+z.height/2,ue=S.clientY+y.db>te&&E.nextElementSibling!==r,ne=S.clientY-y.dt<te&&E.previousElementSibling!==r;o?.after==x||o?.before==x?o=null:ue?o={id:l,after:x}:ne&&(o={id:l,before:x})}}}function H(S){q(S)}function A(S){v?(S.preventDefault(),q(S.touches[0])):k&&(clearTimeout(k),k=null)}function B(){v=null,k&&(clearTimeout(k),k=null),P()}function T(){P()}function P(){r&&(r.style.visibility=""),i&&(i.parentNode.removeChild(i),n&&n.end&&n.end({id:l,top:y.top})),l=r=i=y=o=null,f()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",w),s.addEventListener("touchstart",Y),{destroy(){f(!0)}}}function Nt({row:s,column:n}){function r(l,I){return{justifyContent:I.align,paddingLeft:`${(l.$level-1)*20}px`}}const i=n&&n._cell;return c.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?c.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):c.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),c.jsx("div",{className:"wx-pqc08MHU wx-text",children:i?c.jsx(i,{row:s,column:n}):s.text})]})}function xt({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?c.jsx("div",{style:{textAlign:s.align},children:c.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function Pt(s){const{readonly:n,compactMode:r,width:i=0,display:l="all",columnWidth:I=0,onTableAPIChange:h,multiTaskRows:y=!1,rowMapping:o=null}=s,[v,k]=j.useWritableProp(I),[K,Y]=e.useState(),C=e.useContext(ye.context.i18n),w=e.useMemo(()=>C.getGroup("gantt"),[C]),f=e.useContext(Ge),q=j.useStore(f,"scrollTop"),H=j.useStore(f,"cellHeight"),A=j.useStore(f,"_scrollTask"),B=j.useStore(f,"_selected"),T=j.useStore(f,"area"),P=j.useStore(f,"_tasks"),S=j.useStore(f,"_scales"),U=j.useStore(f,"columns"),se=j.useStore(f,"_sort"),Q=j.useStore(f,"calendar"),ae=j.useStore(f,"durationUnit"),F=j.useStore(f,"splitTasks"),[ce,E]=e.useState(null),x=e.useMemo(()=>!P||!T?[]:y&&o?P:P.slice(T.start,T.end),[P,T,y,o]),z=e.useCallback((a,b)=>{if(b==="add-task")f.exec(b,{target:a,task:{text:w("New Task")},mode:"child",show:!0});else if(b==="open-task"){const $=x.find(_=>_.id===a);($?.data||$?.lazy)&&f.exec(b,{id:a,mode:!$.open})}},[x]),te=e.useCallback(a=>{const b=Ee.locateID(a),$=a.target.dataset.action;$&&a.preventDefault(),b?$==="add-task"||$==="open-task"?z(b,$):f.exec("select-task",{id:b,toggle:a.ctrlKey||a.metaKey,range:a.shiftKey,show:!0}):$==="add-task"&&z(null,$)},[f,z]),ue=e.useRef(null),ne=e.useRef(null),[ie,ke]=e.useState(0),[Re,De]=e.useState(!1);e.useEffect(()=>{const a=ne.current;if(!a||typeof ResizeObserver>"u")return;const b=()=>ke(a.clientWidth);b();const $=new ResizeObserver(b);return $.observe(a),()=>$.disconnect()},[]);const Ce=e.useRef(null),Le=e.useCallback(a=>{const b=a.id,{before:$,after:_}=a,he=a.onMove;let me=$||_,$e=$?"before":"after";if(he){if($e==="after"){const He=f.getTask(me);He.data?.length&&He.open&&($e="before",me=He.data[0].id)}Ce.current={id:b,[$e]:me}}else Ce.current=null;f.exec("move-task",{id:b,mode:$e,target:me,inProgress:he})},[f]),pe=e.useMemo(()=>y&&o?0:T?.from??0,[T,y,o]),ee=e.useMemo(()=>S?.height??0,[S]),p=e.useMemo(()=>!r&&l!=="grid"?(v??0)>(i??0):(v??0)>(ie??0),[r,l,v,i,ie]),W=e.useMemo(()=>{const a={};return p&&l==="all"||l==="grid"&&p?a.width=v:l==="grid"&&(a.width="100%"),a},[p,l,v]),V=e.useMemo(()=>ce&&!x.find(a=>a.id===ce.id)?[...x,ce]:x,[x,ce]),X=e.useMemo(()=>{if(!y||!o)return V;const a=new Map,b=new Set;return V.forEach($=>{const _=o.taskRows.get($.id)??$.id;b.has(_)||(a.set(_,{...$,$rowTasks:o.rowMap.get(_)||[$.id]}),b.add(_))}),Array.from(a.values())},[V,y,o]),G=e.useMemo(()=>{let a=(U||[]).map(_=>{_={..._};const he=_.header;if(typeof he=="object"){const me=he.text&&w(he.text);_.header={...he,text:me}}else _.header=w(he);return _});const b=a.findIndex(_=>_.id==="text"),$=a.findIndex(_=>_.id==="add-task");if(b!==-1&&(a[b].cell&&(a[b]._cell=a[b].cell),a[b].cell=Nt),$!==-1){a[$].cell=a[$].cell||xt;const _=a[$].header;if(typeof _!="object"&&(a[$].header={text:_}),a[$].header.cell=_.cell||xt,n)a.splice($,1);else if(r){const[he]=a.splice($,1);a.unshift(he)}}return a.length>0&&(a[a.length-1].resize=!1),a},[U,w,n,r]),ge=e.useMemo(()=>l==="all"?`${i}px`:l==="grid"?"calc(100% - 4px)":G.find(a=>a.id==="add-task")?"50px":"0",[l,i,G]),re=e.useMemo(()=>{if(X&&se?.length){const a={};return se.forEach(({key:b,order:$},_)=>{a[b]={order:$,...se.length>1&&{index:_}}}),a}return{}},[X,se]),M=e.useCallback(()=>G.some(a=>a.flexgrow&&!a.hidden),[]),J=e.useMemo(()=>M(),[M,Re]),de=e.useMemo(()=>{let a=l==="chart"?G.filter($=>$.id==="add-task"):G;const b=l==="all"?i:ie;if(!J){let $=v,_=!1;if(G.some(he=>he.$width)){let he=0;$=G.reduce((me,$e)=>($e.hidden||(he+=$e.width,me+=$e.$width||$e.width),me),0),he>$&&$>b&&(_=!0)}if(_||$<b){let he=1;return _||(he=(b-50)/($-50||1)),a.map(me=>(me.id!=="add-task"&&!me.hidden&&(me.$width||(me.$width=me.width),me.width=me.$width*he),me))}}return a},[l,G,J,v,i,ie]),fe=e.useCallback(a=>{if(!M()){const b=de.reduce(($,_)=>(a&&_.$width&&(_.$width=_.width),$+(_.hidden?0:_.width)),0);b!==v&&k(b)}De(!0),De(!1)},[M,de,v,k]),m=e.useCallback(()=>{G.filter(b=>b.flexgrow&&!b.hidden).length===1&&G.forEach(b=>{b.$width&&!b.flexgrow&&!b.hidden&&(b.width=b.$width)})},[]),oe=e.useCallback(a=>{if(!n){const b=Ee.locateID(a),$=Ee.locateAttr(a,"data-col-id");!($&&G.find(he=>he.id==$))?.editor&&b&&f.exec("show-editor",{id:b})}},[f,n]),xe=e.useMemo(()=>Array.isArray(B)?B.map(a=>a.id):[],[B]),O=e.useRef(pe);O.current=pe,e.useEffect(()=>{const a=$=>{if(ue.current){const _=ue.current.querySelector(".wx-body");_&&(_.style.top=-(($??0)-(O.current??0))+"px")}ne.current&&(ne.current.scrollTop=0)};return a(q),f.on("scroll-chart",({top:$})=>{$!==void 0&&a($)})},[f,q]),e.useEffect(()=>{if(ue.current){const a=ue.current.querySelector(".wx-body");a&&(a.style.top=-((q??0)-(pe??0))+"px")}},[pe]),e.useEffect(()=>{const a=ue.current;if(!a)return;const b=a.querySelector(".wx-table-box .wx-body");if(!b||typeof ResizeObserver>"u")return;const $=new ResizeObserver(()=>{if(ue.current){const _=ue.current.querySelector(".wx-body");_&&(_.style.top=-((q??0)-(O.current??0))+"px")}});return $.observe(b),()=>{$.disconnect()}},[de,W,l,ge,X,q]),e.useEffect(()=>{if(!A||!K)return;const{id:a}=A,b=K.getState().focusCell;b&&b.row!==a&&ue.current&&ue.current.contains(document.activeElement)&&K.exec("focus-cell",{row:a,column:b.column})},[A,K]);const ve=e.useCallback(({id:a})=>{if(n)return!1;f.getTask(a).open&&f.exec("open-task",{id:a,mode:!1});const b=f.getState()._tasks.find($=>$.id===a);if(E(b||null),!b)return!1},[f,n]),le=e.useCallback(({id:a,top:b})=>{Ce.current?Le({...Ce.current,onMove:!1}):f.exec("drag-task",{id:a,top:b+(pe??0),inProgress:!1}),E(null)},[f,Le,pe]),Me=e.useCallback(({id:a,top:b,detail:$})=>{$&&Le({...$,onMove:!0}),f.exec("drag-task",{id:a,top:b+(pe??0),inProgress:!0})},[f,Le,pe]);e.useEffect(()=>{const a=ue.current;return a?Lt(a,{start:ve,end:le,move:Me,getTask:f.getTask}).destroy:void 0},[f,ve,le,Me]);const be=e.useCallback(a=>{const{key:b,isInput:$}=a;if(!$&&(b==="arrowup"||b==="arrowdown"))return a.eventSource="grid",f.exec("hotkey",a),!1;if(b==="enter"){const _=K?.getState().focusCell;if(_){const{row:he,column:me}=_;me==="add-task"?z(he,"add-task"):me==="text"&&z(he,"open-task")}}},[f,z,K]),Se=e.useRef(null),Ne=()=>{Se.current={setTableAPI:Y,handleHotkey:be,sortVal:se,api:f,adjustColumns:m,setColumnWidth:fe,tasks:x,calendarVal:Q,durationUnitVal:ae,splitTasksVal:F,onTableAPIChange:h}};Ne(),e.useEffect(()=>{Ne()},[Y,be,se,f,m,fe,x,Q,ae,F,h]);const We=e.useCallback(a=>{Y(a),a.intercept("hotkey",b=>Se.current.handleHotkey(b)),a.intercept("scroll",()=>!1),a.intercept("select-row",()=>!1),a.intercept("sort-rows",b=>{const $=Se.current.sortVal,{key:_,add:he}=b,me=$?$.find(He=>He.key===_):null;let $e="asc";return me&&($e=!me||me.order==="asc"?"desc":"asc"),f.exec("sort-tasks",{key:_,order:$e,add:he}),!1}),a.on("resize-column",()=>{Se.current.setColumnWidth(!0)}),a.on("hide-column",b=>{b.mode||Se.current.adjustColumns(),Se.current.setColumnWidth()}),a.intercept("update-cell",b=>{const{id:$,column:_,value:he}=b,me=Se.current.tasks.find($e=>$e.id===$);if(me){const $e={...me};let He=he;He&&!isNaN(He)&&!(He instanceof Date)&&(He*=1),$e[_]=He,we.prepareEditTask($e,{calendar:Se.current.calendarVal,durationUnit:Se.current.durationUnitVal,splitTasks:Se.current.splitTasksVal},_),f.exec("update-task",{id:$,task:$e})}return!1}),h&&h(a)},[]);return c.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ge}`},ref:ne,children:c.jsx("div",{ref:ue,style:W,className:"wx-rHj6070p wx-table",onClick:te,onDoubleClick:oe,children:c.jsx(wt.Grid,{init:We,sizes:{rowHeight:H,headerHeight:(ee??0)-1},rowStyle:a=>a.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:a=>`wx-rHj6070p wx-text-${a.align}${a.id==="add-task"?" wx-action":""}`,data:X,columns:de,selectedRows:[...xe],sortMarks:re})})})}function Wt({borders:s=""}){const n=e.useContext(Ge),r=j.useStore(n,"cellWidth"),i=j.useStore(n,"cellHeight"),l=e.useRef(null),[I,h]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&l.current){const o=getComputedStyle(l.current).getPropertyValue("--wx-gantt-border");h(o?o.substring(o.indexOf("#")):"#1d1e261a")}},[]);const y={width:"100%",height:"100%",background:r!=null&&i!=null?`url(${we.grid(r,i,I,s)})`:void 0,position:"absolute",pointerEvents:"none"};return c.jsx("div",{ref:l,style:y})}function Ht({onSelectLink:s,selectedLink:n,readonly:r}){const i=e.useContext(Ge),l=j.useStore(i,"_links"),I=j.useStore(i,"criticalPath"),h=e.useRef(null),y=e.useCallback(o=>{const v=o?.target?.classList;!v?.contains("wx-line")&&!v?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&h.current){const o=v=>{h.current&&!h.current.contains(v.target)&&y(v)};return document.addEventListener("click",o),()=>{document.removeEventListener("click",o)}}},[r,n,y]),c.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(l||[]).map(o=>{const v="wx-dkx3NwEn wx-line"+(I&&o.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return c.jsx("polyline",{className:v,points:o.$p,onClick:()=>!r&&s(o.id),"data-link-id":o.id},o.id)}),!r&&n&&c.jsx("polyline",{ref:h,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function At(s){const{task:n,type:r}=s;function i(I){const h=n.segments[I];return{left:`${h.$x}px`,top:"0px",width:`${h.$w}px`,height:"100%"}}function l(I){if(!n.progress)return 0;const h=n.duration*n.progress/100,y=n.segments;let o=0,v=0,k=null;do{const K=y[v];v===I&&(o>h?k=0:k=Math.min((h-o)/K.duration,1)*100),o+=K.duration,v++}while(k===null&&v<y.length);return k||0}return c.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map((I,h)=>c.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":h,style:i(h),children:[n.progress?c.jsx("div",{className:"wx-progress-wrapper",children:c.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${l(h)}%`}})}):null,c.jsx("div",{className:"wx-content",children:I.text||""})]},h))})}let Qe=[],Ze=null,ht=null;const mt=(s,n)=>{if(!n||!n.start)return null;const{start:r,lengthUnitWidth:i,lengthUnit:l}=n,I=864e5,h=l==="week"?7:l==="month"?30:l==="quarter"?91:l==="year"?365:1,y=Math.floor(s/i),o=new Date(r.getTime()+y*h*I);return o.setHours(0,0,0,0),o},_t=(s,n,r)=>{if(!r||!s||!n)return 0;const{lengthUnit:i}=r,h=(i==="week"?7:i==="month"?30:i==="quarter"?91:i==="year"?365:1)*864e5;return Math.round((s.getTime()-n.getTime())/h)},zt=(s,n,r)=>{if(!r||!s)return s;const{lengthUnit:i}=r,h=(i==="week"?7:i==="month"?30:i==="quarter"?91:i==="year"?365:1)*864e5,y=new Date(s.getTime()+n*h);return y.setHours(0,0,0,0),y},Gt=(s,n,r,i)=>s<i&&n>r;function Ot(s){const{readonly:n,taskTemplate:r,multiTaskRows:i=!1,rowMapping:l=null,marqueeSelect:I=!1,copyPaste:h=!1,allowTaskIntersection:y=!0}=s,o=e.useContext(Ge),[v,k]=j.useStoreWithCounter(o,"_tasks"),[K,Y]=j.useStoreWithCounter(o,"_links"),C=j.useStore(o,"area"),w=j.useStore(o,"_scales"),f=j.useStore(o,"taskTypes"),q=j.useStore(o,"baselines"),[H,A]=j.useStoreWithCounter(o,"_selected"),B=j.useStore(o,"_scrollTask"),T=j.useStore(o,"criticalPath"),P=j.useStore(o,"tasks"),S=j.useStore(o,"schedule"),U=j.useStore(o,"splitTasks"),se=e.useMemo(()=>{if(!C||!Array.isArray(v))return[];const t=C.start??0,u=C.end??0;return i&&l?v.map(d=>({...d})):v.slice(t,u).map(d=>({...d}))},[k,C,i,l]),Q=j.useStore(o,"cellHeight"),ae=e.useMemo(()=>{if(!i||!l||!se.length)return se;const t=new Map,u=[];return v.forEach(d=>{const g=l.taskRows.get(d.id)??d.id;t.has(g)||(t.set(g,u.length),u.push(g))}),se.map(d=>{const g=l.taskRows.get(d.id)??d.id,D=t.get(g)??0;return{...d,$y:D*Q,$y_base:d.$y_base!==void 0?D*Q:void 0}})},[se,i,l,v,Q]),F=e.useMemo(()=>w.lengthUnitWidth,[w]),ce=e.useMemo(()=>w.lengthUnit||"day",[w]),E=e.useRef(!1),[x,z]=e.useState(void 0),[te,ue]=e.useState(null),ne=e.useRef(null),[ie,ke]=e.useState(null),[Re,De]=e.useState(void 0),Ce=e.useRef(null),[Le,pe]=e.useState(0),[ee,p]=e.useState(null),W=e.useRef(null),[V,X]=e.useState(null),[G,ge]=e.useState(null),[re,M]=e.useState(null),J=e.useRef(null);J.current=G;const de=e.useRef(200),fe=e.useRef(null),m=e.useMemo(()=>{const t=fe.current;return!!(H.length&&t&&t.contains(document.activeElement))},[H,fe.current]),oe=e.useMemo(()=>m&&H[H.length-1]?.id,[m,H]);e.useEffect(()=>{if(B&&m&&B){const{id:t}=B,u=fe.current?.querySelector(`.wx-bar[data-id='${t}']`);u&&u.focus({preventScroll:!0})}},[B]),e.useEffect(()=>{const t=fe.current;if(t&&(pe(t.offsetWidth||0),typeof ResizeObserver<"u")){const u=new ResizeObserver(d=>{d[0]&&pe(d[0].contentRect.width)});return u.observe(t),()=>u.disconnect()}},[fe.current]);const xe=e.useCallback(()=>{document.body.style.userSelect="none"},[]),O=e.useCallback(()=>{document.body.style.userSelect=""},[]),ve=e.useCallback((t,u,d)=>{if(u.target.classList.contains("wx-line")||(d||(d=o.getTask(Oe(t))),d.type==="milestone"||d.type==="summary"))return"";const g=Ee.locate(u,"data-segment");g&&(t=g);const{left:D,width:R}=t.getBoundingClientRect(),L=(u.clientX-D)/R;let N=.2/(R>200?R/200:1);return L<N?"start":L>1-N?"end":""},[o]),le=e.useMemo(()=>{const t=new Set;if(y||!i||!l)return console.log("[collision] skipping - allowTaskIntersection:",y,"multiTaskRows:",i,"rowMapping:",!!l),t;console.log("[collision] checking overlaps...");const u=new Map;return v.forEach(d=>{if(d.type==="summary"||d.type==="milestone")return;const g=l.taskRows.get(d.id)??d.id;u.has(g)||u.set(g,[]),u.get(g).push(d)}),u.forEach(d=>{if(!(d.length<2))for(let g=0;g<d.length;g++)for(let D=g+1;D<d.length;D++){const R=d[g],L=d[D],N=R.$x,Z=R.$x+R.$w,Te=L.$x,je=L.$x+L.$w;Gt(N,Z,Te,je)&&(console.log("[collision] found overlap:",R.id,L.id,"bounds:",N,Z,Te,je),t.add(R.id),t.add(L.id))}}),console.log("[collision] total overlapping tasks:",t.size),t},[y,i,l,v,k]),Me=e.useMemo(()=>{const t=new Map;if(!i||!l)return v.forEach(g=>{t.set(g.id,g.$y)}),t;const u=new Map,d=[];return v.forEach(g=>{const D=l.taskRows.get(g.id)??g.id;u.has(D)||(u.set(D,d.length),d.push(D))}),v.forEach(g=>{const D=l.taskRows.get(g.id)??g.id,R=u.get(D)??0;t.set(g.id,R*Q)}),t},[v,i,l,Q]),be=e.useMemo(()=>{const t=new Map;if(!i||!l)return v.forEach(g=>{t.set(g.id,g.$y),g.row!==void 0&&t.set(g.row,g.$y)}),t;const u=new Map,d=[];return v.forEach(g=>{const D=l.taskRows.get(g.id)??g.id;u.has(D)||(u.set(D,d.length),d.push(D))}),u.forEach((g,D)=>{t.set(D,g*Q)}),t},[v,i,l,Q]),Se=e.useCallback(t=>{if(!fe.current)return[];const d=Math.min(t.startX,t.currentX),g=Math.max(t.startX,t.currentX),D=Math.min(t.startY,t.currentY),R=Math.max(t.startY,t.currentY);return v.filter(L=>{const N=L.$x,Z=L.$x+L.$w,je=Me.get(L.id)??L.$y,Pe=je+L.$h;return N<g&&Z>d&&je<R&&Pe>D})},[v,Me]),Ne=e.useMemo(()=>new Set(H.map(t=>t.id)),[H,A]),We=e.useCallback(t=>Ne.has(t),[Ne]),a=e.useCallback((t,u)=>{const{clientX:d}=u,g=Oe(t),D=o.getTask(g),R=u.target.classList;if(!u.target.closest(".wx-delete-button")&&!n){if(R.contains("wx-progress-marker")){const{progress:L}=o.getTask(g);ne.current={id:g,x:d,progress:L,dx:0,node:t,marker:u.target},u.target.classList.add("wx-progress-in-drag")}else{const L=ve(t,u,D)||"move",N={id:g,mode:L,x:d,dx:0,l:D.$x,w:D.$w};if(U&&D.segments?.length){const Z=Ee.locate(u,"data-segment");Z&&(N.segmentIndex=Z.dataset.segment*1,we.extendDragOptions(D,N))}ue(N)}xe()}},[o,n,ve,xe,U]),b=e.useCallback(t=>{if(t.button!==0||re)return;const u=Ee.locate(t);if(!u&&I&&!n){const d=fe.current;if(!d)return;const g=d.getBoundingClientRect(),D=t.clientX-g.left,R=t.clientY-g.top;if(h){const N=mt(D,w);N&&(J.current=N,ge(N))}const L={startX:D,startY:R,currentX:D,currentY:R,ctrlKey:t.ctrlKey||t.metaKey};p(L),W.current=L,xe();return}if(u){if(I&&!n&&H.length>1){const d=Oe(u);if(We(d)){const g=t.target.classList;if(!g.contains("wx-link")&&!g.contains("wx-progress-marker")&&!t.target.closest(".wx-delete-button")){const D=o.getTask(d);if(!ve(u,t,D)){const L=new Map;H.forEach(N=>{const Z=o.getTask(N.id);if(Z){if(S?.auto&&Z.type==="summary")return;L.set(N.id,{$x:Z.$x,$w:Z.$w,start:Z.start,end:Z.end})}}),X({baseTaskId:d,startX:t.clientX,dx:0,originalPositions:L}),xe();return}}}}a(u,t)}},[a,I,h,n,H,We,o,ve,S,xe,w,re]),$=e.useCallback(t=>{const u=Ee.locate(t);u&&(Ce.current=setTimeout(()=>{De(!0),a(u,t.touches[0])},300))},[a]),_=e.useCallback(t=>{ke(t&&{...K.find(u=>u.id===t)})},[K]),he=e.useCallback(()=>{const t=W.current;if(t){const u=Se(t);t.ctrlKey?u.forEach(d=>{o.exec("select-task",{id:d.id,toggle:!0,marquee:!0})}):(H.length>0&&o.exec("select-task",{id:null,marquee:!0}),u.forEach((d,g)=>{o.exec("select-task",{id:d.id,toggle:g>0,marquee:!0})})),p(null),W.current=null,O(),E.current=!0;return}if(V){const{dx:u,originalPositions:d}=V,g=Math.round(u/F);if(g!==0){let D=!0;d.forEach((R,L)=>{const N=o.getTask(L);N&&(o.exec("update-task",{id:L,diff:g,task:{start:N.start,end:N.end},skipUndo:!D}),D=!1)}),E.current=!0}else d.forEach((D,R)=>{o.exec("drag-task",{id:R,left:D.$x,width:D.$w,inProgress:!1})});X(null),O();return}if(ne.current){const{dx:u,id:d,marker:g,value:D}=ne.current;ne.current=null,typeof D<"u"&&u&&o.exec("update-task",{id:d,task:{progress:D},inProgress:!1}),g.classList.remove("wx-progress-in-drag"),E.current=!0,O()}else if(te){const{id:u,mode:d,dx:g,l:D,w:R,start:L,segment:N,index:Z}=te;if(ue(null),L){const Te=Math.round(g/F);if(!Te)o.exec("drag-task",{id:u,width:R,left:D,inProgress:!1,...N&&{segmentIndex:Z}});else{let je={},Pe=o.getTask(u);N&&(Pe=Pe.segments[Z]);const _e=1440*60*1e3,Ie=Te*(ce==="week"?7:ce==="month"?30:ce==="quarter"?91:ce==="year"?365:1)*_e;d==="move"?(je.start=new Date(Pe.start.getTime()+Ie),je.end=new Date(Pe.end.getTime()+Ie)):d==="start"?(je.start=new Date(Pe.start.getTime()+Ie),je.end=Pe.end):d==="end"&&(je.start=Pe.start,je.end=new Date(Pe.end.getTime()+Ie)),o.exec("update-task",{id:u,task:je,...N&&{segmentIndex:Z}})}E.current=!0}O()}},[o,O,te,F,ce,ee,V,Se,H]),me=e.useCallback((t,u)=>{const{clientX:d,clientY:g}=u,D=fe.current;if(D){const R=D.getBoundingClientRect();de.current=d-R.left}if(re){if(!D)return;const R=D.getBoundingClientRect(),L=d-R.left;M(N=>({...N,currentX:L}));return}if(!n){if(ee){const R=fe.current;if(!R)return;const L=R.getBoundingClientRect(),N=d-L.left,Z=g-L.top;p(Te=>({...Te,currentX:N,currentY:Z})),W.current&&(W.current.currentX=N,W.current.currentY=Z);return}if(V){const R=d-V.startX;V.originalPositions.forEach((L,N)=>{const Z=L.$x+R;o.exec("drag-task",{id:N,left:Z,width:L.$w,inProgress:!0})}),X(L=>({...L,dx:R}));return}if(ne.current){const{node:R,x:L,id:N}=ne.current,Z=ne.current.dx=d-L,Te=Math.round(Z/R.offsetWidth*100);let je=ne.current.progress+Te;ne.current.value=je=Math.min(Math.max(0,je),100),o.exec("update-task",{id:N,task:{progress:je},inProgress:!0})}else if(te){_(null);const{mode:R,l:L,w:N,x:Z,id:Te,start:je,segment:Pe,index:_e}=te,Ae=o.getTask(Te),Ie=d-Z;if(!je&&Math.abs(Ie)<20||R==="start"&&N-Ie<F||R==="end"&&N+Ie<F||R==="move"&&(Ie<0&&L+Ie<0||Ie>0&&L+N+Ie>Le)||te.segment&&!we.isSegmentMoveAllowed(Ae,te))return;const Ke={...te,dx:Ie};let qe,Xe;if(R==="start"?(qe=L+Ie,Xe=N-Ie):R==="end"?(qe=L,Xe=N+Ie):R==="move"&&(qe=L+Ie,Xe=N),o.exec("drag-task",{id:Te,width:Xe,left:qe,inProgress:!0,...Pe&&{segmentIndex:_e}}),!Ke.start&&(R==="move"&&Ae.$x==L||R!=="move"&&Ae.$w==N)){E.current=!0,he();return}Ke.start=!0,ue(Ke)}else{const R=Ee.locate(t);if(R){const L=o.getTask(Oe(R)),Z=Ee.locate(t,"data-segment")||R,Te=ve(Z,u,L);Z.style.cursor=Te&&!n?"col-resize":"pointer"}}}},[o,n,te,F,Le,ve,_,he,ee,V,re]),$e=e.useCallback(t=>{me(t,t)},[me]),He=e.useCallback(t=>{Re?(t.preventDefault(),me(t,t.touches[0])):Ce.current&&(clearTimeout(Ce.current),Ce.current=null)},[Re,me]),Ve=e.useCallback(()=>{he()},[he]),bt=e.useCallback(()=>{De(null),Ce.current&&(clearTimeout(Ce.current),Ce.current=null),he()},[he]);e.useEffect(()=>(window.addEventListener("mouseup",Ve),()=>{window.removeEventListener("mouseup",Ve)}),[Ve]);const yt=e.useCallback(t=>{if(!n){const u=Ee.locateID(t.target);if(u&&!t.target.classList.contains("wx-link")){const d=Ee.locateID(t.target,"data-segment");o.exec("show-editor",{id:u,...d!==null&&{segmentIndex:d}})}}},[o,n]),vt=["e2s","s2s","e2e","s2e"],Ye=e.useCallback((t,u)=>vt[(t?1:0)+(u?0:2)],[]),Fe=e.useCallback((t,u)=>{const d=x.id,g=x.start;return t===d?!0:!!K.find(D=>D.target==t&&D.source==d&&D.type===Ye(g,u))},[x,Y,Ye]),et=e.useCallback(()=>{x&&z(null)},[x]),tt=e.useCallback((t,u,d)=>{if(!u.length||!t||d==null)return;const g=864e5,D=o.getHistory();D?.startBatch();const R=new Date(t),L=R.getDay(),N=L===0?-6:1-L;R.setDate(R.getDate()+N),R.setHours(0,0,0,0),u.forEach((Z,Te)=>{const je=`task-${Date.now()}-${Te}`,Pe=zt(R,Z._startCellOffset||0,w),_e=new Date(Pe.getTime()+(Z._startDayOfWeek||0)*g);_e.setHours(0,0,0,0);const Ae=new Date(_e.getTime()+(Z._durationDays||7)*g);Ae.setHours(0,0,0,0),console.log("[paste] task:",Z.text,"newStart:",_e,"newEnd:",Ae,"_durationDays:",Z._durationDays,"_startDayOfWeek:",Z._startDayOfWeek),o.exec("add-task",{task:{id:je,text:Z.text,start:_e,end:Ae,type:Z.type||"task",parent:d,row:Z.row},target:d,mode:"child",skipUndo:Te>0})}),D?.endBatch()},[o,w]),Tt=e.useCallback(t=>{if(E.current){E.current=!1;return}if(re&&re.currentX!=null){const d=mt(re.currentX,w);d&&tt(d,re.tasks,re.parent),M(null);return}const u=Ee.locateID(t.target);if(u){const d=o.getTask(u),g=v.find(R=>R.id===u);console.log("[click] task:",d?.text,"id:",u),console.log("[click] api.getTask:",{start:d?.start,end:d?.end,duration:d?.duration}),console.log("[click] rendered:",{start:g?.start,end:g?.end,$w:g?.$w,$x:g?.$x});const D=t.target.classList;if(D.contains("wx-link")){const R=D.contains("wx-left");if(!x){z({id:u,start:R});return}x.id!==u&&!Fe(u,R)&&o.exec("add-link",{link:{source:x.id,target:u,type:Ye(x.start,R)}})}else if(D.contains("wx-delete-button-icon"))o.exec("delete-link",{id:ie.id}),ke(null);else{let R;const L=Ee.locate(t,"data-segment");L&&(R=L.dataset.segment*1),o.exec("select-task",{id:u,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:R})}}et()},[o,x,Y,ie,Fe,Ye,et,re,w,tt]),Mt=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),Ct=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),St=e.useCallback(t=>{if(Re||Ce.current)return t.preventDefault(),!1},[Re]),st=e.useMemo(()=>f.map(t=>t.id),[f]),nt=e.useCallback(t=>{let u=st.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(u=`task ${u}`),u},[st]),rt=e.useCallback(t=>{o.exec(t.action,t.data)},[o]),Ue=e.useCallback(t=>T&&P.byId(t).$critical,[T,P]),ot=e.useCallback(t=>{if(S?.auto){const u=P.getSummaryId(t,!0),d=P.getSummaryId(x.id,!0);return x?.id&&!(Array.isArray(u)?u:[u]).includes(x.id)&&!(Array.isArray(d)?d:[d]).includes(t)}return x},[S,P,x]),lt=e.useCallback(()=>{const t=o.getState()._selected;if(!t||!t.length)return;const u=864e5,d=t.map(N=>{const Z=o.getTask(N.id);if(!Z)return null;const Te=v.find(Rt=>Rt.id===N.id);if(!Te)return null;const{$x:je,$y:Pe,$h:_e,$w:Ae,$skip:Ie,$level:Ke,$index:qe,$y_base:Xe,$x_base:hs,$w_base:ms,$h_base:gs,$skip_baseline:ws,$critical:ps,$reorder:ks,...Et}=Te,it=Te.end&&Te.start?Math.round((Te.end.getTime()-Te.start.getTime())/u):0,at=Te.start?(Te.start.getDay()+6)%7:0;return console.log("[copy] task:",Z.text,"durationDays:",it,"startDayOfWeek:",at,"$w:",Ae),{...Et,_durationDays:it,_startDayOfWeek:at,_originalWidth:Ae,_originalHeight:_e}}).filter(Boolean);if(!d.length)return;const D=d[0].parent,R=d.filter(N=>N.parent===D);if(R.length===0)return;const L=R.reduce((N,Z)=>Z.start&&(!N||Z.start<N)?Z.start:N,null);Qe=R.map(N=>({...N,_startCellOffset:_t(N.start,L,w)})),ht=D,Ze=L},[o,w]);e.useEffect(()=>h?o.intercept("hotkey",u=>{if(u.key==="ctrl+c"||u.key==="meta+c")return lt(),!1;if(u.key==="ctrl+v"||u.key==="meta+v")return!Qe.length||!Ze||M({tasks:Qe,baseDate:Ze,parent:ht,currentX:de.current}),!1}):void 0,[h,o,lt]),e.useEffect(()=>{if(!re)return;const t=u=>{u.key==="Escape"&&(u.preventDefault(),u.stopPropagation(),M(null))};return document.addEventListener("keydown",t,!0),()=>document.removeEventListener("keydown",t,!0)},[re]);const ct=e.useMemo(()=>{if(!ee)return null;const t=Math.min(ee.startX,ee.currentX),u=Math.min(ee.startY,ee.currentY),d=Math.abs(ee.currentX-ee.startX),g=Math.abs(ee.currentY-ee.startY);return{left:`${t}px`,top:`${u}px`,width:`${d}px`,height:`${g}px`}},[ee]);return c.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${ae.length?ae[0].$h:0}px`},ref:fe,onContextMenu:St,onMouseDown:b,onMouseMove:$e,onTouchStart:$,onTouchMove:He,onTouchEnd:bt,onClick:Tt,onDoubleClick:yt,onDragStart:t=>(t.preventDefault(),!1),children:[c.jsx(Ht,{onSelectLink:_,selectedLink:ie,readonly:n}),ae.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const u=le.has(t.id),d=`wx-bar wx-${nt(t.type)}`+(Re&&te&&t.id===te.id?" wx-touch":"")+(x&&x.id===t.id?" wx-selected":"")+(Ne.has(t.id)?" wx-selected":"")+(Ue(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(U&&t.segments?" wx-split":"")+(u?" wx-collision":""),g="wx-link wx-left"+(x?" wx-visible":"")+(!x||!Fe(t.id,!0)&&ot(t.id)?" wx-target":"")+(x&&x.id===t.id&&x.start?" wx-selected":"")+(Ue(t.id)?" wx-critical":""),D="wx-link wx-right"+(x?" wx-visible":"")+(!x||!Fe(t.id,!1)&&ot(t.id)?" wx-target":"")+(x&&x.id===t.id&&!x.start?" wx-selected":"")+(Ue(t.id)?" wx-critical":"");return c.jsxs(e.Fragment,{children:[!t.$skip&&c.jsxs("div",{className:"wx-GKbcLEGA "+d,style:Mt(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:oe===t.id?0:-1,children:[n?null:t.id===ie?.target&&ie?.type[2]==="s"?c.jsx(ye.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+g,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?c.jsxs(c.Fragment,{children:[t.progress&&!(U&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:c.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(U&&t.segments)?c.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?c.jsx(r,{data:t,api:o,onAction:rt}):U&&t.segments?c.jsx(At,{task:t,type:nt(t.type)}):c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""}),u&&c.jsx("div",{className:"wx-GKbcLEGA wx-collision-warning",title:"This task overlaps with another task in the same row",children:"!"})]}):c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?c.jsx(r,{data:t,api:o,onAction:rt}):c.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===ie?.target&&ie?.type[2]==="e"?c.jsx(ye.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:c.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):c.jsx("div",{className:"wx-GKbcLEGA "+D,children:c.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),q&&!t.$skip_baseline?c.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:Ct(t)}):null]},t.id)}),ee&&ct&&c.jsx("div",{className:"wx-GKbcLEGA wx-marquee-selection",style:ct}),re&&re.currentX!=null&&re.tasks.map((t,u)=>{const g=(Math.floor(re.currentX/F)+(t._startCellOffset||0))*F,D=t._originalWidth||F,R=t._originalHeight||Q,L=be.get(t.row)??(t.$y||0);return c.jsx("div",{className:"wx-GKbcLEGA wx-bar wx-task wx-paste-preview",style:{left:g,top:L,width:D,height:R},children:c.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text})},`preview-${u}`)})]})}function qt(s){const{highlightTime:n}=s,r=e.useContext(Ge),i=j.useStore(r,"_scales");return c.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:i.width},children:(i?.rows||[]).map((l,I)=>c.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${l.height}px`},children:(l.cells||[]).map((h,y)=>{const o=n?n(h.date,h.unit):"",v="wx-cell "+(h.css||"")+" "+(o||""),k=typeof h.value=="string"&&h.value.includes("<");return c.jsx("div",{className:"wx-ZkvhDKir "+v,style:{width:`${h.width}px`},...k?{dangerouslySetInnerHTML:{__html:h.value}}:{children:h.value}},y)})},I))})}const Xt=new Map;function Yt(s){const n=e.useRef(null),r=e.useRef(0),i=e.useRef(null),l=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(l)return cancelAnimationFrame(i.current),i.current=requestAnimationFrame(()=>{const I={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};Xt.set(s,I),window.dispatchEvent(new CustomEvent("render-metric",{detail:I}))}),()=>cancelAnimationFrame(i.current)})}function Ft(s){const{readonly:n,fullWidth:r,fullHeight:i,taskTemplate:l,cellBorders:I,highlightTime:h,multiTaskRows:y=!1,rowMapping:o=null,marqueeSelect:v=!1,copyPaste:k=!1,scrollToCurrentWeek:K=!1,currentWeekColor:Y=null,allowTaskIntersection:C=!0}=s,w=e.useContext(Ge),[f,q]=j.useStoreWithCounter(w,"_selected"),H=j.useStore(w,"scrollTop"),A=j.useStore(w,"cellHeight"),B=j.useStore(w,"cellWidth"),T=j.useStore(w,"_scales"),P=j.useStore(w,"_markers"),S=j.useStore(w,"_scrollTask"),U=j.useStore(w,"zoom"),se=j.useStore(w,"_tasks"),[Q,ae]=e.useState(),F=e.useRef(null),ce=e.useRef(0),E=e.useRef(!1),x=1+(T?.rows?.length||0),z=e.useMemo(()=>{if(!y||!o||!se?.length)return null;const p=new Map,W=new Map,V=[];return se.forEach(X=>{const G=o.taskRows.get(X.id)??X.id;W.has(G)||(W.set(G,V.length),V.push(G))}),se.forEach(X=>{const G=o.taskRows.get(X.id)??X.id,ge=W.get(G)??0;p.set(X.id,ge*A)}),p},[se,y,o,A]),te=e.useMemo(()=>{const p=[];return f&&f.length&&A&&f.forEach(W=>{const V=z?.get(W.id)??W.$y;p.push({height:`${A}px`,top:`${V-3}px`})}),p},[q,A,z]),ue=e.useMemo(()=>Math.max(Q||0,i),[Q,i]);e.useEffect(()=>{const p=F.current;p&&typeof H=="number"&&(p.scrollTop=H)},[H]);const ne=()=>{ie()};function ie(p){const W=F.current;if(!W)return;const V={};V.left=W.scrollLeft,w.exec("scroll-chart",V)}function ke(){const p=F.current,V=Math.ceil((Q||0)/(A||1))+1,X=Math.floor((p&&p.scrollTop||0)/(A||1)),G=Math.max(0,X-x),ge=X+V+x,re=G*(A||0);w.exec("render-data",{start:G,end:ge,from:re})}e.useEffect(()=>{ke()},[Q,H]);const Re=e.useCallback(p=>{if(!p)return;const{id:W,mode:V}=p;if(V.toString().indexOf("x")<0)return;const X=F.current;if(!X)return;const{clientWidth:G}=X,ge=w.getTask(W);if(ge.$x+ge.$w<X.scrollLeft)w.exec("scroll-chart",{left:ge.$x-(B||0)}),X.scrollLeft=ge.$x-(B||0);else if(ge.$x>=G+X.scrollLeft){const re=G<ge.$w?B||0:ge.$w;w.exec("scroll-chart",{left:ge.$x-G+re}),X.scrollLeft=ge.$x-G+re}},[w,B]);e.useEffect(()=>{Re(S)},[S]);function De(p){if(U&&(p.ctrlKey||p.metaKey)){p.preventDefault();const W=F.current,V=p.clientX-(W?W.getBoundingClientRect().left:0);if(ce.current+=p.deltaY,Math.abs(ce.current)>=150){const G=-Math.sign(ce.current);ce.current=0,w.exec("zoom-scale",{dir:G,offset:V})}}}const Ce=e.useCallback(p=>{const W=h(p.date,p.unit);return W?{css:W,width:p.width}:null},[h]),Le=e.useMemo(()=>{if(!T||!h||!["hour","day","week"].includes(T.minUnit))return null;let W=0;return T.rows[T.rows.length-1].cells.map(V=>{const X=Ce(V),G=W;return W+=V.width,X?{...X,left:G}:null})},[T,h,Ce]),pe=e.useCallback(p=>{p.eventSource="chart",w.exec("hotkey",p)},[w]);e.useEffect(()=>{const p=F.current;if(!p)return;const W=()=>ae(p.clientHeight);W();const V=new ResizeObserver(()=>W());return V.observe(p),()=>{V.disconnect()}},[F.current]);const ee=e.useRef(null);return e.useEffect(()=>{const p=F.current;if(p&&!ee.current)return ee.current=gt.hotkeys(p,{keys:{arrowup:!0,arrowdown:!0},exec:W=>pe(W)}),()=>{ee.current?.destroy(),ee.current=null}},[]),e.useEffect(()=>{const p=F.current;if(!p)return;const W=De;return p.addEventListener("wheel",W),()=>{p.removeEventListener("wheel",W)}},[De]),e.useEffect(()=>{if(!K||E.current||!T||!F.current||!Q)return;const p=F.current,{clientWidth:W}=p,V=new Date,X=T.rows[T.rows.length-1]?.cells;if(!X)return;let G=-1,ge=0;const re=[];for(let J=0;J<X.length;J++){const de=X[J];re.push({left:ge,width:de.width});const fe=de.date;if(de.unit==="week"){const m=new Date(fe);m.setDate(m.getDate()+7),V>=fe&&V<m&&(G=J)}else de.unit==="day"&&V.getFullYear()===fe.getFullYear()&&V.getMonth()===fe.getMonth()&&V.getDate()===fe.getDate()&&(G=J);ge+=de.width}let M=G;if(G>0&&(M=G-1),M>=0&&re[M]){const J=re[M],de=Math.max(0,J.left);p.scrollLeft=de,w.exec("scroll-chart",{left:de}),E.current=!0}},[K,T,Q,w]),Yt("chart"),c.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:F,onScroll:ne,children:[c.jsx(qt,{highlightTime:h,scales:T}),P&&P.length?c.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${ue}px`},children:P.map((p,W)=>c.jsx("div",{className:`wx-mR7v2Xag wx-marker ${p.css||""}`,style:{left:`${p.left}px`},children:c.jsx("div",{className:"wx-mR7v2Xag wx-content",children:p.text})},W))}):null,c.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${ue}px`},children:[Le?c.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:Le.map((p,W)=>p?c.jsx("div",{className:"wx-mR7v2Xag "+p.css,style:{width:`${p.width}px`,left:`${p.left}px`}},W):null)}):null,c.jsx(Wt,{borders:I}),f&&f.length?f.map((p,W)=>p.$y?c.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":p.id,style:te[W]},p.id):null):null,c.jsx(Ot,{readonly:n,taskTemplate:l,multiTaskRows:y,rowMapping:o,marqueeSelect:v,copyPaste:k,allowTaskIntersection:C})]})]})}function Kt(s){const{position:n="after",size:r=4,dir:i="x",onMove:l,onDisplayChange:I,compactMode:h,containerWidth:y=0,leftThreshold:o=50,rightThreshold:v=50}=s,[k,K]=j.useWritableProp(s.value??0),[Y,C]=j.useWritableProp(s.display??"all");function w(ne){let ie=0;n=="center"?ie=r/2:n=="before"&&(ie=r);const ke={size:[r+"px","auto"],p:[ne-ie+"px","0px"],p2:["auto","0px"]};if(i!="x")for(let Re in ke)ke[Re]=ke[Re].reverse();return ke}const[f,q]=e.useState(!1),[H,A]=e.useState(null),B=e.useRef(0),T=e.useRef(),P=e.useRef(),S=e.useRef(Y);e.useEffect(()=>{S.current=Y},[Y]),e.useEffect(()=>{H===null&&k>0&&A(k)},[H,k]);function U(ne){return i=="x"?ne.clientX:ne.clientY}const se=e.useCallback(ne=>{const ie=T.current+U(ne)-B.current;K(ie);let ke;ie<=o?ke="chart":y-ie<=v?ke="grid":ke="all",S.current!==ke&&(C(ke),S.current=ke),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>l&&l(ie),100)},[y,o,v,l]),Q=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",q(!1),window.removeEventListener("mousemove",se),window.removeEventListener("mouseup",Q)},[se]),ae=e.useMemo(()=>Y!=="all"?"auto":i=="x"?"ew-resize":"ns-resize",[Y,i]),F=e.useCallback(ne=>{!h&&(Y==="grid"||Y==="chart")||(B.current=U(ne),T.current=k,q(!0),document.body.style.cursor=ae,document.body.style.userSelect="none",window.addEventListener("mousemove",se),window.addEventListener("mouseup",Q))},[ae,se,Q,k,h,Y]);function ce(){C("all"),H!==null&&(K(H),l&&l(H))}function E(ne){if(h){const ie=Y==="chart"?"grid":"chart";C(ie),I(ie)}else if(Y==="grid"||Y==="chart")ce(),I("all");else{const ie=ne==="left"?"chart":"grid";C(ie),I(ie)}}function x(){E("left")}function z(){E("right")}const te=e.useMemo(()=>w(k),[k,n,r,i]),ue=["wx-resizer",`wx-resizer-${i}`,`wx-resizer-display-${Y}`,f?"wx-resizer-active":""].filter(Boolean).join(" ");return c.jsxs("div",{className:"wx-pFykzMlT "+ue,onMouseDown:F,style:{width:te.size[0],height:te.size[1],cursor:ae},children:[c.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:x})}),c.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:c.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:z})})]}),c.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const Bt=650;function pt(s){let n;function r(){n=new ResizeObserver(l=>{for(let I of l)if(I.target===document.body){let h=I.contentRect.width<=Bt;s(h)}}),n.observe(document.body)}function i(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:i}}function Vt(s){const{taskTemplate:n,readonly:r,cellBorders:i,highlightTime:l,onTableAPIChange:I,multiTaskRows:h=!1,rowMapping:y=null,marqueeSelect:o=!1,copyPaste:v=!1,scrollToCurrentWeek:k=!1,currentWeekColor:K=null,allowTaskIntersection:Y=!0}=s,C=e.useContext(Ge),w=j.useStore(C,"_tasks"),f=j.useStore(C,"_scales"),q=j.useStore(C,"cellHeight"),H=j.useStore(C,"columns"),A=j.useStore(C,"_scrollTask"),B=j.useStore(C,"undo"),T=e.useMemo(()=>{if(!h)return y;const M=new Map,J=new Map;return w.forEach(de=>{const fe=de.row??de.id;J.set(de.id,fe),M.has(fe)||M.set(fe,[]),M.get(fe).push(de.id)}),{rowMap:M,taskRows:J}},[w,h,y]),[P,S]=e.useState(!1);let[U,se]=e.useState(0);const[Q,ae]=e.useState(0),[F,ce]=e.useState(0),[E,x]=e.useState(void 0),[z,te]=e.useState("all"),ue=e.useRef(null),ne=e.useCallback(M=>{S(J=>(M!==J&&(M?(ue.current=z,z==="all"&&te("grid")):(!ue.current||ue.current==="all")&&te("all")),M))},[z]);e.useEffect(()=>{const M=pt(ne);return M.observe(),()=>{M.disconnect()}},[ne]);const ie=e.useMemo(()=>{let M;return H.every(J=>J.width&&!J.flexgrow)?M=H.reduce((J,de)=>J+parseInt(de.width),0):P&&z==="chart"?M=parseInt(H.find(J=>J.id==="action")?.width)||50:M=440,U=M,M},[H,P,z]);e.useEffect(()=>{se(ie)},[ie]);const ke=e.useMemo(()=>(Q??0)-(E??0),[Q,E]),Re=e.useMemo(()=>f.width,[f]),De=e.useMemo(()=>{if(!h||!T)return w.length*q;const M=new Set;return w.forEach(J=>{const de=T.taskRows.get(J.id)??J.id;M.add(de)}),M.size*q},[w,q,h,T]),Ce=e.useMemo(()=>f.height+De+ke,[f,De,ke]),Le=e.useMemo(()=>U+Re,[U,Re]),pe=e.useRef(null),ee=e.useCallback(()=>{Promise.resolve().then(()=>{if((Q??0)>(Le??0)){const M=(Q??0)-U;C.exec("expand-scale",{minWidth:M})}})},[Q,Le,U,C]);e.useEffect(()=>{let M;return pe.current&&(M=new ResizeObserver(ee),M.observe(pe.current)),()=>{M&&M.disconnect()}},[pe.current,ee]),e.useEffect(()=>{ee()},[Re]);const p=e.useRef(null),W=e.useRef(null),V=e.useCallback(()=>{const M=p.current;M&&C.exec("scroll-chart",{top:M.scrollTop})},[C]),X=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{X.current={rTasks:w,rScales:f,rCellHeight:q,scrollSize:ke,ganttDiv:p.current,ganttHeight:F??0}},[w,f,q,ke,F]);const G=e.useCallback(M=>{if(!M)return;const{rTasks:J,rScales:de,rCellHeight:fe,scrollSize:m,ganttDiv:oe,ganttHeight:xe}=X.current;if(!oe)return;const{id:O}=M,ve=J.findIndex(le=>le.id===O);if(ve>-1){const le=xe-de.height,Me=ve*fe,be=oe.scrollTop;let Se=null;Me<be?Se=Me:Me+fe>be+le&&(Se=Me-le+fe+m),Se!==null&&(C.exec("scroll-chart",{top:Math.max(Se,0)}),p.current.scrollTop=Math.max(Se,0))}},[C]);e.useEffect(()=>{G(A)},[A]),e.useEffect(()=>{const M=p.current,J=W.current;if(!M||!J)return;const de=()=>{$t.flushSync(()=>{ce(M.offsetHeight),ae(M.offsetWidth),x(J.offsetWidth)})},fe=new ResizeObserver(de);return fe.observe(M),()=>fe.disconnect()},[p.current]);const ge=e.useRef(null),re=e.useRef(null);return e.useEffect(()=>{re.current&&(re.current.destroy(),re.current=null);const M=ge.current;if(M)return re.current=gt.hotkeys(M,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,"meta+c":!0,"meta+v":!0,"meta+x":!0,"meta+d":!0,backspace:!0,"ctrl+z":B,"ctrl+y":B,"meta+z":B,"meta+shift+z":B},exec:J=>{if(J.isInput)return;const de=J.key;if(de==="ctrl+z"||de==="meta+z"){C.exec("undo",{});return}if(de==="ctrl+y"||de==="meta+shift+z"){C.exec("redo",{});return}C.exec("hotkey",J)}}),()=>{re.current?.destroy(),re.current=null}},[B]),c.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:p,onScroll:V,children:c.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:Ce,width:"100%"},ref:W,children:c.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:F,width:E},children:c.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:ge,children:[H.length?c.jsxs(c.Fragment,{children:[c.jsx(Pt,{display:z,compactMode:P,columnWidth:ie,width:U,readonly:r,fullHeight:De,onTableAPIChange:I,multiTaskRows:h,rowMapping:T}),c.jsx(Kt,{value:U,display:z,compactMode:P,containerWidth:Q,onMove:M=>se(M),onDisplayChange:M=>te(M)})]}):null,c.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:pe,children:c.jsx(Ft,{readonly:r,fullWidth:Re,fullHeight:De,taskTemplate:n,cellBorders:i,highlightTime:l,multiTaskRows:h,rowMapping:T,marqueeSelect:o,copyPaste:v,scrollToCurrentWeek:k,currentWeekColor:K,allowTaskIntersection:Y})})]})})})})}function Ut(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function Qt(s,n){return typeof s=="function"?s:Ee.dateToString(s,n)}function kt(s,n){return s.map(({format:r,...i})=>({...i,format:Qt(r,n)}))}function Zt(s,n){const r=Ut(n);for(let i in r)r[i]=Ee.dateToString(r[i],s);return r}function Jt(s,n){if(!s||!s.length)return s;const r=Ee.dateToString("%d-%m-%Y",n);return s.map(i=>i.template?i:i.id==="start"||i.id=="end"?{...i,_template:l=>r(l),template:l=>r(l)}:i.id==="duration"?{...i,_template:l=>l,template:l=>l}:i)}function es(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:kt(r.scales,n)}))}:s}const ts=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),ss=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],ns=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:i=we.defaultTaskTypes,tasks:l=[],selected:I=[],activeTask:h=null,links:y=[],scales:o=ss,columns:v=we.defaultColumns,start:k=null,end:K=null,lengthUnit:Y="day",durationUnit:C="day",cellWidth:w=100,cellHeight:f=38,scaleHeight:q=36,readonly:H=!1,cellBorders:A="full",zoom:B=!1,baselines:T=!1,highlightTime:P=null,init:S=null,autoScale:U=!0,unscheduledTasks:se=!1,criticalPath:Q=null,schedule:ae={type:"forward"},projectStart:F=null,projectEnd:ce=null,calendar:E=null,undo:x=!1,splitTasks:z=!1,multiTaskRows:te=!1,marqueeSelect:ue=!1,copyPaste:ne=!1,currentWeekHighlight:ie=!1,currentWeekColor:ke=null,scrollToCurrentWeek:Re=!1,allowTaskIntersection:De=!0,...Ce},Le){const pe=e.useRef();pe.current=Ce;const ee=e.useMemo(()=>new we.DataStore(j.writable),[]),p=e.useMemo(()=>({...Je.en,...Be.en}),[]),W=e.useContext(ye.context.i18n),V=e.useMemo(()=>W?W.extend(p,!0):Ee.locale(p),[W,p]),X=e.useMemo(()=>V.getRaw().calendar,[V]),G=e.useMemo(()=>{let le={zoom:es(B,X),scales:kt(o,X),columns:Jt(v,X),links:we.normalizeLinks(y),cellWidth:w};return le.zoom&&(le={...le,...we.normalizeZoom(le.zoom,Zt(X,V.getGroup("gantt")),le.scales,w)}),le},[B,o,v,y,w,X,V]),ge=e.useRef(null);ge.current!==l&&(we.parseTaskDates(l,{durationUnit:C,splitTasks:z,calendar:E}),ge.current=l),e.useEffect(()=>{we.parseTaskDates(l,{durationUnit:C,splitTasks:z,calendar:E})},[l,C,E,z]);const re=e.useMemo(()=>{if(!te)return null;const le=new Map,Me=new Map,be=Se=>{Se.forEach(Ne=>{const We=Ne.row??Ne.id;Me.set(Ne.id,We),le.has(We)||le.set(We,[]),le.get(We).push(Ne.id),Ne.data&&Ne.data.length>0&&be(Ne.data)})};return be(l),{rowMap:le,taskRows:Me}},[l,te]),M=e.useMemo(()=>ee.in,[ee]),J=e.useRef(null);J.current===null&&(J.current=new jt.EventBusRouter((le,Me)=>{const be="on"+ts(le);pe.current&&pe.current[be]&&pe.current[be](Me)}),M.setNext(J.current));const[de,fe]=e.useState(null),m=e.useRef(null);m.current=de;const oe=e.useMemo(()=>({getState:ee.getState.bind(ee),getReactiveState:ee.getReactive.bind(ee),getStores:()=>({data:ee}),exec:M.exec,setNext:le=>(J.current=J.current.setNext(le),J.current),intercept:M.intercept.bind(M),on:M.on.bind(M),detach:M.detach.bind(M),getTask:ee.getTask.bind(ee),serialize:ee.serialize.bind(ee),getTable:le=>le?new Promise(Me=>setTimeout(()=>Me(m.current),1)):m.current,getHistory:()=>ee.getHistory()}),[ee,M]);e.useImperativeHandle(Le,()=>({...oe}),[oe]);const xe=e.useRef(0);e.useEffect(()=>{xe.current?ee.init({tasks:l,links:G.links,start:k,columns:G.columns,end:K,lengthUnit:Y,cellWidth:G.cellWidth,cellHeight:f,scaleHeight:q,scales:G.scales,taskTypes:i,zoom:G.zoom,selected:I,activeTask:h,baselines:T,autoScale:U,unscheduledTasks:se,markers:r,durationUnit:C,criticalPath:Q,schedule:ae,projectStart:F,projectEnd:ce,calendar:E,undo:x,_weekStart:X.weekStart,splitTasks:z}):S&&S(oe),xe.current++},[oe,S,l,G,k,K,Y,f,q,i,I,h,T,U,se,r,C,Q,ae,F,ce,E,x,X,z,ee]),xe.current===0&&ee.init({tasks:l,links:G.links,start:k,columns:G.columns,end:K,lengthUnit:Y,cellWidth:G.cellWidth,cellHeight:f,scaleHeight:q,scales:G.scales,taskTypes:i,zoom:G.zoom,selected:I,activeTask:h,baselines:T,autoScale:U,unscheduledTasks:se,markers:r,durationUnit:C,criticalPath:Q,schedule:ae,projectStart:F,projectEnd:ce,calendar:E,undo:x,_weekStart:X.weekStart,splitTasks:z});const O=e.useMemo(()=>{const le=new Date,Me=X?.weekStart??0,be=new Date(le),Ne=(be.getDay()-Me+7)%7;be.setDate(be.getDate()-Ne),be.setHours(0,0,0,0);const We=new Date(be);return We.setDate(We.getDate()+7),a=>a>=be&&a<We},[X]),ve=e.useMemo(()=>(le,Me)=>{let be=[];if(E)Me=="day"&&!E.getDayHours(le)&&be.push("wx-weekend"),Me=="hour"&&!E.getDayHours(le)&&be.push("wx-weekend");else if(P){const Se=P(le,Me);Se&&be.push(Se)}return ie&&(Me==="week"||Me==="day")&&O(le)&&be.push("wx-current-week"),be.join(" ")},[E,P,ie,O]);return c.jsx(ye.context.i18n.Provider,{value:V,children:c.jsx(Ge.Provider,{value:oe,children:c.jsx(Vt,{taskTemplate:n,readonly:H,cellBorders:A,highlightTime:ve,onTableAPIChange:fe,multiTaskRows:te,rowMapping:re,marqueeSelect:ue,copyPaste:ne,scrollToCurrentWeek:Re,currentWeekColor:ke,allowTaskIntersection:De})})})});function rs({api:s=null,items:n=[]}){const r=e.useContext(ye.context.i18n),i=e.useMemo(()=>r||Ee.locale(Be.en),[r]),l=e.useMemo(()=>i.getGroup("gantt"),[i]),I=j.useStoreLater(s,"_selected"),h=j.useStoreLater(s,"undo"),y=j.useStoreLater(s,"history"),o=j.useStoreLater(s,"splitTasks"),v=["undo","redo"],k=e.useMemo(()=>{const Y=we.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:we.getToolbarButtons({undo:h,splitTasks:o})).map(w=>{let f={...w,disabled:!1};return f.handler=we.isHandledAction(Y,f.id)?q=>we.handleAction(s,q.id,null,l):f.handler,f.text&&(f.text=l(f.text)),f.menuText&&(f.menuText=l(f.menuText)),f})},[n,s,l,h,o]),K=e.useMemo(()=>{const Y=[];return k.forEach(C=>{const w=C.id;if(w==="add-task")Y.push(C);else if(v.includes(w))v.includes(w)&&Y.push({...C,disabled:C.isDisabled(y)});else{if(!I?.length||!s)return;Y.push({...C,disabled:C.isDisabled&&I.some(f=>C.isDisabled(f,s.getState()))})}}),Y.filter((C,w)=>{if(s&&C.isHidden)return!I.some(f=>C.isHidden(f,s.getState()));if(C.comp==="separator"){const f=Y[w+1];if(!f||f.comp==="separator")return!1}return!0})},[s,I,y,k]);return r?c.jsx(ut.Toolbar,{items:K}):c.jsx(ye.context.i18n.Provider,{value:i,children:c.jsx(ut.Toolbar,{items:K})})}const os=e.forwardRef(function({options:n=[],api:r=null,resolver:i=null,filter:l=null,at:I="point",children:h,onClick:y,css:o},v){const k=e.useRef(null),K=e.useRef(null),Y=e.useContext(ye.context.i18n),C=e.useMemo(()=>Y||Ee.locale({...Be.en,...Je.en}),[Y]),w=e.useMemo(()=>C.getGroup("gantt"),[C]),f=j.useStoreLater(r,"taskTypes"),q=j.useStoreLater(r,"selected"),H=j.useStoreLater(r,"_selected"),A=j.useStoreLater(r,"splitTasks"),B=e.useMemo(()=>we.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{k.current&&k.current.show&&k.current.show()}),r.on("drag-task",()=>{k.current&&k.current.show&&k.current.show()}))},[r]);function T(E){return E.map(x=>(x={...x},x.text&&(x.text=w(x.text)),x.subtext&&(x.subtext=w(x.subtext)),x.data&&(x.data=T(x.data)),x))}function P(){const E=n.length?n:we.getMenuOptions({splitTasks:A}),x=E.find(z=>z.id==="convert-task");return x&&(x.data=[],(f||[]).forEach(z=>{x.data.push(x.dataFactory(z))})),T(E)}const S=e.useMemo(()=>P(),[r,n,f,A,w]),U=e.useMemo(()=>H&&H.length?H:[],[H]),se=e.useCallback((E,x)=>{let z=E?r?.getTask(E):null;if(i){const te=i(E,x);z=te===!0?z:te}if(z){const te=Ee.locateID(x.target,"data-segment");te!==null?K.current={id:z.id,segmentIndex:te}:K.current=z.id,(!Array.isArray(q)||!q.includes(z.id))&&r&&r.exec&&r.exec("select-task",{id:z.id})}return z},[r,i,q]),Q=e.useCallback(E=>{const x=E.action;x&&(we.isHandledAction(B,x.id)&&we.handleAction(r,x.id,K.current,w),y&&y(E))},[r,w,y,B]),ae=e.useCallback((E,x)=>{const z=U.length?U:x?[x]:[];let te=l?z.every(ue=>l(E,ue)):!0;if(te&&(E.isHidden&&(te=!z.some(ue=>E.isHidden(ue,r.getState(),K.current))),E.isDisabled)){const ue=z.some(ne=>E.isDisabled(ne,r.getState(),K.current));E.disabled=ue}return te},[l,U,r]);e.useImperativeHandle(v,()=>({show:(E,x)=>{k.current&&k.current.show&&k.current.show(E,x)}}));const F=e.useCallback(E=>{k.current&&k.current.show&&k.current.show(E)},[]),ce=c.jsxs(c.Fragment,{children:[c.jsx(Dt.ContextMenu,{filter:ae,options:S,dataKey:"id",resolver:se,onClick:Q,at:I,ref:k,css:o}),c.jsx("span",{onContextMenu:F,"data-menu-ignore":"true",children:typeof h=="function"?h():h})]});if(!Y&&ye.context.i18n?.Provider){const E=ye.context.i18n.Provider;return c.jsx(E,{value:C,children:ce})}return ce});function ls({api:s,autoSave:n,onLinksChange:r}){const l=e.useContext(ye.context.i18n).getGroup("gantt"),I=j.useStore(s,"activeTask"),h=j.useStore(s,"_activeTask"),y=j.useStore(s,"_links"),o=j.useStore(s,"schedule"),v=j.useStore(s,"unscheduledTasks"),[k,K]=e.useState();function Y(){if(I){const q=y.filter(A=>A.target==I).map(A=>({link:A,task:s.getTask(A.source)})),H=y.filter(A=>A.source==I).map(A=>({link:A,task:s.getTask(A.target)}));return[{title:l("Predecessors"),data:q},{title:l("Successors"),data:H}]}}e.useEffect(()=>{K(Y())},[I,y]);const C=e.useMemo(()=>[{id:"e2s",label:l("End-to-start")},{id:"s2s",label:l("Start-to-start")},{id:"e2e",label:l("End-to-end")},{id:"s2e",label:l("Start-to-end")}],[l]);function w(q){n?s.exec("delete-link",{id:q}):(K(H=>(H||[]).map(A=>({...A,data:A.data.filter(B=>B.link.id!==q)}))),r&&r({id:q,action:"delete-link",data:{id:q}}))}function f(q,H){n?s.exec("update-link",{id:q,link:H}):(K(A=>(A||[]).map(B=>({...B,data:B.data.map(T=>T.link.id===q?{...T,link:{...T.link,...H}}:T)}))),r&&r({id:q,action:"update-link",data:{id:q,link:H}}))}return c.jsx(c.Fragment,{children:(k||[]).map((q,H)=>q.data.length?c.jsx("div",{className:"wx-j93aYGQf wx-links",children:c.jsx(ye.Field,{label:q.title,position:"top",children:c.jsx("table",{children:c.jsx("tbody",{children:q.data.map(A=>c.jsxs("tr",{children:[c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:A.task.text||""})}),o?.auto&&A.link.type==="e2s"?c.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:c.jsx(ye.Text,{type:"number",placeholder:l("Lag"),value:A.link.lag,disabled:v&&h?.unscheduled,onChange:B=>{B.input||f(A.link.id,{lag:B.value})}})}):null,c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:c.jsx(ye.Combo,{value:A.link.type,placeholder:l("Select link type"),options:C,onChange:B=>f(A.link.id,{type:B.value}),children:({option:B})=>B.label})})}),c.jsx("td",{className:"wx-j93aYGQf wx-cell",children:c.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>w(A.link.id),role:"button"})})]},A.link.id))})})})},H):null)})}function cs(s){const{value:n,time:r,format:i,onchange:l,onChange:I,...h}=s,y=I??l;function o(v){const k=new Date(v.value);k.setHours(n.getHours()),k.setMinutes(n.getMinutes()),y&&y({value:k})}return c.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[c.jsx(ye.DatePicker,{...h,value:n,onChange:o,format:i,buttons:["today"],clear:!1}),r?c.jsx(ye.TimePicker,{value:n,onChange:y,format:i}):null]})}ze.registerEditorItem("select",ye.RichSelect);ze.registerEditorItem("date",cs);ze.registerEditorItem("twostate",ye.TwoState);ze.registerEditorItem("slider",ye.Slider);ze.registerEditorItem("counter",ye.Counter);ze.registerEditorItem("links",ls);function is({api:s,items:n=[],css:r="",layout:i="default",readonly:l=!1,placement:I="sidebar",bottomBar:h=!0,topBar:y=!0,autoSave:o=!0,focus:v=!1,hotkeys:k={}}){const K=e.useContext(ye.context.i18n),Y=e.useMemo(()=>K||Ee.locale({...Be.en,...Je.en}),[K]),C=e.useMemo(()=>Y.getGroup("gantt"),[Y]),w=Y.getRaw(),f=e.useMemo(()=>{const m=w.gantt?.dateFormat||w.formats?.dateFormat;return Ee.dateToString(m,w.calendar)},[w]),q=e.useMemo(()=>{if(y===!0&&!l){const m=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:C("Delete"),id:"delete"}];return o?{items:m}:{items:[...m,{comp:"button",type:"primary",text:C("Save"),id:"save"}]}}return y},[y,l,o,C]),[H,A]=e.useState(!1),B=e.useMemo(()=>H?"wx-full-screen":"",[H]),T=e.useCallback(m=>{A(m)},[]);e.useEffect(()=>{const m=pt(T);return m.observe(),()=>{m.disconnect()}},[T]);const P=j.useStore(s,"_activeTask"),S=j.useStore(s,"activeTask"),U=j.useStore(s,"unscheduledTasks"),se=j.useStore(s,"links"),Q=j.useStore(s,"splitTasks"),ae=e.useMemo(()=>Q&&S?.segmentIndex,[Q,S]),F=e.useMemo(()=>ae||ae===0,[ae]),ce=e.useMemo(()=>we.getEditorItems({unscheduledTasks:U}),[U]),E=j.useStore(s,"undo"),[x,z]=e.useState({}),[te,ue]=e.useState(null),[ne,ie]=e.useState(),[ke,Re]=e.useState(null),De=j.useStore(s,"taskTypes"),Ce=e.useMemo(()=>{if(!P)return null;let m;if(F&&P.segments?m={...P.segments[ae]}:m={...P},l){let oe={parent:m.parent};return ce.forEach(({key:xe,comp:O})=>{if(O!=="links"){const ve=m[xe];O==="date"&&ve instanceof Date?oe[xe]=f(ve):O==="slider"&&xe==="progress"?oe[xe]=`${ve}%`:oe[xe]=ve}}),oe}return m||null},[P,F,ae,l,ce,f]);e.useEffect(()=>{ie(Ce)},[Ce]),e.useEffect(()=>{z({}),Re(null),ue(null)},[S]);function Le(m,oe){return m.map(xe=>{const O={...xe};if(xe.config&&(O.config={...O.config}),O.comp==="links"&&s&&(O.api=s,O.autoSave=o,O.onLinksChange=p),O.comp==="select"&&O.key==="type"){const ve=O.options??(De||[]);O.options=ve.map(le=>({...le,label:C(le.label)}))}return O.comp==="slider"&&O.key==="progress"&&(O.labelTemplate=ve=>`${C(O.label)} ${ve}%`),O.label&&(O.label=C(O.label)),O.config?.placeholder&&(O.config.placeholder=C(O.config.placeholder)),oe&&(O.isDisabled&&O.isDisabled(oe,s.getState())?O.disabled=!0:delete O.disabled),O})}const pe=e.useMemo(()=>{let m=n.length?n:ce;return m=Le(m,ne),ne?m.filter(oe=>!oe.isHidden||!oe.isHidden(ne,s.getState())):m},[n,ce,ne,De,C,s,o]),ee=e.useMemo(()=>pe.map(m=>m.key),[pe]);function p({id:m,action:oe,data:xe}){z(O=>({...O,[m]:{action:oe,data:xe}}))}const W=e.useCallback(()=>{for(let m in x)if(se.byId(m)){const{action:oe,data:xe}=x[m];s.exec(oe,xe)}},[s,x,se]),V=e.useCallback(()=>{const m=S?.id||S;if(F){if(P?.segments){const oe=P.segments.filter((xe,O)=>O!==ae);s.exec("update-task",{id:m,task:{segments:oe}})}}else s.exec("delete-task",{id:m})},[s,S,F,P,ae]),X=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),G=e.useCallback(m=>{const{item:oe,changes:xe}=m;oe.id==="delete"&&V(),oe.id==="save"&&(xe.length?X():W()),oe.comp&&X()},[s,S,o,W,V,X]),ge=e.useCallback((m,oe,xe)=>(U&&m.type==="summary"&&(m.unscheduled=!1),we.prepareEditTask(m,s.getState(),oe),xe||ue(!1),m),[U,s]),re=e.useCallback(m=>{m={...m,unscheduled:U&&m.unscheduled&&m.type!=="summary"},delete m.links,delete m.data,(ee.indexOf("duration")===-1||m.segments&&!m.duration)&&delete m.duration;const oe={id:S?.id||S,task:m,...F&&{segmentIndex:ae}};o&&te&&(oe.inProgress=te),s.exec("update-task",oe),o||W()},[s,S,U,o,W,ee,F,ae,te]),M=e.useCallback(m=>{let{update:oe,key:xe,input:O}=m;if(O&&ue(!0),m.update=ge({...oe},xe,O),!o)ie(m.update);else if(!ke&&!O){const ve=pe.find(be=>be.key===xe),le=oe[xe];(!ve.validation||ve.validation(le))&&(!ve.required||le)&&re(m.update)}},[o,ge,ke,pe,re]),J=e.useCallback(m=>{o||re(m.values)},[o,re]),de=e.useCallback(m=>{Re(m.errors)},[]),fe=e.useMemo(()=>E?{"ctrl+z":m=>{m.preventDefault(),s.exec("undo")},"ctrl+y":m=>{m.preventDefault(),s.exec("redo")}}:{},[E,s]);return Ce?c.jsx(ye.Locale,{children:c.jsx(ze.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${B} ${r}`,items:pe,values:Ce,topBar:q,bottomBar:h,placement:I,layout:i,readonly:l,autoSave:o,focus:v,onAction:G,onSave:J,onValidation:de,onChange:M,hotkeys:k&&{...fe,...k}})}):null}const as=({children:s,columns:n=null,api:r})=>{const[i,l]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(l)},[r]),c.jsx(wt.HeaderMenu,{api:i,columns:n,children:s})};function us(s){const{api:n,content:r,children:i}=s,l=e.useRef(null),I=e.useRef(null),[h,y]=e.useState({}),[o,v]=e.useState(null),[k,K]=e.useState({});function Y(T){for(;T;){if(T.getAttribute){const P=T.getAttribute("data-tooltip-id"),S=T.getAttribute("data-tooltip-at"),U=T.getAttribute("data-tooltip");if(P||U)return{id:P,tooltip:U,target:T,at:S}}T=T.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const T=I.current;if(T&&k&&(k.text||r)){const P=T.getBoundingClientRect();let S=!1,U=k.left,se=k.top;P.right>=h.right&&(U=h.width-P.width-5,S=!0),P.bottom>=h.bottom&&(se=k.top-(P.bottom-h.bottom+2),S=!0),S&&K(Q=>Q&&{...Q,left:U,top:se})}},[k,h,r]);const C=e.useRef(null),w=300,f=T=>{clearTimeout(C.current),C.current=setTimeout(()=>{T()},w)};function q(T){let{id:P,tooltip:S,target:U,at:se}=Y(T.target);if(K(null),v(null),!S)if(P)S=A(P);else{clearTimeout(C.current);return}const Q=T.clientX;f(()=>{P&&v(H(B(P)));const ae=U.getBoundingClientRect(),F=l.current,ce=F?F.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let E,x;se==="left"?(E=ae.top+5-ce.top,x=ae.right+5-ce.left):(E=ae.top+ae.height-ce.top,x=Q-ce.left),y(ce),K({top:E,left:x,text:S})})}function H(T){return n?.getTask(B(T))||null}function A(T){return H(T)?.text||""}function B(T){const P=parseInt(T);return isNaN(P)?T:P}return c.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:l,onMouseMove:q,children:[k&&(k.text||r)?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:I,style:{top:`${k.top}px`,left:`${k.left}px`},children:r?c.jsx(r,{data:o}):k.text?c.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:k.text}):null}):null,i]})}function ds({fonts:s=!0,children:n}){return n?c.jsx(ye.Material,{fonts:s,children:n()}):c.jsx(ye.Material,{fonts:s})}function fs({fonts:s=!0,children:n}){return n?c.jsx(ye.Willow,{fonts:s,children:n}):c.jsx(ye.Willow,{fonts:s})}function xs({fonts:s=!0,children:n}){return n?c.jsx(ye.WillowDark,{fonts:s,children:n}):c.jsx(ye.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>we.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>we.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>we.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>we.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>we.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>we.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>we.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>we.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>we.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>ze.registerEditorItem});exports.ContextMenu=os;exports.Editor=is;exports.Gantt=ns;exports.HeaderMenu=as;exports.Material=ds;exports.Toolbar=rs;exports.Tooltip=us;exports.Willow=fs;exports.WillowDark=xs;
//# sourceMappingURL=index.cjs.map
