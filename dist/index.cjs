"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("react/jsx-runtime"),e=require("react"),we=require("@svar-ui/react-core"),ke=require("@svar-ui/lib-dom"),qe=require("@svar-ui/gantt-locales"),Ke=require("@svar-ui/core-locales"),ct=require("@svar-ui/lib-state"),fe=require("@svar-ui/gantt-store"),y=require("@svar-ui/lib-react"),nt=require("@svar-ui/grid-store"),rt=require("@svar-ui/react-grid"),it=require("react-dom"),Je=require("@svar-ui/react-toolbar"),at=require("@svar-ui/react-menu"),Ie=require("@svar-ui/react-editor"),De=e.createContext(null);function He(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function ut(s,n,r){const a=s.getBoundingClientRect(),c=n.querySelector(".wx-body").getBoundingClientRect();return{top:a.top-c.top,left:a.left-c.left,dt:a.bottom-r.clientY,db:r.clientY-a.top}}function et(s){return s&&s.getAttribute("data-context-id")}const tt=5;function dt(s,n){let r,a,c,$,l,w,g,k,d;function L(b){$=b.clientX,l=b.clientY,w={...ut(r,s,b),y:n.getTask(c).$y},document.body.style.userSelect="none"}function I(b){r=ke.locate(b),et(r)&&(c=He(r),d=setTimeout(()=>{k=!0,n&&n.touchStart&&n.touchStart(),L(b.touches[0])},500),s.addEventListener("touchmove",H),s.addEventListener("contextmenu",S),window.addEventListener("touchend",K))}function S(b){if(k||d)return b.preventDefault(),!1}function G(b){b.which===1&&(r=ke.locate(b),et(r)&&(c=He(r),s.addEventListener("mousemove",X),window.addEventListener("mouseup",v),L(b)))}function u(b){s.removeEventListener("mousemove",X),s.removeEventListener("touchmove",H),document.body.removeEventListener("mouseup",v),document.body.removeEventListener("touchend",K),document.body.style.userSelect="",b&&(s.removeEventListener("mousedown",G),s.removeEventListener("touchstart",I))}function A(b){const _=b.clientX-$,Z=b.clientY-l;if(!a){if(Math.abs(_)<tt&&Math.abs(Z)<tt||n&&n.start&&n.start({id:c,e:b})===!1)return;a=r.cloneNode(!0),a.style.pointerEvents="none",a.classList.add("wx-reorder-task"),a.style.position="absolute",a.style.left=w.left+"px",a.style.top=w.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(a,r)}if(a){const se=Math.round(Math.max(0,w.top+Z));if(n&&n.move&&n.move({id:c,top:se,detail:g})===!1)return;const Y=n.getTask(c),ne=Y.$y;if(!w.start&&w.y==ne)return P();w.start=!0,w.y=Y.$y-4,a.style.top=se+"px";const E=document.elementFromPoint(b.clientX,b.clientY),M=ke.locate(E);if(M&&M!==r){const h=He(M),W=M.getBoundingClientRect(),B=W.top+W.height/2,J=b.clientY+w.db>B&&M.nextElementSibling!==r,le=b.clientY-w.dt<B&&M.previousElementSibling!==r;g?.after==h||g?.before==h?g=null:J?g={id:c,after:h}:le&&(g={id:c,before:h})}}}function X(b){A(b)}function H(b){k?(b.preventDefault(),A(b.touches[0])):d&&(clearTimeout(d),d=null)}function K(){k=null,d&&(clearTimeout(d),d=null),P()}function v(){P()}function P(){r&&(r.style.visibility=""),a&&(a.parentNode.removeChild(a),n&&n.end&&n.end({id:c,top:w.top})),c=r=a=w=g=null,u()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",G),s.addEventListener("touchstart",I),{destroy(){u(!0)}}}function ft({row:s,column:n}){function r(c,$){return{justifyContent:$.align,paddingLeft:`${(c.$level-1)*20}px`}}const a=n&&n._cell;return o.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?o.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):o.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),o.jsx("div",{className:"wx-pqc08MHU wx-text",children:a?o.jsx(a,{row:s,column:n}):s.text})]})}function st({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?o.jsx("div",{style:{textAlign:s.align},children:o.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function xt(s){const{readonly:n,compactMode:r,width:a=0,display:c="all",columnWidth:$=0,onTableAPIChange:l,multiTaskRows:w=!1,rowMapping:g=null}=s,[k,d]=y.useWritableProp($),[L,I]=e.useState(),S=e.useContext(we.context.i18n),G=e.useMemo(()=>S.getGroup("gantt"),[S]),u=e.useContext(De),A=y.useStore(u,"scrollTop"),X=y.useStore(u,"cellHeight"),H=y.useStore(u,"_scrollTask"),K=y.useStore(u,"_selected"),v=y.useStore(u,"area"),P=y.useStore(u,"_tasks"),b=y.useStore(u,"_scales"),_=y.useStore(u,"columns"),Z=y.useStore(u,"_sort"),se=y.useStore(u,"calendar"),Y=y.useStore(u,"durationUnit"),ne=y.useStore(u,"splitTasks"),[E,M]=e.useState(null),h=e.useMemo(()=>!P||!v?[]:P.slice(v.start,v.end),[P,v]),W=e.useCallback((i,m)=>{if(m==="add-task")u.exec(m,{target:i,task:{text:G("New Task")},mode:"child",show:!0});else if(m==="open-task"){const T=h.find(q=>q.id===i);(T?.data||T?.lazy)&&u.exec(m,{id:i,mode:!T.open})}},[h]),B=e.useCallback(i=>{const m=ke.locateID(i),T=i.target.dataset.action;T&&i.preventDefault(),m?T==="add-task"||T==="open-task"?W(m,T):u.exec("select-task",{id:m,toggle:i.ctrlKey||i.metaKey,range:i.shiftKey,show:!0}):T==="add-task"&&W(null,T)},[u,W]),J=e.useRef(null),le=e.useRef(null),[re,ce]=e.useState(0),[U,p]=e.useState(!1);e.useEffect(()=>{const i=le.current;if(!i||typeof ResizeObserver>"u")return;const m=()=>ce(i.clientWidth);m();const T=new ResizeObserver(m);return T.observe(i),()=>T.disconnect()},[]);const z=e.useRef(null),O=e.useCallback(i=>{const m=i.id,{before:T,after:q}=i,he=i.onMove;let de=T||q,ve=T?"before":"after";if(he){if(ve==="after"){const Le=u.getTask(de);Le.data?.length&&Le.open&&(ve="before",de=Le.data[0].id)}z.current={id:m,[ve]:de}}else z.current=null;u.exec("move-task",{id:m,mode:ve,target:de,inProgress:he})},[u]),F=e.useMemo(()=>v?.from??0,[v]),Q=e.useMemo(()=>b?.height??0,[b]),xe=e.useMemo(()=>!r&&c!=="grid"?(k??0)>(a??0):(k??0)>(re??0),[r,c,k,a,re]),ie=e.useMemo(()=>{const i={};return xe&&c==="all"||c==="grid"&&xe?i.width=k:c==="grid"&&(i.width="100%"),i},[xe,c,k]),R=e.useMemo(()=>E&&!h.find(i=>i.id===E.id)?[...h,E]:h,[h,E]),ee=e.useMemo(()=>{if(!w||!g)return R;const i=new Map,m=new Set;return R.forEach(T=>{const q=g.taskRows.get(T.id)??T.id;m.has(q)||(i.set(q,{...T,$rowTasks:g.rowMap.get(q)||[T.id]}),m.add(q))}),Array.from(i.values())},[R,w,g]),me=e.useMemo(()=>{let i=(_||[]).map(q=>{q={...q};const he=q.header;if(typeof he=="object"){const de=he.text&&G(he.text);q.header={...he,text:de}}else q.header=G(he);return q});const m=i.findIndex(q=>q.id==="text"),T=i.findIndex(q=>q.id==="add-task");if(m!==-1&&(i[m].cell&&(i[m]._cell=i[m].cell),i[m].cell=ft),T!==-1){i[T].cell=i[T].cell||st;const q=i[T].header;if(typeof q!="object"&&(i[T].header={text:q}),i[T].header.cell=q.cell||st,n)i.splice(T,1);else if(r){const[he]=i.splice(T,1);i.unshift(he)}}return i.length>0&&(i[i.length-1].resize=!1),i},[_,G,n,r]),ye=e.useMemo(()=>c==="all"?`${a}px`:c==="grid"?"calc(100% - 4px)":me.find(i=>i.id==="add-task")?"50px":"0",[c,a,me]),Te=e.useMemo(()=>{if(ee&&Z?.length){const i={};return Z.forEach(({key:m,order:T},q)=>{i[m]={order:T,...Z.length>1&&{index:q}}}),i}return{}},[ee,Z]),Me=e.useCallback(()=>me.some(i=>i.flexgrow&&!i.hidden),[]),je=e.useMemo(()=>Me(),[Me,U]),Ee=e.useMemo(()=>{let i=c==="chart"?me.filter(T=>T.id==="add-task"):me;const m=c==="all"?a:re;if(!je){let T=k,q=!1;if(me.some(he=>he.$width)){let he=0;T=me.reduce((de,ve)=>(ve.hidden||(he+=ve.width,de+=ve.$width||ve.width),de),0),he>T&&T>m&&(q=!0)}if(q||T<m){let he=1;return q||(he=(m-50)/(T-50||1)),i.map(de=>(de.id!=="add-task"&&!de.hidden&&(de.$width||(de.$width=de.width),de.width=de.$width*he),de))}}return i},[c,me,je,k,a,re]),ae=e.useCallback(i=>{if(!Me()){const m=Ee.reduce((T,q)=>(i&&q.$width&&(q.$width=q.width),T+(q.hidden?0:q.width)),0);m!==k&&d(m)}p(!0),p(!1)},[Me,Ee,k,d]),f=e.useCallback(()=>{me.filter(m=>m.flexgrow&&!m.hidden).length===1&&me.forEach(m=>{m.$width&&!m.flexgrow&&!m.hidden&&(m.width=m.$width)})},[]),V=e.useCallback(i=>{if(!n){const m=ke.locateID(i),T=ke.locateAttr(i,"data-col-id");!(T&&me.find(he=>he.id==T))?.editor&&m&&u.exec("show-editor",{id:m})}},[u,n]),ue=e.useMemo(()=>Array.isArray(K)?K.map(i=>i.id):[],[K]),j=e.useCallback(()=>{if(J.current&&ee!==null){const i=J.current.querySelector(".wx-body");i&&(i.style.top=-((A??0)-(F??0))+"px")}le.current&&(le.current.scrollTop=0)},[ee,A,F]);e.useEffect(()=>{J.current&&j()},[A,F,j]),e.useEffect(()=>{const i=J.current;if(!i)return;const m=i.querySelector(".wx-table-box .wx-body");if(!m||typeof ResizeObserver>"u")return;const T=new ResizeObserver(()=>{j()});return T.observe(m),()=>{T.disconnect()}},[Ee,ie,c,ye,ee,j]),e.useEffect(()=>{if(!H||!L)return;const{id:i}=H,m=L.getState().focusCell;m&&m.row!==i&&J.current&&J.current.contains(document.activeElement)&&L.exec("focus-cell",{row:i,column:m.column})},[H,L]);const pe=e.useCallback(({id:i})=>{if(n)return!1;u.getTask(i).open&&u.exec("open-task",{id:i,mode:!1});const m=u.getState()._tasks.find(T=>T.id===i);if(M(m||null),!m)return!1},[u,n]),$e=e.useCallback(({id:i,top:m})=>{z.current?O({...z.current,onMove:!1}):u.exec("drag-task",{id:i,top:m+(F??0),inProgress:!1}),M(null)},[u,O,F]),ze=e.useCallback(({id:i,top:m,detail:T})=>{T&&O({...T,onMove:!0}),u.exec("drag-task",{id:i,top:m+(F??0),inProgress:!0})},[u,O,F]);e.useEffect(()=>{const i=J.current;return i?dt(i,{start:pe,end:$e,move:ze,getTask:u.getTask}).destroy:void 0},[u,pe,$e,ze]);const Pe=e.useCallback(i=>{const{key:m,isInput:T}=i;if(!T&&(m==="arrowup"||m==="arrowdown"))return i.eventSource="grid",u.exec("hotkey",i),!1;if(m==="enter"){const q=L?.getState().focusCell;if(q){const{row:he,column:de}=q;de==="add-task"?W(he,"add-task"):de==="text"&&W(he,"open-task")}}},[u,W,L]),Re=e.useRef(null),Ge=()=>{Re.current={setTableAPI:I,handleHotkey:Pe,sortVal:Z,api:u,adjustColumns:f,setColumnWidth:ae,tasks:h,calendarVal:se,durationUnitVal:Y,splitTasksVal:ne,onTableAPIChange:l}};Ge(),e.useEffect(()=>{Ge()},[I,Pe,Z,u,f,ae,h,se,Y,ne,l]);const Ye=e.useCallback(i=>{I(i),i.intercept("hotkey",m=>Re.current.handleHotkey(m)),i.intercept("scroll",()=>!1),i.intercept("select-row",()=>!1),i.intercept("sort-rows",m=>{const T=Re.current.sortVal,{key:q,add:he}=m,de=T?T.find(Le=>Le.key===q):null;let ve="asc";return de&&(ve=!de||de.order==="asc"?"desc":"asc"),u.exec("sort-tasks",{key:q,order:ve,add:he}),!1}),i.on("resize-column",()=>{Re.current.setColumnWidth(!0)}),i.on("hide-column",m=>{m.mode||Re.current.adjustColumns(),Re.current.setColumnWidth()}),i.intercept("update-cell",m=>{const{id:T,column:q,value:he}=m,de=Re.current.tasks.find(ve=>ve.id===T);if(de){const ve={...de};let Le=he;Le&&!isNaN(Le)&&!(Le instanceof Date)&&(Le*=1),ve[q]=Le,fe.prepareEditTask(ve,{calendar:Re.current.calendarVal,durationUnit:Re.current.durationUnitVal,splitTasks:Re.current.splitTasksVal},q),u.exec("update-task",{id:T,task:ve})}return!1}),l&&l(i)},[]);return o.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ye}`},ref:le,children:o.jsx("div",{ref:J,style:ie,className:"wx-rHj6070p wx-table",onClick:B,onDoubleClick:V,children:o.jsx(rt.Grid,{init:Ye,sizes:{rowHeight:X,headerHeight:(Q??0)-1},rowStyle:i=>i.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:i=>`wx-rHj6070p wx-text-${i.align}${i.id==="add-task"?" wx-action":""}`,data:ee,columns:Ee,selectedRows:[...ue],sortMarks:Te})})})}function mt({borders:s=""}){const n=e.useContext(De),r=y.useStore(n,"cellWidth"),a=y.useStore(n,"cellHeight"),c=e.useRef(null),[$,l]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&c.current){const g=getComputedStyle(c.current).getPropertyValue("--wx-gantt-border");l(g?g.substring(g.indexOf("#")):"#1d1e261a")}},[]);const w={width:"100%",height:"100%",background:r!=null&&a!=null?`url(${fe.grid(r,a,$,s)})`:void 0,position:"absolute"};return o.jsx("div",{ref:c,style:w})}function ht({onSelectLink:s,selectedLink:n,readonly:r}){const a=e.useContext(De),c=y.useStore(a,"_links"),$=y.useStore(a,"criticalPath"),l=e.useRef(null),w=e.useCallback(g=>{const k=g?.target?.classList;!k?.contains("wx-line")&&!k?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&l.current){const g=k=>{l.current&&!l.current.contains(k.target)&&w(k)};return document.addEventListener("click",g),()=>{document.removeEventListener("click",g)}}},[r,n,w]),o.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(c||[]).map(g=>{const k="wx-dkx3NwEn wx-line"+($&&g.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return o.jsx("polyline",{className:k,points:g.$p,onClick:()=>!r&&s(g.id),"data-link-id":g.id},g.id)}),!r&&n&&o.jsx("polyline",{ref:l,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function gt(s){const{task:n,type:r}=s;function a($){const l=n.segments[$];return{left:`${l.$x}px`,top:"0px",width:`${l.$w}px`,height:"100%"}}function c($){if(!n.progress)return 0;const l=n.duration*n.progress/100,w=n.segments;let g=0,k=0,d=null;do{const L=w[k];k===$&&(g>l?d=0:d=Math.min((l-g)/L.duration,1)*100),g+=L.duration,k++}while(d===null&&k<w.length);return d||0}return o.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map(($,l)=>o.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":l,style:a(l),children:[n.progress?o.jsx("div",{className:"wx-progress-wrapper",children:o.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${c(l)}%`}})}):null,o.jsx("div",{className:"wx-content",children:$.text||""})]},l))})}function wt(s){const{readonly:n,taskTemplate:r,multiTaskRows:a=!1,rowMapping:c=null,marqueeSelect:$=!1}=s,l=e.useContext(De),[w,g]=y.useStoreWithCounter(l,"_tasks"),[k,d]=y.useStoreWithCounter(l,"_links"),L=y.useStore(l,"area"),I=y.useStore(l,"_scales"),S=y.useStore(l,"taskTypes"),G=y.useStore(l,"baselines"),[u,A]=y.useStoreWithCounter(l,"_selected"),X=y.useStore(l,"_scrollTask"),H=y.useStore(l,"criticalPath"),K=y.useStore(l,"tasks"),v=y.useStore(l,"schedule"),P=y.useStore(l,"splitTasks"),b=e.useMemo(()=>{if(!L||!Array.isArray(w))return[];const t=L.start??0,x=L.end??0;return w.slice(t,x).map(C=>({...C}))},[g,L]),_=y.useStore(l,"cellHeight"),Z=e.useMemo(()=>{if(!a||!c||!b.length)return b;const t=new Map,x=[];return w.forEach(C=>{const N=c.taskRows.get(C.id)??C.id;t.has(N)||(t.set(N,x.length),x.push(N))}),b.map(C=>{const N=c.taskRows.get(C.id)??C.id,D=t.get(N)??0;return{...C,$y:D*_,$y_base:C.$y_base!==void 0?D*_:void 0}})},[b,a,c,w,_]),se=e.useMemo(()=>I.lengthUnitWidth,[I]),Y=e.useMemo(()=>I.lengthUnit||"day",[I]),ne=e.useRef(!1),[E,M]=e.useState(void 0),[h,W]=e.useState(null),B=e.useRef(null),[J,le]=e.useState(null),[re,ce]=e.useState(void 0),U=e.useRef(null),[p,z]=e.useState(0),[O,F]=e.useState(null),[Q,xe]=e.useState(null),ie=e.useRef(null),R=e.useMemo(()=>{const t=ie.current;return!!(u.length&&t&&t.contains(document.activeElement))},[u,ie.current]),ee=e.useMemo(()=>R&&u[u.length-1]?.id,[R,u]);e.useEffect(()=>{if(X&&R&&X){const{id:t}=X,x=ie.current?.querySelector(`.wx-bar[data-id='${t}']`);x&&x.focus({preventScroll:!0})}},[X]),e.useEffect(()=>{const t=ie.current;if(t&&(z(t.offsetWidth||0),typeof ResizeObserver<"u")){const x=new ResizeObserver(C=>{C[0]&&z(C[0].contentRect.width)});return x.observe(t),()=>x.disconnect()}},[ie.current]);const me=e.useCallback(()=>{document.body.style.userSelect="none"},[]),ye=e.useCallback(()=>{document.body.style.userSelect=""},[]),Te=e.useCallback((t,x,C)=>{if(x.target.classList.contains("wx-line")||(C||(C=l.getTask(He(t))),C.type==="milestone"||C.type==="summary"))return"";const N=ke.locate(x,"data-segment");N&&(t=N);const{left:D,width:te}=t.getBoundingClientRect(),oe=(x.clientX-D)/te;let be=.2/(te>200?te/200:1);return oe<be?"start":oe>1-be?"end":""},[l]),Me=e.useMemo(()=>{const t=new Map;if(!a||!c)return w.forEach(N=>{t.set(N.id,N.$y)}),t;const x=new Map,C=[];return w.forEach(N=>{const D=c.taskRows.get(N.id)??N.id;x.has(D)||(x.set(D,C.length),C.push(D))}),w.forEach(N=>{const D=c.taskRows.get(N.id)??N.id,te=x.get(D)??0;t.set(N.id,te*_)}),t},[w,a,c,_]),je=e.useCallback(t=>{const x=ie.current;if(!x)return[];const C=x.parentElement?.scrollLeft||0,N=x.parentElement?.parentElement?.scrollTop||0,D=Math.min(t.startX,t.currentX),te=Math.max(t.startX,t.currentX),oe=Math.min(t.startY,t.currentY),be=Math.max(t.startY,t.currentY);return w.filter(ge=>{const Se=ge.$x-C,Ne=ge.$x+ge.$w-C,Ae=(Me.get(ge.id)??ge.$y)-N,Ce=Ae+ge.$h;return Se<te&&Ne>D&&Ae<be&&Ce>oe})},[w,Me]),Ee=e.useMemo(()=>new Set(u.map(t=>t.id)),[u,A]),ae=e.useCallback(t=>Ee.has(t),[Ee]),f=e.useCallback((t,x)=>{const{clientX:C}=x,N=He(t),D=l.getTask(N),te=x.target.classList;if(!x.target.closest(".wx-delete-button")&&!n){if(te.contains("wx-progress-marker")){const{progress:oe}=l.getTask(N);B.current={id:N,x:C,progress:oe,dx:0,node:t,marker:x.target},x.target.classList.add("wx-progress-in-drag")}else{const oe=Te(t,x,D)||"move",be={id:N,mode:oe,x:C,dx:0,l:D.$x,w:D.$w};if(P&&D.segments?.length){const ge=ke.locate(x,"data-segment");ge&&(be.segmentIndex=ge.dataset.segment*1,fe.extendDragOptions(D,be))}W(be)}me()}},[l,n,Te,me,P]),V=e.useCallback(t=>{if(t.button!==0)return;const x=ke.locate(t);if(!x&&$&&!n){const C=ie.current;if(!C)return;const N=C.getBoundingClientRect(),D=t.clientX-N.left,te=t.clientY-N.top;F({startX:D,startY:te,currentX:D,currentY:te,ctrlKey:t.ctrlKey||t.metaKey}),me();return}if(x){if($&&!n&&u.length>1){const C=He(x);if(ae(C)){const N=t.target.classList;if(!N.contains("wx-link")&&!N.contains("wx-progress-marker")&&!t.target.closest(".wx-delete-button")){const D=l.getTask(C);if(!Te(x,t,D)){const oe=new Map;u.forEach(be=>{const ge=l.getTask(be.id);if(ge){if(v?.auto&&ge.type==="summary")return;oe.set(be.id,{$x:ge.$x,$w:ge.$w,start:ge.start,end:ge.end})}}),xe({baseTaskId:C,startX:t.clientX,dx:0,originalPositions:oe}),me();return}}}}f(x,t)}},[f,$,n,u,ae,l,Te,v,me]),ue=e.useCallback(t=>{const x=ke.locate(t);x&&(U.current=setTimeout(()=>{ce(!0),f(x,t.touches[0])},300))},[f]),j=e.useCallback(t=>{le(t&&{...k.find(x=>x.id===t)})},[k]),pe=e.useCallback(()=>{if(O){const t=je(O);O.ctrlKey?t.forEach(x=>{l.exec("select-task",{id:x.id,toggle:!0,marquee:!0})}):(u.length>0&&l.exec("select-task",{id:null,marquee:!0}),t.forEach((x,C)=>{l.exec("select-task",{id:x.id,toggle:C>0,marquee:!0})})),F(null),ye(),ne.current=!0;return}if(Q){const{dx:t,originalPositions:x}=Q,C=Math.round(t/se);if(C!==0){let N=!0;x.forEach((D,te)=>{const oe=l.getTask(te);oe&&(l.exec("update-task",{id:te,diff:C,task:{start:oe.start,end:oe.end},skipUndo:!N}),N=!1)}),ne.current=!0}else x.forEach((N,D)=>{l.exec("drag-task",{id:D,left:N.$x,width:N.$w,inProgress:!1})});xe(null),ye();return}if(B.current){const{dx:t,id:x,marker:C,value:N}=B.current;B.current=null,typeof N<"u"&&t&&l.exec("update-task",{id:x,task:{progress:N},inProgress:!1}),C.classList.remove("wx-progress-in-drag"),ne.current=!0,ye()}else if(h){const{id:t,mode:x,dx:C,l:N,w:D,start:te,segment:oe,index:be}=h;if(W(null),te){const ge=Math.round(C/se);if(!ge)l.exec("drag-task",{id:t,width:D,left:N,inProgress:!1,...oe&&{segmentIndex:be}});else{let Se={},Ne=l.getTask(t);oe&&(Ne=Ne.segments[be]);const We=1440*60*1e3,Ce=ge*(Y==="week"?7:Y==="month"?30:Y==="quarter"?91:Y==="year"?365:1)*We;x==="move"?(Se.start=new Date(Ne.start.getTime()+Ce),Se.end=new Date(Ne.end.getTime()+Ce)):x==="start"?(Se.start=new Date(Ne.start.getTime()+Ce),Se.end=Ne.end):x==="end"&&(Se.start=Ne.start,Se.end=new Date(Ne.end.getTime()+Ce)),l.exec("update-task",{id:t,task:Se,...oe&&{segmentIndex:be}})}ne.current=!0}ye()}},[l,ye,h,se,Y,O,Q,je,u]),$e=e.useCallback((t,x)=>{const{clientX:C,clientY:N}=x;if(!n){if(O){const D=ie.current;if(!D)return;const te=D.getBoundingClientRect(),oe=C-te.left,be=N-te.top;F(ge=>({...ge,currentX:oe,currentY:be}));return}if(Q){const D=C-Q.startX;Q.originalPositions.forEach((te,oe)=>{const be=te.$x+D;l.exec("drag-task",{id:oe,left:be,width:te.$w,inProgress:!0})}),xe(te=>({...te,dx:D}));return}if(B.current){const{node:D,x:te,id:oe}=B.current,be=B.current.dx=C-te,ge=Math.round(be/D.offsetWidth*100);let Se=B.current.progress+ge;B.current.value=Se=Math.min(Math.max(0,Se),100),l.exec("update-task",{id:oe,task:{progress:Se},inProgress:!0})}else if(h){j(null);const{mode:D,l:te,w:oe,x:be,id:ge,start:Se,segment:Ne,index:We}=h,Ae=l.getTask(ge),Ce=C-be;if(!Se&&Math.abs(Ce)<20||D==="start"&&oe-Ce<se||D==="end"&&oe+Ce<se||D==="move"&&(Ce<0&&te+Ce<0||Ce>0&&te+oe+Ce>p)||h.segment&&!fe.isSegmentMoveAllowed(Ae,h))return;const Xe={...h,dx:Ce};let _e,Oe;if(D==="start"?(_e=te+Ce,Oe=oe-Ce):D==="end"?(_e=te,Oe=oe+Ce):D==="move"&&(_e=te+Ce,Oe=oe),l.exec("drag-task",{id:ge,width:Oe,left:_e,inProgress:!0,...Ne&&{segmentIndex:We}}),!Xe.start&&(D==="move"&&Ae.$x==te||D!=="move"&&Ae.$w==oe)){ne.current=!0,pe();return}Xe.start=!0,W(Xe)}else{const D=ke.locate(t);if(D){const te=l.getTask(He(D)),be=ke.locate(t,"data-segment")||D,ge=Te(be,x,te);be.style.cursor=ge&&!n?"col-resize":"pointer"}}}},[l,n,h,se,p,Te,j,pe,O,Q]),ze=e.useCallback(t=>{$e(t,t)},[$e]),Pe=e.useCallback(t=>{re?(t.preventDefault(),$e(t,t.touches[0])):U.current&&(clearTimeout(U.current),U.current=null)},[re,$e]),Re=e.useCallback(()=>{pe()},[pe]),Ge=e.useCallback(()=>{ce(null),U.current&&(clearTimeout(U.current),U.current=null),pe()},[pe]);e.useEffect(()=>(window.addEventListener("mouseup",Re),()=>{window.removeEventListener("mouseup",Re)}),[Re]);const Ye=e.useCallback(t=>{if(!n){const x=ke.locateID(t.target);if(x&&!t.target.classList.contains("wx-link")){const C=ke.locateID(t.target,"data-segment");l.exec("show-editor",{id:x,...C!==null&&{segmentIndex:C}})}}},[l,n]),i=["e2s","s2s","e2e","s2e"],m=e.useCallback((t,x)=>i[(t?1:0)+(x?0:2)],[]),T=e.useCallback((t,x)=>{const C=E.id,N=E.start;return t===C?!0:!!k.find(D=>D.target==t&&D.source==C&&D.type===m(N,x))},[E,d,m]),q=e.useCallback(()=>{E&&M(null)},[E]),he=e.useCallback(t=>{if(ne.current){ne.current=!1;return}const x=ke.locateID(t.target);if(x){const C=t.target.classList;if(C.contains("wx-link")){const N=C.contains("wx-left");if(!E){M({id:x,start:N});return}E.id!==x&&!T(x,N)&&l.exec("add-link",{link:{source:E.id,target:x,type:m(E.start,N)}})}else if(C.contains("wx-delete-button-icon"))l.exec("delete-link",{id:J.id}),le(null);else{let N;const D=ke.locate(t,"data-segment");D&&(N=D.dataset.segment*1),l.exec("select-task",{id:x,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:N})}}q()},[l,E,d,J,T,m,q]),de=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),ve=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),Le=e.useCallback(t=>{if(re||U.current)return t.preventDefault(),!1},[re]),Ve=e.useMemo(()=>S.map(t=>t.id),[S]),Be=e.useCallback(t=>{let x=Ve.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(x=`task ${x}`),x},[Ve]),Ue=e.useCallback(t=>{l.exec(t.action,t.data)},[l]),Fe=e.useCallback(t=>H&&K.byId(t).$critical,[H,K]),Qe=e.useCallback(t=>{if(v?.auto){const x=K.getSummaryId(t,!0),C=K.getSummaryId(E.id,!0);return E?.id&&!(Array.isArray(x)?x:[x]).includes(E.id)&&!(Array.isArray(C)?C:[C]).includes(t)}return E},[v,K,E]),Ze=e.useMemo(()=>{if(!O)return null;const t=Math.min(O.startX,O.currentX),x=Math.min(O.startY,O.currentY),C=Math.abs(O.currentX-O.startX),N=Math.abs(O.currentY-O.startY);return{left:`${t}px`,top:`${x}px`,width:`${C}px`,height:`${N}px`}},[O]);return o.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${Z.length?Z[0].$h:0}px`},ref:ie,onContextMenu:Le,onMouseDown:V,onMouseMove:ze,onTouchStart:ue,onTouchMove:Pe,onTouchEnd:Ge,onClick:he,onDoubleClick:Ye,onDragStart:t=>(t.preventDefault(),!1),children:[o.jsx(ht,{onSelectLink:j,selectedLink:J,readonly:n}),Z.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const x=`wx-bar wx-${Be(t.type)}`+(re&&h&&t.id===h.id?" wx-touch":"")+(E&&E.id===t.id?" wx-selected":"")+(Ee.has(t.id)?" wx-selected":"")+(Fe(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(P&&t.segments?" wx-split":""),C="wx-link wx-left"+(E?" wx-visible":"")+(!E||!T(t.id,!0)&&Qe(t.id)?" wx-target":"")+(E&&E.id===t.id&&E.start?" wx-selected":"")+(Fe(t.id)?" wx-critical":""),N="wx-link wx-right"+(E?" wx-visible":"")+(!E||!T(t.id,!1)&&Qe(t.id)?" wx-target":"")+(E&&E.id===t.id&&!E.start?" wx-selected":"")+(Fe(t.id)?" wx-critical":"");return o.jsxs(e.Fragment,{children:[!t.$skip&&o.jsxs("div",{className:"wx-GKbcLEGA "+x,style:de(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:ee===t.id?0:-1,children:[n?null:t.id===J?.target&&J?.type[2]==="s"?o.jsx(we.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:o.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):o.jsx("div",{className:"wx-GKbcLEGA "+C,children:o.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?o.jsxs(o.Fragment,{children:[t.progress&&!(P&&t.segments)?o.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:o.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(P&&t.segments)?o.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?o.jsx(r,{data:t,api:l,onAction:Ue}):P&&t.segments?o.jsx(gt,{task:t,type:Be(t.type)}):o.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?o.jsx(r,{data:t,api:l,onAction:Ue}):o.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===J?.target&&J?.type[2]==="e"?o.jsx(we.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:o.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):o.jsx("div",{className:"wx-GKbcLEGA "+N,children:o.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),G&&!t.$skip_baseline?o.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:ve(t)}):null]},t.id)}),O&&Ze&&o.jsx("div",{className:"wx-GKbcLEGA wx-marquee-selection",style:Ze})]})}function pt(s){const{highlightTime:n}=s,r=e.useContext(De),a=y.useStore(r,"_scales");return o.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:a.width},children:(a?.rows||[]).map((c,$)=>o.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${c.height}px`},children:(c.cells||[]).map((l,w)=>{const g=n?n(l.date,l.unit):"",k="wx-cell "+(l.css||"")+" "+(g||"");return o.jsx("div",{className:"wx-ZkvhDKir "+k,style:{width:`${l.width}px`},children:l.value},w)})},$))})}const bt=new Map;function kt(s){const n=e.useRef(null),r=e.useRef(0),a=e.useRef(null),c=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(c)return cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{const $={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};bt.set(s,$),window.dispatchEvent(new CustomEvent("render-metric",{detail:$}))}),()=>cancelAnimationFrame(a.current)})}function yt(s){const{readonly:n,fullWidth:r,fullHeight:a,taskTemplate:c,cellBorders:$,highlightTime:l,multiTaskRows:w=!1,rowMapping:g=null,marqueeSelect:k=!1}=s,d=e.useContext(De),[L,I]=y.useStoreWithCounter(d,"_selected"),S=y.useStore(d,"scrollTop"),G=y.useStore(d,"cellHeight"),u=y.useStore(d,"cellWidth"),A=y.useStore(d,"_scales"),X=y.useStore(d,"_markers"),H=y.useStore(d,"_scrollTask"),K=y.useStore(d,"zoom"),v=y.useStore(d,"_tasks"),[P,b]=e.useState(),_=e.useRef(null),Z=e.useRef(0),se=1+(A?.rows?.length||0),Y=e.useMemo(()=>{if(!w||!g||!v?.length)return null;const p=new Map,z=new Map,O=[];return v.forEach(F=>{const Q=g.taskRows.get(F.id)??F.id;z.has(Q)||(z.set(Q,O.length),O.push(Q))}),v.forEach(F=>{const Q=g.taskRows.get(F.id)??F.id,xe=z.get(Q)??0;p.set(F.id,xe*G)}),p},[v,w,g,G]),ne=e.useMemo(()=>{const p=[];return L&&L.length&&G&&L.forEach(z=>{const O=Y?.get(z.id)??z.$y;p.push({height:`${G}px`,top:`${O-3}px`})}),p},[I,G,Y]),E=e.useMemo(()=>Math.max(P||0,a),[P,a]);e.useEffect(()=>{const p=_.current;p&&typeof S=="number"&&(p.scrollTop=S)},[S]);const M=()=>{h()};function h(p){const z=_.current;if(!z)return;const O={};O.left=z.scrollLeft,d.exec("scroll-chart",O)}function W(){const p=_.current,O=Math.ceil((P||0)/(G||1))+1,F=Math.floor((p&&p.scrollTop||0)/(G||1)),Q=Math.max(0,F-se),xe=F+O+se,ie=Q*(G||0);d.exec("render-data",{start:Q,end:xe,from:ie})}e.useEffect(()=>{W()},[P,S]);const B=e.useCallback(p=>{if(!p)return;const{id:z,mode:O}=p;if(O.toString().indexOf("x")<0)return;const F=_.current;if(!F)return;const{clientWidth:Q}=F,xe=d.getTask(z);if(xe.$x+xe.$w<F.scrollLeft)d.exec("scroll-chart",{left:xe.$x-(u||0)}),F.scrollLeft=xe.$x-(u||0);else if(xe.$x>=Q+F.scrollLeft){const ie=Q<xe.$w?u||0:xe.$w;d.exec("scroll-chart",{left:xe.$x-Q+ie}),F.scrollLeft=xe.$x-Q+ie}},[d,u]);e.useEffect(()=>{B(H)},[H]);function J(p){if(K&&(p.ctrlKey||p.metaKey)){p.preventDefault();const z=_.current,O=p.clientX-(z?z.getBoundingClientRect().left:0);if(Z.current+=p.deltaY,Math.abs(Z.current)>=150){const Q=-Math.sign(Z.current);Z.current=0,d.exec("zoom-scale",{dir:Q,offset:O})}}}function le(p){const z=l(p.date,p.unit);return z?{css:z,width:p.width}:null}const re=e.useMemo(()=>A&&(A.minUnit==="hour"||A.minUnit==="day")&&l?A.rows[A.rows.length-1].cells.map(le):null,[A,l]),ce=e.useCallback(p=>{p.eventSource="chart",d.exec("hotkey",p)},[d]);e.useEffect(()=>{const p=_.current;if(!p)return;const z=()=>b(p.clientHeight);z();const O=new ResizeObserver(()=>z());return O.observe(p),()=>{O.disconnect()}},[_.current]);const U=e.useRef(null);return e.useEffect(()=>{const p=_.current;if(p&&!U.current)return U.current=nt.hotkeys(p,{keys:{arrowup:!0,arrowdown:!0},exec:z=>ce(z)}),()=>{U.current?.destroy(),U.current=null}},[]),e.useEffect(()=>{const p=_.current;if(!p)return;const z=J;return p.addEventListener("wheel",z),()=>{p.removeEventListener("wheel",z)}},[J]),kt("chart"),o.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:_,onScroll:M,children:[o.jsx(pt,{highlightTime:l,scales:A}),X&&X.length?o.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${E}px`},children:X.map((p,z)=>o.jsx("div",{className:`wx-mR7v2Xag wx-marker ${p.css||""}`,style:{left:`${p.left}px`},children:o.jsx("div",{className:"wx-mR7v2Xag wx-content",children:p.text})},z))}):null,o.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${E}px`},children:[re?o.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:re.map((p,z)=>p?o.jsx("div",{className:"wx-mR7v2Xag "+p.css,style:{width:`${p.width}px`,left:`${z*p.width}px`}},z):null)}):null,o.jsx(mt,{borders:$}),L&&L.length?L.map((p,z)=>p.$y?o.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":p.id,style:ne[z]},p.id):null):null,o.jsx(wt,{readonly:n,taskTemplate:c,multiTaskRows:w,rowMapping:g,marqueeSelect:k})]})]})}function vt(s){const{position:n="after",size:r=4,dir:a="x",onMove:c,onDisplayChange:$,compactMode:l,containerWidth:w=0,leftThreshold:g=50,rightThreshold:k=50}=s,[d,L]=y.useWritableProp(s.value??0),[I,S]=y.useWritableProp(s.display??"all");function G(le){let re=0;n=="center"?re=r/2:n=="before"&&(re=r);const ce={size:[r+"px","auto"],p:[le-re+"px","0px"],p2:["auto","0px"]};if(a!="x")for(let U in ce)ce[U]=ce[U].reverse();return ce}const[u,A]=e.useState(!1),[X,H]=e.useState(null),K=e.useRef(0),v=e.useRef(),P=e.useRef(),b=e.useRef(I);e.useEffect(()=>{b.current=I},[I]),e.useEffect(()=>{X===null&&d>0&&H(d)},[X,d]);function _(le){return a=="x"?le.clientX:le.clientY}const Z=e.useCallback(le=>{const re=v.current+_(le)-K.current;L(re);let ce;re<=g?ce="chart":w-re<=k?ce="grid":ce="all",b.current!==ce&&(S(ce),b.current=ce),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>c&&c(re),100)},[w,g,k,c]),se=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",A(!1),window.removeEventListener("mousemove",Z),window.removeEventListener("mouseup",se)},[Z]),Y=e.useMemo(()=>I!=="all"?"auto":a=="x"?"ew-resize":"ns-resize",[I,a]),ne=e.useCallback(le=>{!l&&(I==="grid"||I==="chart")||(K.current=_(le),v.current=d,A(!0),document.body.style.cursor=Y,document.body.style.userSelect="none",window.addEventListener("mousemove",Z),window.addEventListener("mouseup",se))},[Y,Z,se,d,l,I]);function E(){S("all"),X!==null&&(L(X),c&&c(X))}function M(le){if(l){const re=I==="chart"?"grid":"chart";S(re),$(re)}else if(I==="grid"||I==="chart")E(),$("all");else{const re=le==="left"?"chart":"grid";S(re),$(re)}}function h(){M("left")}function W(){M("right")}const B=e.useMemo(()=>G(d),[d,n,r,a]),J=["wx-resizer",`wx-resizer-${a}`,`wx-resizer-display-${I}`,u?"wx-resizer-active":""].filter(Boolean).join(" ");return o.jsxs("div",{className:"wx-pFykzMlT "+J,onMouseDown:ne,style:{width:B.size[0],height:B.size[1],cursor:Y},children:[o.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[o.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:o.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:h})}),o.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:o.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:W})})]}),o.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const Tt=650;function ot(s){let n;function r(){n=new ResizeObserver(c=>{for(let $ of c)if($.target===document.body){let l=$.contentRect.width<=Tt;s(l)}}),n.observe(document.body)}function a(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:a}}function Ct(s){const{taskTemplate:n,readonly:r,cellBorders:a,highlightTime:c,onTableAPIChange:$,multiTaskRows:l=!1,rowMapping:w=null,marqueeSelect:g=!1}=s,k=e.useContext(De),d=y.useStore(k,"_tasks"),L=y.useStore(k,"_scales"),I=y.useStore(k,"cellHeight"),S=y.useStore(k,"columns"),G=y.useStore(k,"_scrollTask"),u=y.useStore(k,"undo"),[A,X]=e.useState(!1);let[H,K]=e.useState(0);const[v,P]=e.useState(0),[b,_]=e.useState(0),[Z,se]=e.useState(void 0),[Y,ne]=e.useState("all"),E=e.useRef(null),M=e.useCallback(R=>{X(ee=>(R!==ee&&(R?(E.current=Y,Y==="all"&&ne("grid")):(!E.current||E.current==="all")&&ne("all")),R))},[Y]);e.useEffect(()=>{const R=ot(M);return R.observe(),()=>{R.disconnect()}},[M]);const h=e.useMemo(()=>{let R;return S.every(ee=>ee.width&&!ee.flexgrow)?R=S.reduce((ee,me)=>ee+parseInt(me.width),0):A&&Y==="chart"?R=parseInt(S.find(ee=>ee.id==="action")?.width)||50:R=440,H=R,R},[S,A,Y]);e.useEffect(()=>{K(h)},[h]);const W=e.useMemo(()=>(v??0)-(Z??0),[v,Z]),B=e.useMemo(()=>L.width,[L]),J=e.useMemo(()=>{if(!l||!w)return d.length*I;const R=new Set;return d.forEach(ee=>{const me=w.taskRows.get(ee.id)??ee.id;R.add(me)}),R.size*I},[d,I,l,w]),le=e.useMemo(()=>L.height+J+W,[L,J,W]),re=e.useMemo(()=>H+B,[H,B]),ce=e.useRef(null),U=e.useCallback(()=>{Promise.resolve().then(()=>{if((v??0)>(re??0)){const R=(v??0)-H;k.exec("expand-scale",{minWidth:R})}})},[v,re,H,k]);e.useEffect(()=>{let R;return ce.current&&(R=new ResizeObserver(U),R.observe(ce.current)),()=>{R&&R.disconnect()}},[ce.current,U]),e.useEffect(()=>{U()},[B]);const p=e.useRef(null),z=e.useRef(null),O=e.useCallback(()=>{const R=p.current;R&&k.exec("scroll-chart",{top:R.scrollTop})},[k]),F=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{F.current={rTasks:d,rScales:L,rCellHeight:I,scrollSize:W,ganttDiv:p.current,ganttHeight:b??0}},[d,L,I,W,b]);const Q=e.useCallback(R=>{if(!R)return;const{rTasks:ee,rScales:me,rCellHeight:ye,scrollSize:Te,ganttDiv:Me,ganttHeight:je}=F.current;if(!Me)return;const{id:Ee}=R,ae=ee.findIndex(f=>f.id===Ee);if(ae>-1){const f=je-me.height,V=ae*ye,ue=Me.scrollTop;let j=null;V<ue?j=V:V+ye>ue+f&&(j=V-f+ye+Te),j!==null&&(k.exec("scroll-chart",{top:Math.max(j,0)}),p.current.scrollTop=Math.max(j,0))}},[k]);e.useEffect(()=>{Q(G)},[G]),e.useEffect(()=>{const R=p.current,ee=z.current;if(!R||!ee)return;const me=()=>{it.flushSync(()=>{_(R.offsetHeight),P(R.offsetWidth),se(ee.offsetWidth)})},ye=new ResizeObserver(me);return ye.observe(R),()=>ye.disconnect()},[p.current]);const xe=e.useRef(null),ie=e.useRef(null);return e.useEffect(()=>{ie.current&&(ie.current.destroy(),ie.current=null);const R=xe.current;if(R)return ie.current=nt.hotkeys(R,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,"meta+c":!0,"meta+v":!0,"meta+x":!0,"meta+d":!0,backspace:!0,"ctrl+z":u,"ctrl+y":u,"meta+z":u,"meta+shift+z":u},exec:ee=>{ee.isInput||k.exec("hotkey",ee)}}),()=>{ie.current?.destroy(),ie.current=null}},[u]),o.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:p,onScroll:O,children:o.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:le,width:"100%"},ref:z,children:o.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:b,width:Z},children:o.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:xe,children:[S.length?o.jsxs(o.Fragment,{children:[o.jsx(xt,{display:Y,compactMode:A,columnWidth:h,width:H,readonly:r,fullHeight:J,onTableAPIChange:$,multiTaskRows:l,rowMapping:w}),o.jsx(vt,{value:H,display:Y,compactMode:A,containerWidth:v,onMove:R=>K(R),onDisplayChange:R=>ne(R)})]}):null,o.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:ce,children:o.jsx(yt,{readonly:r,fullWidth:B,fullHeight:J,taskTemplate:n,cellBorders:a,highlightTime:c,multiTaskRows:l,rowMapping:w,marqueeSelect:g})})]})})})})}function Mt(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function St(s,n){return typeof s=="function"?s:ke.dateToString(s,n)}function lt(s,n){return s.map(({format:r,...a})=>({...a,format:St(r,n)}))}function Et(s,n){const r=Mt(n);for(let a in r)r[a]=ke.dateToString(r[a],s);return r}function Rt(s,n){if(!s||!s.length)return s;const r=ke.dateToString("%d-%m-%Y",n);return s.map(a=>a.template?a:a.id==="start"||a.id=="end"?{...a,_template:c=>r(c),template:c=>r(c)}:a.id==="duration"?{...a,_template:c=>c,template:c=>c}:a)}function jt(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:lt(r.scales,n)}))}:s}const $t=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),Lt=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],Nt=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:a=fe.defaultTaskTypes,tasks:c=[],selected:$=[],activeTask:l=null,links:w=[],scales:g=Lt,columns:k=fe.defaultColumns,start:d=null,end:L=null,lengthUnit:I="day",durationUnit:S="day",cellWidth:G=100,cellHeight:u=38,scaleHeight:A=36,readonly:X=!1,cellBorders:H="full",zoom:K=!1,baselines:v=!1,highlightTime:P=null,init:b=null,autoScale:_=!0,unscheduledTasks:Z=!1,criticalPath:se=null,schedule:Y={type:"forward"},projectStart:ne=null,projectEnd:E=null,calendar:M=null,undo:h=!1,splitTasks:W=!1,multiTaskRows:B=!1,marqueeSelect:J=!1,...le},re){const ce=e.useRef();ce.current=le;const U=e.useMemo(()=>new fe.DataStore(y.writable),[]),p=e.useMemo(()=>({...Ke.en,...qe.en}),[]),z=e.useContext(we.context.i18n),O=e.useMemo(()=>z?z.extend(p,!0):ke.locale(p),[z,p]),F=e.useMemo(()=>O.getRaw().calendar,[O]),Q=e.useMemo(()=>{let ae={zoom:jt(K,F),scales:lt(g,F),columns:Rt(k,F),links:fe.normalizeLinks(w),cellWidth:G};return ae.zoom&&(ae={...ae,...fe.normalizeZoom(ae.zoom,Et(F,O.getGroup("gantt")),ae.scales,G)}),ae},[K,g,k,w,G,F,O]),xe=e.useRef(null);xe.current!==c&&(fe.parseTaskDates(c,{durationUnit:S,splitTasks:W,calendar:M}),xe.current=c),e.useEffect(()=>{fe.parseTaskDates(c,{durationUnit:S,splitTasks:W,calendar:M})},[c,S,M,W]);const ie=e.useMemo(()=>{if(!B)return null;const ae=new Map,f=new Map,V=ue=>{ue.forEach(j=>{const pe=j.row??j.id;f.set(j.id,pe),ae.has(pe)||ae.set(pe,[]),ae.get(pe).push(j.id),j.data&&j.data.length>0&&V(j.data)})};return V(c),{rowMap:ae,taskRows:f}},[c,B]),R=e.useMemo(()=>U.in,[U]),ee=e.useRef(null);ee.current===null&&(ee.current=new ct.EventBusRouter((ae,f)=>{const V="on"+$t(ae);ce.current&&ce.current[V]&&ce.current[V](f)}),R.setNext(ee.current));const[me,ye]=e.useState(null),Te=e.useRef(null);Te.current=me;const Me=e.useMemo(()=>({getState:U.getState.bind(U),getReactiveState:U.getReactive.bind(U),getStores:()=>({data:U}),exec:R.exec,setNext:ae=>(ee.current=ee.current.setNext(ae),ee.current),intercept:R.intercept.bind(R),on:R.on.bind(R),detach:R.detach.bind(R),getTask:U.getTask.bind(U),serialize:U.serialize.bind(U),getTable:ae=>ae?new Promise(f=>setTimeout(()=>f(Te.current),1)):Te.current,getHistory:()=>U.getHistory()}),[U,R]);e.useImperativeHandle(re,()=>({...Me}),[Me]);const je=e.useRef(0);e.useEffect(()=>{je.current?U.init({tasks:c,links:Q.links,start:d,columns:Q.columns,end:L,lengthUnit:I,cellWidth:Q.cellWidth,cellHeight:u,scaleHeight:A,scales:Q.scales,taskTypes:a,zoom:Q.zoom,selected:$,activeTask:l,baselines:v,autoScale:_,unscheduledTasks:Z,markers:r,durationUnit:S,criticalPath:se,schedule:Y,projectStart:ne,projectEnd:E,calendar:M,undo:h,_weekStart:F.weekStart,splitTasks:W}):b&&b(Me),je.current++},[Me,b,c,Q,d,L,I,u,A,a,$,l,v,_,Z,r,S,se,Y,ne,E,M,h,F,W,U]),je.current===0&&U.init({tasks:c,links:Q.links,start:d,columns:Q.columns,end:L,lengthUnit:I,cellWidth:Q.cellWidth,cellHeight:u,scaleHeight:A,scales:Q.scales,taskTypes:a,zoom:Q.zoom,selected:$,activeTask:l,baselines:v,autoScale:_,unscheduledTasks:Z,markers:r,durationUnit:S,criticalPath:se,schedule:Y,projectStart:ne,projectEnd:E,calendar:M,undo:h,_weekStart:F.weekStart,splitTasks:W});const Ee=e.useMemo(()=>M?(ae,f)=>f=="day"&&!M.getDayHours(ae)||f=="hour"&&!M.getDayHours(ae)?"wx-weekend":"":P,[M,P]);return o.jsx(we.context.i18n.Provider,{value:O,children:o.jsx(De.Provider,{value:Me,children:o.jsx(Ct,{taskTemplate:n,readonly:X,cellBorders:H,highlightTime:Ee,onTableAPIChange:ye,multiTaskRows:B,rowMapping:ie,marqueeSelect:J})})})});function It({api:s=null,items:n=[]}){const r=e.useContext(we.context.i18n),a=e.useMemo(()=>r||ke.locale(qe.en),[r]),c=e.useMemo(()=>a.getGroup("gantt"),[a]),$=y.useStoreLater(s,"_selected"),l=y.useStoreLater(s,"undo"),w=y.useStoreLater(s,"history"),g=y.useStoreLater(s,"splitTasks"),k=["undo","redo"],d=e.useMemo(()=>{const I=fe.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:fe.getToolbarButtons({undo:l,splitTasks:g})).map(G=>{let u={...G,disabled:!1};return u.handler=fe.isHandledAction(I,u.id)?A=>fe.handleAction(s,A.id,null,c):u.handler,u.text&&(u.text=c(u.text)),u.menuText&&(u.menuText=c(u.menuText)),u})},[n,s,c,l,g]),L=e.useMemo(()=>{const I=[];return d.forEach(S=>{const G=S.id;if(G==="add-task")I.push(S);else if(k.includes(G))k.includes(G)&&I.push({...S,disabled:S.isDisabled(w)});else{if(!$?.length||!s)return;I.push({...S,disabled:S.isDisabled&&$.some(u=>S.isDisabled(u,s.getState()))})}}),I.filter((S,G)=>{if(s&&S.isHidden)return!$.some(u=>S.isHidden(u,s.getState()));if(S.comp==="separator"){const u=I[G+1];if(!u||u.comp==="separator")return!1}return!0})},[s,$,w,d]);return r?o.jsx(Je.Toolbar,{items:L}):o.jsx(we.context.i18n.Provider,{value:a,children:o.jsx(Je.Toolbar,{items:L})})}const Dt=e.forwardRef(function({options:n=[],api:r=null,resolver:a=null,filter:c=null,at:$="point",children:l,onClick:w,css:g},k){const d=e.useRef(null),L=e.useRef(null),I=e.useContext(we.context.i18n),S=e.useMemo(()=>I||ke.locale({...qe.en,...Ke.en}),[I]),G=e.useMemo(()=>S.getGroup("gantt"),[S]),u=y.useStoreLater(r,"taskTypes"),A=y.useStoreLater(r,"selected"),X=y.useStoreLater(r,"_selected"),H=y.useStoreLater(r,"splitTasks"),K=e.useMemo(()=>fe.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{d.current&&d.current.show&&d.current.show()}),r.on("drag-task",()=>{d.current&&d.current.show&&d.current.show()}))},[r]);function v(M){return M.map(h=>(h={...h},h.text&&(h.text=G(h.text)),h.subtext&&(h.subtext=G(h.subtext)),h.data&&(h.data=v(h.data)),h))}function P(){const M=n.length?n:fe.getMenuOptions({splitTasks:H}),h=M.find(W=>W.id==="convert-task");return h&&(h.data=[],(u||[]).forEach(W=>{h.data.push(h.dataFactory(W))})),v(M)}const b=e.useMemo(()=>P(),[r,n,u,H,G]),_=e.useMemo(()=>X&&X.length?X:[],[X]),Z=e.useCallback((M,h)=>{let W=M?r?.getTask(M):null;if(a){const B=a(M,h);W=B===!0?W:B}if(W){const B=ke.locateID(h.target,"data-segment");B!==null?L.current={id:W.id,segmentIndex:B}:L.current=W.id,(!Array.isArray(A)||!A.includes(W.id))&&r&&r.exec&&r.exec("select-task",{id:W.id})}return W},[r,a,A]),se=e.useCallback(M=>{const h=M.action;h&&(fe.isHandledAction(K,h.id)&&fe.handleAction(r,h.id,L.current,G),w&&w(M))},[r,G,w,K]),Y=e.useCallback((M,h)=>{const W=_.length?_:h?[h]:[];let B=c?W.every(J=>c(M,J)):!0;if(B&&(M.isHidden&&(B=!W.some(J=>M.isHidden(J,r.getState(),L.current))),M.isDisabled)){const J=W.some(le=>M.isDisabled(le,r.getState(),L.current));M.disabled=J}return B},[c,_,r]);e.useImperativeHandle(k,()=>({show:(M,h)=>{d.current&&d.current.show&&d.current.show(M,h)}}));const ne=e.useCallback(M=>{d.current&&d.current.show&&d.current.show(M)},[]),E=o.jsxs(o.Fragment,{children:[o.jsx(at.ContextMenu,{filter:Y,options:b,dataKey:"id",resolver:Z,onClick:se,at:$,ref:d,css:g}),o.jsx("span",{onContextMenu:ne,"data-menu-ignore":"true",children:typeof l=="function"?l():l})]});if(!I&&we.context.i18n?.Provider){const M=we.context.i18n.Provider;return o.jsx(M,{value:S,children:E})}return E});function At({api:s,autoSave:n,onLinksChange:r}){const c=e.useContext(we.context.i18n).getGroup("gantt"),$=y.useStore(s,"activeTask"),l=y.useStore(s,"_activeTask"),w=y.useStore(s,"_links"),g=y.useStore(s,"schedule"),k=y.useStore(s,"unscheduledTasks"),[d,L]=e.useState();function I(){if($){const A=w.filter(H=>H.target==$).map(H=>({link:H,task:s.getTask(H.source)})),X=w.filter(H=>H.source==$).map(H=>({link:H,task:s.getTask(H.target)}));return[{title:c("Predecessors"),data:A},{title:c("Successors"),data:X}]}}e.useEffect(()=>{L(I())},[$,w]);const S=e.useMemo(()=>[{id:"e2s",label:c("End-to-start")},{id:"s2s",label:c("Start-to-start")},{id:"e2e",label:c("End-to-end")},{id:"s2e",label:c("Start-to-end")}],[c]);function G(A){n?s.exec("delete-link",{id:A}):(L(X=>(X||[]).map(H=>({...H,data:H.data.filter(K=>K.link.id!==A)}))),r&&r({id:A,action:"delete-link",data:{id:A}}))}function u(A,X){n?s.exec("update-link",{id:A,link:X}):(L(H=>(H||[]).map(K=>({...K,data:K.data.map(v=>v.link.id===A?{...v,link:{...v.link,...X}}:v)}))),r&&r({id:A,action:"update-link",data:{id:A,link:X}}))}return o.jsx(o.Fragment,{children:(d||[]).map((A,X)=>A.data.length?o.jsx("div",{className:"wx-j93aYGQf wx-links",children:o.jsx(we.Field,{label:A.title,position:"top",children:o.jsx("table",{children:o.jsx("tbody",{children:A.data.map(H=>o.jsxs("tr",{children:[o.jsx("td",{className:"wx-j93aYGQf wx-cell",children:o.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:H.task.text||""})}),g?.auto&&H.link.type==="e2s"?o.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:o.jsx(we.Text,{type:"number",placeholder:c("Lag"),value:H.link.lag,disabled:k&&l?.unscheduled,onChange:K=>{K.input||u(H.link.id,{lag:K.value})}})}):null,o.jsx("td",{className:"wx-j93aYGQf wx-cell",children:o.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:o.jsx(we.Combo,{value:H.link.type,placeholder:c("Select link type"),options:S,onChange:K=>u(H.link.id,{type:K.value}),children:({option:K})=>K.label})})}),o.jsx("td",{className:"wx-j93aYGQf wx-cell",children:o.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>G(H.link.id),role:"button"})})]},H.link.id))})})})},X):null)})}function Ht(s){const{value:n,time:r,format:a,onchange:c,onChange:$,...l}=s,w=$??c;function g(k){const d=new Date(k.value);d.setHours(n.getHours()),d.setMinutes(n.getMinutes()),w&&w({value:d})}return o.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[o.jsx(we.DatePicker,{...l,value:n,onChange:g,format:a,buttons:["today"],clear:!1}),r?o.jsx(we.TimePicker,{value:n,onChange:w,format:a}):null]})}Ie.registerEditorItem("select",we.RichSelect);Ie.registerEditorItem("date",Ht);Ie.registerEditorItem("twostate",we.TwoState);Ie.registerEditorItem("slider",we.Slider);Ie.registerEditorItem("counter",we.Counter);Ie.registerEditorItem("links",At);function Pt({api:s,items:n=[],css:r="",layout:a="default",readonly:c=!1,placement:$="sidebar",bottomBar:l=!0,topBar:w=!0,autoSave:g=!0,focus:k=!1,hotkeys:d={}}){const L=e.useContext(we.context.i18n),I=e.useMemo(()=>L||ke.locale({...qe.en,...Ke.en}),[L]),S=e.useMemo(()=>I.getGroup("gantt"),[I]),G=I.getRaw(),u=e.useMemo(()=>{const f=G.gantt?.dateFormat||G.formats?.dateFormat;return ke.dateToString(f,G.calendar)},[G]),A=e.useMemo(()=>{if(w===!0&&!c){const f=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:S("Delete"),id:"delete"}];return g?{items:f}:{items:[...f,{comp:"button",type:"primary",text:S("Save"),id:"save"}]}}return w},[w,c,g,S]),[X,H]=e.useState(!1),K=e.useMemo(()=>X?"wx-full-screen":"",[X]),v=e.useCallback(f=>{H(f)},[]);e.useEffect(()=>{const f=ot(v);return f.observe(),()=>{f.disconnect()}},[v]);const P=y.useStore(s,"_activeTask"),b=y.useStore(s,"activeTask"),_=y.useStore(s,"unscheduledTasks"),Z=y.useStore(s,"links"),se=y.useStore(s,"splitTasks"),Y=e.useMemo(()=>se&&b?.segmentIndex,[se,b]),ne=e.useMemo(()=>Y||Y===0,[Y]),E=e.useMemo(()=>fe.getEditorItems({unscheduledTasks:_}),[_]),M=y.useStore(s,"undo"),[h,W]=e.useState({}),[B,J]=e.useState(null),[le,re]=e.useState(),[ce,U]=e.useState(null),p=y.useStore(s,"taskTypes"),z=e.useMemo(()=>{if(!P)return null;let f;if(ne&&P.segments?f={...P.segments[Y]}:f={...P},c){let V={parent:f.parent};return E.forEach(({key:ue,comp:j})=>{if(j!=="links"){const pe=f[ue];j==="date"&&pe instanceof Date?V[ue]=u(pe):j==="slider"&&ue==="progress"?V[ue]=`${pe}%`:V[ue]=pe}}),V}return f||null},[P,ne,Y,c,E,u]);e.useEffect(()=>{re(z)},[z]),e.useEffect(()=>{W({}),U(null),J(null)},[b]);function O(f,V){return f.map(ue=>{const j={...ue};if(ue.config&&(j.config={...j.config}),j.comp==="links"&&s&&(j.api=s,j.autoSave=g,j.onLinksChange=xe),j.comp==="select"&&j.key==="type"){const pe=j.options??(p||[]);j.options=pe.map($e=>({...$e,label:S($e.label)}))}return j.comp==="slider"&&j.key==="progress"&&(j.labelTemplate=pe=>`${S(j.label)} ${pe}%`),j.label&&(j.label=S(j.label)),j.config?.placeholder&&(j.config.placeholder=S(j.config.placeholder)),V&&(j.isDisabled&&j.isDisabled(V,s.getState())?j.disabled=!0:delete j.disabled),j})}const F=e.useMemo(()=>{let f=n.length?n:E;return f=O(f,le),le?f.filter(V=>!V.isHidden||!V.isHidden(le,s.getState())):f},[n,E,le,p,S,s,g]),Q=e.useMemo(()=>F.map(f=>f.key),[F]);function xe({id:f,action:V,data:ue}){W(j=>({...j,[f]:{action:V,data:ue}}))}const ie=e.useCallback(()=>{for(let f in h)if(Z.byId(f)){const{action:V,data:ue}=h[f];s.exec(V,ue)}},[s,h,Z]),R=e.useCallback(()=>{const f=b?.id||b;if(ne){if(P?.segments){const V=P.segments.filter((ue,j)=>j!==Y);s.exec("update-task",{id:f,task:{segments:V}})}}else s.exec("delete-task",{id:f})},[s,b,ne,P,Y]),ee=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),me=e.useCallback(f=>{const{item:V,changes:ue}=f;V.id==="delete"&&R(),V.id==="save"&&(ue.length?ee():ie()),V.comp&&ee()},[s,b,g,ie,R,ee]),ye=e.useCallback((f,V,ue)=>(_&&f.type==="summary"&&(f.unscheduled=!1),fe.prepareEditTask(f,s.getState(),V),ue||J(!1),f),[_,s]),Te=e.useCallback(f=>{f={...f,unscheduled:_&&f.unscheduled&&f.type!=="summary"},delete f.links,delete f.data,(Q.indexOf("duration")===-1||f.segments&&!f.duration)&&delete f.duration;const V={id:b?.id||b,task:f,...ne&&{segmentIndex:Y}};g&&B&&(V.inProgress=B),s.exec("update-task",V),g||ie()},[s,b,_,g,ie,Q,ne,Y,B]),Me=e.useCallback(f=>{let{update:V,key:ue,input:j}=f;if(j&&J(!0),f.update=ye({...V},ue,j),!g)re(f.update);else if(!ce&&!j){const pe=F.find(Pe=>Pe.key===ue),$e=V[ue];(!pe.validation||pe.validation($e))&&(!pe.required||$e)&&Te(f.update)}},[g,ye,ce,F,Te]),je=e.useCallback(f=>{g||Te(f.values)},[g,Te]),Ee=e.useCallback(f=>{U(f.errors)},[]),ae=e.useMemo(()=>M?{"ctrl+z":f=>{f.preventDefault(),s.exec("undo")},"ctrl+y":f=>{f.preventDefault(),s.exec("redo")}}:{},[M,s]);return z?o.jsx(we.Locale,{children:o.jsx(Ie.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${K} ${r}`,items:F,values:z,topBar:A,bottomBar:l,placement:$,layout:a,readonly:c,autoSave:g,focus:k,onAction:me,onSave:je,onValidation:Ee,onChange:Me,hotkeys:d&&{...ae,...d}})}):null}const zt=({children:s,columns:n=null,api:r})=>{const[a,c]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(c)},[r]),o.jsx(rt.HeaderMenu,{api:a,columns:n,children:s})};function Gt(s){const{api:n,content:r,children:a}=s,c=e.useRef(null),$=e.useRef(null),[l,w]=e.useState({}),[g,k]=e.useState(null),[d,L]=e.useState({});function I(v){for(;v;){if(v.getAttribute){const P=v.getAttribute("data-tooltip-id"),b=v.getAttribute("data-tooltip-at"),_=v.getAttribute("data-tooltip");if(P||_)return{id:P,tooltip:_,target:v,at:b}}v=v.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const v=$.current;if(v&&d&&(d.text||r)){const P=v.getBoundingClientRect();let b=!1,_=d.left,Z=d.top;P.right>=l.right&&(_=l.width-P.width-5,b=!0),P.bottom>=l.bottom&&(Z=d.top-(P.bottom-l.bottom+2),b=!0),b&&L(se=>se&&{...se,left:_,top:Z})}},[d,l,r]);const S=e.useRef(null),G=300,u=v=>{clearTimeout(S.current),S.current=setTimeout(()=>{v()},G)};function A(v){let{id:P,tooltip:b,target:_,at:Z}=I(v.target);if(L(null),k(null),!b)if(P)b=H(P);else{clearTimeout(S.current);return}const se=v.clientX;u(()=>{P&&k(X(K(P)));const Y=_.getBoundingClientRect(),ne=c.current,E=ne?ne.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let M,h;Z==="left"?(M=Y.top+5-E.top,h=Y.right+5-E.left):(M=Y.top+Y.height-E.top,h=se-E.left),w(E),L({top:M,left:h,text:b})})}function X(v){return n?.getTask(K(v))||null}function H(v){return X(v)?.text||""}function K(v){const P=parseInt(v);return isNaN(P)?v:P}return o.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:c,onMouseMove:A,children:[d&&(d.text||r)?o.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:$,style:{top:`${d.top}px`,left:`${d.left}px`},children:r?o.jsx(r,{data:g}):d.text?o.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:d.text}):null}):null,a]})}function Wt({fonts:s=!0,children:n}){return n?o.jsx(we.Material,{fonts:s,children:n()}):o.jsx(we.Material,{fonts:s})}function _t({fonts:s=!0,children:n}){return n?o.jsx(we.Willow,{fonts:s,children:n}):o.jsx(we.Willow,{fonts:s})}function Ot({fonts:s=!0,children:n}){return n?o.jsx(we.WillowDark,{fonts:s,children:n}):o.jsx(we.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>fe.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>fe.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>fe.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>fe.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>fe.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>fe.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>fe.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>fe.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>fe.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>Ie.registerEditorItem});exports.ContextMenu=Dt;exports.Editor=Pt;exports.Gantt=Nt;exports.HeaderMenu=zt;exports.Material=Wt;exports.Toolbar=It;exports.Tooltip=Gt;exports.Willow=_t;exports.WillowDark=Ot;
//# sourceMappingURL=index.cjs.map
