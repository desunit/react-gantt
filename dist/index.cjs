"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("react/jsx-runtime"),e=require("react"),he=require("@svar-ui/react-core"),be=require("@svar-ui/lib-dom"),qe=require("@svar-ui/gantt-locales"),Ke=require("@svar-ui/core-locales"),ct=require("@svar-ui/lib-state"),de=require("@svar-ui/gantt-store"),y=require("@svar-ui/lib-react"),nt=require("@svar-ui/grid-store"),rt=require("@svar-ui/react-grid"),it=require("react-dom"),Je=require("@svar-ui/react-toolbar"),at=require("@svar-ui/react-menu"),Ie=require("@svar-ui/react-editor"),De=e.createContext(null);function He(s){const n=s.getAttribute("data-id"),r=parseInt(n);return isNaN(r)||r.toString()!=n?n:r}function ut(s,n,r){const a=s.getBoundingClientRect(),c=n.querySelector(".wx-body").getBoundingClientRect();return{top:a.top-c.top,left:a.left-c.left,dt:a.bottom-r.clientY,db:r.clientY-a.top}}function et(s){return s&&s.getAttribute("data-context-id")}const tt=5;function dt(s,n){let r,a,c,$,l,p,w,k,d;function L(b){$=b.clientX,l=b.clientY,p={...ut(r,s,b),y:n.getTask(c).$y},document.body.style.userSelect="none"}function I(b){r=be.locate(b),et(r)&&(c=He(r),d=setTimeout(()=>{k=!0,n&&n.touchStart&&n.touchStart(),L(b.touches[0])},500),s.addEventListener("touchmove",H),s.addEventListener("contextmenu",S),window.addEventListener("touchend",X))}function S(b){if(k||d)return b.preventDefault(),!1}function W(b){b.which===1&&(r=be.locate(b),et(r)&&(c=He(r),s.addEventListener("mousemove",F),window.addEventListener("mouseup",v),L(b)))}function u(b){s.removeEventListener("mousemove",F),s.removeEventListener("touchmove",H),document.body.removeEventListener("mouseup",v),document.body.removeEventListener("touchend",X),document.body.style.userSelect="",b&&(s.removeEventListener("mousedown",W),s.removeEventListener("touchstart",I))}function A(b){const O=b.clientX-$,Q=b.clientY-l;if(!a){if(Math.abs(O)<tt&&Math.abs(Q)<tt||n&&n.start&&n.start({id:c,e:b})===!1)return;a=r.cloneNode(!0),a.style.pointerEvents="none",a.classList.add("wx-reorder-task"),a.style.position="absolute",a.style.left=p.left+"px",a.style.top=p.top+"px",r.style.visibility="hidden",r.parentNode.insertBefore(a,r)}if(a){const se=Math.round(Math.max(0,p.top+Q));if(n&&n.move&&n.move({id:c,top:se,detail:w})===!1)return;const Y=n.getTask(c),ee=Y.$y;if(!p.start&&p.y==ee)return P();p.start=!0,p.y=Y.$y-4,a.style.top=se+"px";const R=document.elementFromPoint(b.clientX,b.clientY),M=be.locate(R);if(M&&M!==r){const g=He(M),_=M.getBoundingClientRect(),K=_.top+_.height/2,Z=b.clientY+p.db>K&&M.nextElementSibling!==r,oe=b.clientY-p.dt<K&&M.previousElementSibling!==r;w?.after==g||w?.before==g?w=null:Z?w={id:c,after:g}:oe&&(w={id:c,before:g})}}}function F(b){A(b)}function H(b){k?(b.preventDefault(),A(b.touches[0])):d&&(clearTimeout(d),d=null)}function X(){k=null,d&&(clearTimeout(d),d=null),P()}function v(){P()}function P(){r&&(r.style.visibility=""),a&&(a.parentNode.removeChild(a),n&&n.end&&n.end({id:c,top:p.top})),c=r=a=p=w=null,u()}return s.style.position!=="absolute"&&(s.style.position="relative"),s.addEventListener("mousedown",W),s.addEventListener("touchstart",I),{destroy(){u(!0)}}}function ft({row:s,column:n}){function r(c,$){return{justifyContent:$.align,paddingLeft:`${(c.$level-1)*20}px`}}const a=n&&n._cell;return o.jsxs("div",{className:"wx-pqc08MHU wx-content",style:r(s,n),children:[s.data||s.lazy?o.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${s.open?"down":"right"}`,"data-action":"open-task"}):o.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),o.jsx("div",{className:"wx-pqc08MHU wx-text",children:a?o.jsx(a,{row:s,column:n}):s.text})]})}function st({column:s,cell:n}){const r=e.useMemo(()=>s.id,[s?.id]);return n||s.id=="add-task"?o.jsx("div",{style:{textAlign:s.align},children:o.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":r})}):null}function xt(s){const{readonly:n,compactMode:r,width:a=0,display:c="all",columnWidth:$=0,onTableAPIChange:l,multiTaskRows:p=!1,rowMapping:w=null}=s,[k,d]=y.useWritableProp($),[L,I]=e.useState(),S=e.useContext(he.context.i18n),W=e.useMemo(()=>S.getGroup("gantt"),[S]),u=e.useContext(De),A=y.useStore(u,"scrollTop"),F=y.useStore(u,"cellHeight"),H=y.useStore(u,"_scrollTask"),X=y.useStore(u,"_selected"),v=y.useStore(u,"area"),P=y.useStore(u,"_tasks"),b=y.useStore(u,"_scales"),O=y.useStore(u,"columns"),Q=y.useStore(u,"_sort"),se=y.useStore(u,"calendar"),Y=y.useStore(u,"durationUnit"),ee=y.useStore(u,"splitTasks"),[R,M]=e.useState(null),g=e.useMemo(()=>!P||!v?[]:P.slice(v.start,v.end),[P,v]),_=e.useCallback((i,h)=>{if(h==="add-task")u.exec(h,{target:i,task:{text:W("New Task")},mode:"child",show:!0});else if(h==="open-task"){const T=g.find(q=>q.id===i);(T?.data||T?.lazy)&&u.exec(h,{id:i,mode:!T.open})}},[g]),K=e.useCallback(i=>{const h=be.locateID(i),T=i.target.dataset.action;T&&i.preventDefault(),h?T==="add-task"||T==="open-task"?_(h,T):u.exec("select-task",{id:h,toggle:i.ctrlKey||i.metaKey,range:i.shiftKey,show:!0}):T==="add-task"&&_(null,T)},[u,_]),Z=e.useRef(null),oe=e.useRef(null),[re,le]=e.useState(0),[f,z]=e.useState(!1);e.useEffect(()=>{const i=oe.current;if(!i||typeof ResizeObserver>"u")return;const h=()=>le(i.clientWidth);h();const T=new ResizeObserver(h);return T.observe(i),()=>T.disconnect()},[]);const ne=e.useRef(null),G=e.useCallback(i=>{const h=i.id,{before:T,after:q}=i,xe=i.onMove;let ue=T||q,ve=T?"before":"after";if(xe){if(ve==="after"){const Le=u.getTask(ue);Le.data?.length&&Le.open&&(ve="before",ue=Le.data[0].id)}ne.current={id:h,[ve]:ue}}else ne.current=null;u.exec("move-task",{id:h,mode:ve,target:ue,inProgress:xe})},[u]),V=e.useMemo(()=>v?.from??0,[v]),U=e.useMemo(()=>b?.height??0,[b]),ke=e.useMemo(()=>!r&&c!=="grid"?(k??0)>(a??0):(k??0)>(re??0),[r,c,k,a,re]),we=e.useMemo(()=>{const i={};return ke&&c==="all"||c==="grid"&&ke?i.width=k:c==="grid"&&(i.width="100%"),i},[ke,c,k]),E=e.useMemo(()=>R&&!g.find(i=>i.id===R.id)?[...g,R]:g,[g,R]),J=e.useMemo(()=>{if(!p||!w)return E;const i=new Map,h=new Set;return E.forEach(T=>{const q=w.taskRows.get(T.id)??T.id;h.has(q)||(i.set(q,{...T,$rowTasks:w.rowMap.get(q)||[T.id]}),h.add(q))}),Array.from(i.values())},[E,p,w]),fe=e.useMemo(()=>{let i=(O||[]).map(q=>{q={...q};const xe=q.header;if(typeof xe=="object"){const ue=xe.text&&W(xe.text);q.header={...xe,text:ue}}else q.header=W(xe);return q});const h=i.findIndex(q=>q.id==="text"),T=i.findIndex(q=>q.id==="add-task");if(h!==-1&&(i[h].cell&&(i[h]._cell=i[h].cell),i[h].cell=ft),T!==-1){i[T].cell=i[T].cell||st;const q=i[T].header;if(typeof q!="object"&&(i[T].header={text:q}),i[T].header.cell=q.cell||st,n)i.splice(T,1);else if(r){const[xe]=i.splice(T,1);i.unshift(xe)}}return i.length>0&&(i[i.length-1].resize=!1),i},[O,W,n,r]),ye=e.useMemo(()=>c==="all"?`${a}px`:c==="grid"?"calc(100% - 4px)":fe.find(i=>i.id==="add-task")?"50px":"0",[c,a,fe]),Te=e.useMemo(()=>{if(J&&Q?.length){const i={};return Q.forEach(({key:h,order:T},q)=>{i[h]={order:T,...Q.length>1&&{index:q}}}),i}return{}},[J,Q]),Me=e.useCallback(()=>fe.some(i=>i.flexgrow&&!i.hidden),[]),je=e.useMemo(()=>Me(),[Me,f]),Ee=e.useMemo(()=>{let i=c==="chart"?fe.filter(T=>T.id==="add-task"):fe;const h=c==="all"?a:re;if(!je){let T=k,q=!1;if(fe.some(xe=>xe.$width)){let xe=0;T=fe.reduce((ue,ve)=>(ve.hidden||(xe+=ve.width,ue+=ve.$width||ve.width),ue),0),xe>T&&T>h&&(q=!0)}if(q||T<h){let xe=1;return q||(xe=(h-50)/(T-50||1)),i.map(ue=>(ue.id!=="add-task"&&!ue.hidden&&(ue.$width||(ue.$width=ue.width),ue.width=ue.$width*xe),ue))}}return i},[c,fe,je,k,a,re]),ie=e.useCallback(i=>{if(!Me()){const h=Ee.reduce((T,q)=>(i&&q.$width&&(q.$width=q.width),T+(q.hidden?0:q.width)),0);h!==k&&d(h)}z(!0),z(!1)},[Me,Ee,k,d]),x=e.useCallback(()=>{fe.filter(h=>h.flexgrow&&!h.hidden).length===1&&fe.forEach(h=>{h.$width&&!h.flexgrow&&!h.hidden&&(h.width=h.$width)})},[]),B=e.useCallback(i=>{if(!n){const h=be.locateID(i),T=be.locateAttr(i,"data-col-id");!(T&&fe.find(xe=>xe.id==T))?.editor&&h&&u.exec("show-editor",{id:h})}},[u,n]),ae=e.useMemo(()=>Array.isArray(X)?X.map(i=>i.id):[],[X]),j=e.useCallback(()=>{if(Z.current&&J!==null){const i=Z.current.querySelector(".wx-body");i&&(i.style.top=-((A??0)-(V??0))+"px")}oe.current&&(oe.current.scrollTop=0)},[J,A,V]);e.useEffect(()=>{Z.current&&j()},[A,V,j]),e.useEffect(()=>{const i=Z.current;if(!i)return;const h=i.querySelector(".wx-table-box .wx-body");if(!h||typeof ResizeObserver>"u")return;const T=new ResizeObserver(()=>{j()});return T.observe(h),()=>{T.disconnect()}},[Ee,we,c,ye,J,j]),e.useEffect(()=>{if(!H||!L)return;const{id:i}=H,h=L.getState().focusCell;h&&h.row!==i&&Z.current&&Z.current.contains(document.activeElement)&&L.exec("focus-cell",{row:i,column:h.column})},[H,L]);const ge=e.useCallback(({id:i})=>{if(n)return!1;u.getTask(i).open&&u.exec("open-task",{id:i,mode:!1});const h=u.getState()._tasks.find(T=>T.id===i);if(M(h||null),!h)return!1},[u,n]),$e=e.useCallback(({id:i,top:h})=>{ne.current?G({...ne.current,onMove:!1}):u.exec("drag-task",{id:i,top:h+(V??0),inProgress:!1}),M(null)},[u,G,V]),ze=e.useCallback(({id:i,top:h,detail:T})=>{T&&G({...T,onMove:!0}),u.exec("drag-task",{id:i,top:h+(V??0),inProgress:!0})},[u,G,V]);e.useEffect(()=>{const i=Z.current;return i?dt(i,{start:ge,end:$e,move:ze,getTask:u.getTask}).destroy:void 0},[u,ge,$e,ze]);const Pe=e.useCallback(i=>{const{key:h,isInput:T}=i;if(!T&&(h==="arrowup"||h==="arrowdown"))return i.eventSource="grid",u.exec("hotkey",i),!1;if(h==="enter"){const q=L?.getState().focusCell;if(q){const{row:xe,column:ue}=q;ue==="add-task"?_(xe,"add-task"):ue==="text"&&_(xe,"open-task")}}},[u,_,L]),Re=e.useRef(null),Ge=()=>{Re.current={setTableAPI:I,handleHotkey:Pe,sortVal:Q,api:u,adjustColumns:x,setColumnWidth:ie,tasks:g,calendarVal:se,durationUnitVal:Y,splitTasksVal:ee,onTableAPIChange:l}};Ge(),e.useEffect(()=>{Ge()},[I,Pe,Q,u,x,ie,g,se,Y,ee,l]);const Ye=e.useCallback(i=>{I(i),i.intercept("hotkey",h=>Re.current.handleHotkey(h)),i.intercept("scroll",()=>!1),i.intercept("select-row",()=>!1),i.intercept("sort-rows",h=>{const T=Re.current.sortVal,{key:q,add:xe}=h,ue=T?T.find(Le=>Le.key===q):null;let ve="asc";return ue&&(ve=!ue||ue.order==="asc"?"desc":"asc"),u.exec("sort-tasks",{key:q,order:ve,add:xe}),!1}),i.on("resize-column",()=>{Re.current.setColumnWidth(!0)}),i.on("hide-column",h=>{h.mode||Re.current.adjustColumns(),Re.current.setColumnWidth()}),i.intercept("update-cell",h=>{const{id:T,column:q,value:xe}=h,ue=Re.current.tasks.find(ve=>ve.id===T);if(ue){const ve={...ue};let Le=xe;Le&&!isNaN(Le)&&!(Le instanceof Date)&&(Le*=1),ve[q]=Le,de.prepareEditTask(ve,{calendar:Re.current.calendarVal,durationUnit:Re.current.durationUnitVal,splitTasks:Re.current.splitTasksVal},q),u.exec("update-task",{id:T,task:ve})}return!1}),l&&l(i)},[]);return o.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ye}`},ref:oe,children:o.jsx("div",{ref:Z,style:we,className:"wx-rHj6070p wx-table",onClick:K,onDoubleClick:B,children:o.jsx(rt.Grid,{init:Ye,sizes:{rowHeight:F,headerHeight:(U??0)-1},rowStyle:i=>i.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:i=>`wx-rHj6070p wx-text-${i.align}${i.id==="add-task"?" wx-action":""}`,data:J,columns:Ee,selectedRows:[...ae],sortMarks:Te})})})}function mt({borders:s=""}){const n=e.useContext(De),r=y.useStore(n,"cellWidth"),a=y.useStore(n,"cellHeight"),c=e.useRef(null),[$,l]=e.useState("#e4e4e4");e.useEffect(()=>{if(typeof getComputedStyle<"u"&&c.current){const w=getComputedStyle(c.current).getPropertyValue("--wx-gantt-border");l(w?w.substring(w.indexOf("#")):"#1d1e261a")}},[]);const p={width:"100%",height:"100%",background:r!=null&&a!=null?`url(${de.grid(r,a,$,s)})`:void 0,position:"absolute"};return o.jsx("div",{ref:c,style:p})}function ht({onSelectLink:s,selectedLink:n,readonly:r}){const a=e.useContext(De),c=y.useStore(a,"_links"),$=y.useStore(a,"criticalPath"),l=e.useRef(null),p=e.useCallback(w=>{const k=w?.target?.classList;!k?.contains("wx-line")&&!k?.contains("wx-delete-button")&&s(null)},[s]);return e.useEffect(()=>{if(!r&&n&&l.current){const w=k=>{l.current&&!l.current.contains(k.target)&&p(k)};return document.addEventListener("click",w),()=>{document.removeEventListener("click",w)}}},[r,n,p]),o.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(c||[]).map(w=>{const k="wx-dkx3NwEn wx-line"+($&&w.$critical?" wx-critical":"")+(r?"":" wx-line-selectable");return o.jsx("polyline",{className:k,points:w.$p,onClick:()=>!r&&s(w.id),"data-link-id":w.id},w.id)}),!r&&n&&o.jsx("polyline",{ref:l,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:n.$p})]})}function gt(s){const{task:n,type:r}=s;function a($){const l=n.segments[$];return{left:`${l.$x}px`,top:"0px",width:`${l.$w}px`,height:"100%"}}function c($){if(!n.progress)return 0;const l=n.duration*n.progress/100,p=n.segments;let w=0,k=0,d=null;do{const L=p[k];k===$&&(w>l?d=0:d=Math.min((l-w)/L.duration,1)*100),w+=L.duration,k++}while(d===null&&k<p.length);return d||0}return o.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:n.segments.map(($,l)=>o.jsxs("div",{className:`wx-segment wx-bar wx-${r} wx-GKbcLEGA`,"data-segment":l,style:a(l),children:[n.progress?o.jsx("div",{className:"wx-progress-wrapper",children:o.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${c(l)}%`}})}):null,o.jsx("div",{className:"wx-content",children:$.text||""})]},l))})}function wt(s){const{readonly:n,taskTemplate:r,multiTaskRows:a=!1,rowMapping:c=null,marqueeSelect:$=!1}=s,l=e.useContext(De),[p,w]=y.useStoreWithCounter(l,"_tasks"),[k,d]=y.useStoreWithCounter(l,"_links"),L=y.useStore(l,"area"),I=y.useStore(l,"_scales"),S=y.useStore(l,"taskTypes"),W=y.useStore(l,"baselines"),[u,A]=y.useStoreWithCounter(l,"_selected"),F=y.useStore(l,"_scrollTask"),H=y.useStore(l,"criticalPath"),X=y.useStore(l,"tasks"),v=y.useStore(l,"schedule"),P=y.useStore(l,"splitTasks"),b=e.useMemo(()=>{if(!L||!Array.isArray(p))return[];const t=L.start??0,m=L.end??0;return p.slice(t,m).map(C=>({...C}))},[w,L]),O=y.useStore(l,"cellHeight"),Q=e.useMemo(()=>{if(!a||!c||!b.length)return b;const t=new Map,m=[];return p.forEach(C=>{const N=c.taskRows.get(C.id)??C.id;t.has(N)||(t.set(N,m.length),m.push(N))}),b.map(C=>{const N=c.taskRows.get(C.id)??C.id,D=t.get(N)??0;return{...C,$y:D*O,$y_base:C.$y_base!==void 0?D*O:void 0}})},[b,a,c,p,O]),se=e.useMemo(()=>I.lengthUnitWidth,[I]),Y=e.useMemo(()=>I.lengthUnit||"day",[I]),ee=e.useRef(!1),[R,M]=e.useState(void 0),[g,_]=e.useState(null),K=e.useRef(null),[Z,oe]=e.useState(null),[re,le]=e.useState(void 0),f=e.useRef(null),[z,ne]=e.useState(0),[G,V]=e.useState(null),[U,ke]=e.useState(null),we=e.useRef(null),E=e.useMemo(()=>{const t=we.current;return!!(u.length&&t&&t.contains(document.activeElement))},[u,we.current]),J=e.useMemo(()=>E&&u[u.length-1]?.id,[E,u]);e.useEffect(()=>{if(F&&E&&F){const{id:t}=F,m=we.current?.querySelector(`.wx-bar[data-id='${t}']`);m&&m.focus({preventScroll:!0})}},[F]),e.useEffect(()=>{const t=we.current;if(t&&(ne(t.offsetWidth||0),typeof ResizeObserver<"u")){const m=new ResizeObserver(C=>{C[0]&&ne(C[0].contentRect.width)});return m.observe(t),()=>m.disconnect()}},[we.current]);const fe=e.useCallback(()=>{document.body.style.userSelect="none"},[]),ye=e.useCallback(()=>{document.body.style.userSelect=""},[]),Te=e.useCallback((t,m,C)=>{if(m.target.classList.contains("wx-line")||(C||(C=l.getTask(He(t))),C.type==="milestone"||C.type==="summary"))return"";const N=be.locate(m,"data-segment");N&&(t=N);const{left:D,width:te}=t.getBoundingClientRect(),ce=(m.clientX-D)/te;let pe=.2/(te>200?te/200:1);return ce<pe?"start":ce>1-pe?"end":""},[l]),Me=e.useMemo(()=>{const t=new Map;if(!a||!c)return p.forEach(N=>{t.set(N.id,N.$y)}),t;const m=new Map,C=[];return p.forEach(N=>{const D=c.taskRows.get(N.id)??N.id;m.has(D)||(m.set(D,C.length),C.push(D))}),p.forEach(N=>{const D=c.taskRows.get(N.id)??N.id,te=m.get(D)??0;t.set(N.id,te*O)}),t},[p,a,c,O]),je=e.useCallback(t=>{const m=we.current;if(!m)return[];const C=m.parentElement?.scrollLeft||0,N=m.parentElement?.parentElement?.scrollTop||0,D=Math.min(t.startX,t.currentX),te=Math.max(t.startX,t.currentX),ce=Math.min(t.startY,t.currentY),pe=Math.max(t.startY,t.currentY);return p.filter(me=>{const Se=me.$x-C,Ne=me.$x+me.$w-C,Ae=(Me.get(me.id)??me.$y)-N,Ce=Ae+me.$h;return Se<te&&Ne>D&&Ae<pe&&Ce>ce})},[p,Me]),Ee=e.useMemo(()=>new Set(u.map(t=>t.id)),[u,A]),ie=e.useCallback(t=>Ee.has(t),[Ee]),x=e.useCallback((t,m)=>{const{clientX:C}=m,N=He(t),D=l.getTask(N),te=m.target.classList;if(!m.target.closest(".wx-delete-button")&&!n){if(te.contains("wx-progress-marker")){const{progress:ce}=l.getTask(N);K.current={id:N,x:C,progress:ce,dx:0,node:t,marker:m.target},m.target.classList.add("wx-progress-in-drag")}else{const ce=Te(t,m,D)||"move",pe={id:N,mode:ce,x:C,dx:0,l:D.$x,w:D.$w};if(P&&D.segments?.length){const me=be.locate(m,"data-segment");me&&(pe.segmentIndex=me.dataset.segment*1,de.extendDragOptions(D,pe))}_(pe)}fe()}},[l,n,Te,fe,P]),B=e.useCallback(t=>{if(t.button!==0)return;const m=be.locate(t);if(!m&&$&&!n){const C=we.current;if(!C)return;const N=C.getBoundingClientRect(),D=t.clientX-N.left,te=t.clientY-N.top;V({startX:D,startY:te,currentX:D,currentY:te,ctrlKey:t.ctrlKey||t.metaKey}),fe();return}if(m){if($&&!n&&u.length>1){const C=He(m);if(ie(C)){const N=t.target.classList;if(!N.contains("wx-link")&&!N.contains("wx-progress-marker")&&!t.target.closest(".wx-delete-button")){const D=l.getTask(C);if(!Te(m,t,D)){const ce=new Map;u.forEach(pe=>{const me=l.getTask(pe.id);if(me){if(v?.auto&&me.type==="summary")return;ce.set(pe.id,{$x:me.$x,$w:me.$w,start:me.start,end:me.end})}}),ke({baseTaskId:C,startX:t.clientX,dx:0,originalPositions:ce}),fe();return}}}}x(m,t)}},[x,$,n,u,ie,l,Te,v,fe]),ae=e.useCallback(t=>{const m=be.locate(t);m&&(f.current=setTimeout(()=>{le(!0),x(m,t.touches[0])},300))},[x]),j=e.useCallback(t=>{oe(t&&{...k.find(m=>m.id===t)})},[k]),ge=e.useCallback(()=>{if(G){const t=je(G);G.ctrlKey?t.forEach(m=>{l.exec("select-task",{id:m.id,toggle:!0,marquee:!0})}):(u.length>0&&l.exec("select-task",{id:null,marquee:!0}),t.forEach((m,C)=>{l.exec("select-task",{id:m.id,toggle:C>0,marquee:!0})})),V(null),ye(),ee.current=!0;return}if(U){const{dx:t,originalPositions:m}=U,C=Math.round(t/se);if(C!==0){let N=!0;m.forEach((D,te)=>{const ce=l.getTask(te);ce&&(l.exec("update-task",{id:te,diff:C,task:{start:ce.start,end:ce.end},skipUndo:!N}),N=!1)}),ee.current=!0}else m.forEach((N,D)=>{l.exec("drag-task",{id:D,left:N.$x,width:N.$w,inProgress:!1})});ke(null),ye();return}if(K.current){const{dx:t,id:m,marker:C,value:N}=K.current;K.current=null,typeof N<"u"&&t&&l.exec("update-task",{id:m,task:{progress:N},inProgress:!1}),C.classList.remove("wx-progress-in-drag"),ee.current=!0,ye()}else if(g){const{id:t,mode:m,dx:C,l:N,w:D,start:te,segment:ce,index:pe}=g;if(_(null),te){const me=Math.round(C/se);if(!me)l.exec("drag-task",{id:t,width:D,left:N,inProgress:!1,...ce&&{segmentIndex:pe}});else{let Se={},Ne=l.getTask(t);ce&&(Ne=Ne.segments[pe]);const We=1440*60*1e3,Ce=me*(Y==="week"?7:Y==="month"?30:Y==="quarter"?91:Y==="year"?365:1)*We;m==="move"?(Se.start=new Date(Ne.start.getTime()+Ce),Se.end=new Date(Ne.end.getTime()+Ce)):m==="start"?(Se.start=new Date(Ne.start.getTime()+Ce),Se.end=Ne.end):m==="end"&&(Se.start=Ne.start,Se.end=new Date(Ne.end.getTime()+Ce)),l.exec("update-task",{id:t,task:Se,...ce&&{segmentIndex:pe}})}ee.current=!0}ye()}},[l,ye,g,se,Y,G,U,je,u]),$e=e.useCallback((t,m)=>{const{clientX:C,clientY:N}=m;if(!n){if(G){const D=we.current;if(!D)return;const te=D.getBoundingClientRect(),ce=C-te.left,pe=N-te.top;V(me=>({...me,currentX:ce,currentY:pe}));return}if(U){const D=C-U.startX;U.originalPositions.forEach((te,ce)=>{const pe=te.$x+D;l.exec("drag-task",{id:ce,left:pe,width:te.$w,inProgress:!0})}),ke(te=>({...te,dx:D}));return}if(K.current){const{node:D,x:te,id:ce}=K.current,pe=K.current.dx=C-te,me=Math.round(pe/D.offsetWidth*100);let Se=K.current.progress+me;K.current.value=Se=Math.min(Math.max(0,Se),100),l.exec("update-task",{id:ce,task:{progress:Se},inProgress:!0})}else if(g){j(null);const{mode:D,l:te,w:ce,x:pe,id:me,start:Se,segment:Ne,index:We}=g,Ae=l.getTask(me),Ce=C-pe;if(!Se&&Math.abs(Ce)<20||D==="start"&&ce-Ce<se||D==="end"&&ce+Ce<se||D==="move"&&(Ce<0&&te+Ce<0||Ce>0&&te+ce+Ce>z)||g.segment&&!de.isSegmentMoveAllowed(Ae,g))return;const Xe={...g,dx:Ce};let _e,Oe;if(D==="start"?(_e=te+Ce,Oe=ce-Ce):D==="end"?(_e=te,Oe=ce+Ce):D==="move"&&(_e=te+Ce,Oe=ce),l.exec("drag-task",{id:me,width:Oe,left:_e,inProgress:!0,...Ne&&{segmentIndex:We}}),!Xe.start&&(D==="move"&&Ae.$x==te||D!=="move"&&Ae.$w==ce)){ee.current=!0,ge();return}Xe.start=!0,_(Xe)}else{const D=be.locate(t);if(D){const te=l.getTask(He(D)),pe=be.locate(t,"data-segment")||D,me=Te(pe,m,te);pe.style.cursor=me&&!n?"col-resize":"pointer"}}}},[l,n,g,se,z,Te,j,ge,G,U]),ze=e.useCallback(t=>{$e(t,t)},[$e]),Pe=e.useCallback(t=>{re?(t.preventDefault(),$e(t,t.touches[0])):f.current&&(clearTimeout(f.current),f.current=null)},[re,$e]),Re=e.useCallback(()=>{ge()},[ge]),Ge=e.useCallback(()=>{le(null),f.current&&(clearTimeout(f.current),f.current=null),ge()},[ge]);e.useEffect(()=>(window.addEventListener("mouseup",Re),()=>{window.removeEventListener("mouseup",Re)}),[Re]);const Ye=e.useCallback(t=>{if(!n){const m=be.locateID(t.target);if(m&&!t.target.classList.contains("wx-link")){const C=be.locateID(t.target,"data-segment");l.exec("show-editor",{id:m,...C!==null&&{segmentIndex:C}})}}},[l,n]),i=["e2s","s2s","e2e","s2e"],h=e.useCallback((t,m)=>i[(t?1:0)+(m?0:2)],[]),T=e.useCallback((t,m)=>{const C=R.id,N=R.start;return t===C?!0:!!k.find(D=>D.target==t&&D.source==C&&D.type===h(N,m))},[R,d,h]),q=e.useCallback(()=>{R&&M(null)},[R]),xe=e.useCallback(t=>{if(ee.current){ee.current=!1;return}const m=be.locateID(t.target);if(m){const C=t.target.classList;if(C.contains("wx-link")){const N=C.contains("wx-left");if(!R){M({id:m,start:N});return}R.id!==m&&!T(m,N)&&l.exec("add-link",{link:{source:R.id,target:m,type:h(R.start,N)}})}else if(C.contains("wx-delete-button-icon"))l.exec("delete-link",{id:Z.id}),oe(null);else{let N;const D=be.locate(t,"data-segment");D&&(N=D.dataset.segment*1),l.exec("select-task",{id:m,toggle:t.ctrlKey||t.metaKey,range:t.shiftKey,segmentIndex:N})}}q()},[l,R,d,Z,T,h,q]),ue=e.useCallback(t=>({left:`${t.$x}px`,top:`${t.$y}px`,width:`${t.$w}px`,height:`${t.$h}px`}),[]),ve=e.useCallback(t=>({left:`${t.$x_base}px`,top:`${t.$y_base}px`,width:`${t.$w_base}px`,height:`${t.$h_base}px`}),[]),Le=e.useCallback(t=>{if(re||f.current)return t.preventDefault(),!1},[re]),Ve=e.useMemo(()=>S.map(t=>t.id),[S]),Be=e.useCallback(t=>{let m=Ve.includes(t)?t:"task";return["task","milestone","summary"].includes(t)||(m=`task ${m}`),m},[Ve]),Ue=e.useCallback(t=>{l.exec(t.action,t.data)},[l]),Fe=e.useCallback(t=>H&&X.byId(t).$critical,[H,X]),Qe=e.useCallback(t=>{if(v?.auto){const m=X.getSummaryId(t,!0),C=X.getSummaryId(R.id,!0);return R?.id&&!(Array.isArray(m)?m:[m]).includes(R.id)&&!(Array.isArray(C)?C:[C]).includes(t)}return R},[v,X,R]),Ze=e.useMemo(()=>{if(!G)return null;const t=Math.min(G.startX,G.currentX),m=Math.min(G.startY,G.currentY),C=Math.abs(G.currentX-G.startX),N=Math.abs(G.currentY-G.startY);return{left:`${t}px`,top:`${m}px`,width:`${C}px`,height:`${N}px`}},[G]);return o.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${Q.length?Q[0].$h:0}px`},ref:we,onContextMenu:Le,onMouseDown:B,onMouseMove:ze,onTouchStart:ae,onTouchMove:Pe,onTouchEnd:Ge,onClick:xe,onDoubleClick:Ye,onDragStart:t=>(t.preventDefault(),!1),children:[o.jsx(ht,{onSelectLink:j,selectedLink:Z,readonly:n}),Q.map(t=>{if(t.$skip&&t.$skip_baseline)return null;const m=`wx-bar wx-${Be(t.type)}`+(re&&g&&t.id===g.id?" wx-touch":"")+(R&&R.id===t.id?" wx-selected":"")+(Ee.has(t.id)?" wx-selected":"")+(Fe(t.id)?" wx-critical":"")+(t.$reorder?" wx-reorder-task":"")+(P&&t.segments?" wx-split":""),C="wx-link wx-left"+(R?" wx-visible":"")+(!R||!T(t.id,!0)&&Qe(t.id)?" wx-target":"")+(R&&R.id===t.id&&R.start?" wx-selected":"")+(Fe(t.id)?" wx-critical":""),N="wx-link wx-right"+(R?" wx-visible":"")+(!R||!T(t.id,!1)&&Qe(t.id)?" wx-target":"")+(R&&R.id===t.id&&!R.start?" wx-selected":"")+(Fe(t.id)?" wx-critical":"");return o.jsxs(e.Fragment,{children:[!t.$skip&&o.jsxs("div",{className:"wx-GKbcLEGA "+m,style:ue(t),"data-tooltip-id":t.id,"data-id":t.id,tabIndex:J===t.id?0:-1,children:[n?null:t.id===Z?.target&&Z?.type[2]==="s"?o.jsx(he.Button,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:o.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):o.jsx("div",{className:"wx-GKbcLEGA "+C,children:o.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),t.type!=="milestone"?o.jsxs(o.Fragment,{children:[t.progress&&!(P&&t.segments)?o.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:o.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${t.progress}%`}})}):null,!n&&!(P&&t.segments)?o.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${t.progress}% - 10px)`},children:t.progress}):null,r?o.jsx(r,{data:t,api:l,onAction:Ue}):P&&t.segments?o.jsx(gt,{task:t,type:Be(t.type)}):o.jsx("div",{className:"wx-GKbcLEGA wx-content",children:t.text||""})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"wx-GKbcLEGA wx-content"}),r?o.jsx(r,{data:t,api:l,onAction:Ue}):o.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:t.text})]}),n?null:t.id===Z?.target&&Z?.type[2]==="e"?o.jsx(he.Button,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:o.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):o.jsx("div",{className:"wx-GKbcLEGA "+N,children:o.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),W&&!t.$skip_baseline?o.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(t.type==="milestone"?" wx-milestone":""),style:ve(t)}):null]},t.id)}),G&&Ze&&o.jsx("div",{className:"wx-GKbcLEGA wx-marquee-selection",style:Ze})]})}function pt(s){const{highlightTime:n}=s,r=e.useContext(De),a=y.useStore(r,"_scales");return o.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:a.width},children:(a?.rows||[]).map((c,$)=>o.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${c.height}px`},children:(c.cells||[]).map((l,p)=>{const w=n?n(l.date,l.unit):"",k="wx-cell "+(l.css||"")+" "+(w||"");return o.jsx("div",{className:"wx-ZkvhDKir "+k,style:{width:`${l.width}px`},children:l.value},p)})},$))})}const bt=new Map;function kt(s){const n=e.useRef(null),r=e.useRef(0),a=e.useRef(null),c=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;n.current===null&&(n.current=performance.now()),r.current++,e.useEffect(()=>{if(c)return cancelAnimationFrame(a.current),a.current=requestAnimationFrame(()=>{const $={label:s,time:performance.now()-n.current,renders:r.current,timestamp:Date.now()};bt.set(s,$),window.dispatchEvent(new CustomEvent("render-metric",{detail:$}))}),()=>cancelAnimationFrame(a.current)})}function yt(s){const{readonly:n,fullWidth:r,fullHeight:a,taskTemplate:c,cellBorders:$,highlightTime:l,multiTaskRows:p=!1,rowMapping:w=null,marqueeSelect:k=!1}=s,d=e.useContext(De),[L,I]=y.useStoreWithCounter(d,"_selected"),S=y.useStore(d,"scrollTop"),W=y.useStore(d,"cellHeight"),u=y.useStore(d,"cellWidth"),A=y.useStore(d,"_scales"),F=y.useStore(d,"_markers"),H=y.useStore(d,"_scrollTask"),X=y.useStore(d,"zoom"),v=y.useStore(d,"_tasks"),[P,b]=e.useState(),O=e.useRef(null),Q=1+(A?.rows?.length||0),se=e.useMemo(()=>{if(!p||!w||!v?.length)return null;const f=new Map,z=new Map,ne=[];return v.forEach(G=>{const V=w.taskRows.get(G.id)??G.id;z.has(V)||(z.set(V,ne.length),ne.push(V))}),v.forEach(G=>{const V=w.taskRows.get(G.id)??G.id,U=z.get(V)??0;f.set(G.id,U*W)}),f},[v,p,w,W]),Y=e.useMemo(()=>{const f=[];return L&&L.length&&W&&L.forEach(z=>{const ne=se?.get(z.id)??z.$y;f.push({height:`${W}px`,top:`${ne-3}px`})}),f},[I,W,se]),ee=e.useMemo(()=>Math.max(P||0,a),[P,a]);e.useEffect(()=>{const f=O.current;f&&typeof S=="number"&&(f.scrollTop=S)},[S]);const R=()=>{M()};function M(f){const z=O.current;if(!z)return;const ne={};ne.left=z.scrollLeft,d.exec("scroll-chart",ne)}function g(){const f=O.current,ne=Math.ceil((P||0)/(W||1))+1,G=Math.floor((f&&f.scrollTop||0)/(W||1)),V=Math.max(0,G-Q),U=G+ne+Q,ke=V*(W||0);d.exec("render-data",{start:V,end:U,from:ke})}e.useEffect(()=>{g()},[P,S]);const _=e.useCallback(f=>{if(!f)return;const{id:z,mode:ne}=f;if(ne.toString().indexOf("x")<0)return;const G=O.current;if(!G)return;const{clientWidth:V}=G,U=d.getTask(z);if(U.$x+U.$w<G.scrollLeft)d.exec("scroll-chart",{left:U.$x-(u||0)}),G.scrollLeft=U.$x-(u||0);else if(U.$x>=V+G.scrollLeft){const ke=V<U.$w?u||0:U.$w;d.exec("scroll-chart",{left:U.$x-V+ke}),G.scrollLeft=U.$x-V+ke}},[d,u]);e.useEffect(()=>{_(H)},[H]);function K(f){if(X&&(f.ctrlKey||f.metaKey)){f.preventDefault();const z=O.current,ne=-Math.sign(f.deltaY),G=f.clientX-(z?z.getBoundingClientRect().left:0);d.exec("zoom-scale",{dir:ne,offset:G})}}function Z(f){const z=l(f.date,f.unit);return z?{css:z,width:f.width}:null}const oe=e.useMemo(()=>A&&(A.minUnit==="hour"||A.minUnit==="day")&&l?A.rows[A.rows.length-1].cells.map(Z):null,[A,l]),re=e.useCallback(f=>{f.eventSource="chart",d.exec("hotkey",f)},[d]);e.useEffect(()=>{const f=O.current;if(!f)return;const z=()=>b(f.clientHeight);z();const ne=new ResizeObserver(()=>z());return ne.observe(f),()=>{ne.disconnect()}},[O.current]);const le=e.useRef(null);return e.useEffect(()=>{const f=O.current;if(f&&!le.current)return le.current=nt.hotkeys(f,{keys:{arrowup:!0,arrowdown:!0},exec:z=>re(z)}),()=>{le.current?.destroy(),le.current=null}},[]),e.useEffect(()=>{const f=O.current;if(!f)return;const z=K;return f.addEventListener("wheel",z),()=>{f.removeEventListener("wheel",z)}},[K]),kt("chart"),o.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:O,onScroll:R,children:[o.jsx(pt,{highlightTime:l,scales:A}),F&&F.length?o.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${ee}px`},children:F.map((f,z)=>o.jsx("div",{className:`wx-mR7v2Xag wx-marker ${f.css||""}`,style:{left:`${f.left}px`},children:o.jsx("div",{className:"wx-mR7v2Xag wx-content",children:f.text})},z))}):null,o.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${r}px`,height:`${ee}px`},children:[oe?o.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:oe.map((f,z)=>f?o.jsx("div",{className:"wx-mR7v2Xag "+f.css,style:{width:`${f.width}px`,left:`${z*f.width}px`}},z):null)}):null,o.jsx(mt,{borders:$}),L&&L.length?L.map((f,z)=>f.$y?o.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":f.id,style:Y[z]},f.id):null):null,o.jsx(wt,{readonly:n,taskTemplate:c,multiTaskRows:p,rowMapping:w,marqueeSelect:k})]})]})}function vt(s){const{position:n="after",size:r=4,dir:a="x",onMove:c,onDisplayChange:$,compactMode:l,containerWidth:p=0,leftThreshold:w=50,rightThreshold:k=50}=s,[d,L]=y.useWritableProp(s.value??0),[I,S]=y.useWritableProp(s.display??"all");function W(oe){let re=0;n=="center"?re=r/2:n=="before"&&(re=r);const le={size:[r+"px","auto"],p:[oe-re+"px","0px"],p2:["auto","0px"]};if(a!="x")for(let f in le)le[f]=le[f].reverse();return le}const[u,A]=e.useState(!1),[F,H]=e.useState(null),X=e.useRef(0),v=e.useRef(),P=e.useRef(),b=e.useRef(I);e.useEffect(()=>{b.current=I},[I]),e.useEffect(()=>{F===null&&d>0&&H(d)},[F,d]);function O(oe){return a=="x"?oe.clientX:oe.clientY}const Q=e.useCallback(oe=>{const re=v.current+O(oe)-X.current;L(re);let le;re<=w?le="chart":p-re<=k?le="grid":le="all",b.current!==le&&(S(le),b.current=le),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>c&&c(re),100)},[p,w,k,c]),se=e.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",A(!1),window.removeEventListener("mousemove",Q),window.removeEventListener("mouseup",se)},[Q]),Y=e.useMemo(()=>I!=="all"?"auto":a=="x"?"ew-resize":"ns-resize",[I,a]),ee=e.useCallback(oe=>{!l&&(I==="grid"||I==="chart")||(X.current=O(oe),v.current=d,A(!0),document.body.style.cursor=Y,document.body.style.userSelect="none",window.addEventListener("mousemove",Q),window.addEventListener("mouseup",se))},[Y,Q,se,d,l,I]);function R(){S("all"),F!==null&&(L(F),c&&c(F))}function M(oe){if(l){const re=I==="chart"?"grid":"chart";S(re),$(re)}else if(I==="grid"||I==="chart")R(),$("all");else{const re=oe==="left"?"chart":"grid";S(re),$(re)}}function g(){M("left")}function _(){M("right")}const K=e.useMemo(()=>W(d),[d,n,r,a]),Z=["wx-resizer",`wx-resizer-${a}`,`wx-resizer-display-${I}`,u?"wx-resizer-active":""].filter(Boolean).join(" ");return o.jsxs("div",{className:"wx-pFykzMlT "+Z,onMouseDown:ee,style:{width:K.size[0],height:K.size[1],cursor:Y},children:[o.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[o.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:o.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:g})}),o.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:o.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:_})})]}),o.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const Tt=650;function ot(s){let n;function r(){n=new ResizeObserver(c=>{for(let $ of c)if($.target===document.body){let l=$.contentRect.width<=Tt;s(l)}}),n.observe(document.body)}function a(){n&&(n.disconnect(),n=null)}return{observe:r,disconnect:a}}function Ct(s){const{taskTemplate:n,readonly:r,cellBorders:a,highlightTime:c,onTableAPIChange:$,multiTaskRows:l=!1,rowMapping:p=null,marqueeSelect:w=!1}=s,k=e.useContext(De),d=y.useStore(k,"_tasks"),L=y.useStore(k,"_scales"),I=y.useStore(k,"cellHeight"),S=y.useStore(k,"columns"),W=y.useStore(k,"_scrollTask"),u=y.useStore(k,"undo"),[A,F]=e.useState(!1);let[H,X]=e.useState(0);const[v,P]=e.useState(0),[b,O]=e.useState(0),[Q,se]=e.useState(void 0),[Y,ee]=e.useState("all"),R=e.useRef(null),M=e.useCallback(E=>{F(J=>(E!==J&&(E?(R.current=Y,Y==="all"&&ee("grid")):(!R.current||R.current==="all")&&ee("all")),E))},[Y]);e.useEffect(()=>{const E=ot(M);return E.observe(),()=>{E.disconnect()}},[M]);const g=e.useMemo(()=>{let E;return S.every(J=>J.width&&!J.flexgrow)?E=S.reduce((J,fe)=>J+parseInt(fe.width),0):A&&Y==="chart"?E=parseInt(S.find(J=>J.id==="action")?.width)||50:E=440,H=E,E},[S,A,Y]);e.useEffect(()=>{X(g)},[g]);const _=e.useMemo(()=>(v??0)-(Q??0),[v,Q]),K=e.useMemo(()=>L.width,[L]),Z=e.useMemo(()=>{if(!l||!p)return d.length*I;const E=new Set;return d.forEach(J=>{const fe=p.taskRows.get(J.id)??J.id;E.add(fe)}),E.size*I},[d,I,l,p]),oe=e.useMemo(()=>L.height+Z+_,[L,Z,_]),re=e.useMemo(()=>H+K,[H,K]),le=e.useRef(null),f=e.useCallback(()=>{Promise.resolve().then(()=>{if((v??0)>(re??0)){const E=(v??0)-H;k.exec("expand-scale",{minWidth:E})}})},[v,re,H,k]);e.useEffect(()=>{let E;return le.current&&(E=new ResizeObserver(f),E.observe(le.current)),()=>{E&&E.disconnect()}},[le.current,f]),e.useEffect(()=>{f()},[K]);const z=e.useRef(null),ne=e.useRef(null),G=e.useCallback(()=>{const E=z.current;E&&k.exec("scroll-chart",{top:E.scrollTop})},[k]),V=e.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});e.useEffect(()=>{V.current={rTasks:d,rScales:L,rCellHeight:I,scrollSize:_,ganttDiv:z.current,ganttHeight:b??0}},[d,L,I,_,b]);const U=e.useCallback(E=>{if(!E)return;const{rTasks:J,rScales:fe,rCellHeight:ye,scrollSize:Te,ganttDiv:Me,ganttHeight:je}=V.current;if(!Me)return;const{id:Ee}=E,ie=J.findIndex(x=>x.id===Ee);if(ie>-1){const x=je-fe.height,B=ie*ye,ae=Me.scrollTop;let j=null;B<ae?j=B:B+ye>ae+x&&(j=B-x+ye+Te),j!==null&&(k.exec("scroll-chart",{top:Math.max(j,0)}),z.current.scrollTop=Math.max(j,0))}},[k]);e.useEffect(()=>{U(W)},[W]),e.useEffect(()=>{const E=z.current,J=ne.current;if(!E||!J)return;const fe=()=>{it.flushSync(()=>{O(E.offsetHeight),P(E.offsetWidth),se(J.offsetWidth)})},ye=new ResizeObserver(fe);return ye.observe(E),()=>ye.disconnect()},[z.current]);const ke=e.useRef(null),we=e.useRef(null);return e.useEffect(()=>{we.current&&(we.current.destroy(),we.current=null);const E=ke.current;if(E)return we.current=nt.hotkeys(E,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,"meta+c":!0,"meta+v":!0,"meta+x":!0,"meta+d":!0,backspace:!0,"ctrl+z":u,"ctrl+y":u,"meta+z":u,"meta+shift+z":u},exec:J=>{J.isInput||k.exec("hotkey",J)}}),()=>{we.current?.destroy(),we.current=null}},[u]),o.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:z,onScroll:G,children:o.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:oe,width:"100%"},ref:ne,children:o.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:b,width:Q},children:o.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:ke,children:[S.length?o.jsxs(o.Fragment,{children:[o.jsx(xt,{display:Y,compactMode:A,columnWidth:g,width:H,readonly:r,fullHeight:Z,onTableAPIChange:$,multiTaskRows:l,rowMapping:p}),o.jsx(vt,{value:H,display:Y,compactMode:A,containerWidth:v,onMove:E=>X(E),onDisplayChange:E=>ee(E)})]}):null,o.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:le,children:o.jsx(yt,{readonly:r,fullWidth:K,fullHeight:Z,taskTemplate:n,cellBorders:a,highlightTime:c,multiTaskRows:l,rowMapping:p,marqueeSelect:w})})]})})})})}function Mt(s){return{year:"%Y",quarter:`${s("Q")} %Q`,month:"%M",week:`${s("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function St(s,n){return typeof s=="function"?s:be.dateToString(s,n)}function lt(s,n){return s.map(({format:r,...a})=>({...a,format:St(r,n)}))}function Et(s,n){const r=Mt(n);for(let a in r)r[a]=be.dateToString(r[a],s);return r}function Rt(s,n){if(!s||!s.length)return s;const r=be.dateToString("%d-%m-%Y",n);return s.map(a=>a.template?a:a.id==="start"||a.id=="end"?{...a,_template:c=>r(c),template:c=>r(c)}:a.id==="duration"?{...a,_template:c=>c,template:c=>c}:a)}function jt(s,n){return s.levels?{...s,levels:s.levels.map(r=>({...r,scales:lt(r.scales,n)}))}:s}const $t=s=>s.split("-").map(n=>n?n.charAt(0).toUpperCase()+n.slice(1):"").join(""),Lt=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],Nt=e.forwardRef(function({taskTemplate:n=null,markers:r=[],taskTypes:a=de.defaultTaskTypes,tasks:c=[],selected:$=[],activeTask:l=null,links:p=[],scales:w=Lt,columns:k=de.defaultColumns,start:d=null,end:L=null,lengthUnit:I="day",durationUnit:S="day",cellWidth:W=100,cellHeight:u=38,scaleHeight:A=36,readonly:F=!1,cellBorders:H="full",zoom:X=!1,baselines:v=!1,highlightTime:P=null,init:b=null,autoScale:O=!0,unscheduledTasks:Q=!1,criticalPath:se=null,schedule:Y={type:"forward"},projectStart:ee=null,projectEnd:R=null,calendar:M=null,undo:g=!1,splitTasks:_=!1,multiTaskRows:K=!1,marqueeSelect:Z=!1,...oe},re){const le=e.useRef();le.current=oe;const f=e.useMemo(()=>new de.DataStore(y.writable),[]),z=e.useMemo(()=>({...Ke.en,...qe.en}),[]),ne=e.useContext(he.context.i18n),G=e.useMemo(()=>ne?ne.extend(z,!0):be.locale(z),[ne,z]),V=e.useMemo(()=>G.getRaw().calendar,[G]),U=e.useMemo(()=>{let ie={zoom:jt(X,V),scales:lt(w,V),columns:Rt(k,V),links:de.normalizeLinks(p),cellWidth:W};return ie.zoom&&(ie={...ie,...de.normalizeZoom(ie.zoom,Et(V,G.getGroup("gantt")),ie.scales,W)}),ie},[X,w,k,p,W,V,G]),ke=e.useRef(null);ke.current!==c&&(de.parseTaskDates(c,{durationUnit:S,splitTasks:_,calendar:M}),ke.current=c),e.useEffect(()=>{de.parseTaskDates(c,{durationUnit:S,splitTasks:_,calendar:M})},[c,S,M,_]);const we=e.useMemo(()=>{if(!K)return null;const ie=new Map,x=new Map,B=ae=>{ae.forEach(j=>{const ge=j.row??j.id;x.set(j.id,ge),ie.has(ge)||ie.set(ge,[]),ie.get(ge).push(j.id),j.data&&j.data.length>0&&B(j.data)})};return B(c),{rowMap:ie,taskRows:x}},[c,K]),E=e.useMemo(()=>f.in,[f]),J=e.useRef(null);J.current===null&&(J.current=new ct.EventBusRouter((ie,x)=>{const B="on"+$t(ie);le.current&&le.current[B]&&le.current[B](x)}),E.setNext(J.current));const[fe,ye]=e.useState(null),Te=e.useRef(null);Te.current=fe;const Me=e.useMemo(()=>({getState:f.getState.bind(f),getReactiveState:f.getReactive.bind(f),getStores:()=>({data:f}),exec:E.exec,setNext:ie=>(J.current=J.current.setNext(ie),J.current),intercept:E.intercept.bind(E),on:E.on.bind(E),detach:E.detach.bind(E),getTask:f.getTask.bind(f),serialize:f.serialize.bind(f),getTable:ie=>ie?new Promise(x=>setTimeout(()=>x(Te.current),1)):Te.current,getHistory:()=>f.getHistory()}),[f,E]);e.useImperativeHandle(re,()=>({...Me}),[Me]);const je=e.useRef(0);e.useEffect(()=>{je.current?f.init({tasks:c,links:U.links,start:d,columns:U.columns,end:L,lengthUnit:I,cellWidth:U.cellWidth,cellHeight:u,scaleHeight:A,scales:U.scales,taskTypes:a,zoom:U.zoom,selected:$,activeTask:l,baselines:v,autoScale:O,unscheduledTasks:Q,markers:r,durationUnit:S,criticalPath:se,schedule:Y,projectStart:ee,projectEnd:R,calendar:M,undo:g,_weekStart:V.weekStart,splitTasks:_}):b&&b(Me),je.current++},[Me,b,c,U,d,L,I,u,A,a,$,l,v,O,Q,r,S,se,Y,ee,R,M,g,V,_,f]),je.current===0&&f.init({tasks:c,links:U.links,start:d,columns:U.columns,end:L,lengthUnit:I,cellWidth:U.cellWidth,cellHeight:u,scaleHeight:A,scales:U.scales,taskTypes:a,zoom:U.zoom,selected:$,activeTask:l,baselines:v,autoScale:O,unscheduledTasks:Q,markers:r,durationUnit:S,criticalPath:se,schedule:Y,projectStart:ee,projectEnd:R,calendar:M,undo:g,_weekStart:V.weekStart,splitTasks:_});const Ee=e.useMemo(()=>M?(ie,x)=>x=="day"&&!M.getDayHours(ie)||x=="hour"&&!M.getDayHours(ie)?"wx-weekend":"":P,[M,P]);return o.jsx(he.context.i18n.Provider,{value:G,children:o.jsx(De.Provider,{value:Me,children:o.jsx(Ct,{taskTemplate:n,readonly:F,cellBorders:H,highlightTime:Ee,onTableAPIChange:ye,multiTaskRows:K,rowMapping:we,marqueeSelect:Z})})})});function It({api:s=null,items:n=[]}){const r=e.useContext(he.context.i18n),a=e.useMemo(()=>r||be.locale(qe.en),[r]),c=e.useMemo(()=>a.getGroup("gantt"),[a]),$=y.useStoreLater(s,"_selected"),l=y.useStoreLater(s,"undo"),p=y.useStoreLater(s,"history"),w=y.useStoreLater(s,"splitTasks"),k=["undo","redo"],d=e.useMemo(()=>{const I=de.getToolbarButtons({undo:!0,splitTasks:!0});return(n.length?n:de.getToolbarButtons({undo:l,splitTasks:w})).map(W=>{let u={...W,disabled:!1};return u.handler=de.isHandledAction(I,u.id)?A=>de.handleAction(s,A.id,null,c):u.handler,u.text&&(u.text=c(u.text)),u.menuText&&(u.menuText=c(u.menuText)),u})},[n,s,c,l,w]),L=e.useMemo(()=>{const I=[];return d.forEach(S=>{const W=S.id;if(W==="add-task")I.push(S);else if(k.includes(W))k.includes(W)&&I.push({...S,disabled:S.isDisabled(p)});else{if(!$?.length||!s)return;I.push({...S,disabled:S.isDisabled&&$.some(u=>S.isDisabled(u,s.getState()))})}}),I.filter((S,W)=>{if(s&&S.isHidden)return!$.some(u=>S.isHidden(u,s.getState()));if(S.comp==="separator"){const u=I[W+1];if(!u||u.comp==="separator")return!1}return!0})},[s,$,p,d]);return r?o.jsx(Je.Toolbar,{items:L}):o.jsx(he.context.i18n.Provider,{value:a,children:o.jsx(Je.Toolbar,{items:L})})}const Dt=e.forwardRef(function({options:n=[],api:r=null,resolver:a=null,filter:c=null,at:$="point",children:l,onClick:p,css:w},k){const d=e.useRef(null),L=e.useRef(null),I=e.useContext(he.context.i18n),S=e.useMemo(()=>I||be.locale({...qe.en,...Ke.en}),[I]),W=e.useMemo(()=>S.getGroup("gantt"),[S]),u=y.useStoreLater(r,"taskTypes"),A=y.useStoreLater(r,"selected"),F=y.useStoreLater(r,"_selected"),H=y.useStoreLater(r,"splitTasks"),X=e.useMemo(()=>de.getMenuOptions({splitTasks:!0}),[]);e.useEffect(()=>{r&&(r.on("scroll-chart",()=>{d.current&&d.current.show&&d.current.show()}),r.on("drag-task",()=>{d.current&&d.current.show&&d.current.show()}))},[r]);function v(M){return M.map(g=>(g={...g},g.text&&(g.text=W(g.text)),g.subtext&&(g.subtext=W(g.subtext)),g.data&&(g.data=v(g.data)),g))}function P(){const M=n.length?n:de.getMenuOptions({splitTasks:H}),g=M.find(_=>_.id==="convert-task");return g&&(g.data=[],(u||[]).forEach(_=>{g.data.push(g.dataFactory(_))})),v(M)}const b=e.useMemo(()=>P(),[r,n,u,H,W]),O=e.useMemo(()=>F&&F.length?F:[],[F]),Q=e.useCallback((M,g)=>{let _=M?r?.getTask(M):null;if(a){const K=a(M,g);_=K===!0?_:K}if(_){const K=be.locateID(g.target,"data-segment");K!==null?L.current={id:_.id,segmentIndex:K}:L.current=_.id,(!Array.isArray(A)||!A.includes(_.id))&&r&&r.exec&&r.exec("select-task",{id:_.id})}return _},[r,a,A]),se=e.useCallback(M=>{const g=M.action;g&&(de.isHandledAction(X,g.id)&&de.handleAction(r,g.id,L.current,W),p&&p(M))},[r,W,p,X]),Y=e.useCallback((M,g)=>{const _=O.length?O:g?[g]:[];let K=c?_.every(Z=>c(M,Z)):!0;if(K&&(M.isHidden&&(K=!_.some(Z=>M.isHidden(Z,r.getState(),L.current))),M.isDisabled)){const Z=_.some(oe=>M.isDisabled(oe,r.getState(),L.current));M.disabled=Z}return K},[c,O,r]);e.useImperativeHandle(k,()=>({show:(M,g)=>{d.current&&d.current.show&&d.current.show(M,g)}}));const ee=e.useCallback(M=>{d.current&&d.current.show&&d.current.show(M)},[]),R=o.jsxs(o.Fragment,{children:[o.jsx(at.ContextMenu,{filter:Y,options:b,dataKey:"id",resolver:Q,onClick:se,at:$,ref:d,css:w}),o.jsx("span",{onContextMenu:ee,"data-menu-ignore":"true",children:typeof l=="function"?l():l})]});if(!I&&he.context.i18n?.Provider){const M=he.context.i18n.Provider;return o.jsx(M,{value:S,children:R})}return R});function At({api:s,autoSave:n,onLinksChange:r}){const c=e.useContext(he.context.i18n).getGroup("gantt"),$=y.useStore(s,"activeTask"),l=y.useStore(s,"_activeTask"),p=y.useStore(s,"_links"),w=y.useStore(s,"schedule"),k=y.useStore(s,"unscheduledTasks"),[d,L]=e.useState();function I(){if($){const A=p.filter(H=>H.target==$).map(H=>({link:H,task:s.getTask(H.source)})),F=p.filter(H=>H.source==$).map(H=>({link:H,task:s.getTask(H.target)}));return[{title:c("Predecessors"),data:A},{title:c("Successors"),data:F}]}}e.useEffect(()=>{L(I())},[$,p]);const S=e.useMemo(()=>[{id:"e2s",label:c("End-to-start")},{id:"s2s",label:c("Start-to-start")},{id:"e2e",label:c("End-to-end")},{id:"s2e",label:c("Start-to-end")}],[c]);function W(A){n?s.exec("delete-link",{id:A}):(L(F=>(F||[]).map(H=>({...H,data:H.data.filter(X=>X.link.id!==A)}))),r&&r({id:A,action:"delete-link",data:{id:A}}))}function u(A,F){n?s.exec("update-link",{id:A,link:F}):(L(H=>(H||[]).map(X=>({...X,data:X.data.map(v=>v.link.id===A?{...v,link:{...v.link,...F}}:v)}))),r&&r({id:A,action:"update-link",data:{id:A,link:F}}))}return o.jsx(o.Fragment,{children:(d||[]).map((A,F)=>A.data.length?o.jsx("div",{className:"wx-j93aYGQf wx-links",children:o.jsx(he.Field,{label:A.title,position:"top",children:o.jsx("table",{children:o.jsx("tbody",{children:A.data.map(H=>o.jsxs("tr",{children:[o.jsx("td",{className:"wx-j93aYGQf wx-cell",children:o.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:H.task.text||""})}),w?.auto&&H.link.type==="e2s"?o.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:o.jsx(he.Text,{type:"number",placeholder:c("Lag"),value:H.link.lag,disabled:k&&l?.unscheduled,onChange:X=>{X.input||u(H.link.id,{lag:X.value})}})}):null,o.jsx("td",{className:"wx-j93aYGQf wx-cell",children:o.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:o.jsx(he.Combo,{value:H.link.type,placeholder:c("Select link type"),options:S,onChange:X=>u(H.link.id,{type:X.value}),children:({option:X})=>X.label})})}),o.jsx("td",{className:"wx-j93aYGQf wx-cell",children:o.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>W(H.link.id),role:"button"})})]},H.link.id))})})})},F):null)})}function Ht(s){const{value:n,time:r,format:a,onchange:c,onChange:$,...l}=s,p=$??c;function w(k){const d=new Date(k.value);d.setHours(n.getHours()),d.setMinutes(n.getMinutes()),p&&p({value:d})}return o.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[o.jsx(he.DatePicker,{...l,value:n,onChange:w,format:a,buttons:["today"],clear:!1}),r?o.jsx(he.TimePicker,{value:n,onChange:p,format:a}):null]})}Ie.registerEditorItem("select",he.RichSelect);Ie.registerEditorItem("date",Ht);Ie.registerEditorItem("twostate",he.TwoState);Ie.registerEditorItem("slider",he.Slider);Ie.registerEditorItem("counter",he.Counter);Ie.registerEditorItem("links",At);function Pt({api:s,items:n=[],css:r="",layout:a="default",readonly:c=!1,placement:$="sidebar",bottomBar:l=!0,topBar:p=!0,autoSave:w=!0,focus:k=!1,hotkeys:d={}}){const L=e.useContext(he.context.i18n),I=e.useMemo(()=>L||be.locale({...qe.en,...Ke.en}),[L]),S=e.useMemo(()=>I.getGroup("gantt"),[I]),W=I.getRaw(),u=e.useMemo(()=>{const x=W.gantt?.dateFormat||W.formats?.dateFormat;return be.dateToString(x,W.calendar)},[W]),A=e.useMemo(()=>{if(p===!0&&!c){const x=[{comp:"icon",icon:"wxi-close",id:"close"},{comp:"spacer"},{comp:"button",type:"danger",text:S("Delete"),id:"delete"}];return w?{items:x}:{items:[...x,{comp:"button",type:"primary",text:S("Save"),id:"save"}]}}return p},[p,c,w,S]),[F,H]=e.useState(!1),X=e.useMemo(()=>F?"wx-full-screen":"",[F]),v=e.useCallback(x=>{H(x)},[]);e.useEffect(()=>{const x=ot(v);return x.observe(),()=>{x.disconnect()}},[v]);const P=y.useStore(s,"_activeTask"),b=y.useStore(s,"activeTask"),O=y.useStore(s,"unscheduledTasks"),Q=y.useStore(s,"links"),se=y.useStore(s,"splitTasks"),Y=e.useMemo(()=>se&&b?.segmentIndex,[se,b]),ee=e.useMemo(()=>Y||Y===0,[Y]),R=e.useMemo(()=>de.getEditorItems({unscheduledTasks:O}),[O]),M=y.useStore(s,"undo"),[g,_]=e.useState({}),[K,Z]=e.useState(null),[oe,re]=e.useState(),[le,f]=e.useState(null),z=y.useStore(s,"taskTypes"),ne=e.useMemo(()=>{if(!P)return null;let x;if(ee&&P.segments?x={...P.segments[Y]}:x={...P},c){let B={parent:x.parent};return R.forEach(({key:ae,comp:j})=>{if(j!=="links"){const ge=x[ae];j==="date"&&ge instanceof Date?B[ae]=u(ge):j==="slider"&&ae==="progress"?B[ae]=`${ge}%`:B[ae]=ge}}),B}return x||null},[P,ee,Y,c,R,u]);e.useEffect(()=>{re(ne)},[ne]),e.useEffect(()=>{_({}),f(null),Z(null)},[b]);function G(x,B){return x.map(ae=>{const j={...ae};if(ae.config&&(j.config={...j.config}),j.comp==="links"&&s&&(j.api=s,j.autoSave=w,j.onLinksChange=ke),j.comp==="select"&&j.key==="type"){const ge=j.options??(z||[]);j.options=ge.map($e=>({...$e,label:S($e.label)}))}return j.comp==="slider"&&j.key==="progress"&&(j.labelTemplate=ge=>`${S(j.label)} ${ge}%`),j.label&&(j.label=S(j.label)),j.config?.placeholder&&(j.config.placeholder=S(j.config.placeholder)),B&&(j.isDisabled&&j.isDisabled(B,s.getState())?j.disabled=!0:delete j.disabled),j})}const V=e.useMemo(()=>{let x=n.length?n:R;return x=G(x,oe),oe?x.filter(B=>!B.isHidden||!B.isHidden(oe,s.getState())):x},[n,R,oe,z,S,s,w]),U=e.useMemo(()=>V.map(x=>x.key),[V]);function ke({id:x,action:B,data:ae}){_(j=>({...j,[x]:{action:B,data:ae}}))}const we=e.useCallback(()=>{for(let x in g)if(Q.byId(x)){const{action:B,data:ae}=g[x];s.exec(B,ae)}},[s,g,Q]),E=e.useCallback(()=>{const x=b?.id||b;if(ee){if(P?.segments){const B=P.segments.filter((ae,j)=>j!==Y);s.exec("update-task",{id:x,task:{segments:B}})}}else s.exec("delete-task",{id:x})},[s,b,ee,P,Y]),J=e.useCallback(()=>{s.exec("show-editor",{id:null})},[s]),fe=e.useCallback(x=>{const{item:B,changes:ae}=x;B.id==="delete"&&E(),B.id==="save"&&(ae.length?J():we()),B.comp&&J()},[s,b,w,we,E,J]),ye=e.useCallback((x,B,ae)=>(O&&x.type==="summary"&&(x.unscheduled=!1),de.prepareEditTask(x,s.getState(),B),ae||Z(!1),x),[O,s]),Te=e.useCallback(x=>{x={...x,unscheduled:O&&x.unscheduled&&x.type!=="summary"},delete x.links,delete x.data,(U.indexOf("duration")===-1||x.segments&&!x.duration)&&delete x.duration;const B={id:b?.id||b,task:x,...ee&&{segmentIndex:Y}};w&&K&&(B.inProgress=K),s.exec("update-task",B),w||we()},[s,b,O,w,we,U,ee,Y,K]),Me=e.useCallback(x=>{let{update:B,key:ae,input:j}=x;if(j&&Z(!0),x.update=ye({...B},ae,j),!w)re(x.update);else if(!le&&!j){const ge=V.find(Pe=>Pe.key===ae),$e=B[ae];(!ge.validation||ge.validation($e))&&(!ge.required||$e)&&Te(x.update)}},[w,ye,le,V,Te]),je=e.useCallback(x=>{w||Te(x.values)},[w,Te]),Ee=e.useCallback(x=>{f(x.errors)},[]),ie=e.useMemo(()=>M?{"ctrl+z":x=>{x.preventDefault(),s.exec("undo")},"ctrl+y":x=>{x.preventDefault(),s.exec("redo")}}:{},[M,s]);return ne?o.jsx(he.Locale,{children:o.jsx(Ie.Editor,{css:`wx-XkvqDXuw wx-gantt-editor ${X} ${r}`,items:V,values:ne,topBar:A,bottomBar:l,placement:$,layout:a,readonly:c,autoSave:w,focus:k,onAction:fe,onSave:je,onValidation:Ee,onChange:Me,hotkeys:d&&{...ie,...d}})}):null}const zt=({children:s,columns:n=null,api:r})=>{const[a,c]=e.useState(null);return e.useEffect(()=>{r&&r.getTable(!0).then(c)},[r]),o.jsx(rt.HeaderMenu,{api:a,columns:n,children:s})};function Gt(s){const{api:n,content:r,children:a}=s,c=e.useRef(null),$=e.useRef(null),[l,p]=e.useState({}),[w,k]=e.useState(null),[d,L]=e.useState({});function I(v){for(;v;){if(v.getAttribute){const P=v.getAttribute("data-tooltip-id"),b=v.getAttribute("data-tooltip-at"),O=v.getAttribute("data-tooltip");if(P||O)return{id:P,tooltip:O,target:v,at:b}}v=v.parentNode}return{id:null,tooltip:null,target:null,at:null}}e.useEffect(()=>{const v=$.current;if(v&&d&&(d.text||r)){const P=v.getBoundingClientRect();let b=!1,O=d.left,Q=d.top;P.right>=l.right&&(O=l.width-P.width-5,b=!0),P.bottom>=l.bottom&&(Q=d.top-(P.bottom-l.bottom+2),b=!0),b&&L(se=>se&&{...se,left:O,top:Q})}},[d,l,r]);const S=e.useRef(null),W=300,u=v=>{clearTimeout(S.current),S.current=setTimeout(()=>{v()},W)};function A(v){let{id:P,tooltip:b,target:O,at:Q}=I(v.target);if(L(null),k(null),!b)if(P)b=H(P);else{clearTimeout(S.current);return}const se=v.clientX;u(()=>{P&&k(F(X(P)));const Y=O.getBoundingClientRect(),ee=c.current,R=ee?ee.getBoundingClientRect():{top:0,left:0,right:0,bottom:0,width:0,height:0};let M,g;Q==="left"?(M=Y.top+5-R.top,g=Y.right+5-R.left):(M=Y.top+Y.height-R.top,g=se-R.left),p(R),L({top:M,left:g,text:b})})}function F(v){return n?.getTask(X(v))||null}function H(v){return F(v)?.text||""}function X(v){const P=parseInt(v);return isNaN(P)?v:P}return o.jsxs("div",{className:"wx-KG0Lwsqo wx-tooltip-area",ref:c,onMouseMove:A,children:[d&&(d.text||r)?o.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip",ref:$,style:{top:`${d.top}px`,left:`${d.left}px`},children:r?o.jsx(r,{data:w}):d.text?o.jsx("div",{className:"wx-KG0Lwsqo wx-gantt-tooltip-text",children:d.text}):null}):null,a]})}function Wt({fonts:s=!0,children:n}){return n?o.jsx(he.Material,{fonts:s,children:n()}):o.jsx(he.Material,{fonts:s})}function _t({fonts:s=!0,children:n}){return n?o.jsx(he.Willow,{fonts:s,children:n}):o.jsx(he.Willow,{fonts:s})}function Ot({fonts:s=!0,children:n}){return n?o.jsx(he.WillowDark,{fonts:s,children:n}):o.jsx(he.WillowDark,{fonts:s})}Object.defineProperty(exports,"defaultColumns",{enumerable:!0,get:()=>de.defaultColumns});Object.defineProperty(exports,"defaultEditorItems",{enumerable:!0,get:()=>de.defaultEditorItems});Object.defineProperty(exports,"defaultMenuOptions",{enumerable:!0,get:()=>de.defaultMenuOptions});Object.defineProperty(exports,"defaultTaskTypes",{enumerable:!0,get:()=>de.defaultTaskTypes});Object.defineProperty(exports,"defaultToolbarButtons",{enumerable:!0,get:()=>de.defaultToolbarButtons});Object.defineProperty(exports,"getEditorItems",{enumerable:!0,get:()=>de.getEditorItems});Object.defineProperty(exports,"getMenuOptions",{enumerable:!0,get:()=>de.getMenuOptions});Object.defineProperty(exports,"getToolbarButtons",{enumerable:!0,get:()=>de.getToolbarButtons});Object.defineProperty(exports,"registerScaleUnit",{enumerable:!0,get:()=>de.registerScaleUnit});Object.defineProperty(exports,"registerEditorItem",{enumerable:!0,get:()=>Ie.registerEditorItem});exports.ContextMenu=Dt;exports.Editor=Pt;exports.Gantt=Nt;exports.HeaderMenu=zt;exports.Material=Wt;exports.Toolbar=It;exports.Tooltip=Gt;exports.Willow=_t;exports.WillowDark=Ot;
//# sourceMappingURL=index.cjs.map
